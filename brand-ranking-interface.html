<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>📊 Brand Ranking System - Excel Style Interface</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
        }
        
        .header p {
            text-align: center;
            color: #666;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            margin: 20px;
            border-radius: 15px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .filter-group label {
            color: white;
            font-weight: 600;
            white-space: nowrap;
        }
        
        .filter-group select,
        .filter-group input {
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            background: rgba(255,255,255,0.9);
            color: #333;
            font-size: 14px;
            min-width: 120px;
        }
        
        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn.secondary {
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(5px);
        }
        
        .table-container {
            margin: 20px;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .excel-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        
        .excel-table th {
            background: linear-gradient(45deg, #2c3e50, #34495e);
            color: white;
            padding: 15px 12px;
            text-align: left;
            font-weight: 700;
            position: sticky;
            top: 0;
            z-index: 10;
            cursor: pointer;
            user-select: none;
            border-bottom: 2px solid #fff;
        }
        
        .excel-table th:hover {
            background: linear-gradient(45deg, #34495e, #2c3e50);
        }
        
        .excel-table th.sortable::after {
            content: ' ⇅';
            opacity: 0.5;
            font-size: 12px;
        }
        
        .excel-table th.sort-asc::after {
            content: ' ↑';
            opacity: 1;
            color: #3498db;
        }
        
        .excel-table th.sort-desc::after {
            content: ' ↓';
            opacity: 1;
            color: #3498db;
        }
        
        .excel-table td {
            padding: 12px;
            border-bottom: 1px solid #eee;
            vertical-align: top;
        }
        
        .excel-table tbody tr {
            transition: all 0.2s ease;
        }
        
        .excel-table tbody tr:hover {
            background: #f8f9fa;
            transform: scale(1.001);
        }
        
        .excel-table tbody tr:nth-child(even) {
            background: #fafafa;
        }
        
        .excel-table tbody tr:nth-child(even):hover {
            background: #f0f0f0;
        }
        
        /* Column-specific styling */
        .col-rank {
            text-align: center;
            font-weight: bold;
            width: 60px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }
        
        .col-title {
            min-width: 200px;
            font-weight: 600;
        }
        
        .col-category {
            text-align: center;
            width: 100px;
        }
        
        .col-score {
            text-align: center;
            width: 80px;
            font-weight: bold;
        }
        
        .col-votes {
            text-align: center;
            width: 80px;
        }
        
        .col-status {
            text-align: center;
            width: 100px;
        }
        
        .col-date {
            width: 120px;
            font-size: 12px;
            color: #666;
        }
        
        /* Score styling */
        .score-excellent { color: #27ae60; font-weight: bold; }
        .score-good { color: #f39c12; font-weight: bold; }
        .score-average { color: #e74c3c; }
        .score-poor { color: #c0392b; }
        
        /* Status badges */
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-submitted { background: #3498db; color: white; }
        .status-analyzing { background: #f39c12; color: white; }
        .status-approved { background: #27ae60; color: white; }
        .status-implemented { background: #8e44ad; color: white; }
        .status-rejected { background: #e74c3c; color: white; }
        
        /* Category icons */
        .category-icon {
            font-size: 16px;
            margin-right: 5px;
        }
        
        /* Voting interface */
        .vote-controls {
            display: flex;
            align-items: center;
            gap: 5px;
            justify-content: center;
        }
        
        .vote-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            padding: 2px 4px;
            border-radius: 3px;
            transition: all 0.2s ease;
        }
        
        .vote-btn:hover {
            background: #f0f0f0;
            transform: scale(1.1);
        }
        
        .vote-up:hover { background: #27ae60; color: white; }
        .vote-down:hover { background: #e74c3c; color: white; }
        
        /* Rating stars */
        .star-rating {
            display: flex;
            gap: 2px;
            align-items: center;
        }
        
        .star {
            cursor: pointer;
            font-size: 16px;
            color: #ddd;
            transition: color 0.2s ease;
        }
        
        .star.active,
        .star:hover {
            color: #ffd700;
        }
        
        /* Magnetism meter */
        .magnetism-meter {
            width: 60px;
            height: 8px;
            background: #eee;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }
        
        .magnetism-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.3s ease;
        }
        
        /* Progress bars for different scores */
        .progress-bar {
            width: 50px;
            height: 6px;
            background: #eee;
            border-radius: 3px;
            overflow: hidden;
            margin: 2px 0;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.3s ease;
        }
        
        .progress-magnetism { background: linear-gradient(45deg, #ff6b6b, #ffd93d); }
        .progress-feasibility { background: linear-gradient(45deg, #4ecdc4, #44a08d); }
        .progress-impact { background: linear-gradient(45deg, #667eea, #764ba2); }
        .progress-originality { background: linear-gradient(45deg, #f093fb, #f5576c); }
        
        /* Statistics panel */
        .stats-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px;
        }
        
        .stat-card {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .stat-card h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }
        
        .stat-label {
            font-size: 12px;
            color: #666;
        }
        
        /* Responsive design */
        @media (max-width: 1200px) {
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filter-group {
                justify-content: center;
            }
        }
        
        @media (max-width: 768px) {
            .excel-table {
                font-size: 12px;
            }
            
            .excel-table th,
            .excel-table td {
                padding: 8px 6px;
            }
            
            .col-title {
                min-width: 150px;
            }
            
            .stats-panel {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
        }
        
        /* Loading states */
        .loading {
            text-align: center;
            padding: 50px;
            color: white;
        }
        
        .spinner {
            border: 3px solid rgba(255,255,255,0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Modal for detailed voting */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            margin: 50px auto;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .voting-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .voting-category {
            text-align: center;
        }
        
        .voting-category h4 {
            margin-bottom: 10px;
            color: #333;
        }
        
        /* Export styles */
        .export-controls {
            display: flex;
            gap: 10px;
            margin-left: auto;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>📊 Brand Ranking System</h1>
        <p>Excel-style interface for ranking and evaluating brand ideas</p>
    </div>
    
    <!-- Statistics Panel -->
    <div class="stats-panel" id="statsPanel">
        <!-- Stats loaded dynamically -->
    </div>
    
    <!-- Controls -->
    <div class="controls">
        <div class="filter-group">
            <label>Category:</label>
            <select id="categoryFilter">
                <option value="">All Categories</option>
                <option value="game">🎮 Games</option>
                <option value="service">⚙️ Services</option>
                <option value="domain">🌐 Domains</option>
                <option value="ai">🤖 AI</option>
                <option value="tool">🔧 Tools</option>
                <option value="community">👥 Community</option>
            </select>
            
            <label>Status:</label>
            <select id="statusFilter">
                <option value="">All Status</option>
                <option value="submitted">Submitted</option>
                <option value="analyzing">Analyzing</option>
                <option value="approved">Approved</option>
                <option value="implemented">Implemented</option>
                <option value="rejected">Rejected</option>
            </select>
            
            <label>Min Score:</label>
            <input type="number" id="minScoreFilter" min="0" max="100" placeholder="0">
            
            <label>Search:</label>
            <input type="text" id="searchFilter" placeholder="Search titles...">
        </div>
        
        <div class="export-controls">
            <button class="btn secondary" onclick="refreshData()">🔄 Refresh</button>
            <button class="btn secondary" onclick="exportToCSV()">📊 Export CSV</button>
            <button class="btn secondary" onclick="exportToJSON()">📁 Export JSON</button>
            <button class="btn" onclick="openBulkVotingModal()">🗳️ Bulk Vote</button>
        </div>
    </div>
    
    <!-- Loading -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
        Loading brand ideas...
    </div>
    
    <!-- Excel-style Table -->
    <div class="table-container" id="tableContainer" style="display: none;">
        <table class="excel-table">
            <thead>
                <tr>
                    <th class="col-rank sortable" data-sort="rank">#</th>
                    <th class="col-title sortable" data-sort="title">Title</th>
                    <th class="col-category sortable" data-sort="category">Category</th>
                    <th class="col-score sortable" data-sort="composite_score">
                        <div>Total Score</div>
                        <div style="font-size: 10px; opacity: 0.7;">Composite</div>
                    </th>
                    <th class="col-score sortable" data-sort="magnetism_score">
                        <div>Magnetism</div>
                        <div style="font-size: 10px; opacity: 0.7;">Cultural Appeal</div>
                    </th>
                    <th class="col-votes sortable" data-sort="votes">
                        <div>Votes</div>
                        <div style="font-size: 10px; opacity: 0.7;">Count</div>
                    </th>
                    <th class="col-score sortable" data-sort="vote_score">
                        <div>Rating</div>
                        <div style="font-size: 10px; opacity: 0.7;">Avg Score</div>
                    </th>
                    <th class="col-score sortable" data-sort="feasibility_score">
                        <div>Feasibility</div>
                        <div style="font-size: 10px; opacity: 0.7;">Can Build</div>
                    </th>
                    <th class="col-score sortable" data-sort="impact_score">
                        <div>Impact</div>
                        <div style="font-size: 10px; opacity: 0.7;">Potential</div>
                    </th>
                    <th class="col-score sortable" data-sort="originality_score">
                        <div>Originality</div>
                        <div style="font-size: 10px; opacity: 0.7;">Uniqueness</div>
                    </th>
                    <th class="col-status sortable" data-sort="status">Status</th>
                    <th class="col-date sortable" data-sort="submitted_at">Submitted</th>
                    <th class="col-votes">Actions</th>
                </tr>
            </thead>
            <tbody id="brandTableBody">
                <!-- Rows loaded dynamically -->
            </tbody>
        </table>
    </div>
    
    <!-- Detailed Voting Modal -->
    <div class="modal" id="votingModal">
        <div class="modal-content">
            <h2 id="votingIdeaTitle">Vote on Idea</h2>
            <div id="votingIdeaDescription"></div>
            
            <div class="voting-grid">
                <div class="voting-category">
                    <h4>🧲 Magnetism</h4>
                    <div class="star-rating" data-category="magnetism">
                        <span class="star" data-value="1">★</span>
                        <span class="star" data-value="2">★</span>
                        <span class="star" data-value="3">★</span>
                        <span class="star" data-value="4">★</span>
                        <span class="star" data-value="5">★</span>
                    </div>
                    <p>How appealing is this brand?</p>
                </div>
                
                <div class="voting-category">
                    <h4>🔧 Feasibility</h4>
                    <div class="star-rating" data-category="feasibility">
                        <span class="star" data-value="1">★</span>
                        <span class="star" data-value="2">★</span>
                        <span class="star" data-value="3">★</span>
                        <span class="star" data-value="4">★</span>
                        <span class="star" data-value="5">★</span>
                    </div>
                    <p>How feasible is implementation?</p>
                </div>
                
                <div class="voting-category">
                    <h4>🚀 Impact</h4>
                    <div class="star-rating" data-category="impact">
                        <span class="star" data-value="1">★</span>
                        <span class="star" data-value="2">★</span>
                        <span class="star" data-value="3">★</span>
                        <span class="star" data-value="4">★</span>
                        <span class="star" data-value="5">★</span>
                    </div>
                    <p>What's the potential impact?</p>
                </div>
                
                <div class="voting-category">
                    <h4>💡 Originality</h4>
                    <div class="star-rating" data-category="originality">
                        <span class="star" data-value="1">★</span>
                        <span class="star" data-value="2">★</span>
                        <span class="star" data-value="3">★</span>
                        <span class="star" data-value="4">★</span>
                        <span class="star" data-value="5">★</span>
                    </div>
                    <p>How original is this concept?</p>
                </div>
            </div>
            
            <div style="margin: 20px 0;">
                <label>Comment (optional):</label>
                <textarea id="voteComment" placeholder="Share your thoughts..." style="width: 100%; height: 80px; margin-top: 10px; padding: 10px; border-radius: 8px; border: 2px solid #eee;"></textarea>
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: flex-end;">
                <button type="button" class="btn secondary" onclick="closeVotingModal()">Cancel</button>
                <button type="button" class="btn" onclick="submitVote()">🗳️ Submit Vote</button>
            </div>
        </div>
    </div>
    
    <script>
        let allIdeas = [];
        let filteredIdeas = [];
        let currentSort = { column: 'composite_score', direction: 'desc' };
        let currentVotingIdeaId = null;
        let voteData = { magnetism: 0, feasibility: 0, impact: 0, originality: 0 };
        
        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            loadBrandIdeas();
            setupFilters();
            setupSorting();
            setupStarRatings();
        });
        
        // Load brand ideas data
        async function loadBrandIdeas() {
            try {
                // In real implementation, this would call the API
                // const response = await fetch('/api/brand-ideas/leaderboard');
                // allIdeas = await response.json();
                
                // Mock data for development
                allIdeas = generateMockData();
                filteredIdeas = [...allIdeas];
                
                updateStatistics();
                renderTable();
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('tableContainer').style.display = 'block';
                
            } catch (error) {
                console.error('Failed to load brand ideas:', error);
                // Show mock data on error
                allIdeas = generateMockData();
                filteredIdeas = [...allIdeas];
                updateStatistics();
                renderTable();
                document.getElementById('loading').style.display = 'none';
                document.getElementById('tableContainer').style.display = 'block';
            }
        }
        
        // Generate mock data for development
        function generateMockData() {
            const categories = ['game', 'service', 'domain', 'ai', 'tool', 'community'];
            const statuses = ['submitted', 'analyzing', 'approved', 'implemented', 'rejected'];
            const titles = [
                'Death to Boring Learning',
                'Build Together API',
                'AI Code Whisperer',
                'Spark Community Hub',
                'Revolutionary Game Engine',
                'Dream Architecture Platform',
                'Wise Command Center',
                'Prosperity Trading Bot',
                'Creative Catalyst Studio',
                'Neural Network Builder',
                'Blockchain Democracy',
                'Quantum Computing Interface',
                'Augmented Reality Workspace',
                'Voice-Controlled IDE',
                'Collaborative Code Reviews'
            ];
            
            return titles.map((title, i) => {
                const magnetism = Math.floor(Math.random() * 40) + 60; // 60-100
                const feasibility = Math.floor(Math.random() * 10) + 1; // 1-10
                const impact = Math.floor(Math.random() * 10) + 1;
                const originality = Math.floor(Math.random() * 10) + 1;
                const votes = Math.floor(Math.random() * 50) + 1;
                const voteScore = (Math.random() * 2 + 3).toFixed(1); // 3.0-5.0
                
                // Calculate composite score
                const compositeScore = Math.round(
                    magnetism * 0.3 + 
                    parseFloat(voteScore) * 10 * 0.25 + 
                    feasibility * 10 * 0.15 + 
                    impact * 10 * 0.15 + 
                    originality * 10 * 0.15
                );
                
                return {
                    id: \`idea_\${String(i + 1).padStart(3, '0')}\`,
                    title: title,
                    description: \`Revolutionary \${categories[i % categories.length]} platform that transforms user experience through innovative design and intelligent systems.\`,
                    category: categories[i % categories.length],
                    magnetism_score: magnetism,
                    feasibility_score: feasibility,
                    impact_score: impact,
                    originality_score: originality,
                    votes: votes,
                    vote_score: parseFloat(voteScore),
                    composite_score: compositeScore,
                    status: statuses[Math.floor(Math.random() * statuses.length)],
                    submitted_by: \`user_\${Math.floor(Math.random() * 10) + 1}\`,
                    submitted_at: new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000).toISOString()
                };
            }).sort((a, b) => b.composite_score - a.composite_score)
              .map((item, index) => ({ ...item, rank: index + 1 }));
        }
        
        // Update statistics panel
        function updateStatistics() {
            const stats = {
                total: allIdeas.length,
                avgMagnetism: Math.round(allIdeas.reduce((sum, idea) => sum + idea.magnetism_score, 0) / allIdeas.length),
                totalVotes: allIdeas.reduce((sum, idea) => sum + idea.votes, 0),
                implemented: allIdeas.filter(idea => idea.status === 'implemented').length
            };
            
            const statsHTML = \`
                <div class="stat-card">
                    <h3>Total Ideas</h3>
                    <div class="stat-value">\${stats.total}</div>
                    <div class="stat-label">Community submissions</div>
                </div>
                <div class="stat-card">
                    <h3>Avg Magnetism</h3>
                    <div class="stat-value">\${stats.avgMagnetism}%</div>
                    <div class="stat-label">Cultural appeal score</div>
                </div>
                <div class="stat-card">
                    <h3>Total Votes</h3>
                    <div class="stat-value">\${stats.totalVotes}</div>
                    <div class="stat-label">Community engagement</div>
                </div>
                <div class="stat-card">
                    <h3>Implemented</h3>
                    <div class="stat-value">\${stats.implemented}</div>
                    <div class="stat-label">Ideas brought to life</div>
                </div>
            \`;
            
            document.getElementById('statsPanel').innerHTML = statsHTML;
        }
        
        // Render the main table
        function renderTable() {
            const tbody = document.getElementById('brandTableBody');
            
            tbody.innerHTML = filteredIdeas.map(idea => \`
                <tr>
                    <td class="col-rank">\${idea.rank}</td>
                    <td class="col-title">
                        <div style="font-weight: 600; margin-bottom: 5px;">\${idea.title}</div>
                        <div style="font-size: 12px; color: #666; line-height: 1.4;">
                            \${idea.description.length > 100 ? idea.description.substring(0, 100) + '...' : idea.description}
                        </div>
                    </td>
                    <td class="col-category">
                        <span class="category-icon">\${getCategoryIcon(idea.category)}</span>
                        \${idea.category}
                    </td>
                    <td class="col-score \${getScoreClass(idea.composite_score)}">\${idea.composite_score}</td>
                    <td class="col-score">
                        <div class="magnetism-meter">
                            <div class="magnetism-fill progress-magnetism" style="width: \${idea.magnetism_score}%"></div>
                        </div>
                        <div style="font-size: 12px; text-align: center; margin-top: 2px;">\${idea.magnetism_score}%</div>
                    </td>
                    <td class="col-votes">
                        <div class="vote-controls">
                            <button class="vote-btn vote-up" onclick="quickVote('\${idea.id}', 1)" title="Upvote">👍</button>
                            <span style="margin: 0 8px; font-weight: 600;">\${idea.votes}</span>
                            <button class="vote-btn vote-down" onclick="quickVote('\${idea.id}', -1)" title="Downvote">👎</button>
                        </div>
                    </td>
                    <td class="col-score \${getScoreClass(idea.vote_score * 20)}">\${idea.vote_score}/5</td>
                    <td class="col-score">
                        <div class="progress-bar">
                            <div class="progress-fill progress-feasibility" style="width: \${idea.feasibility_score * 10}%"></div>
                        </div>
                        <div style="font-size: 11px; text-align: center;">\${idea.feasibility_score}/10</div>
                    </td>
                    <td class="col-score">
                        <div class="progress-bar">
                            <div class="progress-fill progress-impact" style="width: \${idea.impact_score * 10}%"></div>
                        </div>
                        <div style="font-size: 11px; text-align: center;">\${idea.impact_score}/10</div>
                    </td>
                    <td class="col-score">
                        <div class="progress-bar">
                            <div class="progress-fill progress-originality" style="width: \${idea.originality_score * 10}%"></div>
                        </div>
                        <div style="font-size: 11px; text-align: center;">\${idea.originality_score}/10</div>
                    </td>
                    <td class="col-status">
                        <span class="status-badge status-\${idea.status}">\${idea.status}</span>
                    </td>
                    <td class="col-date">\${formatDate(idea.submitted_at)}</td>
                    <td class="col-votes">
                        <button class="btn" onclick="openDetailedVoting('\${idea.id}')" style="font-size: 11px; padding: 4px 8px;">
                            🗳️ Vote
                        </button>
                    </td>
                </tr>
            \`).join('');
        }
        
        // Helper functions
        function getCategoryIcon(category) {
            const icons = {
                game: '🎮',
                service: '⚙️',
                domain: '🌐',
                ai: '🤖',
                tool: '🔧',
                community: '👥'
            };
            return icons[category] || '💡';
        }
        
        function getScoreClass(score) {
            if (score >= 80) return 'score-excellent';
            if (score >= 60) return 'score-good';
            if (score >= 40) return 'score-average';
            return 'score-poor';
        }
        
        function formatDate(dateStr) {
            return new Date(dateStr).toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric'
            });
        }
        
        // Filter setup
        function setupFilters() {
            const categoryFilter = document.getElementById('categoryFilter');
            const statusFilter = document.getElementById('statusFilter');
            const minScoreFilter = document.getElementById('minScoreFilter');
            const searchFilter = document.getElementById('searchFilter');
            
            [categoryFilter, statusFilter, minScoreFilter, searchFilter].forEach(filter => {
                filter.addEventListener('change', applyFilters);
                filter.addEventListener('input', applyFilters);
            });
        }
        
        function applyFilters() {
            const categoryFilter = document.getElementById('categoryFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            const minScoreFilter = parseInt(document.getElementById('minScoreFilter').value) || 0;
            const searchFilter = document.getElementById('searchFilter').value.toLowerCase();
            
            filteredIdeas = allIdeas.filter(idea => {
                if (categoryFilter && idea.category !== categoryFilter) return false;
                if (statusFilter && idea.status !== statusFilter) return false;
                if (idea.composite_score < minScoreFilter) return false;
                if (searchFilter && !idea.title.toLowerCase().includes(searchFilter)) return false;
                return true;
            });
            
            // Re-apply current sort
            sortIdeas(currentSort.column, currentSort.direction);
            renderTable();
        }
        
        // Sorting setup
        function setupSorting() {
            document.querySelectorAll('th.sortable').forEach(th => {
                th.addEventListener('click', function() {
                    const column = this.dataset.sort;
                    const direction = currentSort.column === column && currentSort.direction === 'asc' ? 'desc' : 'asc';
                    sortIdeas(column, direction);
                    updateSortIndicators(column, direction);
                    renderTable();
                });
            });
            
            // Set initial sort
            updateSortIndicators('composite_score', 'desc');
        }
        
        function sortIdeas(column, direction) {
            currentSort = { column, direction };
            
            filteredIdeas.sort((a, b) => {
                let aVal = a[column];
                let bVal = b[column];
                
                // Handle different data types
                if (typeof aVal === 'string') {
                    aVal = aVal.toLowerCase();
                    bVal = bVal.toLowerCase();
                }
                
                if (direction === 'asc') {
                    return aVal > bVal ? 1 : -1;
                } else {
                    return aVal < bVal ? 1 : -1;
                }
            });
            
            // Update ranks after sorting
            filteredIdeas.forEach((idea, index) => {
                idea.rank = index + 1;
            });
        }
        
        function updateSortIndicators(column, direction) {
            // Clear all sort indicators
            document.querySelectorAll('th.sortable').forEach(th => {
                th.classList.remove('sort-asc', 'sort-desc');
            });
            
            // Add indicator to current sort column
            const th = document.querySelector(\`th[data-sort="\${column}"]\`);
            if (th) {
                th.classList.add(direction === 'asc' ? 'sort-asc' : 'sort-desc');
            }
        }
        
        // Star rating setup
        function setupStarRatings() {
            document.querySelectorAll('.star-rating').forEach(rating => {
                const stars = rating.querySelectorAll('.star');
                const category = rating.dataset.category;
                
                stars.forEach((star, index) => {
                    star.addEventListener('click', function() {
                        const value = parseInt(this.dataset.value);
                        voteData[category] = value;
                        
                        // Update visual state
                        stars.forEach((s, i) => {
                            s.classList.toggle('active', i < value);
                        });
                    });
                    
                    star.addEventListener('mouseenter', function() {
                        const value = parseInt(this.dataset.value);
                        stars.forEach((s, i) => {
                            s.style.color = i < value ? '#ffd700' : '#ddd';
                        });
                    });
                });
                
                rating.addEventListener('mouseleave', function() {
                    stars.forEach((s, i) => {
                        const currentValue = voteData[category] || 0;
                        s.style.color = i < currentValue ? '#ffd700' : '#ddd';
                    });
                });
            });
        }
        
        // Voting functions
        async function quickVote(ideaId, direction) {
            try {
                // In real implementation:
                // await fetch(\`/api/ideas/\${ideaId}/vote\`, { method: 'POST', body: JSON.stringify({direction}) });
                
                // Mock update
                const idea = allIdeas.find(i => i.id === ideaId);
                if (idea) {
                    idea.votes += direction;
                    renderTable();
                }
                
            } catch (error) {
                console.error('Quick vote failed:', error);
            }
        }
        
        function openDetailedVoting(ideaId) {
            const idea = allIdeas.find(i => i.id === ideaId);
            if (!idea) return;
            
            currentVotingIdeaId = ideaId;
            document.getElementById('votingIdeaTitle').textContent = idea.title;
            document.getElementById('votingIdeaDescription').textContent = idea.description;
            
            // Reset vote data and stars
            voteData = { magnetism: 0, feasibility: 0, impact: 0, originality: 0 };
            document.querySelectorAll('.star').forEach(star => {
                star.classList.remove('active');
                star.style.color = '#ddd';
            });
            
            document.getElementById('voteComment').value = '';
            document.getElementById('votingModal').style.display = 'block';
        }
        
        function closeVotingModal() {
            document.getElementById('votingModal').style.display = 'none';
        }
        
        async function submitVote() {
            if (!currentVotingIdeaId) return;
            
            // Validate that at least one category was voted on
            const hasVotes = Object.values(voteData).some(v => v > 0);
            if (!hasVotes) {
                alert('Please rate at least one category before submitting.');
                return;
            }
            
            const votePayload = {
                idea_id: currentVotingIdeaId,
                magnetism_vote: voteData.magnetism || null,
                feasibility_vote: voteData.feasibility || null,
                impact_vote: voteData.impact || null,
                originality_vote: voteData.originality || null,
                vote_comment: document.getElementById('voteComment').value,
                voter_id: 'current_user' // In real app, get from auth
            };
            
            try {
                // In real implementation:
                // await fetch(\`/api/ideas/\${currentVotingIdeaId}/vote\`, { method: 'POST', body: JSON.stringify(votePayload) });
                
                // Mock update
                const idea = allIdeas.find(i => i.id === currentVotingIdeaId);
                if (idea) {
                    idea.votes += 1;
                    // Update scores with new vote
                    if (voteData.magnetism) idea.magnetism_score = Math.round((idea.magnetism_score + voteData.magnetism * 20) / 2);
                    if (voteData.feasibility) idea.feasibility_score = Math.round((idea.feasibility_score + voteData.feasibility) / 2);
                    if (voteData.impact) idea.impact_score = Math.round((idea.impact_score + voteData.impact) / 2);
                    if (voteData.originality) idea.originality_score = Math.round((idea.originality_score + voteData.originality) / 2);
                    
                    // Recalculate composite score
                    idea.composite_score = Math.round(
                        idea.magnetism_score * 0.3 + 
                        idea.vote_score * 10 * 0.25 + 
                        idea.feasibility_score * 10 * 0.15 + 
                        idea.impact_score * 10 * 0.15 + 
                        idea.originality_score * 10 * 0.15
                    );
                }
                
                closeVotingModal();
                renderTable();
                alert('✅ Vote submitted successfully!');
                
            } catch (error) {
                console.error('Vote submission failed:', error);
                alert('❌ Failed to submit vote. Please try again.');
            }
        }
        
        // Utility functions
        function refreshData() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('tableContainer').style.display = 'none';
            loadBrandIdeas();
        }
        
        function exportToCSV() {
            const headers = ['Rank', 'Title', 'Category', 'Composite Score', 'Magnetism', 'Votes', 'Rating', 'Feasibility', 'Impact', 'Originality', 'Status', 'Submitted'];
            const rows = filteredIdeas.map(idea => [
                idea.rank,
                idea.title,
                idea.category,
                idea.composite_score,
                idea.magnetism_score,
                idea.votes,
                idea.vote_score,
                idea.feasibility_score,
                idea.impact_score,
                idea.originality_score,
                idea.status,
                formatDate(idea.submitted_at)
            ]);
            
            const csvContent = [headers, ...rows].map(row => row.join(',')).join('\\n');
            downloadFile(csvContent, 'brand-rankings.csv', 'text/csv');
        }
        
        function exportToJSON() {
            const jsonContent = JSON.stringify(filteredIdeas, null, 2);
            downloadFile(jsonContent, 'brand-rankings.json', 'application/json');
        }
        
        function downloadFile(content, filename, contentType) {
            const blob = new Blob([content], { type: contentType });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            link.click();
            URL.revokeObjectURL(url);
        }
        
        function openBulkVotingModal() {
            alert('🚧 Bulk voting feature coming soon! This will allow voting on multiple ideas at once.');
        }
        
        // Close modal when clicking outside
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>