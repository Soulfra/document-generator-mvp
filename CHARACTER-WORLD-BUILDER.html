<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Character Mascot World Builder</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Comic Sans MS', cursive, sans-serif;
            overflow: hidden;
            color: #fff;
        }

        #worldContainer {
            width: 100vw;
            height: 100vh;
            position: relative;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 177, 153, 0.3) 0%, transparent 50%),
                linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        /* Character Mascots */
        .character-mascot {
            position: absolute;
            width: 60px;
            height: 80px;
            cursor: pointer;
            z-index: 20;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .character-mascot:hover {
            transform: scale(1.1);
            filter: brightness(1.2);
        }

        .character-body {
            width: 50px;
            height: 60px;
            border-radius: 50% 50% 40% 40%;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            border: 3px solid #fff;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            animation: bobFloat 3s ease-in-out infinite;
        }

        .character-name {
            font-size: 10px;
            font-weight: bold;
            margin-top: 5px;
            text-align: center;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
            background: rgba(0,0,0,0.3);
            padding: 2px 6px;
            border-radius: 10px;
        }

        @keyframes bobFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
        }

        /* Mascot Types */
        .mascot-kawaii .character-body { 
            background: linear-gradient(45deg, #ff9a9e, #fecfef);
            animation-delay: 0s;
        }
        
        .mascot-cool .character-body { 
            background: linear-gradient(45deg, #667eea, #764ba2);
            animation-delay: 0.5s;
        }
        
        .mascot-nature .character-body { 
            background: linear-gradient(45deg, #56ab2f, #a8e6cf);
            animation-delay: 1s;
        }
        
        .mascot-tech .character-body { 
            background: linear-gradient(45deg, #0f4c75, #3282b8);
            animation-delay: 1.5s;
        }

        .mascot-artist .character-body { 
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            animation-delay: 2s;
        }

        /* Character Rooms */
        .character-room {
            position: absolute;
            border: 3px solid rgba(255,255,255,0.8);
            border-radius: 15px;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            z-index: 10;
            transition: all 0.5s ease;
            overflow: hidden;
        }

        .room-header {
            background: rgba(0,0,0,0.3);
            padding: 8px;
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.3);
        }

        .room-content {
            padding: 10px;
            height: calc(100% - 35px);
            position: relative;
        }

        /* Room Items */
        .room-item {
            position: absolute;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 5;
        }

        .room-item:hover {
            transform: scale(1.2);
            filter: brightness(1.3);
        }

        /* Outfit Customizer */
        .outfit-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 280px;
            background: rgba(0,0,0,0.8);
            border: 2px solid #fff;
            border-radius: 15px;
            padding: 15px;
            z-index: 30;
            backdrop-filter: blur(15px);
        }

        .outfit-title {
            font-size: 16px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 15px;
            color: #ff9a9e;
        }

        .outfit-section {
            margin-bottom: 15px;
        }

        .outfit-section h4 {
            font-size: 12px;
            margin-bottom: 8px;
            color: #fecfef;
        }

        .outfit-options {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        .outfit-option {
            width: 50px;
            height: 50px;
            border: 2px solid #fff;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.1);
        }

        .outfit-option:hover {
            transform: scale(1.1);
            background: rgba(255,255,255,0.3);
        }

        .outfit-option.selected {
            background: #ff9a9e;
            box-shadow: 0 0 15px rgba(255, 154, 158, 0.6);
        }

        /* Building Interface */
        .building-interface {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            border: 2px solid #fff;
            border-radius: 15px;
            padding: 12px;
            z-index: 30;
            backdrop-filter: blur(15px);
        }

        .building-tools {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .tool-btn {
            padding: 8px 12px;
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tool-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .tool-btn.active {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            box-shadow: 0 0 20px rgba(255, 107, 107, 0.5);
        }

        .item-palette {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 5px;
        }

        .palette-item {
            width: 35px;
            height: 35px;
            border: 1px solid #fff;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(255,255,255,0.1);
        }

        .palette-item:hover {
            background: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }

        /* Activity Log */
        .activity-log {
            position: absolute;
            top: 20px;
            left: 20px;
            width: 300px;
            max-height: 200px;
            background: rgba(0,0,0,0.8);
            border: 2px solid #fff;
            border-radius: 15px;
            padding: 10px;
            z-index: 30;
            backdrop-filter: blur(15px);
            overflow-y: auto;
        }

        .log-title {
            font-size: 14px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 10px;
            color: #a8e6cf;
        }

        .log-entry {
            font-size: 11px;
            margin: 3px 0;
            padding: 4px 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 5px;
            border-left: 3px solid;
            animation: logAppear 0.5s ease;
        }

        .log-kawaii { border-left-color: #ff9a9e; }
        .log-cool { border-left-color: #667eea; }
        .log-nature { border-left-color: #56ab2f; }
        .log-tech { border-left-color: #0f4c75; }
        .log-artist { border-left-color: #ff6b6b; }

        @keyframes logAppear {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Speech Bubbles */
        .speech-bubble {
            position: absolute;
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            padding: 8px 12px;
            border-radius: 15px;
            font-size: 12px;
            max-width: 150px;
            z-index: 25;
            animation: bubbleAppear 0.5s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .speech-bubble:after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 20px;
            width: 0;
            height: 0;
            border-left: 8px solid transparent;
            border-right: 8px solid transparent;
            border-top: 8px solid rgba(255, 255, 255, 0.95);
        }

        @keyframes bubbleAppear {
            from {
                opacity: 0;
                transform: scale(0.8) translateY(10px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        /* Construction Effects */
        .construction-effect {
            position: absolute;
            width: 30px;
            height: 30px;
            background: radial-gradient(circle, #feca57, #ff9ff3);
            border-radius: 50%;
            z-index: 15;
            animation: constructionPulse 1s ease-out forwards;
            pointer-events: none;
        }

        @keyframes constructionPulse {
            0% {
                transform: scale(0);
                opacity: 1;
            }
            100% {
                transform: scale(2);
                opacity: 0;
            }
        }

        /* Character Status Panel */
        .character-status {
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 250px;
            background: rgba(0,0,0,0.8);
            border: 2px solid #fff;
            border-radius: 15px;
            padding: 12px;
            z-index: 30;
            backdrop-filter: blur(15px);
        }

        .status-title {
            font-size: 14px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 10px;
            color: #feca57;
        }

        .character-stats {
            font-size: 11px;
            margin: 5px 0;
        }

        .stat-bar {
            width: 100%;
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            overflow: hidden;
            margin: 3px 0;
        }

        .stat-fill {
            height: 100%;
            background: linear-gradient(90deg, #56ab2f, #a8e6cf);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        /* World Expansion Effects */
        .world-expansion {
            position: absolute;
            border: 2px dashed rgba(255,255,255,0.5);
            border-radius: 10px;
            background: rgba(255,255,255,0.05);
            z-index: 5;
            animation: expandPulse 3s ease-in-out infinite;
        }

        @keyframes expandPulse {
            0%, 100% {
                opacity: 0.3;
                transform: scale(1);
            }
            50% {
                opacity: 0.7;
                transform: scale(1.02);
            }
        }

        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0,0,0,0.2);
            border-radius: 3px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.5);
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div id="worldContainer">
        <!-- Activity Log -->
        <div class="activity-log">
            <div class="log-title">üèóÔ∏è Building Activity</div>
            <div id="activityLog"></div>
        </div>

        <!-- Outfit Customizer -->
        <div class="outfit-panel">
            <div class="outfit-title">üëó Character Customizer</div>
            
            <div class="outfit-section">
                <h4>üé® Body Colors</h4>
                <div class="outfit-options" id="bodyColors"></div>
            </div>
            
            <div class="outfit-section">
                <h4>üëï Outfits</h4>
                <div class="outfit-options" id="outfitOptions"></div>
            </div>
            
            <div class="outfit-section">
                <h4>üé≠ Accessories</h4>
                <div class="outfit-options" id="accessoryOptions"></div>
            </div>
        </div>

        <!-- Building Interface -->
        <div class="building-interface">
            <div class="building-tools">
                <button class="tool-btn active" onclick="setTool('room')">üè† Room</button>
                <button class="tool-btn" onclick="setTool('furniture')">ü™ë Furniture</button>
                <button class="tool-btn" onclick="setTool('decor')">üé® Decor</button>
                <button class="tool-btn" onclick="setTool('delete')">üóëÔ∏è Delete</button>
            </div>
            <div class="item-palette" id="itemPalette"></div>
        </div>

        <!-- Character Status -->
        <div class="character-status">
            <div class="status-title">üìä Character Stats</div>
            <div id="characterStats">
                <div>Selected: <span id="selectedCharacter">None</span></div>
            </div>
        </div>
    </div>

    <script>
        class CharacterWorldBuilder {
            constructor() {
                this.characters = new Map();
                this.rooms = new Map();
                this.selectedCharacter = null;
                this.selectedTool = 'room';
                this.activityLog = [];
                this.worldExpansions = [];
                
                this.characterTypes = {
                    kawaii: { name: 'Mochi', emoji: 'üç°', personality: 'cute_builder' },
                    cool: { name: 'Nova', emoji: '‚≠ê', personality: 'tech_builder' },
                    nature: { name: 'Flora', emoji: 'üå∏', personality: 'garden_builder' },
                    tech: { name: 'Byte', emoji: 'ü§ñ', personality: 'smart_builder' },
                    artist: { name: 'Palette', emoji: 'üé®', personality: 'creative_builder' }
                };
                
                this.initializeSystem();
            }
            
            async initializeSystem() {
                console.log('üèóÔ∏è Initializing Character World Builder...');
                
                await this.spawnCharacters();
                await this.setupCustomizationPanels();
                await this.startCharacterBehaviors();
                await this.setupInteractions();
                
                console.log('‚úÖ Character World Builder Ready!');
            }
            
            async spawnCharacters() {
                const spawnPositions = [
                    { x: 150, y: 200 },
                    { x: 350, y: 150 },
                    { x: 550, y: 250 },
                    { x: 750, y: 180 },
                    { x: 950, y: 220 }
                ];
                
                Object.entries(this.characterTypes).forEach(([type, data], index) => {
                    const character = this.createCharacter(type, data, spawnPositions[index]);
                    this.characters.set(character.id, character);
                    document.getElementById('worldContainer').appendChild(character.element);
                });
            }
            
            createCharacter(type, data, position) {
                const character = {
                    id: `char_${type}_${Date.now()}`,
                    type: type,
                    name: data.name,
                    emoji: data.emoji,
                    personality: data.personality,
                    position: position,
                    stats: {
                        happiness: 80 + Math.random() * 20,
                        creativity: 60 + Math.random() * 40,
                        energy: 90 + Math.random() * 10,
                        building_skill: 50 + Math.random() * 50
                    },
                    currentActivity: 'exploring',
                    room: null,
                    outfit: {
                        body_color: this.getDefaultBodyColor(type),
                        outfit: 'üëï',
                        accessory: null
                    }
                };
                
                character.element = this.createCharacterElement(character);
                return character;
            }
            
            createCharacterElement(character) {
                const element = document.createElement('div');
                element.className = `character-mascot mascot-${character.type}`;
                element.style.left = character.position.x + 'px';
                element.style.top = character.position.y + 'px';
                element.setAttribute('data-character-id', character.id);
                
                const body = document.createElement('div');
                body.className = 'character-body';
                body.textContent = character.emoji;
                body.style.background = character.outfit.body_color;
                
                const name = document.createElement('div');
                name.className = 'character-name';
                name.textContent = character.name;
                
                element.appendChild(body);
                element.appendChild(name);
                
                element.addEventListener('click', (e) => {
                    e.stopPropagation();
                    this.selectCharacter(character.id);
                });
                
                return element;
            }
            
            getDefaultBodyColor(type) {
                const colors = {
                    kawaii: 'linear-gradient(45deg, #ff9a9e, #fecfef)',
                    cool: 'linear-gradient(45deg, #667eea, #764ba2)',
                    nature: 'linear-gradient(45deg, #56ab2f, #a8e6cf)',
                    tech: 'linear-gradient(45deg, #0f4c75, #3282b8)',
                    artist: 'linear-gradient(45deg, #ff6b6b, #feca57)'
                };
                return colors[type];
            }
            
            async setupCustomizationPanels() {
                // Body Colors
                const bodyColors = [
                    'linear-gradient(45deg, #ff9a9e, #fecfef)',
                    'linear-gradient(45deg, #667eea, #764ba2)',
                    'linear-gradient(45deg, #56ab2f, #a8e6cf)',
                    'linear-gradient(45deg, #0f4c75, #3282b8)',
                    'linear-gradient(45deg, #ff6b6b, #feca57)',
                    'linear-gradient(45deg, #a8edea, #fed6e3)',
                    'linear-gradient(45deg, #d299c2, #fef9d7)',
                    'linear-gradient(45deg, #89f7fe, #66a6ff)'
                ];
                
                const bodyColorsContainer = document.getElementById('bodyColors');
                bodyColors.forEach((color, index) => {
                    const option = document.createElement('div');
                    option.className = 'outfit-option';
                    option.style.background = color;
                    option.setAttribute('data-color', color);
                    option.onclick = () => this.changeBodyColor(color);
                    bodyColorsContainer.appendChild(option);
                });
                
                // Outfits
                const outfits = ['üëï', 'üëî', 'üëó', 'üéΩ', 'ü¶∫', 'üëò', 'ü•ª', 'üëö'];
                const outfitContainer = document.getElementById('outfitOptions');
                outfits.forEach(outfit => {
                    const option = document.createElement('div');
                    option.className = 'outfit-option';
                    option.textContent = outfit;
                    option.onclick = () => this.changeOutfit(outfit);
                    outfitContainer.appendChild(option);
                });
                
                // Accessories
                const accessories = ['üé©', 'üëë', 'üéÄ', 'ü•Ω', 'üëì', 'üï∂Ô∏è', 'üé≠', 'üîÆ'];
                const accessoryContainer = document.getElementById('accessoryOptions');
                accessories.forEach(accessory => {
                    const option = document.createElement('div');
                    option.className = 'outfit-option';
                    option.textContent = accessory;
                    option.onclick = () => this.changeAccessory(accessory);
                    accessoryContainer.appendChild(option);
                });
                
                // Item Palette
                this.updateItemPalette();
            }
            
            updateItemPalette() {
                const palettes = {
                    room: ['üè†', 'üèòÔ∏è', 'üè∞', 'üèõÔ∏è', 'üè°', 'üè¢'],
                    furniture: ['ü™ë', 'üõèÔ∏è', 'üö™', 'ü™ü', 'üí∫', 'üõãÔ∏è'],
                    decor: ['üñºÔ∏è', 'üïØÔ∏è', 'üå∫', 'üé®', 'üìö', 'üéµ']
                };
                
                const paletteContainer = document.getElementById('itemPalette');
                paletteContainer.innerHTML = '';
                
                const items = palettes[this.selectedTool] || [];
                items.forEach(item => {
                    const element = document.createElement('div');
                    element.className = 'palette-item';
                    element.textContent = item;
                    element.onclick = () => this.selectPaletteItem(item);
                    paletteContainer.appendChild(element);
                });
            }
            
            selectCharacter(characterId) {
                this.selectedCharacter = characterId;
                const character = this.characters.get(characterId);
                
                // Update UI
                document.getElementById('selectedCharacter').textContent = character.name;
                
                // Update character stats display
                this.updateCharacterStats(character);
                
                // Visual feedback
                document.querySelectorAll('.character-mascot').forEach(el => {
                    el.style.boxShadow = '';
                });
                
                character.element.style.boxShadow = '0 0 20px rgba(255, 255, 255, 0.8)';
                
                this.addActivityLog(`Selected ${character.name} for customization`, character.type);
            }
            
            updateCharacterStats(character) {
                const statsContainer = document.getElementById('characterStats');
                statsContainer.innerHTML = `
                    <div>Selected: <span style="color: #feca57;">${character.name}</span></div>
                    <div style="margin-top: 10px;">
                        <div>üòä Happiness: <div class="stat-bar"><div class="stat-fill" style="width: ${character.stats.happiness}%;"></div></div></div>
                        <div>üé® Creativity: <div class="stat-bar"><div class="stat-fill" style="width: ${character.stats.creativity}%;"></div></div></div>
                        <div>‚ö° Energy: <div class="stat-bar"><div class="stat-fill" style="width: ${character.stats.energy}%;"></div></div></div>
                        <div>üî® Building: <div class="stat-bar"><div class="stat-fill" style="width: ${character.stats.building_skill}%;"></div></div></div>
                    </div>
                    <div style="margin-top: 10px; font-size: 10px;">
                        Activity: <span style="color: #a8e6cf;">${character.currentActivity}</span>
                    </div>
                `;
            }
            
            changeBodyColor(color) {
                if (!this.selectedCharacter) {
                    this.addActivityLog('No character selected for customization', 'tech');
                    return;
                }
                
                const character = this.characters.get(this.selectedCharacter);
                character.outfit.body_color = color;
                
                const bodyElement = character.element.querySelector('.character-body');
                bodyElement.style.background = color;
                
                this.addActivityLog(`${character.name} changed body color`, character.type);
                this.increaseStats(character, { happiness: 5, creativity: 3 });
            }
            
            changeOutfit(outfit) {
                if (!this.selectedCharacter) return;
                
                const character = this.characters.get(this.selectedCharacter);
                character.outfit.outfit = outfit;
                
                // Add outfit as overlay
                this.addOutfitOverlay(character, outfit);
                
                this.addActivityLog(`${character.name} tried on ${outfit}`, character.type);
                this.increaseStats(character, { happiness: 8, creativity: 5 });
            }
            
            changeAccessory(accessory) {
                if (!this.selectedCharacter) return;
                
                const character = this.characters.get(this.selectedCharacter);
                character.outfit.accessory = accessory;
                
                // Add accessory as overlay
                this.addAccessoryOverlay(character, accessory);
                
                this.addActivityLog(`${character.name} equipped ${accessory}`, character.type);
                this.increaseStats(character, { happiness: 10, creativity: 7 });
            }
            
            addOutfitOverlay(character, outfit) {
                // Remove existing outfit overlay
                const existingOutfit = character.element.querySelector('.outfit-overlay');
                if (existingOutfit) existingOutfit.remove();
                
                const overlay = document.createElement('div');
                overlay.className = 'outfit-overlay';
                overlay.style.position = 'absolute';
                overlay.style.bottom = '15px';
                overlay.style.right = '2px';
                overlay.style.fontSize = '16px';
                overlay.textContent = outfit;
                
                character.element.appendChild(overlay);
            }
            
            addAccessoryOverlay(character, accessory) {
                // Remove existing accessory overlay
                const existingAccessory = character.element.querySelector('.accessory-overlay');
                if (existingAccessory) existingAccessory.remove();
                
                const overlay = document.createElement('div');
                overlay.className = 'accessory-overlay';
                overlay.style.position = 'absolute';
                overlay.style.top = '-5px';
                overlay.style.right = '5px';
                overlay.style.fontSize = '14px';
                overlay.textContent = accessory;
                
                character.element.appendChild(overlay);
            }
            
            async startCharacterBehaviors() {
                // Each character acts independently
                this.characters.forEach(character => {
                    this.startCharacterActivity(character);
                });
            }
            
            startCharacterActivity(character) {
                const activityInterval = setInterval(() => {
                    this.performCharacterActivity(character);
                }, 5000 + Math.random() * 10000); // 5-15 seconds
                
                character.activityInterval = activityInterval;
            }
            
            performCharacterActivity(character) {
                const activities = this.getCharacterActivities(character.personality);
                const activity = activities[Math.floor(Math.random() * activities.length)];
                
                character.currentActivity = activity.name;
                
                switch (activity.type) {
                    case 'build_room':
                        this.characterBuildRoom(character);
                        break;
                    case 'decorate':
                        this.characterDecorate(character);
                        break;
                    case 'move':
                        this.characterMove(character);
                        break;
                    case 'socialize':
                        this.characterSocialize(character);
                        break;
                    case 'customize':
                        this.characterSelfCustomize(character);
                        break;
                }
                
                // Update stats display if this character is selected
                if (this.selectedCharacter === character.id) {
                    this.updateCharacterStats(character);
                }
            }
            
            getCharacterActivities(personality) {
                const activities = {
                    cute_builder: [
                        { name: 'building cozy room', type: 'build_room' },
                        { name: 'decorating with flowers', type: 'decorate' },
                        { name: 'exploring happily', type: 'move' },
                        { name: 'making friends', type: 'socialize' }
                    ],
                    tech_builder: [
                        { name: 'constructing smart room', type: 'build_room' },
                        { name: 'adding tech gadgets', type: 'decorate' },
                        { name: 'scanning area', type: 'move' },
                        { name: 'upgrading outfit', type: 'customize' }
                    ],
                    garden_builder: [
                        { name: 'planting garden room', type: 'build_room' },
                        { name: 'growing plants', type: 'decorate' },
                        { name: 'wandering peacefully', type: 'move' },
                        { name: 'communing with nature', type: 'socialize' }
                    ],
                    smart_builder: [
                        { name: 'designing efficient room', type: 'build_room' },
                        { name: 'optimizing layout', type: 'decorate' },
                        { name: 'calculating routes', type: 'move' },
                        { name: 'analyzing patterns', type: 'customize' }
                    ],
                    creative_builder: [
                        { name: 'crafting art studio', type: 'build_room' },
                        { name: 'painting decorations', type: 'decorate' },
                        { name: 'seeking inspiration', type: 'move' },
                        { name: 'expressing creativity', type: 'customize' }
                    ]
                };
                
                return activities[personality] || activities.cute_builder;
            }
            
            characterBuildRoom(character) {
                if (character.room) return; // Already has a room
                
                // Find empty space near character
                const roomPosition = this.findEmptySpace(character.position, 200, 150);
                if (!roomPosition) return;
                
                const room = this.createRoom(character, roomPosition);
                character.room = room.id;
                this.rooms.set(room.id, room);
                
                document.getElementById('worldContainer').appendChild(room.element);
                
                this.addActivityLog(`${character.name} built their own room!`, character.type);
                this.createConstructionEffect(roomPosition.x + 100, roomPosition.y + 75);
                this.increaseStats(character, { happiness: 15, building_skill: 10, energy: -20 });
            }
            
            createRoom(character, position) {
                const room = {
                    id: `room_${character.id}_${Date.now()}`,
                    owner: character.id,
                    position: position,
                    width: 200,
                    height: 150,
                    items: [],
                    theme: character.type
                };
                
                room.element = this.createRoomElement(room, character);
                return room;
            }
            
            createRoomElement(room, character) {
                const element = document.createElement('div');
                element.className = 'character-room';
                element.style.left = room.position.x + 'px';
                element.style.top = room.position.y + 'px';
                element.style.width = room.width + 'px';
                element.style.height = room.height + 'px';
                element.style.borderColor = this.getRoomBorderColor(character.type);
                
                const header = document.createElement('div');
                header.className = 'room-header';
                header.textContent = `${character.name}'s Room ${character.emoji}`;
                
                const content = document.createElement('div');
                content.className = 'room-content';
                
                element.appendChild(header);
                element.appendChild(content);
                
                return element;
            }
            
            getRoomBorderColor(type) {
                const colors = {
                    kawaii: 'rgba(255, 154, 158, 0.8)',
                    cool: 'rgba(102, 126, 234, 0.8)',
                    nature: 'rgba(86, 171, 47, 0.8)',
                    tech: 'rgba(15, 76, 117, 0.8)',
                    artist: 'rgba(255, 107, 107, 0.8)'
                };
                return colors[type] || 'rgba(255, 255, 255, 0.8)';
            }
            
            characterDecorate(character) {
                if (!character.room) return;
                
                const room = this.rooms.get(character.room);
                const decorations = this.getDecorationsByType(character.type);
                const decoration = decorations[Math.floor(Math.random() * decorations.length)];
                
                // Add decoration to room
                const decorationElement = this.createRoomItem(decoration, room);
                room.items.push(decorationElement);
                
                this.addActivityLog(`${character.name} added ${decoration} to their room`, character.type);
                this.increaseStats(character, { happiness: 8, creativity: 12 });
            }
            
            getDecorationsByType(type) {
                const decorations = {
                    kawaii: ['üå∏', 'üéÄ', 'üß∏', 'üç∞', 'ü¶Ñ', 'üåà'],
                    cool: ['‚≠ê', 'üöÄ', 'üíé', 'üîÆ', '‚ö°', 'üåü'],
                    nature: ['üå∫', 'üåø', 'ü¶ã', 'üåô', 'üçÉ', 'üåª'],
                    tech: ['üñ•Ô∏è', '‚öôÔ∏è', 'üîß', 'üíª', 'üì±', 'ü§ñ'],
                    artist: ['üé®', 'üñåÔ∏è', 'üé≠', 'üé™', 'üéµ', 'üé™']
                };
                return decorations[type] || decorations.kawaii;
            }
            
            createRoomItem(item, room) {
                const element = document.createElement('div');
                element.className = 'room-item';
                element.textContent = item;
                element.style.left = Math.random() * (room.width - 40) + 'px';
                element.style.top = Math.random() * (room.height - 70) + 'px';
                
                room.element.querySelector('.room-content').appendChild(element);
                
                // Create construction effect
                const roomPos = room.position;
                this.createConstructionEffect(
                    roomPos.x + parseInt(element.style.left) + 20,
                    roomPos.y + parseInt(element.style.top) + 50
                );
                
                return element;
            }
            
            characterMove(character) {
                // Move character to a new position
                const newPosition = {
                    x: Math.max(50, Math.min(window.innerWidth - 100, character.position.x + (Math.random() - 0.5) * 200)),
                    y: Math.max(50, Math.min(window.innerHeight - 100, character.position.y + (Math.random() - 0.5) * 150))
                };
                
                character.position = newPosition;
                character.element.style.left = newPosition.x + 'px';
                character.element.style.top = newPosition.y + 'px';
                
                this.showSpeechBubble(character, this.getMovementDialogue(character.personality));
                this.increaseStats(character, { energy: -5, happiness: 3 });
            }
            
            getMovementDialogue(personality) {
                const dialogues = {
                    cute_builder: ['So many cute places!', 'Let me explore here!', 'This looks fun!'],
                    tech_builder: ['Scanning for optimal location...', 'Analyzing this area', 'Data looks good here'],
                    garden_builder: ['Feeling the earth energy', 'Nature calls me here', 'Perfect growing spot'],
                    smart_builder: ['Calculating efficiency...', 'This position is logical', 'Optimal location found'],
                    creative_builder: ['Inspiration strikes!', 'This sparks creativity', 'Perfect for art!']
                };
                
                const options = dialogues[personality] || dialogues.cute_builder;
                return options[Math.floor(Math.random() * options.length)];
            }
            
            characterSocialize(character) {
                // Find nearby characters
                const nearbyCharacters = this.findNearbyCharacters(character, 150);
                
                if (nearbyCharacters.length > 0) {
                    const target = nearbyCharacters[Math.floor(Math.random() * nearbyCharacters.length)];
                    this.showSpeechBubble(character, `Hi ${target.name}! ${this.getSocialDialogue(character.personality)}`);
                    this.showSpeechBubble(target, this.getSocialResponse(target.personality), 1000);
                    
                    this.addActivityLog(`${character.name} chatted with ${target.name}`, character.type);
                    this.increaseStats(character, { happiness: 12, energy: -3 });
                    this.increaseStats(target, { happiness: 8 });
                } else {
                    this.showSpeechBubble(character, 'I wonder where everyone is?');
                }
            }
            
            getSocialDialogue(personality) {
                const dialogues = {
                    cute_builder: 'Want to build something cute together?',
                    tech_builder: 'Check out my latest tech setup!',
                    garden_builder: 'Look at these beautiful flowers!',
                    smart_builder: 'I have an efficient building plan',
                    creative_builder: 'Want to see my latest artwork?'
                };
                return dialogues[personality] || 'How are you doing?';
            }
            
            getSocialResponse(personality) {
                const responses = {
                    cute_builder: 'That sounds adorable!',
                    tech_builder: 'Fascinating technology!',
                    garden_builder: 'Nature is wonderful!',
                    smart_builder: 'Very logical approach!',
                    creative_builder: 'So inspiring!'
                };
                return responses[personality] || 'Great to see you!';
            }
            
            characterSelfCustomize(character) {
                // Character customizes themselves randomly
                const customizations = ['body_color', 'accessory'];
                const customization = customizations[Math.floor(Math.random() * customizations.length)];
                
                if (customization === 'body_color') {
                    const colors = [
                        'linear-gradient(45deg, #ff9a9e, #fecfef)',
                        'linear-gradient(45deg, #a8edea, #fed6e3)',
                        'linear-gradient(45deg, #d299c2, #fef9d7)'
                    ];
                    const newColor = colors[Math.floor(Math.random() * colors.length)];
                    character.outfit.body_color = newColor;
                    character.element.querySelector('.character-body').style.background = newColor;
                    
                    this.addActivityLog(`${character.name} changed their appearance`, character.type);
                } else {
                    const accessories = ['üé©', 'üëë', 'üéÄ', 'ü•Ω'];
                    const newAccessory = accessories[Math.floor(Math.random() * accessories.length)];
                    this.addAccessoryOverlay(character, newAccessory);
                    
                    this.addActivityLog(`${character.name} put on ${newAccessory}`, character.type);
                }
                
                this.increaseStats(character, { happiness: 10, creativity: 8 });
            }
            
            // Utility Functions
            findEmptySpace(position, width, height) {
                for (let attempt = 0; attempt < 10; attempt++) {
                    const testPos = {
                        x: position.x + (Math.random() - 0.5) * 400,
                        y: position.y + (Math.random() - 0.5) * 300
                    };
                    
                    if (testPos.x > 0 && testPos.y > 0 && 
                        testPos.x + width < window.innerWidth && 
                        testPos.y + height < window.innerHeight) {
                        return testPos;
                    }
                }
                return null;
            }
            
            findNearbyCharacters(character, radius) {
                const nearby = [];
                this.characters.forEach(other => {
                    if (other.id !== character.id) {
                        const distance = Math.sqrt(
                            Math.pow(other.position.x - character.position.x, 2) +
                            Math.pow(other.position.y - character.position.y, 2)
                        );
                        if (distance < radius) {
                            nearby.push(other);
                        }
                    }
                });
                return nearby;
            }
            
            showSpeechBubble(character, text, delay = 0) {
                setTimeout(() => {
                    const bubble = document.createElement('div');
                    bubble.className = 'speech-bubble';
                    bubble.textContent = text;
                    bubble.style.left = (character.position.x + 70) + 'px';
                    bubble.style.top = (character.position.y - 60) + 'px';
                    
                    document.getElementById('worldContainer').appendChild(bubble);
                    
                    setTimeout(() => {
                        if (bubble.parentElement) bubble.remove();
                    }, 3000);
                }, delay);
            }
            
            createConstructionEffect(x, y) {
                const effect = document.createElement('div');
                effect.className = 'construction-effect';
                effect.style.left = x + 'px';
                effect.style.top = y + 'px';
                
                document.getElementById('worldContainer').appendChild(effect);
                
                setTimeout(() => {
                    if (effect.parentElement) effect.remove();
                }, 1000);
            }
            
            increaseStats(character, changes) {
                Object.keys(changes).forEach(stat => {
                    if (character.stats[stat] !== undefined) {
                        character.stats[stat] = Math.max(0, Math.min(100, character.stats[stat] + changes[stat]));
                    }
                });
            }
            
            addActivityLog(message, characterType) {
                const logEntry = {
                    message: `${new Date().toLocaleTimeString()}: ${message}`,
                    type: characterType,
                    timestamp: Date.now()
                };
                
                this.activityLog.unshift(logEntry);
                this.activityLog = this.activityLog.slice(0, 20); // Keep last 20 entries
                
                this.updateActivityLogDisplay();
            }
            
            updateActivityLogDisplay() {
                const logContainer = document.getElementById('activityLog');
                logContainer.innerHTML = this.activityLog.map(entry => 
                    `<div class="log-entry log-${entry.type}">${entry.message}</div>`
                ).join('');
                logContainer.scrollTop = 0;
            }
            
            setupInteractions() {
                // Click on empty space to deselect
                document.getElementById('worldContainer').addEventListener('click', (e) => {
                    if (e.target.id === 'worldContainer') {
                        this.selectedCharacter = null;
                        document.getElementById('selectedCharacter').textContent = 'None';
                        document.querySelectorAll('.character-mascot').forEach(el => {
                            el.style.boxShadow = '';
                        });
                    }
                });
            }
        }
        
        // Global functions for UI controls
        function setTool(tool) {
            worldBuilder.selectedTool = tool;
            worldBuilder.updateItemPalette();
            
            // Update button states
            document.querySelectorAll('.tool-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }
        
        // Initialize the Character World Builder
        const worldBuilder = new CharacterWorldBuilder();
        
        console.log('üéÆ Character World Builder Initialized!');
        console.log('üí° Watch your mascots build their own rooms and customize themselves!');
        console.log('üé® Click characters to customize their appearance');
        console.log('üèóÔ∏è Characters will automatically build and decorate their spaces');
    </script>
</body>
</html>