<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìñ Conversation to GIF API Documentation</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f8f9fa;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 20px;
            text-align: center;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .nav-links {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .nav-links a {
            display: inline-block;
            margin: 0 15px;
            padding: 10px 20px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            transition: background 0.3s ease;
        }
        
        .nav-links a:hover {
            background: #5a6fd8;
        }
        
        .api-section {
            background: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .api-section h2 {
            color: #667eea;
            margin-bottom: 20px;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
        }
        
        .endpoint {
            background: #f8f9fa;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
        }
        
        .endpoint-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }
        
        .method {
            background: #28a745;
            color: white;
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 0.8rem;
            margin-right: 10px;
        }
        
        .method.get { background: #17a2b8; }
        .method.post { background: #28a745; }
        .method.ws { background: #ffc107; color: #333; }
        
        .code-block {
            background: #1e1e1e;
            color: #ffffff;
            padding: 20px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 15px 0;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.9rem;
        }
        
        .response-example {
            background: #e8f5e8;
            border: 1px solid #d4edda;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        .parameter {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-indicator.online { background: #28a745; }
        .status-indicator.offline { background: #dc3545; }
        .status-indicator.checking { background: #ffc107; }
        
        .service-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .service-card {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .try-it-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 0;
            transition: background 0.3s ease;
        }
        
        .try-it-button:hover {
            background: #5a6fd8;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìñ Conversation to GIF API</h1>
            <p>Complete documentation for the conversation-to-visual pipeline</p>
        </div>

        <div class="nav-links">
            <a href="/platform-hub.html">üè† Platform Hub</a>
            <a href="/conversation-to-gif.html">üé¨ Try It Live</a>
            <a href="#quick-start">üöÄ Quick Start</a>
            <a href="#endpoints">üì° Endpoints</a>
            <a href="#websockets">üîå WebSockets</a>
            <a href="#examples">üíª Examples</a>
        </div>

        <!-- Service Status -->
        <div class="api-section">
            <h2>üîß Service Status</h2>
            <div class="service-status" id="service-status">
                <div class="service-card">
                    <div><span class="status-indicator checking" id="extractor-indicator"></span><strong>Visual Extractor</strong></div>
                    <div>Port: 8091 | <span id="extractor-status">Checking...</span></div>
                </div>
                <div class="service-card">
                    <div><span class="status-indicator checking" id="gif-indicator"></span><strong>GIF Generator</strong></div>
                    <div>Port: 8093 | <span id="gif-status">Checking...</span></div>
                </div>
                <div class="service-card">
                    <div><span class="status-indicator checking" id="soulfra-indicator"></span><strong>SoulFra Integration</strong></div>
                    <div>Port: 8092 | <span id="soulfra-status">Checking...</span></div>
                </div>
                <div class="service-card">
                    <div><span class="status-indicator checking" id="ai-indicator"></span><strong>AI Orchestrator</strong></div>
                    <div>Port: 3001 | <span id="ai-status">Checking...</span></div>
                </div>
            </div>
        </div>

        <!-- Quick Start -->
        <div class="api-section" id="quick-start">
            <h2>üöÄ Quick Start</h2>
            <p>Transform conversations into animated GIFs in three simple steps:</p>
            
            <div class="endpoint">
                <div class="endpoint-title">1. Start the Services</div>
                <div class="code-block">
# Start all conversation-to-visual services
docker-compose up -d

# Or start individually:
node multi-agent-orchestrator.js &           # Port 3001
node conversation-to-visual-extractor.js &   # Port 8091  
node soulfra-ai-integration.js &            # Port 8092
node gif-generation-pipeline.js &           # Port 8093</div>
            </div>

            <div class="endpoint">
                <div class="endpoint-title">2. Send a Conversation</div>
                <div class="code-block">
curl -X POST http://localhost:8080/api/conversation-to-gif/generate-gifs \
  -H "Content-Type: application/json" \
  -d '{
    "conversation": [
      {"role": "user", "content": "I want to build a space game with rockets"},
      {"role": "assistant", "content": "Great! We could have flying rockets..."}
    ],
    "animationSettings": {
      "animationType": "bounce",
      "spriteSize": "64x64"
    }
  }'</div>
            </div>

            <div class="endpoint">
                <div class="endpoint-title">3. Download Your GIFs</div>
                <div class="response-example">
                    <strong>Response includes:</strong><br>
                    ‚Ä¢ Generated GIF URLs for download<br>
                    ‚Ä¢ Visual elements extracted from conversation<br>
                    ‚Ä¢ Animation metadata and processing stats<br>
                    ‚Ä¢ Direct download links for each GIF
                </div>
                <button class="try-it-button" onclick="tryQuickStart()">üß™ Try Quick Start</button>
            </div>
        </div>

        <!-- API Endpoints -->
        <div class="api-section" id="endpoints">
            <h2>üì° API Endpoints</h2>

            <div class="endpoint">
                <div class="endpoint-title">
                    <span class="method post">POST</span>
                    Extract Visual Elements
                </div>
                <div><strong>URL:</strong> <code>/api/conversation-to-gif/extract-visuals</code></div>
                <div>Extract visual elements from conversation messages</div>
                
                <div class="parameter">
                    <strong>Request Body:</strong>
                    <div class="code-block">{
  "conversation": [
    {"role": "user", "content": "I want to build a space game"},
    {"role": "assistant", "content": "Great idea! Let me help..."}
  ],
  "extractionOptions": {
    "includeEmotions": true,
    "includeActions": true,
    "maxSprites": 5
  }
}</div>
                </div>
                
                <div class="response-example">
                    <strong>Response Example:</strong>
                    <div class="code-block">{
  "success": true,
  "visualElements": {
    "objects": ["rocket", "alien", "spaceship"],
    "actions": ["flying", "shooting"],
    "emotions": ["excited", "adventurous"],
    "colors": ["#FF0000", "#00FF00", "#0000FF"]
  },
  "spriteDescriptions": [...]
}</div>
                </div>
                <button class="try-it-button" onclick="tryExtractVisuals()">üß™ Try This Endpoint</button>
            </div>

            <div class="endpoint">
                <div class="endpoint-title">
                    <span class="method post">POST</span>
                    Generate GIFs from Conversation
                </div>
                <div><strong>URL:</strong> <code>/api/conversation-to-gif/generate-gifs</code></div>
                <div>Complete pipeline: extract elements and generate animated GIFs</div>
                
                <div class="parameter">
                    <strong>Animation Settings:</strong>
                    ‚Ä¢ animationType: bounce, rotation, pulse, sequence, loop<br>
                    ‚Ä¢ spriteSize: 16x16, 32x32, 64x64, 128x128<br>
                    ‚Ä¢ frameRate: 1-30 FPS<br>
                    ‚Ä¢ duration: 500-5000ms
                </div>
                
                <button class="try-it-button" onclick="tryGenerateGifs()">üß™ Try This Endpoint</button>
            </div>

            <div class="endpoint">
                <div class="endpoint-title">
                    <span class="method get">GET</span>
                    Download Generated GIF
                </div>
                <div><strong>URL:</strong> <code>/api/conversation-to-gif/download/{spriteId}</code></div>
                <div>Download a generated GIF file</div>
                
                <div class="parameter">
                    <strong>Parameters:</strong><br>
                    ‚Ä¢ spriteId (path): ID of the generated sprite<br>
                    ‚Ä¢ format (query): gif, webp, mp4 (default: gif)
                </div>
            </div>

            <div class="endpoint">
                <div class="endpoint-title">
                    <span class="method get">GET</span>
                    Pipeline Status
                </div>
                <div><strong>URL:</strong> <code>/api/conversation-to-gif/status</code></div>
                <div>Check status of all pipeline services</div>
                <button class="try-it-button" onclick="checkStatus()">üß™ Check Status Now</button>
            </div>
        </div>

        <!-- WebSocket Connections -->
        <div class="api-section" id="websockets">
            <h2>üîå WebSocket Connections</h2>
            
            <div class="endpoint">
                <div class="endpoint-title">
                    <span class="method ws">WS</span>
                    Real-time Conversation Analysis
                </div>
                <div><strong>URL:</strong> <code>ws://localhost:8091/conversation-analysis</code></div>
                
                <div class="code-block">
const ws = new WebSocket('ws://localhost:8091/conversation-analysis');

ws.onopen = () => {
  ws.send(JSON.stringify({
    type: 'analyze_conversation',
    data: {
      conversation: [...],
      options: { maxSprites: 5 }
    }
  }));
};

ws.onmessage = (event) => {
  const data = JSON.parse(event.data);
  if (data.type === 'analysis_complete') {
    console.log('Analysis:', data.spriteDescriptions);
  }
};</div>
                <button class="try-it-button" onclick="tryWebSocket()">üß™ Test WebSocket</button>
            </div>

            <div class="endpoint">
                <div class="endpoint-title">
                    <span class="method ws">WS</span>
                    Live GIF Generation
                </div>
                <div><strong>URL:</strong> <code>ws://localhost:8093</code></div>
                <div>Real-time updates during GIF generation process</div>
            </div>
        </div>

        <!-- Examples -->
        <div class="api-section" id="examples">
            <h2>üíª Code Examples</h2>
            
            <div class="endpoint">
                <div class="endpoint-title">JavaScript Fetch Example</div>
                <div class="code-block">
async function generateGIFsFromConversation(conversation) {
  try {
    const response = await fetch('/api/conversation-to-gif/generate-gifs', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        conversation: conversation,
        animationSettings: {
          animationType: 'bounce',
          spriteSize: '64x64',
          frameRate: 8
        }
      })
    });
    
    const result = await response.json();
    
    if (result.success) {
      console.log(`Generated ${result.generatedGIFs.length} GIFs!`);
      result.generatedGIFs.forEach(gif => {
        console.log(`Download: ${gif.downloadUrl}`);
      });
    }
  } catch (error) {
    console.error('Generation failed:', error);
  }
}</div>
            </div>

            <div class="endpoint">
                <div class="endpoint-title">Python Example</div>
                <div class="code-block">
import requests
import json

def generate_gifs_from_conversation(conversation):
    url = "http://localhost:8080/api/conversation-to-gif/generate-gifs"
    
    payload = {
        "conversation": conversation,
        "animationSettings": {
            "animationType": "rotation",
            "spriteSize": "32x32"
        }
    }
    
    response = requests.post(url, json=payload)
    
    if response.status_code == 200:
        result = response.json()
        print(f"Generated {len(result['generatedGIFs'])} GIFs!")
        for gif in result['generatedGIFs']:
            print(f"GIF: {gif['spriteName']} - {gif['downloadUrl']}")
    else:
        print(f"Error: {response.status_code}")

# Example usage
conversation = [
    {"role": "user", "content": "I want to build a platformer game"},
    {"role": "assistant", "content": "Great! We could have jumping characters..."}
]

generate_gifs_from_conversation(conversation)</div>
            </div>
        </div>

        <!-- Integration Guide -->
        <div class="api-section">
            <h2>üîó Integration Guide</h2>
            <p>For complete integration examples, WebSocket patterns, and troubleshooting:</p>
            <div style="text-align: center; margin: 20px 0;">
                <a href="/API-CONVERSATION-TO-GIF-GUIDE.md" target="_blank" class="try-it-button" style="display: inline-block; text-decoration: none; font-size: 1.1rem;">
                    üìö View Complete Integration Guide
                </a>
            </div>
        </div>
    </div>

    <script>
        // Check service status on page load
        async function checkAllServices() {
            const services = [
                { name: 'extractor', url: 'http://localhost:8091/health', port: 8091 },
                { name: 'gif', url: 'http://localhost:8093/health', port: 8093 },
                { name: 'soulfra', url: 'http://localhost:8092/health', port: 8092 },
                { name: 'ai', url: 'http://localhost:3001/health', port: 3001 }
            ];

            for (const service of services) {
                try {
                    const response = await fetch(service.url);
                    const result = await response.json();
                    
                    updateServiceStatus(service.name, true, 'Online');
                } catch (error) {
                    updateServiceStatus(service.name, false, 'Offline');
                }
            }
        }

        function updateServiceStatus(serviceName, isOnline, statusText) {
            const indicator = document.getElementById(`${serviceName}-indicator`);
            const status = document.getElementById(`${serviceName}-status`);
            
            indicator.className = `status-indicator ${isOnline ? 'online' : 'offline'}`;
            status.textContent = statusText;
        }

        // Try functions for interactive testing
        async function tryQuickStart() {
            const sampleConversation = [
                {"role": "user", "content": "I want to build a space exploration game"},
                {"role": "assistant", "content": "Great! We could have rockets flying through space..."}
            ];

            try {
                const response = await fetch('/api/conversation-to-gif/generate-gifs', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        conversation: sampleConversation,
                        animationSettings: {
                            animationType: 'bounce',
                            spriteSize: '64x64'
                        }
                    })
                });

                const result = await response.json();
                alert(`Success! Generated ${result.generatedGIFs?.length || 0} GIFs. Check the console for details.`);
                console.log('Quick Start Result:', result);
            } catch (error) {
                alert(`Error: ${error.message}`);
                console.error('Quick Start Error:', error);
            }
        }

        async function tryExtractVisuals() {
            const sampleConversation = [
                {"role": "user", "content": "I want to build a space game with flying rockets and alien encounters"},
                {"role": "assistant", "content": "Amazing! We could have colorful rockets with bouncing animations..."}
            ];

            try {
                const response = await fetch('/api/conversation-to-gif/extract-visuals', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        conversation: sampleConversation,
                        extractionOptions: {
                            includeEmotions: true,
                            includeActions: true,
                            maxSprites: 5
                        }
                    })
                });

                const result = await response.json();
                alert('Visual elements extracted! Check the console for details.');
                console.log('Visual Elements:', result);
            } catch (error) {
                alert(`Error: ${error.message}`);
                console.error('Extract Visuals Error:', error);
            }
        }

        async function tryGenerateGifs() {
            window.open('/conversation-to-gif.html', '_blank');
        }

        async function checkStatus() {
            try {
                const response = await fetch('/api/conversation-to-gif/status');
                const result = await response.json();
                alert('Status checked! See console for details.');
                console.log('Pipeline Status:', result);
                
                // Update service status display
                if (result.services) {
                    Object.entries(result.services).forEach(([serviceName, serviceData]) => {
                        const isHealthy = serviceData.status === 'healthy';
                        const cleanName = serviceName.replace(/([A-Z])/g, '-$1').toLowerCase();
                        updateServiceStatus(cleanName, isHealthy, serviceData.status);
                    });
                }
            } catch (error) {
                alert(`Error: ${error.message}`);
                console.error('Status Check Error:', error);
            }
        }

        function tryWebSocket() {
            try {
                const ws = new WebSocket('ws://localhost:8091/conversation-analysis');
                
                ws.onopen = () => {
                    alert('WebSocket connected! Check console for details.');
                    console.log('WebSocket connection established');
                    
                    // Send test message
                    ws.send(JSON.stringify({
                        type: 'test_connection',
                        data: { message: 'Testing from API docs' }
                    }));
                };
                
                ws.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    console.log('WebSocket message:', data);
                };
                
                ws.onerror = (error) => {
                    console.error('WebSocket error:', error);
                    alert('WebSocket connection failed. Make sure the service is running on port 8091.');
                };
                
                // Close after 5 seconds
                setTimeout(() => {
                    ws.close();
                    console.log('WebSocket connection closed');
                }, 5000);
                
            } catch (error) {
                alert(`WebSocket error: ${error.message}`);
            }
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            checkAllServices();
            
            // Refresh status every 30 seconds
            setInterval(checkAllServices, 30000);
        });
    </script>
</body>
</html>