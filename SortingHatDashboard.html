<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sorting Hat Dashboard - Magical File Organization</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e94560;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Header */
        .header {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            text-align: center;
            border-bottom: 2px solid #e94560;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 0 0 20px rgba(233, 69, 96, 0.5);
        }
        
        .header .subtitle {
            color: #f7f7f7;
            font-size: 1.2em;
        }
        
        /* House Colors */
        .gryffindor { color: #740001; background: rgba(116, 0, 1, 0.1); }
        .ravenclaw { color: #0e1a40; background: rgba(14, 26, 64, 0.1); }
        .hufflepuff { color: #ecb939; background: rgba(236, 185, 57, 0.1); }
        .slytherin { color: #1a472a; background: rgba(26, 71, 42, 0.1); }
        
        /* Main Container */
        .container {
            flex: 1;
            display: flex;
            gap: 20px;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }
        
        /* Left Panel - File Upload & Categories */
        .left-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        /* Upload Area */
        .upload-area {
            background: rgba(255, 255, 255, 0.05);
            border: 2px dashed #e94560;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .upload-area:hover {
            background: rgba(233, 69, 96, 0.1);
            transform: translateY(-2px);
        }
        
        .upload-area.dragging {
            background: rgba(233, 69, 96, 0.2);
            border-color: #f7f7f7;
        }
        
        .upload-icon {
            font-size: 4em;
            margin-bottom: 20px;
        }
        
        /* Category List */
        .category-panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            flex: 1;
            overflow-y: auto;
        }
        
        .category-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .category-item:hover {
            background: rgba(233, 69, 96, 0.1);
            transform: translateX(5px);
        }
        
        .category-item.active {
            background: rgba(233, 69, 96, 0.2);
            border-left: 4px solid #e94560;
        }
        
        .category-count {
            background: #e94560;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.9em;
        }
        
        /* Right Panel - File List & Details */
        .right-panel {
            flex: 2;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        /* Search Bar */
        .search-bar {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            display: flex;
            gap: 10px;
        }
        
        .search-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(233, 69, 96, 0.3);
            border-radius: 5px;
            padding: 10px;
            color: white;
            font-size: 1em;
        }
        
        .search-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .search-button {
            background: #e94560;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .search-button:hover {
            background: #c23652;
            transform: translateY(-2px);
        }
        
        /* File Grid */
        .file-grid {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            flex: 1;
            overflow-y: auto;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .file-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid transparent;
        }
        
        .file-card:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: #e94560;
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(233, 69, 96, 0.3);
        }
        
        .file-icon {
            font-size: 3em;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .file-name {
            font-weight: bold;
            margin-bottom: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .file-house {
            font-size: 0.9em;
            opacity: 0.8;
            margin-bottom: 10px;
            padding: 5px 10px;
            border-radius: 5px;
            text-align: center;
        }
        
        .file-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin-top: 10px;
        }
        
        .tag {
            background: rgba(233, 69, 96, 0.2);
            padding: 3px 8px;
            border-radius: 3px;
            font-size: 0.8em;
        }
        
        /* Stats Panel */
        .stats-panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 20px;
            display: flex;
            justify-content: space-around;
            text-align: center;
        }
        
        .stat-item {
            flex: 1;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #f7f7f7;
        }
        
        .stat-label {
            opacity: 0.8;
            margin-top: 5px;
        }
        
        /* Loading Spinner */
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
        }
        
        .loading.active {
            display: block;
        }
        
        .spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(233, 69, 96, 0.3);
            border-top-color: #e94560;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Sorting Animation */
        .sorting-animation {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 4em;
            animation: float 2s ease-in-out infinite;
            display: none;
        }
        
        .sorting-animation.active {
            display: block;
        }
        
        @keyframes float {
            0%, 100% { transform: translate(-50%, -50%) translateY(0); }
            50% { transform: translate(-50%, -50%) translateY(-20px); }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .file-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <h1>üé© Sorting Hat Dashboard</h1>
        <div class="subtitle">"Like Harry Potter's Sorting Hat, but for your 7,137 business ideas"</div>
    </div>
    
    <!-- Main Container -->
    <div class="container">
        <!-- Left Panel -->
        <div class="left-panel">
            <!-- Upload Area -->
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">üìÅ</div>
                <h3>Drop Files Here</h3>
                <p>or click to browse</p>
                <input type="file" id="fileInput" style="display: none;" multiple>
            </div>
            
            <!-- Category List -->
            <div class="category-panel">
                <h3 style="margin-bottom: 15px;">Categories</h3>
                <div id="categoryList">
                    <!-- Categories will be populated here -->
                </div>
            </div>
        </div>
        
        <!-- Right Panel -->
        <div class="right-panel">
            <!-- Search Bar -->
            <div class="search-bar">
                <input type="text" class="search-input" placeholder="Search through your files..." id="searchInput">
                <button class="search-button" onclick="searchFiles()">üîç Search</button>
            </div>
            
            <!-- Stats Panel -->
            <div class="stats-panel">
                <div class="stat-item">
                    <div class="stat-value" id="totalFiles">0</div>
                    <div class="stat-label">Total Files</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="sortedFiles">0</div>
                    <div class="stat-label">Sorted</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="avgConfidence">0%</div>
                    <div class="stat-label">Avg Confidence</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="uniqueIdeas">0</div>
                    <div class="stat-label">Unique Ideas</div>
                </div>
            </div>
            
            <!-- File Grid -->
            <div class="file-grid" id="fileGrid">
                <!-- Files will be populated here -->
            </div>
        </div>
    </div>
    
    <!-- Loading Spinner -->
    <div class="loading" id="loading">
        <div class="spinner"></div>
    </div>
    
    <!-- Sorting Animation -->
    <div class="sorting-animation" id="sortingAnimation">üé©</div>
    
    <script>
        // Dashboard state
        let files = [];
        let categories = [];
        let selectedCategory = null;
        let searchQuery = '';
        
        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', () => {
            setupUploadArea();
            loadCategories();
            loadFiles();
            updateStats();
            
            // Auto-refresh every 30 seconds
            setInterval(() => {
                loadFiles();
                updateStats();
            }, 30000);
        });
        
        // Setup upload area
        function setupUploadArea() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');
            
            uploadArea.addEventListener('click', () => fileInput.click());
            
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragging');
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragging');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragging');
                handleFiles(e.dataTransfer.files);
            });
            
            fileInput.addEventListener('change', (e) => {
                handleFiles(e.target.files);
            });
        }
        
        // Handle file upload
        async function handleFiles(fileList) {
            if (fileList.length === 0) return;
            
            showSortingAnimation();
            
            const formData = new FormData();
            const filesArray = [];
            
            for (let i = 0; i < fileList.length; i++) {
                const file = fileList[i];
                filesArray.push({
                    name: file.name,
                    size: file.size,
                    type: file.type,
                    lastModified: file.lastModified
                });
            }
            
            try {
                const response = await fetch('/api/file-organizer/organize', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ files: filesArray })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showNotification(`‚úÖ Sorted ${result.organized} files!`);
                    loadFiles();
                    loadCategories();
                    updateStats();
                } else {
                    showNotification(`‚ùå Error: ${result.error}`, 'error');
                }
            } catch (error) {
                showNotification(`‚ùå Upload failed: ${error.message}`, 'error');
            } finally {
                hideSortingAnimation();
            }
        }
        
        // Load categories
        async function loadCategories() {
            try {
                const response = await fetch('/api/file-organizer/categories');
                const result = await response.json();
                
                if (result.success) {
                    categories = result.categories;
                    renderCategories();
                }
            } catch (error) {
                console.error('Failed to load categories:', error);
            }
        }
        
        // Render categories
        function renderCategories() {
            const categoryList = document.getElementById('categoryList');
            categoryList.innerHTML = '';
            
            // Add "All Files" option
            const allItem = createCategoryItem({
                id: 'all',
                name: 'All Files',
                count: files.length
            }, true);
            categoryList.appendChild(allItem);
            
            // Add categories
            categories.forEach(category => {
                const item = createCategoryItem(category);
                categoryList.appendChild(item);
            });
        }
        
        // Create category item
        function createCategoryItem(category, isAll = false) {
            const item = document.createElement('div');
            item.className = 'category-item';
            if (selectedCategory === category.id || (!selectedCategory && isAll)) {
                item.classList.add('active');
            }
            
            item.innerHTML = `
                <span>${category.name}</span>
                <span class="category-count">${category.count || 0}</span>
            `;
            
            item.addEventListener('click', () => {
                selectedCategory = isAll ? null : category.id;
                document.querySelectorAll('.category-item').forEach(el => el.classList.remove('active'));
                item.classList.add('active');
                renderFiles();
            });
            
            return item;
        }
        
        // Load files
        async function loadFiles() {
            showLoading();
            
            try {
                let url = '/api/file-organizer/search?q=*';
                if (selectedCategory) {
                    url = `/api/file-organizer/category/${selectedCategory}`;
                }
                
                const response = await fetch(url);
                const result = await response.json();
                
                if (result.success) {
                    files = result.results || result.files || [];
                    renderFiles();
                }
            } catch (error) {
                console.error('Failed to load files:', error);
            } finally {
                hideLoading();
            }
        }
        
        // Render files
        function renderFiles() {
            const fileGrid = document.getElementById('fileGrid');
            fileGrid.innerHTML = '';
            
            const filteredFiles = searchQuery 
                ? files.filter(file => 
                    file.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
                    file.tags?.some(tag => tag.toLowerCase().includes(searchQuery.toLowerCase()))
                )
                : files;
            
            filteredFiles.forEach(file => {
                const card = createFileCard(file);
                fileGrid.appendChild(card);
            });
            
            if (filteredFiles.length === 0) {
                fileGrid.innerHTML = '<div style="text-align: center; opacity: 0.5;">No files found</div>';
            }
        }
        
        // Create file card
        function createFileCard(file) {
            const card = document.createElement('div');
            card.className = 'file-card';
            
            const icon = getFileIcon(file.type || file.name);
            const house = file.hogwartsHouse || { house: 'unsorted', motto: 'Awaiting sorting' };
            
            card.innerHTML = `
                <div class="file-icon">${icon}</div>
                <div class="file-name" title="${file.name}">${file.name}</div>
                <div class="file-house ${house.house}">${house.house.toUpperCase()}</div>
                <div style="font-size: 0.8em; opacity: 0.7;">${house.motto}</div>
                ${file.tags ? `
                    <div class="file-tags">
                        ${file.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                    </div>
                ` : ''}
            `;
            
            card.addEventListener('click', () => showFileDetails(file));
            
            return card;
        }
        
        // Get file icon
        function getFileIcon(type) {
            const icons = {
                'pdf': 'üìÑ',
                'doc': 'üìù',
                'docx': 'üìù',
                'xls': 'üìä',
                'xlsx': 'üìä',
                'ppt': 'üìΩÔ∏è',
                'pptx': 'üìΩÔ∏è',
                'txt': 'üìÉ',
                'md': 'üìã',
                'js': 'üü®',
                'py': 'üêç',
                'sol': '‚õìÔ∏è',
                'default': 'üìÅ'
            };
            
            const ext = type.includes('.') ? type.split('.').pop() : type;
            return icons[ext] || icons.default;
        }
        
        // Search files
        function searchFiles() {
            searchQuery = document.getElementById('searchInput').value;
            renderFiles();
        }
        
        // Update statistics
        async function updateStats() {
            try {
                const response = await fetch('/api/file-organizer/stats');
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('totalFiles').textContent = result.stats.totalFiles || 0;
                    document.getElementById('sortedFiles').textContent = result.stats.organized || 0;
                    document.getElementById('avgConfidence').textContent = `${result.stats.avgQuality || 0}%`;
                    document.getElementById('uniqueIdeas').textContent = Object.keys(result.stats.categories || {}).length;
                }
            } catch (error) {
                console.error('Failed to update stats:', error);
            }
        }
        
        // Show file details
        function showFileDetails(file) {
            // In a real implementation, this would open a modal or side panel
            console.log('File details:', file);
            showNotification(`üìÅ ${file.name} - ${file.hogwartsHouse?.house || 'Unsorted'}`);
        }
        
        // Show notification
        function showNotification(message, type = 'success') {
            // Simple notification - in production use a proper toast library
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'error' ? '#dc3545' : '#28a745'};
                color: white;
                padding: 15px 25px;
                border-radius: 5px;
                z-index: 1000;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
        
        // Loading helpers
        function showLoading() {
            document.getElementById('loading').classList.add('active');
        }
        
        function hideLoading() {
            document.getElementById('loading').classList.remove('active');
        }
        
        function showSortingAnimation() {
            document.getElementById('sortingAnimation').classList.add('active');
        }
        
        function hideSortingAnimation() {
            document.getElementById('sortingAnimation').classList.remove('active');
        }
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === '/' && e.ctrlKey) {
                e.preventDefault();
                document.getElementById('searchInput').focus();
            }
            
            if (e.key === 'r' && e.ctrlKey) {
                e.preventDefault();
                loadFiles();
                updateStats();
            }
        });
        
        // Add animations
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); }
                to { transform: translateX(0); }
            }
            
            @keyframes slideOut {
                from { transform: translateX(0); }
                to { transform: translateX(100%); }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>