<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>üéØ UNIFIED CONTROL PANEL - Everything in ONE Place</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <!-- Unified CSS Framework -->
    <link rel="stylesheet" href="./styles/unified-framework.css">
    
    <!-- Consent Manager -->
    <script src="./components/consent-manager.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            color: white;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            padding: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            margin-bottom: 40px;
        }
        
        .header h1 {
            font-size: 3em;
            margin-bottom: 10px;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        .panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 25px;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .services-panel h2 {
            color: #00ff88;
            margin-bottom: 20px;
        }
        
        .service {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            margin: 10px 0;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
        }
        
        .service-light {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 15px;
        }
        
        .service-light.green { 
            background: #00ff88; 
            box-shadow: 0 0 10px #00ff88;
        }
        
        .service-light.red { 
            background: #ff4444; 
            box-shadow: 0 0 10px #ff4444;
        }
        
        .service-info {
            flex: 1;
        }
        
        .service-name {
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .service-port {
            color: #888;
            font-size: 0.9em;
        }
        
        .flow-panel {
            position: relative;
        }
        
        .flow-diagram {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            padding: 30px;
            height: 500px;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            align-items: center;
        }
        
        .flow-step {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px 40px;
            border-radius: 15px;
            text-align: center;
            width: 80%;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .flow-step.active {
            background: linear-gradient(45deg, #00ff88, #00ffff);
            color: black;
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(0, 255, 136, 0.5);
        }
        
        .flow-arrow {
            font-size: 30px;
            color: #666;
            margin: 10px 0;
        }
        
        .flow-arrow.active {
            color: #00ff88;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        .actions-panel h2 {
            color: #00ffff;
            margin-bottom: 20px;
        }
        
        .big-button {
            display: block;
            width: 100%;
            padding: 20px;
            margin: 15px 0;
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.3em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .big-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }
        
        .big-button.primary {
            background: linear-gradient(45deg, #00ff88, #00ffff);
            color: black;
            font-size: 1.5em;
            padding: 25px;
        }
        
        .stats-bar {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #00ff88;
        }
        
        .stat-label {
            color: #888;
            margin-top: 5px;
        }
        
        .output-panel {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 15px;
            padding: 20px;
            margin-top: 30px;
            display: none;
        }
        
        .output-panel.show {
            display: block;
        }
        
        .output-content {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .simple-controls {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #00ff88;
        }
        
        .emoji-status {
            font-size: 60px;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .simple-message {
            text-align: center;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
    <!-- Include Unified Navigation -->
    <div id="unified-nav-placeholder"></div>
    
    <div class="container">
        <div class="header">
            <h1>üéØ UNIFIED CONTROL PANEL</h1>
            <p>Everything Connected in ONE Place!</p>
        </div>
        
        <div class="stats-bar">
            <div class="stat-card">
                <div class="stat-number" id="health-percentage">0%</div>
                <div class="stat-label">System Health</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="docs-processed">0</div>
                <div class="stat-label">Docs Processed</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="ai-calls">0</div>
                <div class="stat-label">AI Calls</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="mvps-created">0</div>
                <div class="stat-label">MVPs Created</div>
            </div>
        </div>
        
        <div class="main-grid">
            <div class="panel services-panel">
                <h2>üîß Services Status</h2>
                <div id="services-list">
                    <!-- Services will be populated here -->
                </div>
            </div>
            
            <div class="panel flow-panel">
                <h2 style="color: #ffaa00; text-align: center; margin-bottom: 20px;">üìä How It Works</h2>
                <div class="flow-diagram">
                    <div class="flow-step" id="step-1">
                        <div style="font-size: 40px;">üìÑ</div>
                        <div style="font-weight: bold;">1. Your Document</div>
                        <div style="font-size: 12px;">Describe what you want</div>
                    </div>
                    <div class="flow-arrow" id="arrow-1">‚¨áÔ∏è</div>
                    <div class="flow-step" id="step-2">
                        <div style="font-size: 40px;">ü§ñ</div>
                        <div style="font-weight: bold;">2. AI Understands</div>
                        <div style="font-size: 12px;">AI API (Port 3001)</div>
                    </div>
                    <div class="flow-arrow" id="arrow-2">‚¨áÔ∏è</div>
                    <div class="flow-step" id="step-3">
                        <div style="font-size: 40px;">üé®</div>
                        <div style="font-weight: bold;">3. Pick Template</div>
                        <div style="font-size: 12px;">Template Processor (Port 3000)</div>
                    </div>
                    <div class="flow-arrow" id="arrow-3">‚¨áÔ∏è</div>
                    <div class="flow-step" id="step-4">
                        <div style="font-size: 40px;">üöÄ</div>
                        <div style="font-weight: bold;">4. Get MVP!</div>
                        <div style="font-size: 12px;">Document Generator (Port 4000)</div>
                    </div>
                </div>
            </div>
            
            <div class="panel actions-panel">
                <h2>üéÆ Quick Actions</h2>
                <button class="big-button primary" onclick="createSimpleMVP()">
                    üöÄ Create TODO App MVP
                </button>
                <button class="big-button" onclick="openDocumentGenerator()">
                    üìÑ Open Document Generator
                </button>
                <button class="big-button" onclick="openGame()">
                    üéÆ Train AI (Play Game)
                </button>
                <button class="big-button" onclick="openMasterController()">
                    üìä System Dashboard
                </button>
                <button class="big-button" onclick="checkEverything()">
                    üîç Check All Services
                </button>
                <button class="big-button" onclick="fixEverything()">
                    üîß Fix Everything
                </button>
            </div>
        </div>
        
        <div class="output-panel" id="output-panel">
            <h3>üì§ Output</h3>
            <div class="output-content" id="output-content">
                <!-- Output will appear here -->
            </div>
        </div>
    </div>
    
    <div class="simple-controls">
        <div class="emoji-status" id="simple-status">ü§î</div>
        <div class="simple-message" id="simple-message">Checking system...</div>
        <button class="big-button" onclick="makeItWork()">
            Make Everything Work!
        </button>
    </div>
    
    <script>
        // Service configuration
        const services = {
            'template-processor': { 
                name: 'Template Processor', 
                port: 3000, 
                url: 'http://localhost:3000',
                essential: true 
            },
            'ai-api': { 
                name: 'AI API', 
                port: 3001, 
                url: 'http://localhost:3001',
                essential: true 
            },
            'document-generator': { 
                name: 'Document Generator', 
                port: 4000, 
                url: 'http://localhost:4000',
                essential: true 
            },
            'game-learning': { 
                name: 'Game Learning', 
                port: 5555, 
                url: 'http://localhost:5555',
                essential: false 
            },
            'master-controller': { 
                name: 'Master Controller', 
                port: 9999, 
                url: 'http://localhost:9999',
                essential: false 
            }
        };
        
        let stats = {
            health: 0,
            docsProcessed: 0,
            aiCalls: 0,
            mvpsCreated: 0
        };
        
        // Initialize
        async function init() {
            await checkAllServices();
            setInterval(checkAllServices, 10000); // Check every 10 seconds
        }
        
        // Check all services
        async function checkAllServices() {
            const servicesList = document.getElementById('services-list');
            servicesList.innerHTML = '';
            
            let healthyCount = 0;
            let totalCount = 0;
            
            for (const [id, service] of Object.entries(services)) {
                totalCount++;
                const isHealthy = await checkService(service);
                if (isHealthy) healthyCount++;
                
                const serviceEl = createServiceElement(service, isHealthy);
                servicesList.appendChild(serviceEl);
            }
            
            // Update stats
            stats.health = Math.round((healthyCount / totalCount) * 100);
            updateStats();
            updateSimpleStatus(healthyCount, totalCount);
        }
        
        // Check individual service
        async function checkService(service) {
            try {
                const response = await fetch(service.url + '/health', { 
                    method: 'GET',
                    mode: 'cors'
                });
                return response.ok;
            } catch (error) {
                return false;
            }
        }
        
        // Create service element
        function createServiceElement(service, isHealthy) {
            const div = document.createElement('div');
            div.className = 'service';
            div.innerHTML = `
                <div style="display: flex; align-items: center;">
                    <div class="service-light ${isHealthy ? 'green' : 'red'}"></div>
                    <div class="service-info">
                        <div class="service-name">${service.name}</div>
                        <div class="service-port">Port ${service.port}</div>
                    </div>
                </div>
                <div>${isHealthy ? '‚úÖ' : '‚ùå'}</div>
            `;
            return div;
        }
        
        // Update stats
        function updateStats() {
            document.getElementById('health-percentage').textContent = stats.health + '%';
            document.getElementById('docs-processed').textContent = stats.docsProcessed;
            document.getElementById('ai-calls').textContent = stats.aiCalls;
            document.getElementById('mvps-created').textContent = stats.mvpsCreated;
        }
        
        // Update simple status
        function updateSimpleStatus(healthy, total) {
            const emoji = document.getElementById('simple-status');
            const message = document.getElementById('simple-message');
            
            if (healthy === total) {
                emoji.textContent = 'üòä';
                message.textContent = 'Everything is working!';
            } else if (healthy >= total / 2) {
                emoji.textContent = 'üòê';
                message.textContent = `${healthy}/${total} services running`;
            } else {
                emoji.textContent = 'üò¢';
                message.textContent = 'Most services are down';
            }
        }
        
        // Create simple MVP
        async function createSimpleMVP() {
            // Check consent before processing
            if (!window.consentManager?.canUseAI()) {
                showOutput('‚ùå AI processing consent required. Please check your consent settings.\n');
                return;
            }
            
            showOutput('Creating TODO App MVP...\n');
            animateFlow();
            
            try {
                // Step 1: Create document
                showOutput('üìÑ Creating document...\n');
                const doc = {
                    title: 'Simple TODO App',
                    content: 'I need a simple todo list app with add, complete, and delete features',
                    type: 'web-app'
                };
                
                // Step 2: Process with AI
                showOutput('ü§ñ AI analyzing requirements...\n');
                await simulateStep(2000);
                stats.aiCalls++;
                
                // Step 3: Select template
                showOutput('üé® Selecting best template...\n');
                await simulateStep(1500);
                
                // Step 4: Generate MVP
                showOutput('üöÄ Generating MVP...\n');
                await simulateStep(2500);
                stats.docsProcessed++;
                stats.mvpsCreated++;
                
                showOutput('\n‚úÖ MVP CREATED!\n');
                showOutput('üì¶ Files generated:\n');
                showOutput('  - index.html\n');
                showOutput('  - styles.css\n');
                showOutput('  - app.js\n');
                showOutput('  - README.md\n');
                showOutput('\nüéâ Your TODO app is ready!\n');
                
                updateStats();
                
            } catch (error) {
                showOutput('\n‚ùå Error: ' + error.message + '\n');
            }
        }
        
        // Animate flow diagram
        function animateFlow() {
            const steps = ['step-1', 'arrow-1', 'step-2', 'arrow-2', 'step-3', 'arrow-3', 'step-4'];
            let current = 0;
            
            const interval = setInterval(() => {
                // Remove active from all
                steps.forEach(id => {
                    document.getElementById(id).classList.remove('active');
                });
                
                // Add active to current
                if (current < steps.length) {
                    document.getElementById(steps[current]).classList.add('active');
                    current++;
                } else {
                    clearInterval(interval);
                }
            }, 1000);
        }
        
        // Simulate processing step
        function simulateStep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        // Show output
        function showOutput(text) {
            const panel = document.getElementById('output-panel');
            const content = document.getElementById('output-content');
            
            panel.classList.add('show');
            content.textContent += text;
            content.scrollTop = content.scrollHeight;
        }
        
        // Action functions
        function openDocumentGenerator() {
            window.open('http://localhost:4000', '_blank');
        }
        
        function openGame() {
            window.open('./self-learning-game-interface.html', '_blank');
        }
        
        function openMasterController() {
            window.open('http://localhost:9999', '_blank');
        }
        
        async function checkEverything() {
            showOutput('\nüîç Checking all services...\n');
            await checkAllServices();
            showOutput('‚úÖ Check complete!\n');
        }
        
        async function fixEverything() {
            showOutput('\nüîß Attempting to fix services...\n');
            showOutput('‚ö†Ô∏è  Please run these commands in terminal:\n');
            showOutput('  cd /Users/matthewmauer/Desktop/Document-Generator\n');
            showOutput('  node services/real-template-processor.js &\n');
            showOutput('  node services/real-ai-api.js &\n');
            showOutput('  node document-generator-app.js &\n');
            showOutput('\n');
        }
        
        async function makeItWork() {
            await checkEverything();
            if (stats.health < 100) {
                await fixEverything();
            } else {
                showOutput('\nüòä Everything is already working!\n');
            }
        }
        
        // Load unified navigation
        async function loadUnifiedNav() {
            try {
                const response = await fetch('./components/unified-navigation.html');
                const navHTML = await response.text();
                document.getElementById('unified-nav-placeholder').innerHTML = navHTML;
            } catch (error) {
                console.warn('Could not load unified navigation:', error);
            }
        }
        
        // Initialize on load
        window.onload = function() {
            loadUnifiedNav();
            init();
        };
    </script>
</body>
</html>