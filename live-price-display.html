<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Crypto & Gaming Prices</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #0a0a0a;
            color: #00ff88;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            color: #00ff88;
            text-shadow: 0 0 10px #00ff88;
            margin-bottom: 30px;
        }
        
        .price-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .price-card {
            background: rgba(0, 255, 136, 0.1);
            border: 2px solid #00ff88;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .price-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 255, 136, 0.3);
        }
        
        .price-card h2 {
            margin: 0 0 10px 0;
            color: #00ffff;
            font-size: 1.5em;
        }
        
        .price {
            font-size: 2em;
            font-weight: bold;
            color: #ffff00;
            margin: 10px 0;
        }
        
        .details {
            font-size: 0.9em;
            color: #88ff88;
        }
        
        .update-time {
            font-size: 0.8em;
            color: #666;
            margin-top: 10px;
        }
        
        .status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 10px 20px;
            background: #001122;
            border: 1px solid #00ff88;
            border-radius: 20px;
            font-size: 0.9em;
        }
        
        .status.connected {
            border-color: #00ff88;
            color: #00ff88;
        }
        
        .status.disconnected {
            border-color: #ff0088;
            color: #ff0088;
        }
        
        .controls {
            text-align: center;
            margin-bottom: 30px;
        }
        
        button {
            background: #00ff88;
            color: #000;
            border: none;
            padding: 10px 20px;
            margin: 0 5px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s;
        }
        
        button:hover {
            background: #00ffff;
            transform: scale(1.05);
        }
        
        .confidence-bar {
            width: 100%;
            height: 10px;
            background: #333;
            border-radius: 5px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .confidence-fill {
            height: 100%;
            background: linear-gradient(to right, #ff0000, #ffff00, #00ff00);
            transition: width 0.3s ease;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .updating {
            animation: pulse 1s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Live Price Dashboard</h1>
        
        <div class="controls">
            <button onclick="refreshAll()">üîÑ Refresh All</button>
            <button onclick="toggleAutoRefresh()">‚è±Ô∏è Auto-Refresh: <span id="autoStatus">ON</span></button>
            <button onclick="connectWebSocket()">üîå Connect WebSocket</button>
        </div>
        
        <div class="price-grid" id="priceGrid">
            <!-- Crypto Prices -->
            <div class="price-card" id="btc-card">
                <h2>‚Çø Bitcoin (BTC)</h2>
                <div class="price updating">Loading...</div>
                <div class="details">
                    <div>Confidence: <span id="btc-confidence">-</span>%</div>
                    <div class="confidence-bar">
                        <div class="confidence-fill" id="btc-confidence-bar" style="width: 0%"></div>
                    </div>
                </div>
                <div class="update-time" id="btc-time">-</div>
            </div>
            
            <div class="price-card" id="eth-card">
                <h2>Œû Ethereum (ETH)</h2>
                <div class="price updating">Loading...</div>
                <div class="details">
                    <div>Confidence: <span id="eth-confidence">-</span>%</div>
                    <div class="confidence-bar">
                        <div class="confidence-fill" id="eth-confidence-bar" style="width: 0%"></div>
                    </div>
                </div>
                <div class="update-time" id="eth-time">-</div>
            </div>
            
            <!-- Gaming Items -->
            <div class="price-card" id="scythe-card">
                <h2>‚öîÔ∏è Scythe of Vitur</h2>
                <div class="price updating">Loading...</div>
                <div class="details">
                    <div>OSRS Grand Exchange</div>
                </div>
                <div class="update-time" id="scythe-time">-</div>
            </div>
            
            <div class="price-card" id="tbow-card">
                <h2>üèπ Twisted Bow</h2>
                <div class="price updating">Loading...</div>
                <div class="details">
                    <div>OSRS Grand Exchange</div>
                </div>
                <div class="update-time" id="tbow-time">-</div>
            </div>
        </div>
        
        <div class="status disconnected" id="status">
            üî¥ Disconnected
        </div>
    </div>
    
    <script>
        let ws = null;
        let autoRefresh = true;
        let refreshInterval = null;
        
        // Format price with appropriate decimals
        function formatPrice(price, currency = 'USD') {
            if (currency === 'GP') {
                return price.toLocaleString() + ' GP';
            }
            return '$' + price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }
        
        // Update price card
        function updatePriceCard(id, data) {
            const card = document.getElementById(id + '-card');
            if (!card) return;
            
            const priceElement = card.querySelector('.price');
            const timeElement = document.getElementById(id + '-time');
            
            priceElement.classList.add('updating');
            
            setTimeout(() => {
                priceElement.textContent = formatPrice(data.price, data.currency);
                priceElement.classList.remove('updating');
                
                if (data.confidence) {
                    document.getElementById(id + '-confidence').textContent = data.confidence;
                    document.getElementById(id + '-confidence-bar').style.width = data.confidence + '%';
                }
                
                timeElement.textContent = new Date(data.timestamp).toLocaleTimeString();
            }, 100);
        }
        
        // Fetch data from API
        async function fetchData(category, source, id) {
            try {
                const response = await fetch(`http://localhost:3011/api/data/${category}/${source}`);
                const result = await response.json();
                
                if (result.data) {
                    updatePriceCard(id, result.data);
                }
            } catch (error) {
                console.error(`Failed to fetch ${category}/${source}:`, error);
            }
        }
        
        // Refresh all prices
        async function refreshAll() {
            fetchData('crypto', 'bitcoin', 'btc');
            fetchData('crypto', 'ethereum', 'eth');
            fetchData('gaming', 'scythe', 'scythe');
            fetchData('gaming', 'tbow', 'tbow');
        }
        
        // Toggle auto-refresh
        function toggleAutoRefresh() {
            autoRefresh = !autoRefresh;
            document.getElementById('autoStatus').textContent = autoRefresh ? 'ON' : 'OFF';
            
            if (autoRefresh) {
                startAutoRefresh();
            } else {
                stopAutoRefresh();
            }
        }
        
        // Start auto-refresh
        function startAutoRefresh() {
            if (refreshInterval) clearInterval(refreshInterval);
            refreshInterval = setInterval(refreshAll, 30000); // Every 30 seconds
        }
        
        // Stop auto-refresh
        function stopAutoRefresh() {
            if (refreshInterval) {
                clearInterval(refreshInterval);
                refreshInterval = null;
            }
        }
        
        // Connect WebSocket for real-time updates
        function connectWebSocket() {
            if (ws) ws.close();
            
            ws = new WebSocket('ws://localhost:3010');
            
            ws.onopen = () => {
                console.log('WebSocket connected');
                document.getElementById('status').textContent = 'üü¢ Connected';
                document.getElementById('status').className = 'status connected';
            };
            
            ws.onmessage = (event) => {
                const message = JSON.parse(event.data);
                
                if (message.type === 'update') {
                    const idMap = {
                        'bitcoin': 'btc',
                        'ethereum': 'eth',
                        'scythe': 'scythe',
                        'tbow': 'tbow'
                    };
                    
                    const id = idMap[message.source];
                    if (id && message.data) {
                        updatePriceCard(id, message.data);
                    }
                }
            };
            
            ws.onerror = (error) => {
                console.error('WebSocket error:', error);
                document.getElementById('status').textContent = 'üî¥ Error';
                document.getElementById('status').className = 'status disconnected';
            };
            
            ws.onclose = () => {
                console.log('WebSocket disconnected');
                document.getElementById('status').textContent = 'üî¥ Disconnected';
                document.getElementById('status').className = 'status disconnected';
            };
        }
        
        // Initialize
        window.onload = () => {
            refreshAll();
            connectWebSocket();
            if (autoRefresh) {
                startAutoRefresh();
            }
        };
    </script>
</body>
</html>