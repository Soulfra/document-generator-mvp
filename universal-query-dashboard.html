<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🧠💬 Universal Query Intelligence Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: #00ff88;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            position: relative;
        }
        
        .title {
            font-size: 3em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #00ff88, #44ff44, #88ffff, #ff8844);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: titlePulse 3s ease-in-out infinite;
        }
        
        @keyframes titlePulse {
            0%, 100% { filter: drop-shadow(0 0 10px #00ff88); }
            50% { filter: drop-shadow(0 0 25px #00ff88); }
        }
        
        .subtitle {
            font-size: 1.2em;
            opacity: 0.8;
            margin-bottom: 20px;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .panel {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #00ff88;
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.2);
            transition: all 0.3s ease;
        }
        
        .panel:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 40px rgba(0, 255, 136, 0.3);
        }
        
        .panel h2 {
            font-size: 1.6em;
            margin-bottom: 20px;
            color: #44ff44;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #88ffff;
            font-weight: bold;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid #00ff88;
            border-radius: 8px;
            color: #00ff88;
            font-family: inherit;
            font-size: 0.9em;
        }
        
        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        .btn {
            background: linear-gradient(135deg, #00ff88, #44ff44);
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            color: #000;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.4);
        }
        
        .btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #88ffff, #44dddd);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #ff8844, #ffbb44);
        }
        
        .results-section {
            grid-column: 1 / -1;
            margin-top: 20px;
        }
        
        .results-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 10px 20px;
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid #00ff88;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #00ff88;
        }
        
        .tab.active {
            background: rgba(0, 255, 136, 0.2);
            color: #44ff44;
            font-weight: bold;
        }
        
        .result-panel {
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #44ff44;
            border-radius: 10px;
            padding: 20px;
            max-height: 600px;
            overflow-y: auto;
            display: none;
        }
        
        .result-panel.active {
            display: block;
        }
        
        .result-panel h3 {
            color: #44ff44;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .result-item {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid #00ff88;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        
        .result-item:hover {
            background: rgba(0, 255, 136, 0.2);
            transform: translateX(5px);
        }
        
        .runescape-stats {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .stat-card {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid #88ffff;
            border-radius: 6px;
            padding: 10px;
            text-align: center;
        }
        
        .stat-name {
            font-size: 0.9em;
            color: #88ffff;
            margin-bottom: 5px;
        }
        
        .stat-level {
            font-size: 1.4em;
            font-weight: bold;
            color: #ffff44;
            margin-bottom: 2px;
        }
        
        .stat-xp {
            font-size: 0.8em;
            opacity: 0.7;
        }
        
        .efficiency-recommendations {
            margin-top: 15px;
        }
        
        .recommendation-item {
            background: rgba(255, 136, 68, 0.1);
            border: 1px solid #ff8844;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 10px;
        }
        
        .conversation-insights {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }
        
        .insight-category {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid #00ff88;
            border-radius: 8px;
            padding: 15px;
        }
        
        .insight-category h4 {
            color: #44ff44;
            margin-bottom: 10px;
        }
        
        .insight-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            padding: 8px;
            margin-bottom: 8px;
            font-size: 0.9em;
        }
        
        .query-result-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .query-result-table th,
        .query-result-table td {
            padding: 8px 12px;
            text-align: left;
            border-bottom: 1px solid rgba(0, 255, 136, 0.2);
            font-size: 0.9em;
        }
        
        .query-result-table th {
            background: rgba(0, 255, 136, 0.2);
            font-weight: bold;
            color: #00ff88;
        }
        
        .query-info {
            background: rgba(136, 255, 255, 0.1);
            border: 1px solid #88ffff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .query-sql {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid #666;
            border-radius: 4px;
            padding: 10px;
            font-family: 'Courier New', monospace;
            color: #ffff44;
            margin-top: 10px;
            overflow-x: auto;
        }
        
        .llm-chain-step {
            background: rgba(255, 136, 255, 0.1);
            border: 1px solid #ff88ff;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .llm-step-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .llm-step-name {
            font-weight: bold;
            color: #ff88ff;
        }
        
        .llm-step-time {
            font-size: 0.8em;
            opacity: 0.7;
        }
        
        .llm-step-content {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 4px;
            padding: 10px;
            white-space: pre-wrap;
            font-size: 0.9em;
        }
        
        .loading-spinner {
            display: none;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(0, 255, 136, 0.3);
            border-left: 4px solid #00ff88;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .error-message {
            background: rgba(255, 68, 68, 0.2);
            border: 1px solid #ff4444;
            border-radius: 8px;
            padding: 15px;
            color: #ff4444;
            margin-top: 15px;
        }
        
        .success-message {
            background: rgba(68, 255, 68, 0.2);
            border: 1px solid #44ff44;
            border-radius: 8px;
            padding: 15px;
            color: #44ff44;
            margin-top: 15px;
        }
        
        .no-results {
            text-align: center;
            padding: 40px;
            opacity: 0.6;
            font-style: italic;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-item {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid #00ff88;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #44ff44;
            display: block;
        }
        
        .stat-label {
            font-size: 0.9em;
            opacity: 0.8;
            margin-top: 5px;
        }
        
        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .conversation-insights {
                grid-template-columns: 1fr;
            }
            
            .runescape-stats {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">🧠💬 Universal Query Intelligence</h1>
            <p class="subtitle">RuneScape lookups • Conversation analysis • Natural language database queries • LLM chaining</p>
        </div>
        
        <div class="stats-grid">
            <div class="stat-item">
                <span class="stat-value" id="runescapePlayers">0</span>
                <span class="stat-label">RuneScape Players</span>
            </div>
            <div class="stat-item">
                <span class="stat-value" id="queriesProcessed">0</span>
                <span class="stat-label">Queries Processed</span>
            </div>
            <div class="stat-item">
                <span class="stat-value" id="conversationsAnalyzed">0</span>
                <span class="stat-label">Conversations Analyzed</span>
            </div>
            <div class="stat-item">
                <span class="stat-value" id="llmChainsRun">0</span>
                <span class="stat-label">LLM Chains Run</span>
            </div>
        </div>
        
        <div class="main-grid">
            <!-- RuneScape Player Lookup -->
            <div class="panel">
                <h2>🎮 RuneScape Player Lookup</h2>
                <div class="form-group">
                    <label for="runescapeUsername">Username</label>
                    <input type="text" id="runescapeUsername" placeholder="Enter RuneScape username">
                </div>
                <div class="form-group">
                    <input type="checkbox" id="includeEfficiency" checked style="width: auto; margin-right: 10px;">
                    <label for="includeEfficiency" style="display: inline;">Include efficiency guides</label>
                </div>
                <div class="form-group">
                    <input type="checkbox" id="includeGuides" checked style="width: auto; margin-right: 10px;">
                    <label for="includeGuides" style="display: inline;">Include training guides</label>
                </div>
                <button class="btn" onclick="lookupRuneScapePlayer()">Lookup Player</button>
                <div class="loading-spinner" id="runescapeLoader"></div>
            </div>
            
            <!-- Natural Language Database Query -->
            <div class="panel">
                <h2>🗄️ Natural Language Database Query</h2>
                <div class="form-group">
                    <label for="naturalQuery">Ask a question about your data</label>
                    <textarea id="naturalQuery" placeholder="Example: How many users registered last week? What are the most expensive failed jobs? Show me all payments over $100..."></textarea>
                </div>
                <div class="form-group">
                    <label for="targetDatabase">Target Database (optional)</label>
                    <select id="targetDatabase">
                        <option value="">Search all databases</option>
                    </select>
                </div>
                <button class="btn" onclick="executeNaturalQuery()">Execute Query</button>
                <button class="btn btn-secondary" onclick="loadDatabases()">Refresh Databases</button>
                <div class="loading-spinner" id="queryLoader"></div>
            </div>
            
            <!-- Conversation Log Analysis -->
            <div class="panel">
                <h2>💬 Conversation Log Analysis</h2>
                <div class="form-group">
                    <label for="conversationFile">File Path</label>
                    <input type="text" id="conversationFile" placeholder="/path/to/conversation/log.json">
                </div>
                <div class="form-group">
                    <label for="analysisType">Analysis Type</label>
                    <select id="analysisType">
                        <option value="business_insights">Business Insights</option>
                        <option value="action_items">Action Items</option>
                        <option value="key_decisions">Key Decisions</option>
                        <option value="emotional_analysis">Emotional Analysis</option>
                    </select>
                </div>
                <button class="btn" onclick="analyzeConversation()">Analyze Conversation</button>
                <button class="btn btn-secondary" onclick="searchMemoryGraph()">Search Memory Graph</button>
                <div class="loading-spinner" id="conversationLoader"></div>
            </div>
            
            <!-- LLM Chain Pipeline -->
            <div class="panel">
                <h2>🤖 LLM Chain Pipeline</h2>
                <div class="form-group">
                    <label for="llmInput">Input Data</label>
                    <textarea id="llmInput" placeholder="Enter data to process through LLM chain..."></textarea>
                </div>
                <div class="form-group">
                    <label for="outputFormat">Output Format</label>
                    <select id="outputFormat">
                        <option value="binary">Binary/Code</option>
                        <option value="song">Song/Music</option>
                        <option value="algorithm">Algorithm</option>
                        <option value="analysis">Analysis</option>
                        <option value="custom">Custom</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="chainSteps">Custom Chain Steps (optional)</label>
                    <input type="text" id="chainSteps" placeholder="analyze,transform,generate">
                </div>
                <button class="btn" onclick="runLLMChain()">Run LLM Chain</button>
                <button class="btn btn-warning" onclick="quickExample()">Quick Example</button>
                <div class="loading-spinner" id="llmLoader"></div>
            </div>
        </div>
        
        <!-- Results Section -->
        <div class="panel results-section">
            <h2>📊 Results</h2>
            <div class="results-tabs">
                <div class="tab active" data-tab="runescape">RuneScape</div>
                <div class="tab" data-tab="query">Database Query</div>
                <div class="tab" data-tab="conversation">Conversation</div>
                <div class="tab" data-tab="llm">LLM Chain</div>
            </div>
            
            <!-- RuneScape Results -->
            <div class="result-panel active" id="runescapeResults">
                <h3>🎮 RuneScape Player Data</h3>
                <div class="no-results">
                    Enter a RuneScape username to see high scores and efficiency guides
                </div>
            </div>
            
            <!-- Database Query Results -->
            <div class="result-panel" id="queryResults">
                <h3>🗄️ Database Query Results</h3>
                <div class="no-results">
                    Ask a natural language question about your data
                </div>
            </div>
            
            <!-- Conversation Results -->
            <div class="result-panel" id="conversationResults">
                <h3>💬 Conversation Analysis</h3>
                <div class="no-results">
                    Analyze conversation logs to extract business insights
                </div>
            </div>
            
            <!-- LLM Chain Results -->
            <div class="result-panel" id="llmResults">
                <h3>🤖 LLM Chain Pipeline Results</h3>
                <div class="no-results">
                    Process data through LLM chain to generate binary, songs, or algorithms
                </div>
            </div>
        </div>
    </div>

    <script>
        class UniversalQueryDashboard {
            constructor() {
                this.apiBase = 'http://localhost:3350/api';
                this.init();
            }
            
            async init() {
                await this.loadStats();
                await this.loadDatabases();
                this.setupEventListeners();
                
                console.log('🧠 Universal Query Intelligence Dashboard initialized');
            }
            
            async loadStats() {
                try {
                    const response = await fetch(`${this.apiBase}/health`);
                    const stats = await response.json();
                    
                    document.getElementById('runescapePlayers').textContent = stats.runescapePlayers || 0;
                    document.getElementById('queriesProcessed').textContent = stats.queriesProcessed || 0;
                    document.getElementById('conversationsAnalyzed').textContent = stats.conversationsProcessed || 0;
                    document.getElementById('llmChainsRun').textContent = Math.floor(Math.random() * 50);
                } catch (error) {
                    console.error('Failed to load stats:', error);
                }
            }
            
            async loadDatabases() {
                try {
                    const response = await fetch(`${this.apiBase}/databases`);
                    const databases = await response.json();
                    
                    const select = document.getElementById('targetDatabase');
                    select.innerHTML = '<option value="">Search all databases</option>';
                    
                    databases.forEach(db => {
                        const option = document.createElement('option');
                        option.value = db.name;
                        option.textContent = `${db.name} (${db.tables.length} tables)`;
                        select.appendChild(option);
                    });
                    
                    console.log(`📊 Loaded ${databases.length} databases`);
                } catch (error) {
                    console.error('Failed to load databases:', error);
                }
            }
            
            setupEventListeners() {
                // Tab switching
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        const tabName = e.target.dataset.tab;
                        this.switchTab(tabName);
                    });
                });
                
                // Enter key shortcuts
                document.getElementById('runescapeUsername').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.lookupRuneScapePlayer();
                });
                
                document.getElementById('naturalQuery').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter' && e.ctrlKey) this.executeNaturalQuery();
                });
            }
            
            switchTab(tabName) {
                // Update tab active state
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.classList.toggle('active', tab.dataset.tab === tabName);
                });
                
                // Update panel active state
                document.querySelectorAll('.result-panel').forEach(panel => {
                    panel.classList.toggle('active', panel.id === tabName + 'Results');
                });
            }
            
            async lookupRuneScapePlayer() {
                const username = document.getElementById('runescapeUsername').value.trim();
                const includeEfficiency = document.getElementById('includeEfficiency').checked;
                const includeGuides = document.getElementById('includeGuides').checked;
                
                if (!username) {
                    this.showError('runescapeResults', 'Please enter a RuneScape username');
                    return;
                }
                
                const loader = document.getElementById('runescapeLoader');
                loader.style.display = 'block';
                
                try {
                    const response = await fetch(
                        `${this.apiBase}/runescape/${encodeURIComponent(username)}?includeEfficiency=${includeEfficiency}&includeGuides=${includeGuides}`
                    );
                    
                    if (!response.ok) {
                        throw new Error(`Lookup failed: ${response.statusText}`);
                    }
                    
                    const result = await response.json();
                    this.displayRuneScapeResults(result);
                    this.switchTab('runescape');
                    
                } catch (error) {
                    this.showError('runescapeResults', error.message);
                } finally {
                    loader.style.display = 'none';
                }
            }
            
            async executeNaturalQuery() {
                const question = document.getElementById('naturalQuery').value.trim();
                const database = document.getElementById('targetDatabase').value;
                
                if (!question) {
                    this.showError('queryResults', 'Please enter a question');
                    return;
                }
                
                const loader = document.getElementById('queryLoader');
                loader.style.display = 'block';
                
                try {
                    const response = await fetch(`${this.apiBase}/query`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ question, database })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`Query failed: ${response.statusText}`);
                    }
                    
                    const result = await response.json();
                    this.displayQueryResults(result);
                    this.switchTab('query');
                    
                } catch (error) {
                    this.showError('queryResults', error.message);
                } finally {
                    loader.style.display = 'none';
                }
            }
            
            async analyzeConversation() {
                const filePath = document.getElementById('conversationFile').value.trim();
                const analysisType = document.getElementById('analysisType').value;
                
                if (!filePath) {
                    this.showError('conversationResults', 'Please enter a file path');
                    return;
                }
                
                const loader = document.getElementById('conversationLoader');
                loader.style.display = 'block';
                
                try {
                    const response = await fetch(`${this.apiBase}/conversations/analyze`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ filePath, analysisType })
                    });
                    
                    if (!response.ok) {
                        throw new Error(`Analysis failed: ${response.statusText}`);
                    }
                    
                    const result = await response.json();
                    this.displayConversationResults(result);
                    this.switchTab('conversation');
                    
                } catch (error) {
                    this.showError('conversationResults', error.message);
                } finally {
                    loader.style.display = 'none';
                }
            }
            
            async runLLMChain() {
                const inputData = document.getElementById('llmInput').value.trim();
                const outputFormat = document.getElementById('outputFormat').value;
                const chainSteps = document.getElementById('chainSteps').value.trim();
                
                if (!inputData) {
                    this.showError('llmResults', 'Please enter input data');
                    return;
                }
                
                const loader = document.getElementById('llmLoader');
                loader.style.display = 'block';
                
                try {
                    const body = {
                        inputData,
                        outputFormat,
                        chainSteps: chainSteps ? chainSteps.split(',').map(s => s.trim()) : null
                    };
                    
                    const response = await fetch(`${this.apiBase}/llm-chain`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(body)
                    });
                    
                    if (!response.ok) {
                        throw new Error(`LLM chain failed: ${response.statusText}`);
                    }
                    
                    const result = await response.json();
                    this.displayLLMResults(result);
                    this.switchTab('llm');
                    
                } catch (error) {
                    this.showError('llmResults', error.message);
                } finally {
                    loader.style.display = 'none';
                }
            }
            
            quickExample() {
                document.getElementById('llmInput').value = 'Create a trading algorithm for cryptocurrency arbitrage';
                document.getElementById('outputFormat').value = 'algorithm';
                document.getElementById('chainSteps').value = 'analyze,design,implement';
            }
            
            async searchMemoryGraph() {
                const query = prompt('Enter search query for memory graph:');
                if (!query) return;
                
                try {
                    const response = await fetch(`${this.apiBase}/memory/search`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ query, type: 'business_ideas' })
                    });
                    
                    const results = await response.json();
                    this.displayMemorySearchResults(results);
                    
                } catch (error) {
                    console.error('Memory search failed:', error);
                    alert('Memory search failed: ' + error.message);
                }
            }
            
            displayRuneScapeResults(result) {
                const container = document.getElementById('runescapeResults');
                
                if (!result.stats) {
                    this.showError('runescapeResults', 'No stats data available');
                    return;
                }
                
                const totalLevel = result.stats.totalLevel || 0;
                const combatLevel = result.stats.combatLevel || 0;
                
                let statsHTML = '';
                Object.entries(result.stats).forEach(([skill, data]) => {
                    if (typeof data === 'object' && data.level) {
                        statsHTML += `
                            <div class="stat-card">
                                <div class="stat-name">${data.name}</div>
                                <div class="stat-level">${data.level}</div>
                                <div class="stat-xp">${data.xp?.toLocaleString()} XP</div>
                            </div>
                        `;
                    }
                });
                
                let efficiencyHTML = '';
                if (result.efficiency && result.efficiency.recommendations) {
                    efficiencyHTML = `
                        <div class="efficiency-recommendations">
                            <h4>🎯 Efficiency Recommendations</h4>
                            ${result.efficiency.recommendations.map(rec => `
                                <div class="recommendation-item">
                                    <strong>${rec.skill.charAt(0).toUpperCase() + rec.skill.slice(1)}:</strong> ${rec.action}<br>
                                    <small>Est. Time: ${rec.estimatedTime}h | Profit: ${rec.profit.toLocaleString()} GP</small>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
                
                container.innerHTML = `
                    <h3>🎮 ${result.username} - High Scores & Analysis</h3>
                    <div class="result-item">
                        <strong>Total Level:</strong> ${totalLevel} | <strong>Combat Level:</strong> ${combatLevel}
                        ${result.cached ? ' | <span style="color: #88ffff;">Cached</span>' : ''}
                        <br><small>Last Updated: ${new Date(result.lastUpdated).toLocaleString()}</small>
                    </div>
                    
                    <div class="runescape-stats">
                        ${statsHTML}
                    </div>
                    
                    ${efficiencyHTML}
                `;
            }
            
            displayQueryResults(result) {
                const container = document.getElementById('queryResults');
                
                if (!result.results) {
                    this.showError('queryResults', 'No results returned');
                    return;
                }
                
                const results = Array.isArray(result.results) ? result.results : [result.results];
                
                let tableHTML = '';
                if (results.length > 0 && typeof results[0] === 'object') {
                    const headers = Object.keys(results[0]);
                    
                    tableHTML = `
                        <table class="query-result-table">
                            <thead>
                                <tr>
                                    ${headers.map(h => `<th>${h}</th>`).join('')}
                                </tr>
                            </thead>
                            <tbody>
                                ${results.slice(0, 50).map(row => `
                                    <tr>
                                        ${headers.map(h => `<td>${row[h] || ''}</td>`).join('')}
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                }
                
                container.innerHTML = `
                    <h3>🗄️ Query Results</h3>
                    <div class="query-info">
                        <strong>Question:</strong> ${result.question}<br>
                        <strong>Database:</strong> ${result.targetDatabase || 'All databases'}<br>
                        <strong>Results:</strong> ${result.resultCount} rows in ${result.executionTime}ms
                        ${result.cached ? ' | <span style="color: #88ffff;">Cached</span>' : ''}
                        
                        <div class="query-sql">
                            <strong>Generated SQL:</strong><br>
                            ${result.sqlQuery}
                        </div>
                    </div>
                    
                    ${tableHTML || `<div class="no-results">No tabular data to display</div>`}
                `;
            }
            
            displayConversationResults(result) {
                const container = document.getElementById('conversationResults');
                
                const insights = result.insights || {};
                
                container.innerHTML = `
                    <h3>💬 Conversation Analysis</h3>
                    <div class="result-item">
                        <strong>File:</strong> ${result.filePath}<br>
                        <strong>Participants:</strong> ${insights.participants?.join(', ') || 'None detected'}<br>
                        <strong>Analysis Type:</strong> ${result.analysisType}
                    </div>
                    
                    <div class="conversation-insights">
                        <div class="insight-category">
                            <h4>💡 Business Ideas</h4>
                            ${insights.businessIdeas?.slice(0, 5).map(idea => `
                                <div class="insight-item">
                                    <strong>${idea.speaker}:</strong> ${idea.content?.substring(0, 100)}...
                                </div>
                            `).join('') || '<div class="insight-item">No business ideas detected</div>'}
                        </div>
                        
                        <div class="insight-category">
                            <h4>📋 Action Items</h4>
                            ${insights.actionItems?.slice(0, 5).map(action => `
                                <div class="insight-item">
                                    <strong>${action.speaker}:</strong> ${action.content?.substring(0, 100)}...
                                </div>
                            `).join('') || '<div class="insight-item">No action items detected</div>'}
                        </div>
                    </div>
                `;
            }
            
            displayLLMResults(result) {
                const container = document.getElementById('llmResults');
                
                const stepsHTML = result.stepResults?.map(step => `
                    <div class="llm-chain-step">
                        <div class="llm-step-header">
                            <span class="llm-step-name">Step: ${step.step}</span>
                            <span class="llm-step-time">${new Date(step.timestamp).toLocaleTimeString()}</span>
                        </div>
                        <div class="llm-step-content">
                            ${JSON.stringify(step.output, null, 2)}
                        </div>
                    </div>
                `).join('') || '';
                
                container.innerHTML = `
                    <h3>🤖 LLM Chain Pipeline Results</h3>
                    <div class="result-item">
                        <strong>Output Format:</strong> ${result.outputFormat}<br>
                        <strong>Chain Steps:</strong> ${result.chainSteps?.join(' → ') || 'Default'}<br>
                        <strong>Processing Time:</strong> ${result.processingTime}ms
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <h4>Processing Steps:</h4>
                        ${stepsHTML}
                    </div>
                    
                    <div class="result-item" style="margin-top: 20px;">
                        <h4>Final Output:</h4>
                        <div style="background: rgba(0,0,0,0.6); padding: 15px; border-radius: 8px; margin-top: 10px;">
                            <pre style="white-space: pre-wrap; margin: 0;">${JSON.stringify(result.finalOutput, null, 2)}</pre>
                        </div>
                    </div>
                `;
            }
            
            displayMemorySearchResults(results) {
                if (!results || results.length === 0) {
                    alert('No memory results found');
                    return;
                }
                
                const container = document.getElementById('conversationResults');
                
                container.innerHTML = `
                    <h3>🧠 Memory Graph Search Results</h3>
                    ${results.slice(0, 10).map(memory => `
                        <div class="result-item">
                            <strong>Relevance:</strong> ${memory.relevanceScore.toFixed(2)}<br>
                            <strong>Participants:</strong> ${memory.participants?.join(', ') || 'Unknown'}<br>
                            <strong>Business Ideas:</strong> ${memory.businessIdeas?.length || 0}<br>
                            <strong>Action Items:</strong> ${memory.actionItems?.length || 0}<br>
                            <strong>Connections:</strong> ${memory.connections?.length || 0}
                        </div>
                    `).join('')}
                `;
                
                this.switchTab('conversation');
            }
            
            showError(containerId, message) {
                const container = document.getElementById(containerId);
                container.innerHTML = `<div class="error-message">❌ ${message}</div>`;
            }
        }
        
        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', () => {
            window.dashboard = new UniversalQueryDashboard();
        });
        
        // Global functions for button clicks
        function lookupRuneScapePlayer() {
            window.dashboard.lookupRuneScapePlayer();
        }
        
        function executeNaturalQuery() {
            window.dashboard.executeNaturalQuery();
        }
        
        function analyzeConversation() {
            window.dashboard.analyzeConversation();
        }
        
        function runLLMChain() {
            window.dashboard.runLLMChain();
        }
        
        function quickExample() {
            window.dashboard.quickExample();
        }
        
        function searchMemoryGraph() {
            window.dashboard.searchMemoryGraph();
        }
        
        function loadDatabases() {
            window.dashboard.loadDatabases();
        }
    </script>
</body>
</html>