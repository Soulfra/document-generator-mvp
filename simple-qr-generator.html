<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Empire QR Generator</title>
    <style>
        body {
            background: #000;
            color: #00ff00;
            font-family: monospace;
            padding: 20px;
            text-align: center;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .empire-item {
            background: rgba(0,255,0,0.1);
            border: 2px solid #00ff00;
            margin: 20px 0;
            padding: 20px;
            border-radius: 10px;
        }
        
        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 15px 25px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
        }
        
        .qr-code {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            display: inline-block;
        }
        
        .share-url {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            word-break: break-all;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì± Empire QR Generator</h1>
        <p>Generate QR codes for your empire components</p>
        
        <div class="empire-item">
            <h3>ü§ñ Agent System</h3>
            <p>Reward: $5,000</p>
            <button onclick="generateQR('agent', 5000, 'ü§ñ')">Generate QR</button>
            <div id="qr-agent"></div>
        </div>
        
        <div class="empire-item">
            <h3>üíé Crypto Mining</h3>
            <p>Reward: $10,000</p>
            <button onclick="generateQR('crypto', 10000, 'üíé')">Generate QR</button>
            <div id="qr-crypto"></div>
        </div>
        
        <div class="empire-item">
            <h3>üéÆ Gaming Platform</h3>
            <p>Reward: $7,500</p>
            <button onclick="generateQR('gaming', 7500, 'üéÆ')">Generate QR</button>
            <div id="qr-gaming"></div>
        </div>
        
        <div class="empire-item">
            <h3>üö¢ Invite to Game</h3>
            <p>Share the main game</p>
            <button onclick="generateGameInvite()">Generate Game Invite</button>
            <div id="qr-game"></div>
        </div>
        
        <div class="empire-item">
            <h3>üìç Location Battle</h3>
            <p>Share your empire location</p>
            <button onclick="generateLocationQR()">Generate Location QR</button>
            <div id="qr-location"></div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script>
        function generateQR(type, reward, emoji) {
            // Create a simple reward URL
            const rewardData = {
                type: type,
                reward: reward,
                emoji: emoji,
                timestamp: Date.now()
            };
            
            // Encode the data
            const rewardUrl = `${window.location.origin}/claim?data=${encodeURIComponent(JSON.stringify(rewardData))}`;
            
            // Generate QR code
            const canvas = document.createElement('canvas');
            QRCode.toCanvas(canvas, rewardUrl, {
                width: 200,
                margin: 2,
                color: {
                    dark: '#000000',
                    light: '#FFFFFF'
                }
            }, function (error) {
                if (error) {
                    console.error(error);
                    return;
                }
                
                const container = document.getElementById(`qr-${type}`);
                container.innerHTML = '';
                
                const qrDiv = document.createElement('div');
                qrDiv.className = 'qr-code';
                qrDiv.appendChild(canvas);
                
                const urlDiv = document.createElement('div');
                urlDiv.className = 'share-url';
                urlDiv.textContent = rewardUrl;
                
                const shareBtn = document.createElement('button');
                shareBtn.textContent = 'üì§ Share';
                shareBtn.onclick = () => shareQR(rewardUrl, `${emoji} Empire Reward: $${reward.toLocaleString()}`);
                
                container.appendChild(qrDiv);
                container.appendChild(urlDiv);
                container.appendChild(shareBtn);
            });
        }
        
        function generateGameInvite() {
            const gameUrl = window.location.href.replace('simple-qr-generator.html', 'simple-mobile-game.html');
            
            const canvas = document.createElement('canvas');
            QRCode.toCanvas(canvas, gameUrl, {
                width: 200,
                margin: 2,
                color: {
                    dark: '#000000',
                    light: '#FFFFFF'
                }
            }, function (error) {
                if (error) {
                    console.error(error);
                    return;
                }
                
                const container = document.getElementById('qr-game');
                container.innerHTML = '';
                
                const qrDiv = document.createElement('div');
                qrDiv.className = 'qr-code';
                qrDiv.appendChild(canvas);
                
                const urlDiv = document.createElement('div');
                urlDiv.className = 'share-url';
                urlDiv.textContent = gameUrl;
                
                const shareBtn = document.createElement('button');
                shareBtn.textContent = 'üì§ Share to Snapchat';
                shareBtn.onclick = () => shareQR(gameUrl, 'üö¢ Join my ShipRekt Empire!');
                
                container.appendChild(qrDiv);
                container.appendChild(urlDiv);
                container.appendChild(shareBtn);
            });
        }
        
        function shareQR(url, message) {
            if (navigator.share) {
                navigator.share({
                    title: 'ShipRekt Empire',
                    text: message,
                    url: url
                }).catch(err => {
                    copyToClipboard(url);
                    alert('üìã Link copied! Share it with your brother!');
                });
            } else {
                copyToClipboard(url);
                alert('üìã Link copied! Share it with your brother!');
            }
        }
        
        function copyToClipboard(text) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text);
            } else {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
            }
        }
        
        // Handle QR code claims
        window.addEventListener('load', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const claimData = urlParams.get('data');
            
            if (claimData) {
                try {
                    const reward = JSON.parse(decodeURIComponent(claimData));
                    
                    // Show claim success
                    document.body.innerHTML = `
                        <div style="text-align: center; padding: 40px;">
                            <h1>üéâ Empire Component Claimed!</h1>
                            <div style="font-size: 80px; margin: 20px;">${reward.emoji}</div>
                            <h2>+$${reward.reward.toLocaleString()}</h2>
                            <p style="margin: 20px 0;">You found a ${reward.type} system!</p>
                            <button onclick="openGame()" style="background: #00ff00; color: #000; border: none; padding: 20px 40px; font-size: 18px; border-radius: 10px; cursor: pointer;">
                                üö¢ Open ShipRekt Game
                            </button>
                        </div>
                    `;
                    
                    // Vibrate if supported
                    if (navigator.vibrate) {
                        navigator.vibrate([200, 100, 200, 100, 200]);
                    }
                    
                } catch (e) {
                    console.error('Invalid claim data:', e);
                }
            }
        });
        
        function generateLocationQR() {
            showNotification('üìç Getting your location...');
            
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    position => {
                        const locationData = {
                            type: 'empire-location',
                            lat: position.coords.latitude,
                            lng: position.coords.longitude,
                            empire: Math.floor(Math.random() * 50000) + 10000, // Random empire value
                            player: 'ShipRekt Captain',
                            timestamp: Date.now(),
                            accuracy: position.coords.accuracy
                        };
                        
                        // Create Google Maps URL
                        const mapsUrl = `https://maps.google.com/maps?q=${locationData.lat},${locationData.lng}&z=15`;
                        
                        // Create game join URL with location
                        const gameUrl = `${window.location.origin}/simple-mobile-game.html?location=${encodeURIComponent(JSON.stringify(locationData))}`;
                        
                        const canvas = document.createElement('canvas');
                        QRCode.toCanvas(canvas, gameUrl, {
                            width: 200,
                            margin: 2,
                            color: {
                                dark: '#000000',
                                light: '#FFFFFF'
                            }
                        }, function (error) {
                            if (error) {
                                console.error(error);
                                return;
                            }
                            
                            const container = document.getElementById('qr-location');
                            container.innerHTML = '';
                            
                            const qrDiv = document.createElement('div');
                            qrDiv.className = 'qr-code';
                            qrDiv.appendChild(canvas);
                            
                            const urlDiv = document.createElement('div');
                            urlDiv.className = 'share-url';
                            urlDiv.innerHTML = `
                                <strong>Game:</strong> ${gameUrl}<br>
                                <strong>Maps:</strong> ${mapsUrl}<br>
                                <strong>Empire:</strong> $${locationData.empire.toLocaleString()}<br>
                                <strong>Coords:</strong> ${locationData.lat.toFixed(4)}, ${locationData.lng.toFixed(4)}
                            `;
                            
                            const shareBtn = document.createElement('button');
                            shareBtn.textContent = 'üìç Share Location Battle';
                            shareBtn.onclick = () => shareLocationBattle(gameUrl, mapsUrl, locationData);
                            
                            container.appendChild(qrDiv);
                            container.appendChild(urlDiv);
                            container.appendChild(shareBtn);
                            
                            showNotification('üìç Location QR created! Share with your bro to battle here!');
                        });
                    },
                    error => {
                        showNotification('‚ùå Location access denied. Enable GPS for location battles!');
                        console.error('Location error:', error);
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 300000
                    }
                );
            } else {
                showNotification('‚ùå GPS not supported on this device');
            }
        }
        
        function shareLocationBattle(gameUrl, mapsUrl, locationData) {
            const message = `üö¢ Battle me at my ShipRekt Empire! I'm here with $${locationData.empire.toLocaleString()} empire value!`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'üìç ShipRekt Empire Battle Challenge',
                    text: message,
                    url: gameUrl
                }).catch(() => {
                    // Fallback to maps URL if game URL fails
                    navigator.share({
                        title: 'üìç Meet me here!',
                        text: message,
                        url: mapsUrl
                    }).catch(() => {
                        copyToClipboard(gameUrl);
                        showNotification('üìã Battle link copied! Send to your bro!');
                    });
                });
            } else {
                copyToClipboard(gameUrl);
                showNotification('üìã Battle link copied! Send to your bro!');
            }
        }
        
        function showNotification(message) {
            // Simple notification for QR generator
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0,255,0,0.9);
                color: #000;
                padding: 20px;
                border-radius: 10px;
                z-index: 1000;
                font-weight: bold;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 3000);
        }
        
        function openGame() {
            window.location.href = 'simple-mobile-game.html';
        }
        
        // Handle location data passed from mobile game
        window.addEventListener('load', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const locationParam = urlParams.get('location');
            
            if (locationParam) {
                try {
                    const locationData = JSON.parse(decodeURIComponent(locationParam));
                    showNotification(`üìç Location received! Lat: ${locationData.lat.toFixed(4)}, Lng: ${locationData.lng.toFixed(4)}`);
                    
                    // Auto-generate QR for the location
                    setTimeout(() => {
                        generateLocationQRFromData(locationData);
                    }, 1000);
                    
                } catch (e) {
                    console.error('Invalid location data:', e);
                }
            }
        });
        
        function generateLocationQRFromData(locationData) {
            const gameUrl = `${window.location.origin}/simple-mobile-game.html?location=${encodeURIComponent(JSON.stringify(locationData))}`;
            
            const canvas = document.createElement('canvas');
            QRCode.toCanvas(canvas, gameUrl, {
                width: 200,
                margin: 2,
                color: {
                    dark: '#000000',
                    light: '#FFFFFF'
                }
            }, function (error) {
                if (error) {
                    console.error(error);
                    return;
                }
                
                const container = document.getElementById('qr-location');
                container.innerHTML = '';
                
                const qrDiv = document.createElement('div');
                qrDiv.className = 'qr-code';
                qrDiv.appendChild(canvas);
                
                const urlDiv = document.createElement('div');
                urlDiv.className = 'share-url';
                urlDiv.innerHTML = `
                    <strong>Empire Battle Location</strong><br>
                    Empire Value: $${locationData.empire.toLocaleString()}<br>
                    Coordinates: ${locationData.lat.toFixed(4)}, ${locationData.lng.toFixed(4)}<br>
                    Player: ${locationData.player}
                `;
                
                const shareBtn = document.createElement('button');
                shareBtn.textContent = 'üìç Share Battle Invite';
                shareBtn.onclick = () => shareLocationBattle(gameUrl, `https://maps.google.com/maps?q=${locationData.lat},${locationData.lng}&z=15`, locationData);
                
                container.appendChild(qrDiv);
                container.appendChild(urlDiv);
                container.appendChild(shareBtn);
            });
        }
        
        console.log('üì± QR Generator ready!');
        console.log('Generate QR codes and share with friends!');
        console.log('üìç Location battles now supported!');
    </script>
</body>
</html>