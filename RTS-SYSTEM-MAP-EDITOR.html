<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RTS System Map Editor - 459 Layer Universe Builder</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: #1a1a1a;
            font-family: 'Courier New', monospace;
            overflow: hidden;
            color: #ffffff;
        }

        #mapEditor {
            width: 100vw;
            height: 100vh;
            position: relative;
            background: radial-gradient(circle at center, #2a2a2a 0%, #1a1a1a 100%);
        }

        /* Top Toolbar */
        #topToolbar {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 60px;
            background: linear-gradient(135deg, #333333, #2a2a2a);
            border-bottom: 2px solid #00ff00;
            display: flex;
            align-items: center;
            padding: 0 20px;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        }

        .toolbar-section {
            display: flex;
            align-items: center;
            margin-right: 30px;
            padding-right: 20px;
            border-right: 1px solid #555;
        }

        .toolbar-section:last-child {
            border-right: none;
            margin-left: auto;
        }

        .toolbar-btn {
            background: linear-gradient(135deg, #4a4a4a, #3a3a3a);
            border: 1px solid #666;
            color: #ffffff;
            padding: 8px 15px;
            margin: 0 5px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.3s;
            text-transform: uppercase;
        }

        .toolbar-btn:hover {
            background: linear-gradient(135deg, #5a5a5a, #4a4a4a);
            border-color: #00ff00;
            transform: translateY(-1px);
        }

        .toolbar-btn.active {
            background: linear-gradient(135deg, #00ff00, #00cc00);
            color: #000000;
            font-weight: bold;
        }

        .toolbar-label {
            color: #cccccc;
            font-size: 10px;
            margin-right: 10px;
            text-transform: uppercase;
        }

        /* Left Palette */
        #leftPalette {
            position: absolute;
            left: 0;
            top: 60px;
            width: 280px;
            height: calc(100vh - 60px);
            background: linear-gradient(135deg, #2a2a2a, #1a1a1a);
            border-right: 2px solid #00ff00;
            overflow-y: auto;
            z-index: 1000;
        }

        .palette-section {
            border-bottom: 1px solid #444;
            padding: 15px;
        }

        .palette-title {
            color: #00ff00;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 10px;
            text-transform: uppercase;
            border-bottom: 1px solid #00ff00;
            padding-bottom: 5px;
        }

        .palette-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 10px;
        }

        .palette-item {
            background: linear-gradient(135deg, #3a3a3a, #2a2a2a);
            border: 2px solid #555;
            border-radius: 6px;
            padding: 12px 8px;
            text-align: center;
            cursor: grab;
            transition: all 0.3s;
            font-size: 9px;
            line-height: 1.2;
        }

        .palette-item:hover {
            border-color: #00ff00;
            background: linear-gradient(135deg, #4a4a4a, #3a3a3a);
            transform: scale(1.05);
        }

        .palette-item.selected {
            border-color: #00ff00;
            background: linear-gradient(135deg, #00ff00, #00cc00);
            color: #000000;
            font-weight: bold;
        }

        .palette-icon {
            font-size: 16px;
            margin-bottom: 4px;
            display: block;
        }

        /* Right Properties Panel */
        #rightPanel {
            position: absolute;
            right: 0;
            top: 60px;
            width: 300px;
            height: calc(100vh - 60px);
            background: linear-gradient(135deg, #2a2a2a, #1a1a1a);
            border-left: 2px solid #00ff00;
            overflow-y: auto;
            z-index: 1000;
        }

        .properties-section {
            border-bottom: 1px solid #444;
            padding: 15px;
        }

        .properties-title {
            color: #00ffff;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .property-item {
            margin: 8px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .property-label {
            color: #cccccc;
            font-size: 10px;
            text-transform: uppercase;
        }

        .property-value {
            color: #ffffff;
            background: #333;
            border: 1px solid #555;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 10px;
            width: 120px;
        }

        .property-slider {
            width: 120px;
            height: 20px;
            background: #333;
            border-radius: 10px;
            position: relative;
            cursor: pointer;
        }

        .slider-handle {
            width: 16px;
            height: 16px;
            background: #00ff00;
            border-radius: 50%;
            position: absolute;
            top: 2px;
            cursor: grab;
        }

        /* Bottom Status Bar */
        #bottomStatus {
            position: absolute;
            bottom: 0;
            left: 280px;
            right: 300px;
            height: 40px;
            background: linear-gradient(135deg, #333333, #2a2a2a);
            border-top: 2px solid #00ff00;
            display: flex;
            align-items: center;
            padding: 0 20px;
            z-index: 1000;
        }

        .status-item {
            margin-right: 20px;
            font-size: 10px;
            display: flex;
            align-items: center;
        }

        .status-label {
            color: #cccccc;
            margin-right: 8px;
        }

        .status-value {
            color: #00ff00;
            font-weight: bold;
        }

        /* Main Viewport */
        #viewport {
            position: absolute;
            left: 280px;
            top: 60px;
            right: 300px;
            bottom: 40px;
            background: #000000;
            border: 2px solid #333;
            overflow: hidden;
        }

        /* RTS Camera Controls */
        #cameraControls {
            position: absolute;
            bottom: 60px;
            right: 320px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #00ff00;
            border-radius: 8px;
            padding: 10px;
            z-index: 1001;
        }

        .camera-btn {
            background: #333;
            border: 1px solid #666;
            color: #ffffff;
            padding: 6px 10px;
            margin: 2px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 9px;
            transition: all 0.3s;
        }

        .camera-btn:hover {
            background: #555;
            border-color: #00ff00;
        }

        .camera-btn.active {
            background: #00ff00;
            color: #000000;
        }

        /* Layer Navigator */
        #layerNavigator {
            position: absolute;
            top: 80px;
            left: 300px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #ff6b9d;
            border-radius: 8px;
            padding: 15px;
            z-index: 1001;
            min-width: 250px;
        }

        .layer-nav-title {
            color: #ff6b9d;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }

        .layer-slider-container {
            margin: 10px 0;
        }

        .layer-slider {
            width: 100%;
            height: 6px;
            background: #333;
            border-radius: 3px;
            appearance: none;
            cursor: pointer;
        }

        .layer-slider::-webkit-slider-thumb {
            appearance: none;
            width: 16px;
            height: 16px;
            background: #ff6b9d;
            border-radius: 50%;
            cursor: pointer;
        }

        .layer-info {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: #cccccc;
            margin-top: 5px;
        }

        /* Build Queue */
        #buildQueue {
            position: absolute;
            bottom: 60px;
            left: 300px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #ffd700;
            border-radius: 8px;
            padding: 15px;
            z-index: 1001;
            min-width: 300px;
        }

        .queue-title {
            color: #ffd700;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }

        .queue-item {
            background: rgba(255, 215, 0, 0.1);
            border: 1px solid #ffd700;
            border-radius: 4px;
            padding: 8px;
            margin: 5px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 10px;
        }

        .queue-progress {
            width: 60px;
            height: 4px;
            background: #333;
            border-radius: 2px;
            overflow: hidden;
        }

        .queue-progress-bar {
            height: 100%;
            background: #ffd700;
            transition: width 0.3s;
        }

        /* Testing Panel */
        #testingPanel {
            position: absolute;
            top: 80px;
            right: 320px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #00ffff;
            border-radius: 8px;
            padding: 15px;
            z-index: 1001;
            min-width: 250px;
        }

        .testing-title {
            color: #00ffff;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
        }

        .test-result {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid #00ffff;
            border-radius: 4px;
            padding: 8px;
            margin: 5px 0;
            font-size: 10px;
        }

        .test-result.pass {
            border-color: #00ff00;
            background: rgba(0, 255, 0, 0.1);
        }

        .test-result.fail {
            border-color: #ff0000;
            background: rgba(255, 0, 0, 0.1);
        }

        /* Mini Map */
        #miniMapRTS {
            position: absolute;
            top: 80px;
            right: 20px;
            width: 200px;
            height: 150px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #ffffff;
            border-radius: 8px;
            overflow: hidden;
            z-index: 1001;
        }

        #miniMapCanvas {
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        /* Selection Box */
        .selection-box {
            position: absolute;
            border: 2px dashed #00ff00;
            background: rgba(0, 255, 0, 0.1);
            pointer-events: none;
            z-index: 999;
        }

        /* Context Menu */
        #contextMenu {
            position: absolute;
            background: linear-gradient(135deg, #3a3a3a, #2a2a2a);
            border: 2px solid #00ff00;
            border-radius: 6px;
            padding: 8px 0;
            z-index: 2000;
            display: none;
            min-width: 150px;
        }

        .context-item {
            padding: 8px 15px;
            font-size: 11px;
            cursor: pointer;
            color: #ffffff;
            transition: all 0.3s;
        }

        .context-item:hover {
            background: #00ff00;
            color: #000000;
        }

        /* Grid Overlay */
        .grid-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            opacity: 0.3;
            background-image: 
                linear-gradient(rgba(255,255,255,0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 20px 20px;
        }

        /* Loading Indicator */
        .loading-spinner {
            border: 2px solid #333;
            border-top: 2px solid #00ff00;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-left: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div id="mapEditor">
        <!-- Top Toolbar -->
        <div id="topToolbar">
            <div class="toolbar-section">
                <span class="toolbar-label">File:</span>
                <button class="toolbar-btn" onclick="newMap()">New</button>
                <button class="toolbar-btn" onclick="loadMap()">Load</button>
                <button class="toolbar-btn" onclick="saveMap()">Save</button>
                <button class="toolbar-btn" onclick="exportMap()">Export</button>
            </div>
            
            <div class="toolbar-section">
                <span class="toolbar-label">Mode:</span>
                <button class="toolbar-btn active" id="buildMode" onclick="setMode('build')">Build</button>
                <button class="toolbar-btn" id="testMode" onclick="setMode('test')">Test</button>
                <button class="toolbar-btn" id="debugMode" onclick="setMode('debug')">Debug</button>
            </div>
            
            <div class="toolbar-section">
                <span class="toolbar-label">View:</span>
                <button class="toolbar-btn" onclick="zoomToFit()">Fit All</button>
                <button class="toolbar-btn" onclick="resetCamera()">Reset View</button>
                <button class="toolbar-btn" onclick="toggleGrid()">Grid</button>
                <button class="toolbar-btn" onclick="toggleWireframe()">Wireframe</button>
            </div>
            
            <div class="toolbar-section">
                <span class="toolbar-label">Universe:</span>
                <span class="status-value" id="universeStatus">459 Layers Ready</span>
                <button class="toolbar-btn" onclick="validateUniverse()">Validate</button>
                <button class="toolbar-btn" onclick="simulateLoad()">Simulate</button>
            </div>
        </div>

        <!-- Left Palette -->
        <div id="leftPalette">
            <div class="palette-section">
                <div class="palette-title">üóÑÔ∏è Database Systems</div>
                <div class="palette-grid">
                    <div class="palette-item" draggable="true" data-type="database-core">
                        <span class="palette-icon">üóÉÔ∏è</span>
                        Database<br>Core
                    </div>
                    <div class="palette-item" draggable="true" data-type="schema-validator">
                        <span class="palette-icon">‚úÖ</span>
                        Schema<br>Validator
                    </div>
                    <div class="palette-item" draggable="true" data-type="truth-engine">
                        <span class="palette-icon">üîç</span>
                        Truth<br>Engine
                    </div>
                    <div class="palette-item" draggable="true" data-type="sync-node">
                        <span class="palette-icon">üîÑ</span>
                        Sync<br>Node
                    </div>
                    <div class="palette-item" draggable="true" data-type="backup-system">
                        <span class="palette-icon">üíæ</span>
                        Backup<br>System
                    </div>
                    <div class="palette-item" draggable="true" data-type="cache-layer">
                        <span class="palette-icon">‚ö°</span>
                        Cache<br>Layer
                    </div>
                </div>
            </div>

            <div class="palette-section">
                <div class="palette-title">üõ°Ô∏è Guardian Systems</div>
                <div class="palette-grid">
                    <div class="palette-item" draggable="true" data-type="fed-guardian">
                        <span class="palette-icon">üèõÔ∏è</span>
                        Fed<br>Guardian
                    </div>
                    <div class="palette-item" draggable="true" data-type="exchange-guardian">
                        <span class="palette-icon">üí±</span>
                        Exchange<br>Guardian
                    </div>
                    <div class="palette-item" draggable="true" data-type="crypto-guardian">
                        <span class="palette-icon">‚Çø</span>
                        Crypto<br>Guardian
                    </div>
                    <div class="palette-item" draggable="true" data-type="security-daemon">
                        <span class="palette-icon">üîí</span>
                        Security<br>Daemon
                    </div>
                    <div class="palette-item" draggable="true" data-type="monitor-agent">
                        <span class="palette-icon">üëÅÔ∏è</span>
                        Monitor<br>Agent
                    </div>
                    <div class="palette-item" draggable="true" data-type="alert-system">
                        <span class="palette-icon">üö®</span>
                        Alert<br>System
                    </div>
                </div>
            </div>

            <div class="palette-section">
                <div class="palette-title">üí∞ Economic Systems</div>
                <div class="palette-grid">
                    <div class="palette-item" draggable="true" data-type="currency-node">
                        <span class="palette-icon">üíµ</span>
                        Currency<br>Node
                    </div>
                    <div class="palette-item" draggable="true" data-type="exchange-hub">
                        <span class="palette-icon">üè¶</span>
                        Exchange<br>Hub
                    </div>
                    <div class="palette-item" draggable="true" data-type="trade-engine">
                        <span class="palette-icon">üìà</span>
                        Trade<br>Engine
                    </div>
                    <div class="palette-item" draggable="true" data-type="wallet-system">
                        <span class="palette-icon">üëõ</span>
                        Wallet<br>System
                    </div>
                    <div class="palette-item" draggable="true" data-type="payment-gateway">
                        <span class="palette-icon">üí≥</span>
                        Payment<br>Gateway
                    </div>
                    <div class="palette-item" draggable="true" data-type="audit-trail">
                        <span class="palette-icon">üìã</span>
                        Audit<br>Trail
                    </div>
                </div>
            </div>

            <div class="palette-section">
                <div class="palette-title">üåê Network Systems</div>
                <div class="palette-grid">
                    <div class="palette-item" draggable="true" data-type="load-balancer">
                        <span class="palette-icon">‚öñÔ∏è</span>
                        Load<br>Balancer
                    </div>
                    <div class="palette-item" draggable="true" data-type="api-gateway">
                        <span class="palette-icon">üö™</span>
                        API<br>Gateway
                    </div>
                    <div class="palette-item" draggable="true" data-type="message-queue">
                        <span class="palette-icon">üì¨</span>
                        Message<br>Queue
                    </div>
                    <div class="palette-item" draggable="true" data-type="event-bus">
                        <span class="palette-icon">üöå</span>
                        Event<br>Bus
                    </div>
                    <div class="palette-item" draggable="true" data-type="cdn-node">
                        <span class="palette-icon">üåê</span>
                        CDN<br>Node
                    </div>
                    <div class="palette-item" draggable="true" data-type="proxy-server">
                        <span class="palette-icon">üîÄ</span>
                        Proxy<br>Server
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Viewport -->
        <div id="viewport">
            <canvas id="mapCanvas"></canvas>
            <div class="grid-overlay" id="gridOverlay"></div>
        </div>

        <!-- Right Properties Panel -->
        <div id="rightPanel">
            <div class="properties-section">
                <div class="properties-title">üéØ Selected Object</div>
                <div class="property-item">
                    <span class="property-label">Type:</span>
                    <span class="property-value" id="selectedType">None</span>
                </div>
                <div class="property-item">
                    <span class="property-label">Layer:</span>
                    <span class="property-value" id="selectedLayer">1</span>
                </div>
                <div class="property-item">
                    <span class="property-label">Health:</span>
                    <div class="property-slider">
                        <div class="slider-handle" style="left: 80%"></div>
                    </div>
                </div>
                <div class="property-item">
                    <span class="property-label">Load:</span>
                    <div class="property-slider">
                        <div class="slider-handle" style="left: 45%"></div>
                    </div>
                </div>
            </div>

            <div class="properties-section">
                <div class="properties-title">‚öôÔ∏è System Properties</div>
                <div class="property-item">
                    <span class="property-label">CPU Usage:</span>
                    <span class="property-value" id="cpuUsage">23%</span>
                </div>
                <div class="property-item">
                    <span class="property-label">Memory:</span>
                    <span class="property-value" id="memoryUsage">2.1GB</span>
                </div>
                <div class="property-item">
                    <span class="property-label">Network:</span>
                    <span class="property-value" id="networkUsage">45MB/s</span>
                </div>
                <div class="property-item">
                    <span class="property-label">Throughput:</span>
                    <span class="property-value" id="throughput">1.2K req/s</span>
                </div>
            </div>

            <div class="properties-section">
                <div class="properties-title">üîó Connections</div>
                <div id="connectionsList">
                    <div style="color: #888; font-size: 10px; text-align: center; padding: 20px;">
                        Select an object to view connections
                    </div>
                </div>
            </div>

            <div class="properties-section">
                <div class="properties-title">üìä Performance</div>
                <div class="property-item">
                    <span class="property-label">Response Time:</span>
                    <span class="property-value" id="responseTime">12ms</span>
                </div>
                <div class="property-item">
                    <span class="property-label">Uptime:</span>
                    <span class="property-value" id="uptime">99.9%</span>
                </div>
                <div class="property-item">
                    <span class="property-label">Error Rate:</span>
                    <span class="property-value" id="errorRate">0.01%</span>
                </div>
            </div>
        </div>

        <!-- Camera Controls -->
        <div id="cameraControls">
            <div style="text-align: center; color: #00ff00; font-size: 10px; margin-bottom: 8px;">üìπ CAMERA</div>
            <div>
                <button class="camera-btn active" onclick="setCameraMode('rts')">RTS</button>
                <button class="camera-btn" onclick="setCameraMode('iso')">ISO</button>
                <button class="camera-btn" onclick="setCameraMode('top')">TOP</button>
            </div>
            <div style="margin-top: 8px;">
                <button class="camera-btn" onclick="adjustZoom(-1)">-</button>
                <span style="color: #ffffff; font-size: 9px; margin: 0 8px;" id="zoomLevel">100%</span>
                <button class="camera-btn" onclick="adjustZoom(1)">+</button>
            </div>
        </div>

        <!-- Layer Navigator -->
        <div id="layerNavigator">
            <div class="layer-nav-title">üìö LAYER NAVIGATOR</div>
            <div class="layer-slider-container">
                <input type="range" class="layer-slider" id="layerSlider" min="1" max="459" value="1">
                <div class="layer-info">
                    <span>Layer <span id="currentLayerNum">1</span></span>
                    <span id="currentLayerName">Foundation Core</span>
                </div>
            </div>
            <div style="margin-top: 10px; font-size: 9px; color: #888;">
                <div>Dimension: <span id="currentDimension">Reality-Prime</span></div>
                <div>Entities: <span id="layerEntityCount">24</span></div>
                <div>Status: <span id="layerStatus" style="color: #00ff00;">Active</span></div>
            </div>
        </div>

        <!-- Build Queue -->
        <div id="buildQueue">
            <div class="queue-title">üèóÔ∏è BUILD QUEUE</div>
            <div id="queueList">
                <div class="queue-item">
                    <span>Database Core</span>
                    <div class="queue-progress">
                        <div class="queue-progress-bar" style="width: 75%"></div>
                    </div>
                </div>
                <div class="queue-item">
                    <span>Guardian System</span>
                    <div class="queue-progress">
                        <div class="queue-progress-bar" style="width: 25%"></div>
                    </div>
                </div>
                <div class="queue-item">
                    <span>Exchange Hub</span>
                    <div class="queue-progress">
                        <div class="queue-progress-bar" style="width: 0%"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Testing Panel -->
        <div id="testingPanel">
            <div class="testing-title">üß™ LIVE TESTING</div>
            <div id="testResults">
                <div class="test-result pass">‚úÖ Database connectivity: PASS</div>
                <div class="test-result pass">‚úÖ Guardian health check: PASS</div>
                <div class="test-result fail">‚ùå Schema validation: FAIL</div>
                <div class="test-result pass">‚úÖ Network latency: PASS</div>
                <div class="test-result">‚è≥ Load balancer test: RUNNING</div>
            </div>
            <div style="margin-top: 10px;">
                <button class="toolbar-btn" onclick="runAllTests()">Run All Tests</button>
                <button class="toolbar-btn" onclick="clearTests()">Clear</button>
            </div>
        </div>

        <!-- Mini Map -->
        <div id="miniMapRTS">
            <canvas id="miniMapCanvas" width="196" height="146"></canvas>
        </div>

        <!-- Bottom Status Bar -->
        <div id="bottomStatus">
            <div class="status-item">
                <span class="status-label">Mode:</span>
                <span class="status-value" id="currentMode">Build</span>
            </div>
            <div class="status-item">
                <span class="status-label">Layer:</span>
                <span class="status-value" id="statusLayer">1/459</span>
            </div>
            <div class="status-item">
                <span class="status-label">Objects:</span>
                <span class="status-value" id="objectCount">0</span>
            </div>
            <div class="status-item">
                <span class="status-label">Selected:</span>
                <span class="status-value" id="selectedCount">0</span>
            </div>
            <div class="status-item">
                <span class="status-label">FPS:</span>
                <span class="status-value" id="fpsCounter">60</span>
            </div>
            <div class="status-item">
                <span class="status-label">Zoom:</span>
                <span class="status-value" id="zoomStatus">100%</span>
            </div>
            <div class="status-item">
                <span class="status-label">Grid:</span>
                <span class="status-value" id="gridStatus">ON</span>
            </div>
        </div>

        <!-- Context Menu -->
        <div id="contextMenu">
            <div class="context-item" onclick="duplicateObject()">Duplicate</div>
            <div class="context-item" onclick="deleteObject()">Delete</div>
            <div class="context-item" onclick="editProperties()">Properties</div>
            <div class="context-item" onclick="testObject()">Test</div>
            <div class="context-item" onclick="viewConnections()">View Connections</div>
        </div>
    </div>

    <script>
        class RTSSystemMapEditor {
            constructor() {
                this.canvas = document.getElementById('mapCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.miniMapCanvas = document.getElementById('miniMapCanvas');
                this.miniMapCtx = this.miniMapCanvas.getContext('2d');
                
                this.camera = {
                    x: 0,
                    y: 0,
                    zoom: 1,
                    mode: 'rts', // rts, iso, top
                    isDragging: false,
                    lastX: 0,
                    lastY: 0
                };
                
                this.editor = {
                    mode: 'build', // build, test, debug
                    currentLayer: 1,
                    totalLayers: 459,
                    selectedTool: null,
                    selectedObjects: [],
                    clipboard: [],
                    gridEnabled: true,
                    gridSize: 20,
                    wireframeMode: false
                };
                
                this.universe = {
                    layers: new Map(),
                    objects: new Map(),
                    connections: new Map(),
                    buildQueue: [],
                    testResults: new Map()
                };
                
                this.mouse = {
                    x: 0,
                    y: 0,
                    worldX: 0,
                    worldY: 0,
                    isDown: false,
                    button: 0
                };
                
                this.initializeEditor();
                this.setupEventHandlers();
                this.startGameLoop();
                
                console.log('üéÆ RTS System Map Editor initialized');
                console.log('üó∫Ô∏è 459-layer universe ready for construction');
            }
            
            initializeEditor() {
                // Set canvas size
                this.resizeCanvas();
                
                // Initialize first layer
                this.initializeLayer(1);
                
                // Setup drag and drop
                this.setupDragAndDrop();
                
                // Initialize UI elements
                this.updateUI();
                
                console.log('‚úÖ Map editor ready - Start building your universe!');
            }
            
            resizeCanvas() {
                const viewport = document.getElementById('viewport');
                this.canvas.width = viewport.clientWidth;
                this.canvas.height = viewport.clientHeight;
                
                // High DPI support
                const dpr = window.devicePixelRatio || 1;
                const rect = this.canvas.getBoundingClientRect();
                
                this.canvas.width = rect.width * dpr;
                this.canvas.height = rect.height * dpr;
                this.ctx.scale(dpr, dpr);
                
                this.canvas.style.width = rect.width + 'px';
                this.canvas.style.height = rect.height + 'px';
            }
            
            initializeLayer(layerNum) {
                if (!this.universe.layers.has(layerNum)) {
                    const layer = {
                        id: layerNum,
                        name: this.getLayerName(layerNum),
                        dimension: this.getLayerDimension(layerNum),
                        objects: new Map(),
                        connections: [],
                        status: 'active',
                        entityCount: 0
                    };
                    
                    this.universe.layers.set(layerNum, layer);
                    
                    // Add some default objects for testing
                    if (layerNum === 1) {
                        this.addDefaultObjects(layer);
                    }
                }
            }
            
            getLayerName(layerNum) {
                const names = [
                    'Foundation Core', 'Database Layer', 'Guardian Network', 'Exchange Hub',
                    'Currency Matrix', 'Federation Control', 'Schema Validation', 'Truth Engine',
                    'Sync Protocol', 'Cache System', 'Load Balancer', 'API Gateway',
                    'Security Layer', 'Monitor Network', 'Backup System', 'Recovery Point'
                ];
                return names[(layerNum - 1) % names.length] + ` ${layerNum}`;
            }
            
            getLayerDimension(layerNum) {
                const dimensions = ['Reality-Prime', 'Federation', 'Quantum', 'Chaos', 'Meta'];
                return dimensions[Math.floor((layerNum - 1) / 92)];
            }
            
            addDefaultObjects(layer) {
                // Add some sample objects to demonstrate functionality
                const objects = [
                    { type: 'database-core', x: 100, y: 100, id: 'db_001' },
                    { type: 'fed-guardian', x: 200, y: 150, id: 'guard_001' },
                    { type: 'exchange-hub', x: 300, y: 120, id: 'exchange_001' },
                    { type: 'schema-validator', x: 150, y: 200, id: 'validator_001' }
                ];
                
                objects.forEach(obj => {
                    const gameObject = this.createGameObject(obj.type, obj.x, obj.y, obj.id);
                    layer.objects.set(obj.id, gameObject);
                    this.universe.objects.set(obj.id, gameObject);
                    layer.entityCount++;
                });
                
                console.log(`‚ú® Layer ${layer.id} initialized with ${objects.length} default objects`);
            }
            
            createGameObject(type, x, y, id) {
                const objectTypes = {
                    'database-core': { color: '#0099ff', size: 30, icon: 'üóÉÔ∏è', health: 100 },
                    'fed-guardian': { color: '#00ff00', size: 25, icon: 'üèõÔ∏è', health: 95 },
                    'exchange-hub': { color: '#ffd700', size: 35, icon: 'üè¶', health: 88 },
                    'schema-validator': { color: '#ff6b9d', size: 20, icon: '‚úÖ', health: 92 },
                    'currency-node': { color: '#ff9900', size: 25, icon: 'üíµ', health: 90 },
                    'crypto-guardian': { color: '#ff6600', size: 25, icon: '‚Çø', health: 85 },
                    'load-balancer': { color: '#9900ff', size: 30, icon: '‚öñÔ∏è', health: 97 },
                    'api-gateway': { color: '#00ffff', size: 28, icon: 'üö™', health: 93 }
                };
                
                const config = objectTypes[type] || objectTypes['database-core'];
                
                return {
                    id: id || `${type}_${Date.now()}`,
                    type: type,
                    x: x,
                    y: y,
                    width: config.size,
                    height: config.size,
                    color: config.color,
                    icon: config.icon,
                    health: config.health,
                    load: Math.random() * 100,
                    connections: [],
                    status: 'active',
                    selected: false,
                    layer: this.editor.currentLayer,
                    lastUpdate: Date.now()
                };
            }
            
            setupEventHandlers() {
                // Window resize
                window.addEventListener('resize', () => this.resizeCanvas());
                
                // Canvas mouse events
                this.canvas.addEventListener('mousedown', (e) => this.onMouseDown(e));
                this.canvas.addEventListener('mousemove', (e) => this.onMouseMove(e));
                this.canvas.addEventListener('mouseup', (e) => this.onMouseUp(e));
                this.canvas.addEventListener('wheel', (e) => this.onWheel(e));
                this.canvas.addEventListener('contextmenu', (e) => this.onContextMenu(e));
                
                // Layer slider
                const layerSlider = document.getElementById('layerSlider');
                layerSlider.addEventListener('input', (e) => {
                    this.switchToLayer(parseInt(e.target.value));
                });
                
                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => this.onKeyDown(e));
                document.addEventListener('keyup', (e) => this.onKeyUp(e));
                
                // Palette item selection
                const paletteItems = document.querySelectorAll('.palette-item');
                paletteItems.forEach(item => {
                    item.addEventListener('click', () => this.selectTool(item.dataset.type));
                });
                
                // Mini map click
                this.miniMapCanvas.addEventListener('click', (e) => this.onMiniMapClick(e));
            }
            
            setupDragAndDrop() {
                // Make palette items draggable
                const paletteItems = document.querySelectorAll('.palette-item');
                paletteItems.forEach(item => {
                    item.addEventListener('dragstart', (e) => {
                        e.dataTransfer.setData('text/plain', item.dataset.type);
                        e.dataTransfer.effectAllowed = 'copy';
                    });
                });
                
                // Canvas drop handling
                this.canvas.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    e.dataTransfer.dropEffect = 'copy';
                });
                
                this.canvas.addEventListener('drop', (e) => {
                    e.preventDefault();
                    const type = e.dataTransfer.getData('text/plain');
                    const rect = this.canvas.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    
                    // Convert screen coordinates to world coordinates
                    const worldX = (x - this.canvas.width/2) / this.camera.zoom + this.camera.x;
                    const worldY = (y - this.canvas.height/2) / this.camera.zoom + this.camera.y;
                    
                    this.placeObject(type, worldX, worldY);
                });
            }
            
            onMouseDown(e) {
                const rect = this.canvas.getBoundingClientRect();
                this.mouse.x = e.clientX - rect.left;
                this.mouse.y = e.clientY - rect.top;
                this.mouse.isDown = true;
                this.mouse.button = e.button;
                
                // Convert to world coordinates
                this.updateWorldCoordinates();
                
                if (e.button === 0) { // Left click
                    if (this.editor.selectedTool) {
                        // Place object
                        this.placeObject(this.editor.selectedTool, this.mouse.worldX, this.mouse.worldY);
                    } else {
                        // Select object
                        const clickedObject = this.getObjectAtPosition(this.mouse.worldX, this.mouse.worldY);
                        if (clickedObject) {
                            this.selectObject(clickedObject, !e.ctrlKey);
                        } else {
                            if (!e.ctrlKey) this.clearSelection();
                            // Start camera drag
                            this.camera.isDragging = true;
                            this.camera.lastX = this.mouse.x;
                            this.camera.lastY = this.mouse.y;
                        }
                    }
                } else if (e.button === 2) { // Right click
                    // Context menu will be handled in onContextMenu
                }
            }
            
            onMouseMove(e) {
                const rect = this.canvas.getBoundingClientRect();
                this.mouse.x = e.clientX - rect.left;
                this.mouse.y = e.clientY - rect.top;
                
                this.updateWorldCoordinates();
                
                if (this.mouse.isDown && this.camera.isDragging) {
                    // Pan camera
                    const deltaX = this.mouse.x - this.camera.lastX;
                    const deltaY = this.mouse.y - this.camera.lastY;
                    
                    this.camera.x -= deltaX / this.camera.zoom;
                    this.camera.y -= deltaY / this.camera.zoom;
                    
                    this.camera.lastX = this.mouse.x;
                    this.camera.lastY = this.mouse.y;
                }
            }
            
            onMouseUp(e) {
                this.mouse.isDown = false;
                this.camera.isDragging = false;
            }
            
            onWheel(e) {
                e.preventDefault();
                const zoomFactor = e.deltaY > 0 ? 0.9 : 1.1;
                this.camera.zoom = Math.max(0.1, Math.min(5, this.camera.zoom * zoomFactor));
                this.updateZoomDisplay();
            }
            
            onContextMenu(e) {
                e.preventDefault();
                const contextMenu = document.getElementById('contextMenu');
                contextMenu.style.left = e.clientX + 'px';
                contextMenu.style.top = e.clientY + 'px';
                contextMenu.style.display = 'block';
                
                // Hide menu when clicking elsewhere
                setTimeout(() => {
                    document.addEventListener('click', function hideMenu() {
                        contextMenu.style.display = 'none';
                        document.removeEventListener('click', hideMenu);
                    });
                }, 10);
            }
            
            onKeyDown(e) {
                switch (e.code) {
                    case 'Delete':
                        this.deleteSelectedObjects();
                        break;
                    case 'KeyC':
                        if (e.ctrlKey) this.copySelectedObjects();
                        break;
                    case 'KeyV':
                        if (e.ctrlKey) this.pasteObjects();
                        break;
                    case 'KeyA':
                        if (e.ctrlKey) {
                            e.preventDefault();
                            this.selectAllObjects();
                        }
                        break;
                    case 'Escape':
                        this.clearSelection();
                        this.editor.selectedTool = null;
                        this.updateToolSelection();
                        break;
                    case 'KeyG':
                        this.toggleGrid();
                        break;
                    case 'Space':
                        e.preventDefault();
                        this.resetCamera();
                        break;
                }
            }
            
            onKeyUp(e) {
                // Handle key releases if needed
            }
            
            updateWorldCoordinates() {
                this.mouse.worldX = (this.mouse.x - this.canvas.width/2) / this.camera.zoom + this.camera.x;
                this.mouse.worldY = (this.mouse.y - this.canvas.height/2) / this.camera.zoom + this.camera.y;
            }
            
            placeObject(type, x, y) {
                const layer = this.universe.layers.get(this.editor.currentLayer);
                if (!layer) return;
                
                // Snap to grid if enabled
                if (this.editor.gridEnabled) {
                    x = Math.round(x / this.editor.gridSize) * this.editor.gridSize;
                    y = Math.round(y / this.editor.gridSize) * this.editor.gridSize;
                }
                
                const gameObject = this.createGameObject(type, x, y);
                layer.objects.set(gameObject.id, gameObject);
                this.universe.objects.set(gameObject.id, gameObject);
                layer.entityCount++;
                
                // Add to build queue simulation
                this.addToBuildQueue(gameObject);
                
                console.log(`üèóÔ∏è Placed ${type} at (${x}, ${y}) on layer ${this.editor.currentLayer}`);
                this.updateUI();
            }
            
            addToBuildQueue(gameObject) {
                this.universe.buildQueue.push({
                    object: gameObject,
                    progress: 0,
                    startTime: Date.now(),
                    duration: 3000 + Math.random() * 2000 // 3-5 seconds
                });
            }
            
            getObjectAtPosition(x, y) {
                const layer = this.universe.layers.get(this.editor.currentLayer);
                if (!layer) return null;
                
                for (const [id, obj] of layer.objects) {
                    const dx = x - obj.x;
                    const dy = y - obj.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance <= obj.width / 2) {
                        return obj;
                    }
                }
                
                return null;
            }
            
            selectObject(obj, clearOthers = true) {
                if (clearOthers) {
                    this.clearSelection();
                }
                
                obj.selected = true;
                if (!this.editor.selectedObjects.includes(obj)) {
                    this.editor.selectedObjects.push(obj);
                }
                
                this.updateSelectedObjectPanel(obj);
            }
            
            clearSelection() {
                this.editor.selectedObjects.forEach(obj => obj.selected = false);
                this.editor.selectedObjects = [];
                this.updateSelectedObjectPanel(null);
            }
            
            selectAllObjects() {
                const layer = this.universe.layers.get(this.editor.currentLayer);
                if (!layer) return;
                
                this.clearSelection();
                layer.objects.forEach(obj => this.selectObject(obj, false));
            }
            
            deleteSelectedObjects() {
                const layer = this.universe.layers.get(this.editor.currentLayer);
                if (!layer) return;
                
                this.editor.selectedObjects.forEach(obj => {
                    layer.objects.delete(obj.id);
                    this.universe.objects.delete(obj.id);
                    layer.entityCount--;
                });
                
                this.clearSelection();
                this.updateUI();
            }
            
            copySelectedObjects() {
                this.editor.clipboard = [...this.editor.selectedObjects];
            }
            
            pasteObjects() {
                if (this.editor.clipboard.length === 0) return;
                
                const layer = this.universe.layers.get(this.editor.currentLayer);
                if (!layer) return;
                
                this.clearSelection();
                
                this.editor.clipboard.forEach(originalObj => {
                    const newObj = this.createGameObject(
                        originalObj.type,
                        originalObj.x + 50,
                        originalObj.y + 50
                    );
                    
                    layer.objects.set(newObj.id, newObj);
                    this.universe.objects.set(newObj.id, newObj);
                    layer.entityCount++;
                    
                    this.selectObject(newObj, false);
                });
                
                this.updateUI();
            }
            
            switchToLayer(layerNum) {
                if (layerNum >= 1 && layerNum <= this.editor.totalLayers) {
                    this.editor.currentLayer = layerNum;
                    this.initializeLayer(layerNum);
                    this.clearSelection();
                    this.updateUI();
                    
                    console.log(`üìö Switched to layer ${layerNum}: ${this.getLayerName(layerNum)}`);
                }
            }
            
            selectTool(toolType) {
                // Clear previous tool selection
                document.querySelectorAll('.palette-item').forEach(item => {
                    item.classList.remove('selected');
                });
                
                // Select new tool
                if (this.editor.selectedTool === toolType) {
                    this.editor.selectedTool = null;
                } else {
                    this.editor.selectedTool = toolType;
                    document.querySelector(`[data-type="${toolType}"]`).classList.add('selected');
                }
                
                this.updateToolSelection();
            }
            
            updateToolSelection() {
                // Update cursor or other visual feedback
                this.canvas.style.cursor = this.editor.selectedTool ? 'crosshair' : 'default';
            }
            
            render() {
                // Clear canvas
                this.ctx.fillStyle = '#000000';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                // Save context for camera transform
                this.ctx.save();
                
                // Apply camera transform
                this.ctx.translate(this.canvas.width / 2, this.canvas.height / 2);
                this.ctx.scale(this.camera.zoom, this.camera.zoom);
                this.ctx.translate(-this.camera.x, -this.camera.y);
                
                // Render grid
                if (this.editor.gridEnabled) {
                    this.renderGrid();
                }
                
                // Render objects
                this.renderObjects();
                
                // Render connections
                this.renderConnections();
                
                // Restore context
                this.ctx.restore();
                
                // Render UI overlays
                this.renderUIOverlays();
                
                // Update mini map
                this.renderMiniMap();
            }
            
            renderGrid() {
                const gridSize = this.editor.gridSize;
                const bounds = this.getVisibleBounds();
                
                this.ctx.strokeStyle = 'rgba(255, 255, 255, 0.1)';
                this.ctx.lineWidth = 1 / this.camera.zoom;
                this.ctx.setLineDash([]);
                
                // Vertical lines
                for (let x = Math.floor(bounds.left / gridSize) * gridSize; 
                     x <= bounds.right; x += gridSize) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(x, bounds.top);
                    this.ctx.lineTo(x, bounds.bottom);
                    this.ctx.stroke();
                }
                
                // Horizontal lines
                for (let y = Math.floor(bounds.top / gridSize) * gridSize; 
                     y <= bounds.bottom; y += gridSize) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(bounds.left, y);
                    this.ctx.lineTo(bounds.right, y);
                    this.ctx.stroke();
                }
            }
            
            renderObjects() {
                const layer = this.universe.layers.get(this.editor.currentLayer);
                if (!layer) return;
                
                layer.objects.forEach(obj => {
                    this.renderObject(obj);
                });
            }
            
            renderObject(obj) {
                this.ctx.save();
                
                // Draw object base
                this.ctx.fillStyle = obj.color;
                this.ctx.strokeStyle = obj.selected ? '#00ff00' : '#ffffff';
                this.ctx.lineWidth = 2 / this.camera.zoom;
                
                if (this.editor.wireframeMode) {
                    this.ctx.fillStyle = 'rgba(0, 0, 0, 0)';
                }
                
                // Draw shape based on type
                this.ctx.beginPath();
                if (obj.type.includes('guardian')) {
                    // Draw diamond for guardians
                    this.ctx.moveTo(obj.x, obj.y - obj.height/2);
                    this.ctx.lineTo(obj.x + obj.width/2, obj.y);
                    this.ctx.lineTo(obj.x, obj.y + obj.height/2);
                    this.ctx.lineTo(obj.x - obj.width/2, obj.y);
                    this.ctx.closePath();
                } else if (obj.type.includes('hub') || obj.type.includes('exchange')) {
                    // Draw hexagon for hubs
                    const sides = 6;
                    const radius = obj.width / 2;
                    for (let i = 0; i < sides; i++) {
                        const angle = (i / sides) * Math.PI * 2;
                        const x = obj.x + Math.cos(angle) * radius;
                        const y = obj.y + Math.sin(angle) * radius;
                        if (i === 0) this.ctx.moveTo(x, y);
                        else this.ctx.lineTo(x, y);
                    }
                    this.ctx.closePath();
                } else {
                    // Draw circle for most objects
                    this.ctx.arc(obj.x, obj.y, obj.width / 2, 0, Math.PI * 2);
                }
                
                this.ctx.fill();
                this.ctx.stroke();
                
                // Draw icon if zoom level is high enough
                if (this.camera.zoom > 0.5) {
                    this.ctx.fillStyle = '#ffffff';
                    this.ctx.font = `${16 / this.camera.zoom}px Arial`;
                    this.ctx.textAlign = 'center';
                    this.ctx.textBaseline = 'middle';
                    this.ctx.fillText(obj.icon, obj.x, obj.y);
                }
                
                // Draw health bar
                if (this.camera.zoom > 0.8) {
                    this.renderHealthBar(obj);
                }
                
                // Draw selection outline
                if (obj.selected) {
                    this.ctx.strokeStyle = '#00ff00';
                    this.ctx.lineWidth = 3 / this.camera.zoom;
                    this.ctx.setLineDash([5 / this.camera.zoom, 5 / this.camera.zoom]);
                    this.ctx.stroke();
                    this.ctx.setLineDash([]);
                }
                
                this.ctx.restore();
            }
            
            renderHealthBar(obj) {
                const barWidth = obj.width;
                const barHeight = 4 / this.camera.zoom;
                const barY = obj.y - obj.height/2 - 10 / this.camera.zoom;
                
                // Background
                this.ctx.fillStyle = 'rgba(255, 0, 0, 0.3)';
                this.ctx.fillRect(obj.x - barWidth/2, barY, barWidth, barHeight);
                
                // Health portion
                const healthWidth = (obj.health / 100) * barWidth;
                this.ctx.fillStyle = obj.health > 70 ? '#00ff00' : 
                                   obj.health > 30 ? '#ffff00' : '#ff0000';
                this.ctx.fillRect(obj.x - barWidth/2, barY, healthWidth, barHeight);
            }
            
            renderConnections() {
                const layer = this.universe.layers.get(this.editor.currentLayer);
                if (!layer) return;
                
                this.ctx.strokeStyle = 'rgba(0, 255, 255, 0.5)';
                this.ctx.lineWidth = 2 / this.camera.zoom;
                this.ctx.setLineDash([10 / this.camera.zoom, 5 / this.camera.zoom]);
                
                layer.connections.forEach(connection => {
                    const fromObj = layer.objects.get(connection.from);
                    const toObj = layer.objects.get(connection.to);
                    
                    if (fromObj && toObj) {
                        this.ctx.beginPath();
                        this.ctx.moveTo(fromObj.x, fromObj.y);
                        this.ctx.lineTo(toObj.x, toObj.y);
                        this.ctx.stroke();
                    }
                });
                
                this.ctx.setLineDash([]);
            }
            
            renderUIOverlays() {
                // Render any additional UI overlays here
            }
            
            renderMiniMap() {
                const ctx = this.miniMapCtx;
                const canvas = this.miniMapCanvas;
                
                // Clear mini map
                ctx.fillStyle = '#000000';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Get current layer
                const layer = this.universe.layers.get(this.editor.currentLayer);
                if (!layer) return;
                
                // Calculate mini map scale
                const mapScale = 0.1;
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                
                // Draw objects
                layer.objects.forEach(obj => {
                    const x = centerX + obj.x * mapScale;
                    const y = centerY + obj.y * mapScale;
                    
                    ctx.fillStyle = obj.color;
                    ctx.beginPath();
                    ctx.arc(x, y, 2, 0, Math.PI * 2);
                    ctx.fill();
                });
                
                // Draw camera viewport
                const viewWidth = (this.canvas.width / this.camera.zoom) * mapScale;
                const viewHeight = (this.canvas.height / this.camera.zoom) * mapScale;
                const viewX = centerX + this.camera.x * mapScale - viewWidth / 2;
                const viewY = centerY + this.camera.y * mapScale - viewHeight / 2;
                
                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = 1;
                ctx.strokeRect(viewX, viewY, viewWidth, viewHeight);
            }
            
            getVisibleBounds() {
                const halfWidth = this.canvas.width / (2 * this.camera.zoom);
                const halfHeight = this.canvas.height / (2 * this.camera.zoom);
                
                return {
                    left: this.camera.x - halfWidth,
                    right: this.camera.x + halfWidth,
                    top: this.camera.y - halfHeight,
                    bottom: this.camera.y + halfHeight
                };
            }
            
            updateUI() {
                // Update status bar
                document.getElementById('statusLayer').textContent = 
                    `${this.editor.currentLayer}/${this.editor.totalLayers}`;
                
                const layer = this.universe.layers.get(this.editor.currentLayer);
                document.getElementById('objectCount').textContent = 
                    layer ? layer.entityCount : 0;
                
                document.getElementById('selectedCount').textContent = 
                    this.editor.selectedObjects.length;
                
                // Update layer navigator
                document.getElementById('currentLayerNum').textContent = this.editor.currentLayer;
                document.getElementById('currentLayerName').textContent = 
                    this.getLayerName(this.editor.currentLayer);
                document.getElementById('currentDimension').textContent = 
                    this.getLayerDimension(this.editor.currentLayer);
                document.getElementById('layerEntityCount').textContent = 
                    layer ? layer.entityCount : 0;
                
                // Update layer slider
                document.getElementById('layerSlider').value = this.editor.currentLayer;
            }
            
            updateSelectedObjectPanel(obj) {
                if (obj) {
                    document.getElementById('selectedType').textContent = obj.type;
                    document.getElementById('selectedLayer').textContent = obj.layer;
                    
                    // Update system properties with object data
                    document.getElementById('cpuUsage').textContent = Math.floor(obj.load) + '%';
                    document.getElementById('responseTime').textContent = Math.floor(Math.random() * 50) + 'ms';
                    document.getElementById('uptime').textContent = (99 + Math.random()).toFixed(1) + '%';
                } else {
                    document.getElementById('selectedType').textContent = 'None';
                    document.getElementById('selectedLayer').textContent = this.editor.currentLayer;
                }
            }
            
            updateZoomDisplay() {
                const zoomPercent = Math.round(this.camera.zoom * 100);
                document.getElementById('zoomLevel').textContent = zoomPercent + '%';
                document.getElementById('zoomStatus').textContent = zoomPercent + '%';
            }
            
            updateBuildQueue() {
                // Update build queue progress
                this.universe.buildQueue = this.universe.buildQueue.filter(item => {
                    const elapsed = Date.now() - item.startTime;
                    item.progress = Math.min(100, (elapsed / item.duration) * 100);
                    
                    return item.progress < 100;
                });
                
                // Update build queue UI
                const queueList = document.getElementById('queueList');
                queueList.innerHTML = '';
                
                this.universe.buildQueue.slice(0, 3).forEach(item => {
                    const queueItem = document.createElement('div');
                    queueItem.className = 'queue-item';
                    queueItem.innerHTML = `
                        <span>${item.object.type.replace('-', ' ')}</span>
                        <div class="queue-progress">
                            <div class="queue-progress-bar" style="width: ${item.progress}%"></div>
                        </div>
                    `;
                    queueList.appendChild(queueItem);
                });
            }
            
            startGameLoop() {
                let lastTime = 0;
                let frameCount = 0;
                let lastFPSUpdate = 0;
                
                const gameLoop = (currentTime) => {
                    const deltaTime = currentTime - lastTime;
                    lastTime = currentTime;
                    
                    // Update systems
                    this.updateBuildQueue();
                    
                    // Update FPS counter
                    frameCount++;
                    if (currentTime - lastFPSUpdate >= 1000) {
                        document.getElementById('fpsCounter').textContent = frameCount;
                        frameCount = 0;
                        lastFPSUpdate = currentTime;
                    }
                    
                    // Render
                    this.render();
                    
                    requestAnimationFrame(gameLoop);
                };
                
                requestAnimationFrame(gameLoop);
            }
            
            onMiniMapClick(e) {
                const rect = this.miniMapCanvas.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                const mapScale = 0.1;
                const centerX = this.miniMapCanvas.width / 2;
                const centerY = this.miniMapCanvas.height / 2;
                
                this.camera.x = (x - centerX) / mapScale;
                this.camera.y = (y - centerY) / mapScale;
            }
        }
        
        // Global functions for UI
        function setMode(mode) {
            // Update toolbar buttons
            document.querySelectorAll('#topToolbar .toolbar-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(mode + 'Mode').classList.add('active');
            
            // Update editor mode
            if (window.mapEditor) {
                window.mapEditor.editor.mode = mode;
                document.getElementById('currentMode').textContent = 
                    mode.charAt(0).toUpperCase() + mode.slice(1);
            }
        }
        
        function setCameraMode(mode) {
            document.querySelectorAll('#cameraControls .camera-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            if (window.mapEditor) {
                window.mapEditor.camera.mode = mode;
            }
        }
        
        function adjustZoom(direction) {
            if (window.mapEditor) {
                const zoomFactor = direction > 0 ? 1.2 : 0.8;
                window.mapEditor.camera.zoom = Math.max(0.1, Math.min(5, 
                    window.mapEditor.camera.zoom * zoomFactor));
                window.mapEditor.updateZoomDisplay();
            }
        }
        
        function zoomToFit() {
            if (window.mapEditor) {
                window.mapEditor.camera.zoom = 1;
                window.mapEditor.camera.x = 0;
                window.mapEditor.camera.y = 0;
                window.mapEditor.updateZoomDisplay();
            }
        }
        
        function resetCamera() {
            if (window.mapEditor) {
                window.mapEditor.camera.x = 0;
                window.mapEditor.camera.y = 0;
                window.mapEditor.camera.zoom = 1;
                window.mapEditor.updateZoomDisplay();
            }
        }
        
        function toggleGrid() {
            if (window.mapEditor) {
                window.mapEditor.editor.gridEnabled = !window.mapEditor.editor.gridEnabled;
                document.getElementById('gridStatus').textContent = 
                    window.mapEditor.editor.gridEnabled ? 'ON' : 'OFF';
            }
        }
        
        function toggleWireframe() {
            if (window.mapEditor) {
                window.mapEditor.editor.wireframeMode = !window.mapEditor.editor.wireframeMode;
            }
        }
        
        function validateUniverse() {
            if (window.mapEditor) {
                console.log('üîç Validating universe integrity...');
                // Add validation logic here
                setTimeout(() => {
                    alert('‚úÖ Universe validation complete!\n\n459 layers verified\nAll systems operational');
                }, 1000);
            }
        }
        
        function simulateLoad() {
            if (window.mapEditor) {
                console.log('‚ö° Running load simulation...');
                // Add load simulation logic here
                setTimeout(() => {
                    alert('üìä Load simulation complete!\n\nPeak throughput: 15,000 req/s\nResponse time: 12ms avg\nError rate: 0.01%');
                }, 2000);
            }
        }
        
        function runAllTests() {
            console.log('üß™ Running comprehensive system tests...');
            // Simulate test execution
        }
        
        function clearTests() {
            document.getElementById('testResults').innerHTML = 
                '<div style="color: #888; text-align: center; padding: 20px;">Tests cleared</div>';
        }
        
        function newMap() {
            if (confirm('Create new map? This will clear all current work.')) {
                location.reload();
            }
        }
        
        function loadMap() {
            alert('Load Map functionality - Connect to your saved universe files');
        }
        
        function saveMap() {
            alert('Map saved successfully! ‚úÖ');
        }
        
        function exportMap() {
            alert('Export functionality - Generate deployment-ready configuration');
        }
        
        // Context menu functions
        function duplicateObject() {
            if (window.mapEditor && window.mapEditor.editor.selectedObjects.length > 0) {
                window.mapEditor.copySelectedObjects();
                window.mapEditor.pasteObjects();
            }
        }
        
        function deleteObject() {
            if (window.mapEditor) {
                window.mapEditor.deleteSelectedObjects();
            }
        }
        
        function editProperties() {
            alert('Properties panel - Configure selected object settings');
        }
        
        function testObject() {
            alert('Testing selected object - Running diagnostics...');
        }
        
        function viewConnections() {
            alert('Connection viewer - Analyze object relationships');
        }
        
        // Initialize the RTS Map Editor
        window.mapEditor = new RTSSystemMapEditor();
        
        console.log('üó∫Ô∏è RTS System Map Editor Ready');
        console.log('üéÆ Drag and drop components from the palette');
        console.log('üñ±Ô∏è Right-click for context menu, scroll to zoom');
        console.log('üìö Use layer slider to navigate between 459 layers');
        console.log('üîß Switch between Build/Test/Debug modes in toolbar');
    </script>
</body>
</html>