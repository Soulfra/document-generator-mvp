<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üè∞ HollowTown - Living Portfolio World</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #0a0a0a;
            color: #e0e0e0;
            overflow: hidden;
            height: 100vh;
        }

        /* Main Grid Layout */
        .hub-container {
            display: grid;
            grid-template-columns: 300px 1fr 350px;
            grid-template-rows: 60px 1fr 100px;
            grid-template-areas: 
                "header header header"
                "avatar game stats"
                "skills skills achievements";
            height: 100vh;
            gap: 2px;
            background: #1a1a1a;
        }

        /* Header */
        .header {
            grid-area: header;
            background: linear-gradient(135deg, #1a0033 0%, #330066 50%, #1a0033 100%);
            border-bottom: 3px solid #9b59b6;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            box-shadow: 0 4px 20px rgba(155, 89, 182, 0.5);
        }

        .header h1 {
            font-size: 24px;
            color: #e8d5ff;
            text-shadow: 2px 2px 8px rgba(155, 89, 182, 0.8);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-stats {
            display: flex;
            gap: 20px;
            font-size: 14px;
        }

        .header-stat {
            color: #b8a0d0;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .header-stat span {
            color: #e8d5ff;
            font-weight: bold;
        }

        /* Avatar Panel */
        .avatar-panel {
            grid-area: avatar;
            background: #1a1a1a;
            border: 2px solid #4a4a4a;
            padding: 15px;
            overflow-y: auto;
        }

        .avatar-display {
            width: 100%;
            aspect-ratio: 1;
            background: #2a2a2a;
            border: 3px solid #9b59b6;
            border-radius: 12px;
            margin-bottom: 15px;
            position: relative;
            overflow: hidden;
            image-rendering: pixelated;
        }

        .avatar-display img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            image-rendering: pixelated;
        }

        .avatar-level {
            position: absolute;
            bottom: 5px;
            right: 5px;
            background: rgba(155, 89, 182, 0.9);
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .avatar-info {
            background: #2a2a2a;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .avatar-name {
            font-size: 16px;
            color: #e8d5ff;
            margin-bottom: 5px;
        }

        .avatar-class {
            font-size: 12px;
            color: #b8a0d0;
        }

        .customization-section {
            margin-top: 15px;
        }

        .customization-title {
            font-size: 14px;
            color: #9b59b6;
            margin-bottom: 8px;
        }

        .customization-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 5px;
        }

        .custom-btn {
            background: #2a2a2a;
            border: 1px solid #4a4a4a;
            color: #b8a0d0;
            padding: 6px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.2s;
        }

        .custom-btn:hover {
            background: #3a3a3a;
            border-color: #9b59b6;
            color: #e8d5ff;
        }

        .custom-btn.active {
            background: #4a2a5a;
            border-color: #9b59b6;
            color: #e8d5ff;
        }

        /* Game World */
        .game-world {
            grid-area: game;
            background: #0f0f0f;
            border: 2px solid #4a4a4a;
            position: relative;
            overflow: hidden;
        }

        .game-placeholder {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: radial-gradient(circle at center, #1a0033 0%, #0a0a0a 70%);
        }

        .game-placeholder h2 {
            font-size: 28px;
            color: #9b59b6;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(155, 89, 182, 0.8);
        }

        .game-loading {
            width: 200px;
            height: 4px;
            background: #2a2a2a;
            border-radius: 2px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .game-loading-bar {
            height: 100%;
            background: linear-gradient(90deg, #9b59b6 0%, #3498db 100%);
            animation: loading 2s infinite;
        }

        @keyframes loading {
            0% { width: 0%; }
            50% { width: 70%; }
            100% { width: 100%; }
        }

        .game-iframe {
            width: 100%;
            height: 100%;
            border: none;
            display: none;
        }

        /* Stats Panel */
        .stats-panel {
            grid-area: stats;
            background: #1a1a1a;
            border: 2px solid #4a4a4a;
            padding: 15px;
            overflow-y: auto;
        }

        .stats-title {
            font-size: 16px;
            color: #9b59b6;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stat-section {
            background: #2a2a2a;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 12px;
            color: #8a8a8a;
            margin-bottom: 4px;
        }

        .stat-value {
            font-size: 18px;
            color: #e8d5ff;
            font-weight: bold;
        }

        .stat-bar {
            height: 4px;
            background: #3a3a3a;
            border-radius: 2px;
            overflow: hidden;
            margin-top: 4px;
        }

        .stat-bar-fill {
            height: 100%;
            background: linear-gradient(90deg, #9b59b6 0%, #3498db 100%);
            transition: width 0.3s ease;
        }

        .live-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #4caf50;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        /* Skills Section */
        .skills-section {
            grid-area: skills;
            background: #1a1a1a;
            border: 2px solid #4a4a4a;
            padding: 15px;
            display: flex;
            gap: 15px;
            overflow-x: auto;
        }

        .skill-tree {
            background: #2a2a2a;
            border: 1px solid #4a4a4a;
            border-radius: 8px;
            padding: 10px;
            min-width: 150px;
            text-align: center;
        }

        .skill-icon {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .skill-name {
            font-size: 12px;
            color: #b8a0d0;
            margin-bottom: 5px;
        }

        .skill-level {
            font-size: 14px;
            color: #e8d5ff;
            font-weight: bold;
        }

        .skill-tree.unlocked {
            border-color: #9b59b6;
            background: #2a1a3a;
        }

        .skill-tree.locked {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Achievements */
        .achievements-section {
            grid-area: achievements;
            background: #1a1a1a;
            border: 2px solid #4a4a4a;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            overflow-x: auto;
        }

        .achievement {
            background: #2a2a2a;
            border: 2px solid #4a4a4a;
            border-radius: 8px;
            padding: 8px 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 150px;
        }

        .achievement.earned {
            border-color: #ffd700;
            background: #3a3a2a;
        }

        .achievement-icon {
            font-size: 20px;
        }

        .achievement-text {
            font-size: 11px;
            color: #b8a0d0;
        }

        /* Modals */
        .connection-modal {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(26, 26, 26, 0.95);
            border: 2px solid #9b59b6;
            border-radius: 8px;
            padding: 15px;
            min-width: 250px;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(155, 89, 182, 0.5);
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .connection-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #ff4444;
        }

        .connection-dot.connected {
            background: #4caf50;
        }

        .connection-text {
            font-size: 12px;
            color: #b8a0d0;
        }

        /* Animations */
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.8; }
        }

        /* Scrollbars */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #1a1a1a;
        }

        ::-webkit-scrollbar-thumb {
            background: #4a4a4a;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #6a6a6a;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .hub-container {
                grid-template-columns: 250px 1fr 300px;
            }
        }

        @media (max-width: 900px) {
            .hub-container {
                grid-template-columns: 1fr;
                grid-template-rows: 60px auto auto auto auto auto;
                grid-template-areas: 
                    "header"
                    "avatar"
                    "game"
                    "stats"
                    "skills"
                    "achievements";
            }

            .avatar-panel, .stats-panel {
                max-height: 300px;
            }

            .game-world {
                min-height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="hub-container">
        <!-- Header -->
        <header class="header">
            <h1>
                <span>üè∞</span>
                HollowTown
                <span style="font-size: 14px; color: #b8a0d0;">Living Portfolio</span>
            </h1>
            <div class="header-stats">
                <div class="header-stat">
                    <span class="live-indicator"></span>
                    <span id="playersOnline">0</span> Players
                </div>
                <div class="header-stat">
                    üèóÔ∏è <span id="projectsActive">0</span> Projects
                </div>
                <div class="header-stat">
                    ‚ö° <span id="systemHealth">0</span>% Health
                </div>
            </div>
        </header>

        <!-- Avatar Panel -->
        <div class="avatar-panel">
            <div class="avatar-display" id="avatarDisplay">
                <img id="avatarImage" src="" alt="Your Avatar">
                <div class="avatar-level">Lv. <span id="avatarLevel">1</span></div>
            </div>

            <div class="avatar-info">
                <div class="avatar-name" id="avatarName">Recovery Mage</div>
                <div class="avatar-class" id="avatarClass">Full-Stack Developer</div>
            </div>

            <div class="customization-section">
                <div class="customization-title">üé® Character Style</div>
                <div class="customization-options">
                    <button class="custom-btn active" data-style="hollow-knight">Hollow Knight</button>
                    <button class="custom-btn" data-style="silksong">Silksong</button>
                    <button class="custom-btn" data-style="cyberpunk">Cyberpunk</button>
                    <button class="custom-btn" data-style="pixel">Pixel Art</button>
                </div>
            </div>

            <div class="customization-section">
                <div class="customization-title">‚öîÔ∏è Class</div>
                <div class="customization-options">
                    <button class="custom-btn active" data-class="fullstack">Full-Stack</button>
                    <button class="custom-btn" data-class="frontend">Frontend</button>
                    <button class="custom-btn" data-class="backend">Backend</button>
                    <button class="custom-btn" data-class="devops">DevOps</button>
                </div>
            </div>
        </div>

        <!-- Game World (Godot/WebGL) -->
        <div class="game-world">
            <div class="game-placeholder" id="gamePlaceholder">
                <h2>üéÆ HollowTown World</h2>
                <div class="game-loading">
                    <div class="game-loading-bar"></div>
                </div>
                <p style="color: #8a8a8a; font-size: 14px;">Loading Godot Engine...</p>
                <p style="color: #6a6a6a; font-size: 12px; margin-top: 10px;">
                    Your gaming achievements unlock web dev abilities
                </p>
            </div>
            <iframe class="game-iframe" id="gameFrame" src=""></iframe>
        </div>

        <!-- Stats Panel (Real Data) -->
        <div class="stats-panel">
            <h3 class="stats-title">
                üìä Live System Stats
                <span class="live-indicator"></span>
            </h3>

            <div class="stat-section">
                <div class="stat-label">Database Jobs</div>
                <div class="stat-value"><span id="dbJobs">0</span></div>
                <div class="stat-bar">
                    <div class="stat-bar-fill" id="dbJobsBar" style="width: 0%"></div>
                </div>
            </div>

            <div class="stat-section">
                <div class="stat-label">Active Users</div>
                <div class="stat-value"><span id="activeUsers">0</span></div>
                <div class="stat-bar">
                    <div class="stat-bar-fill" id="activeUsersBar" style="width: 0%"></div>
                </div>
            </div>

            <div class="stat-section">
                <div class="stat-label">API Services</div>
                <div class="stat-value"><span id="apiServices">0</span>/7</div>
                <div class="stat-bar">
                    <div class="stat-bar-fill" id="apiServicesBar" style="width: 0%"></div>
                </div>
            </div>

            <div class="stat-section">
                <div class="stat-label">Docker Containers</div>
                <div class="stat-value"><span id="dockerContainers">0</span></div>
                <div class="stat-bar">
                    <div class="stat-bar-fill" id="dockerBar" style="width: 0%"></div>
                </div>
            </div>

            <div class="stat-section">
                <div class="stat-label">Experience Points</div>
                <div class="stat-value"><span id="xpPoints">0</span> XP</div>
                <div class="stat-bar">
                    <div class="stat-bar-fill" id="xpBar" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- Skills Section -->
        <div class="skills-section">
            <div class="skill-tree unlocked">
                <div class="skill-icon">üîß</div>
                <div class="skill-name">Backend</div>
                <div class="skill-level">Lv. 99</div>
            </div>
            
            <div class="skill-tree unlocked">
                <div class="skill-icon">üé®</div>
                <div class="skill-name">Frontend</div>
                <div class="skill-level">Lv. 87</div>
            </div>
            
            <div class="skill-tree unlocked">
                <div class="skill-icon">üöÄ</div>
                <div class="skill-name">DevOps</div>
                <div class="skill-level">Lv. 75</div>
            </div>
            
            <div class="skill-tree unlocked">
                <div class="skill-icon">ü§ñ</div>
                <div class="skill-name">AI/ML</div>
                <div class="skill-level">Lv. 62</div>
            </div>
            
            <div class="skill-tree locked">
                <div class="skill-icon">üîê</div>
                <div class="skill-name">???</div>
                <div class="skill-level">Locked</div>
            </div>
        </div>

        <!-- Achievements Section -->
        <div class="achievements-section">
            <div class="achievement earned">
                <div class="achievement-icon">üèÜ</div>
                <div class="achievement-text">Real Data Master</div>
            </div>
            
            <div class="achievement earned">
                <div class="achievement-icon">‚ö°</div>
                <div class="achievement-text">WASM Recovery</div>
            </div>
            
            <div class="achievement earned">
                <div class="achievement-icon">üéÆ</div>
                <div class="achievement-text">Avatar Creator</div>
            </div>
            
            <div class="achievement">
                <div class="achievement-icon">üè∞</div>
                <div class="achievement-text">Town Builder</div>
            </div>
            
            <div class="achievement">
                <div class="achievement-icon">üë•</div>
                <div class="achievement-text">Community Leader</div>
            </div>
        </div>
    </div>

    <!-- Connection Status Modal -->
    <div class="connection-modal">
        <div class="connection-status">
            <div class="connection-dot" id="connectionDot"></div>
            <div class="connection-text" id="connectionText">Connecting to backend...</div>
        </div>
        <div style="font-size: 11px; color: #6a6a6a;">
            Backend: <span id="backendUrl">localhost:3030</span>
        </div>
    </div>

    <script>
        class HollowTownHub {
            constructor() {
                this.backendUrl = 'http://localhost:3030';
                this.wsUrl = 'ws://localhost:3030';
                this.ws = null;
                this.avatarData = null;
                this.stats = {};
                
                this.init();
            }

            init() {
                // Load avatar from localStorage
                this.loadAvatar();
                
                // Connect to backend
                this.connectWebSocket();
                
                // Setup UI handlers
                this.setupEventHandlers();
                
                // Start animations
                this.startAnimations();
            }

            loadAvatar() {
                const savedAvatar = localStorage.getItem('hollowtown-avatar');
                if (savedAvatar) {
                    this.avatarData = JSON.parse(savedAvatar);
                    this.displayAvatar();
                } else {
                    // Use default avatar
                    document.getElementById('avatarImage').src = 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect fill="%232a2a2a" width="100" height="100"/><text x="50%" y="50%" text-anchor="middle" dy=".3em" fill="%236a6a6a" font-size="12">No Avatar</text></svg>';
                }
            }

            displayAvatar() {
                if (this.avatarData && this.avatarData.image) {
                    const img = document.getElementById('avatarImage');
                    img.src = this.avatarData.image;
                    img.style.filter = this.getStyleFilter(this.avatarData.style || 'hollow-knight');
                }
            }

            getStyleFilter(style) {
                const filters = {
                    'hollow-knight': 'contrast(1.2) saturate(0.8) hue-rotate(200deg)',
                    'silksong': 'contrast(1.3) saturate(1.2) hue-rotate(320deg) brightness(1.1)',
                    'cyberpunk': 'contrast(2) saturate(1.5) hue-rotate(180deg) brightness(0.9)',
                    'pixel-art': 'contrast(1.5) saturate(0.5)'
                };
                return filters[style] || '';
            }

            connectWebSocket() {
                try {
                    this.ws = new WebSocket(this.wsUrl);
                    
                    this.ws.onopen = () => {
                        this.updateConnectionStatus(true);
                        this.ws.send(JSON.stringify({
                            type: 'subscribe_monitoring',
                            client: 'hollowtown-hub'
                        }));
                    };
                    
                    this.ws.onmessage = (event) => {
                        const data = JSON.parse(event.data);
                        this.handleWebSocketMessage(data);
                    };
                    
                    this.ws.onclose = () => {
                        this.updateConnectionStatus(false);
                        setTimeout(() => this.connectWebSocket(), 5000);
                    };
                    
                } catch (error) {
                    console.error('WebSocket connection failed:', error);
                    this.updateConnectionStatus(false);
                }
            }

            handleWebSocketMessage(message) {
                switch (message.type) {
                    case 'system_stats_update':
                        this.updateStats(message.data);
                        break;
                    case 'real_data_update':
                        this.updateRealData(message.data);
                        break;
                    case 'player_joined':
                        this.handlePlayerJoined(message.data);
                        break;
                }
            }

            updateConnectionStatus(connected) {
                const dot = document.getElementById('connectionDot');
                const text = document.getElementById('connectionText');
                
                if (connected) {
                    dot.classList.add('connected');
                    text.textContent = 'Connected to backend';
                } else {
                    dot.classList.remove('connected');
                    text.textContent = 'Connecting to backend...';
                }
            }

            updateStats(stats) {
                // Database stats
                if (stats.database) {
                    const dbJobs = stats.database.totalJobs || 0;
                    document.getElementById('dbJobs').textContent = dbJobs;
                    document.getElementById('dbJobsBar').style.width = Math.min(dbJobs, 100) + '%';
                    
                    const activeUsers = stats.database.activeUsers || 0;
                    document.getElementById('activeUsers').textContent = activeUsers;
                    document.getElementById('activeUsersBar').style.width = Math.min(activeUsers * 10, 100) + '%';
                }
                
                // Service stats
                if (stats.services) {
                    const healthyServices = Object.values(stats.services).filter(s => s.healthy).length;
                    const totalServices = Object.keys(stats.services).length;
                    document.getElementById('apiServices').textContent = healthyServices;
                    document.getElementById('apiServicesBar').style.width = (healthyServices / 7 * 100) + '%';
                }
                
                // Container stats
                if (stats.containers && stats.containers.available) {
                    const containers = Object.values(stats.containers.containers || {});
                    const running = containers.filter(c => c.healthy).length;
                    document.getElementById('dockerContainers').textContent = running;
                    document.getElementById('dockerBar').style.width = (running / containers.length * 100) + '%';
                }
                
                // Calculate XP based on system activity
                const xp = (stats.database?.totalJobs || 0) * 10 + 
                          (stats.database?.activeUsers || 0) * 50;
                document.getElementById('xpPoints').textContent = xp;
                document.getElementById('xpBar').style.width = (xp % 1000) / 10 + '%';
                
                // Update avatar level
                const level = Math.floor(xp / 1000) + 1;
                document.getElementById('avatarLevel').textContent = level;
                
                // Update header stats
                document.getElementById('playersOnline').textContent = stats.database?.activeUsers || 0;
                document.getElementById('projectsActive').textContent = stats.database?.activeJobs || 0;
                
                const health = stats.database?.connected ? 
                    (Object.values(stats.services || {}).filter(s => s.healthy).length / 7 * 100).toFixed(0) : 0;
                document.getElementById('systemHealth').textContent = health;
            }

            updateRealData(data) {
                if (data.systemStats) {
                    this.updateStats(data.systemStats);
                }
            }

            setupEventHandlers() {
                // Style buttons
                document.querySelectorAll('[data-style]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('[data-style]').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        
                        const style = e.target.getAttribute('data-style');
                        if (this.avatarData) {
                            this.avatarData.style = style;
                            localStorage.setItem('hollowtown-avatar', JSON.stringify(this.avatarData));
                            this.displayAvatar();
                        }
                    });
                });
                
                // Class buttons
                document.querySelectorAll('[data-class]').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('[data-class]').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        
                        const className = e.target.getAttribute('data-class');
                        const classNames = {
                            'fullstack': 'Full-Stack Developer',
                            'frontend': 'Frontend Wizard',
                            'backend': 'Backend Architect',
                            'devops': 'DevOps Engineer'
                        };
                        
                        document.getElementById('avatarClass').textContent = classNames[className];
                    });
                });
            }

            handlePlayerJoined(playerData) {
                // Show notification when new player joins
                console.log('New player joined:', playerData);
            }

            startAnimations() {
                // Simulate some dynamic content
                setInterval(() => {
                    // Request fresh data if connected
                    if (this.ws && this.ws.readyState === WebSocket.OPEN) {
                        this.ws.send(JSON.stringify({
                            type: 'get_real_data'
                        }));
                    }
                }, 30000); // Every 30 seconds
            }
        }

        // Initialize HollowTown when page loads
        document.addEventListener('DOMContentLoaded', () => {
            window.hollowtown = new HollowTownHub();
        });
    </script>
</body>
</html>