<!DOCTYPE html>
<html>
<head>
    <title>Blockchain Analysis Game - Live System Visualization</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            overflow: hidden;
            height: 100vh;
        }
        
        .game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(45deg, #0a0a0a, #1a1a2e, #16213e, #0f0f23);
            animation: backgroundShift 30s ease-in-out infinite;
        }
        
        @keyframes backgroundShift {
            0%, 100% { background: linear-gradient(45deg, #0a0a0a, #1a1a2e, #16213e, #0f0f23); }
            25% { background: linear-gradient(45deg, #1a1a2e, #16213e, #0f0f23, #2d1b69); }
            50% { background: linear-gradient(45deg, #16213e, #0f0f23, #2d1b69, #0a0a0a); }
            75% { background: linear-gradient(45deg, #0f0f23, #2d1b69, #0a0a0a, #1a1a2e); }
        }
        
        /* Game HUD */
        .game-hud {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        
        .hud-panel {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #00d4ff;
            border-radius: 10px;
            padding: 15px;
            font-size: 14px;
            min-width: 200px;
        }
        
        .hud-title {
            color: #00d4ff;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .score-item {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
        }
        
        .score-value {
            color: #4ecdc4;
            font-weight: bold;
        }
        
        /* Game Arena */
        .game-arena {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90vw;
            height: 80vh;
            border: 3px solid #00d4ff;
            border-radius: 20px;
            background: radial-gradient(ellipse at center, rgba(0, 212, 255, 0.1), transparent);
            overflow: hidden;
        }
        
        /* Service Nodes */
        .service-node {
            position: absolute;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            animation: pulse 3s ease-in-out infinite;
        }
        
        .service-node:hover {
            transform: scale(1.2);
            z-index: 100;
        }
        
        .service-node.meta-layer {
            background: radial-gradient(circle, #00d4ff, #0088cc);
            border: 4px solid #00d4ff;
            box-shadow: 0 0 40px #00d4ff;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 150px;
            height: 150px;
            z-index: 50;
        }
        
        .service-node.monero {
            background: radial-gradient(circle, #ff6600, #cc4400);
            border: 4px solid #ff6600;
            box-shadow: 0 0 30px #ff6600;
            top: 20%;
            left: 25%;
        }
        
        .service-node.blamechain {
            background: radial-gradient(circle, #4ecdc4, #2a9d8f);
            border: 4px solid #4ecdc4;
            box-shadow: 0 0 30px #4ecdc4;
            top: 70%;
            right: 25%;
        }
        
        .service-node.handshake {
            background: radial-gradient(circle, #6c5ce7, #5a4fcf);
            border: 4px solid #6c5ce7;
            box-shadow: 0 0 30px #6c5ce7;
            bottom: 20%;
            left: 20%;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.8; transform: translate(-50%, -50%) scale(1); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.05); }
        }
        
        .service-name {
            font-size: 12px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 5px;
        }
        
        .service-status {
            font-size: 10px;
            opacity: 0.8;
        }
        
        /* Connection Lines */
        .connection-line {
            position: absolute;
            height: 3px;
            background: linear-gradient(90deg, transparent, #00d4ff, transparent);
            border-radius: 2px;
            animation: dataFlow 2s linear infinite;
            z-index: 10;
        }
        
        @keyframes dataFlow {
            0% { opacity: 0; transform: scaleX(0); }
            50% { opacity: 1; transform: scaleX(1); }
            100% { opacity: 0; transform: scaleX(0); }
        }
        
        /* Data Packets */
        .data-packet {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #00d4ff;
            box-shadow: 0 0 15px #00d4ff;
            animation: packetMove 3s linear infinite;
            z-index: 20;
        }
        
        .data-packet.analysis {
            background: #ff6600;
            box-shadow: 0 0 15px #ff6600;
        }
        
        .data-packet.recording {
            background: #4ecdc4;
            box-shadow: 0 0 15px #4ecdc4;
        }
        
        .data-packet.agreement {
            background: #6c5ce7;
            box-shadow: 0 0 15px #6c5ce7;
        }
        
        /* Particle Effects */
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #00d4ff;
            border-radius: 50%;
            animation: particleFloat 8s linear infinite;
            opacity: 0.6;
        }
        
        @keyframes particleFloat {
            0% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 0.6; }
            90% { opacity: 0.6; }
            100% { transform: translateY(-20px) rotate(360deg); opacity: 0; }
        }
        
        /* Narrative Display */
        .narrative-display {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #00d4ff;
            border-radius: 15px;
            padding: 20px;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .narrative-entry {
            margin: 10px 0;
            padding: 10px;
            background: rgba(0, 212, 255, 0.1);
            border-left: 3px solid #00d4ff;
            border-radius: 5px;
            animation: narrativeAppear 0.5s ease-out;
        }
        
        @keyframes narrativeAppear {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .narrative-time {
            font-size: 10px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .narrative-text {
            font-style: italic;
            line-height: 1.4;
        }
        
        /* Game Controls */
        .game-controls {
            position: absolute;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .control-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 2px solid #00d4ff;
            background: rgba(0, 212, 255, 0.2);
            color: #00d4ff;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .control-btn:hover {
            background: rgba(0, 212, 255, 0.4);
            transform: scale(1.1);
            box-shadow: 0 0 20px #00d4ff;
        }
        
        /* Discovery Animation */
        .discovery-effect {
            position: absolute;
            width: 200px;
            height: 200px;
            border: 3px solid #00d4ff;
            border-radius: 50%;
            animation: discoveryPulse 1s ease-out;
            pointer-events: none;
        }
        
        @keyframes discoveryPulse {
            0% { 
                transform: translate(-50%, -50%) scale(0);
                opacity: 1;
            }
            100% { 
                transform: translate(-50%, -50%) scale(2);
                opacity: 0;
            }
        }
        
        /* Agreement Formation */
        .agreement-forming {
            position: absolute;
            width: 100px;
            height: 100px;
            border: 2px solid #6c5ce7;
            border-radius: 50%;
            animation: agreementForm 2s ease-in-out;
            pointer-events: none;
        }
        
        @keyframes agreementForm {
            0%, 100% { 
                transform: translate(-50%, -50%) scale(0) rotate(0deg);
                opacity: 0;
            }
            50% { 
                transform: translate(-50%, -50%) scale(1.5) rotate(180deg);
                opacity: 1;
            }
        }
        
        /* Game Stats */
        .game-stats {
            position: absolute;
            top: 50%;
            left: 20px;
            transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #4ecdc4;
            border-radius: 10px;
            padding: 20px;
            width: 200px;
        }
        
        .stat-row {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            font-size: 12px;
        }
        
        .stat-label {
            color: #aaa;
        }
        
        .stat-value {
            color: #4ecdc4;
            font-weight: bold;
        }
        
        /* Loading Screen */
        .loading-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            transition: opacity 1s;
        }
        
        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .loading-text {
            font-size: 24px;
            color: #00d4ff;
            margin-bottom: 30px;
            animation: loadingPulse 2s ease-in-out infinite;
        }
        
        @keyframes loadingPulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }
        
        .loading-spinner {
            width: 80px;
            height: 80px;
            border: 4px solid rgba(0, 212, 255, 0.3);
            border-top: 4px solid #00d4ff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Loading Screen -->
        <div class="loading-screen" id="loadingScreen">
            <div class="loading-text">INITIALIZING BLOCKCHAIN ANALYSIS GAME</div>
            <div class="loading-spinner"></div>
            <div style="margin-top: 20px; font-size: 14px; color: #666;">
                Connecting to meta-handshake layer...
            </div>
        </div>
        
        <!-- Game HUD -->
        <div class="game-hud">
            <div class="hud-panel">
                <div class="hud-title">🎮 GAME STATUS</div>
                <div class="score-item">
                    <span>Level:</span>
                    <span class="score-value" id="gameLevel">1</span>
                </div>
                <div class="score-item">
                    <span>Score:</span>
                    <span class="score-value" id="gameScore">0</span>
                </div>
                <div class="score-item">
                    <span>Discoveries:</span>
                    <span class="score-value" id="totalDiscoveries">0</span>
                </div>
            </div>
            
            <div class="hud-panel">
                <div class="hud-title">⛓️ BLOCKCHAIN STATUS</div>
                <div class="score-item">
                    <span>Active Services:</span>
                    <span class="score-value" id="activeServices">0</span>
                </div>
                <div class="score-item">
                    <span>Agreements:</span>
                    <span class="score-value" id="totalAgreements">0</span>
                </div>
                <div class="score-item">
                    <span>Data Packets:</span>
                    <span class="score-value" id="dataPackets">0</span>
                </div>
            </div>
            
            <div class="hud-panel">
                <div class="hud-title">🧠 META STATUS</div>
                <div class="score-item">
                    <span>Consciousness:</span>
                    <span class="score-value" id="consciousnessLevel">Awakening</span>
                </div>
                <div class="score-item">
                    <span>Integrity:</span>
                    <span class="score-value" id="systemIntegrity">0%</span>
                </div>
            </div>
        </div>
        
        <!-- Game Arena -->
        <div class="game-arena" id="gameArena">
            <!-- Service Nodes will be dynamically created here -->
        </div>
        
        <!-- Game Stats -->
        <div class="game-stats">
            <div class="hud-title">📊 LIVE STATS</div>
            <div class="stat-row">
                <span class="stat-label">Monero Analysis:</span>
                <span class="stat-value" id="moneroStatus">Inactive</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">BlameChain:</span>
                <span class="stat-value" id="blamechainStatus">Inactive</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Handshakes:</span>
                <span class="stat-value" id="handshakeStatus">Inactive</span>
            </div>
            <div class="stat-row">
                <span class="stat-label">Meta Layer:</span>
                <span class="stat-value" id="metaStatus">Inactive</span>
            </div>
        </div>
        
        <!-- Game Controls -->
        <div class="game-controls">
            <div class="control-btn" onclick="startDiscovery()" title="Start Discovery">
                🔍
            </div>
            <div class="control-btn" onclick="boostAnalysis()" title="Boost Analysis">
                ⚡
            </div>
            <div class="control-btn" onclick="viewNarrative()" title="View Narrative">
                📖
            </div>
            <div class="control-btn" onclick="resetGame()" title="Reset Game">
                🔄
            </div>
        </div>
        
        <!-- Narrative Display -->
        <div class="narrative-display" id="narrativeDisplay">
            <div class="narrative-entry">
                <div class="narrative-time">Game Start</div>
                <div class="narrative-text">"Welcome to the Blockchain Analysis Game! Watch as our meta-system awakens and discovers itself..."</div>
            </div>
        </div>
    </div>
    
    <script>
        // Game State
        let gameState = {
            level: 1,
            score: 0,
            discoveries: 0,
            agreements: 0,
            dataPackets: 0,
            services: new Map(),
            connections: [],
            narratives: [],
            isRunning: false
        };
        
        // WebSocket connections
        let websockets = {
            meta: null,
            monero: null,
            blamechain: null,
            handshake: null
        };
        
        // Game initialization
        async function initGame() {
            console.log('🎮 Initializing Blockchain Analysis Game...');
            
            // Create service nodes
            createServiceNodes();
            
            // Generate background particles
            generateParticles();
            
            // Connect to all services
            await connectToServices();
            
            // Start game loop
            startGameLoop();
            
            // Hide loading screen
            setTimeout(() => {
                document.getElementById('loadingScreen').classList.add('hidden');
                gameState.isRunning = true;
                addNarrative("🎮 Game initialized! The blockchain analysis arena is now active.");
            }, 3000);
        }
        
        // Create service nodes in the arena
        function createServiceNodes() {
            const arena = document.getElementById('gameArena');
            
            // Meta Layer (center)
            const metaNode = createServiceNode('meta-layer', 'Meta Layer', 'Coordinating', '50%', '50%');
            arena.appendChild(metaNode);
            
            // Monero Genesis Explorer
            const moneroNode = createServiceNode('monero', 'Monero Explorer', 'Analyzing', '25%', '20%');
            arena.appendChild(moneroNode);
            
            // BlameChain Interface
            const blamechainNode = createServiceNode('blamechain', 'BlameChain', 'Recording', '75%', '70%');
            arena.appendChild(blamechainNode);
            
            // Handshake Layer
            const handshakeNode = createServiceNode('handshake', 'Handshake Layer', 'Discovering', '20%', '80%');
            arena.appendChild(handshakeNode);
            
            // Store nodes
            gameState.services.set('meta', metaNode);
            gameState.services.set('monero', moneroNode);
            gameState.services.set('blamechain', blamechainNode);
            gameState.services.set('handshake', handshakeNode);
        }
        
        // Create individual service node
        function createServiceNode(className, name, status, left, top) {
            const node = document.createElement('div');
            node.className = `service-node ${className}`;
            node.style.left = left;
            node.style.top = top;
            node.innerHTML = `
                <div class="service-name">${name}</div>
                <div class="service-status">${status}</div>
            `;
            
            // Add click handler
            node.onclick = () => nodeClicked(className);
            
            return node;
        }
        
        // Generate background particles
        function generateParticles() {
            const container = document.querySelector('.game-container');
            
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = Math.random() * 100 + '%';
                    particle.style.animationDelay = Math.random() * 8 + 's';
                    particle.style.animationDuration = (5 + Math.random() * 10) + 's';
                    
                    container.appendChild(particle);
                    
                    // Remove after animation
                    setTimeout(() => {
                        particle.remove();
                    }, 15000);
                }, i * 200);
            }
            
            // Regenerate particles periodically
            setTimeout(generateParticles, 15000);
        }
        
        // Connect to all services
        async function connectToServices() {
            // Connect to Meta Layer
            try {
                websockets.meta = new WebSocket('ws://localhost:48016');
                websockets.meta.onopen = () => {
                    console.log('🔗 Connected to Meta Layer');
                    updateServiceStatus('meta', 'Active');
                    gameState.score += 100;
                };
                websockets.meta.onmessage = (event) => {
                    handleMetaMessage(JSON.parse(event.data));
                };
            } catch (error) {
                console.log('Meta Layer not available');
            }
            
            // Connect to Monero Explorer
            try {
                websockets.monero = new WebSocket('ws://localhost:48014');
                websockets.monero.onopen = () => {
                    console.log('🔗 Connected to Monero Explorer');
                    updateServiceStatus('monero', 'Active');
                    gameState.score += 100;
                };
                websockets.monero.onmessage = (event) => {
                    handleMoneroMessage(JSON.parse(event.data));
                };
            } catch (error) {
                console.log('Monero Explorer not available');
            }
            
            // Connect to BlameChain
            try {
                websockets.blamechain = new WebSocket('ws://localhost:48012');
                websockets.blamechain.onopen = () => {
                    console.log('🔗 Connected to BlameChain');
                    updateServiceStatus('blamechain', 'Active');
                    gameState.score += 100;
                };
                websockets.blamechain.onmessage = (event) => {
                    handleBlamechainMessage(JSON.parse(event.data));
                };
            } catch (error) {
                console.log('BlameChain not available');
            }
            
            // Connect to Handshake Layer
            try {
                websockets.handshake = new WebSocket('ws://localhost:48010');
                websockets.handshake.onopen = () => {
                    console.log('🔗 Connected to Handshake Layer');
                    updateServiceStatus('handshake', 'Active');
                    gameState.score += 100;
                };
                websockets.handshake.onmessage = (event) => {
                    handleHandshakeMessage(JSON.parse(event.data));
                };
            } catch (error) {
                console.log('Handshake Layer not available');
            }
        }
        
        // Handle messages from different services
        function handleMetaMessage(data) {
            if (data.type === 'narrative_update') {
                addNarrative(`🧠 Meta: "${data.narrative.text}"`);
                createDiscoveryEffect('50%', '50%');
                gameState.score += 50;
            }
            
            if (data.type === 'service_message') {
                spawnDataPacket('meta', data.from);
                gameState.dataPackets++;
            }
        }
        
        function handleMoneroMessage(data) {
            if (data.type === 'genesis_analysis') {
                addNarrative(`🔐 Monero: Genesis analysis complete - ${data.principles?.length || 4} privacy principles found`);
                spawnDataPacket('monero', 'meta');
                gameState.score += 75;
            }
        }
        
        function handleBlamechainMessage(data) {
            if (data.type === 'discovery_recorded') {
                addNarrative(`⛓️ BlameChain: Discovery recorded on blockchain - ${data.service}`);
                spawnDataPacket('blamechain', 'meta');
                gameState.discoveries++;
                gameState.score += 60;
            }
        }
        
        function handleHandshakeMessage(data) {
            if (data.type === 'new_discovery') {
                addNarrative(`🤝 Handshake: New service discovered - ${data.discovery?.name || 'Unknown'}`);
                createAgreementEffect(data.discovery?.name || 'service');
                gameState.agreements++;
                gameState.score += 80;
            }
        }
        
        // Visual effects
        function createDiscoveryEffect(left, top) {
            const arena = document.getElementById('gameArena');
            const effect = document.createElement('div');
            effect.className = 'discovery-effect';
            effect.style.left = left;
            effect.style.top = top;
            
            arena.appendChild(effect);
            
            setTimeout(() => {
                effect.remove();
            }, 1000);
        }
        
        function createAgreementEffect(serviceName) {
            const arena = document.getElementById('gameArena');
            const effect = document.createElement('div');
            effect.className = 'agreement-forming';
            effect.style.left = Math.random() * 80 + 10 + '%';
            effect.style.top = Math.random() * 80 + 10 + '%';
            
            arena.appendChild(effect);
            
            setTimeout(() => {
                effect.remove();
            }, 2000);
        }
        
        function spawnDataPacket(from, to) {
            const arena = document.getElementById('gameArena');
            const packet = document.createElement('div');
            packet.className = `data-packet ${from}`;
            
            // Start position
            const fromNode = gameState.services.get(from);
            const toNode = gameState.services.get(to);
            
            if (fromNode && toNode) {
                const fromRect = fromNode.getBoundingClientRect();
                const toRect = toNode.getBoundingClientRect();
                const arenaRect = arena.getBoundingClientRect();
                
                packet.style.left = (fromRect.left - arenaRect.left + fromRect.width/2) + 'px';
                packet.style.top = (fromRect.top - arenaRect.top + fromRect.height/2) + 'px';
                
                arena.appendChild(packet);
                
                // Animate to destination
                setTimeout(() => {
                    packet.style.transition = 'all 1.5s ease-in-out';
                    packet.style.left = (toRect.left - arenaRect.left + toRect.width/2) + 'px';
                    packet.style.top = (toRect.top - arenaRect.top + toRect.height/2) + 'px';
                    packet.style.opacity = '0';
                }, 100);
                
                setTimeout(() => {
                    packet.remove();
                }, 1600);
            }
        }
        
        // Game controls
        function startDiscovery() {
            addNarrative("🔍 Player initiated discovery sequence!");
            
            // Trigger discovery in all connected services
            Object.values(websockets).forEach(ws => {
                if (ws && ws.readyState === WebSocket.OPEN) {
                    ws.send(JSON.stringify({ type: 'start_discovery', source: 'game_player' }));
                }
            });
            
            gameState.score += 25;
            updateDisplay();
        }
        
        function boostAnalysis() {
            addNarrative("⚡ Analysis boost activated! All systems operating at maximum efficiency!");
            
            // Visual boost effect
            document.querySelectorAll('.service-node').forEach(node => {
                node.style.animation = 'pulse 0.5s ease-in-out 3';
            });
            
            gameState.score += 50;
            updateDisplay();
        }
        
        function viewNarrative() {
            const display = document.getElementById('narrativeDisplay');
            display.style.maxHeight = display.style.maxHeight === '300px' ? '150px' : '300px';
        }
        
        function resetGame() {
            if (confirm('Reset the game? This will restart all systems.')) {
                location.reload();
            }
        }
        
        // Node interaction
        function nodeClicked(nodeType) {
            const node = gameState.services.get(nodeType);
            if (!node) return;
            
            // Create click effect
            createDiscoveryEffect(node.style.left, node.style.top);
            
            // Add narrative based on node type
            const messages = {
                meta: "🧠 Meta Layer: I coordinate all blockchain analysis systems",
                monero: "🔐 Monero Explorer: I analyze privacy principles from the genesis block",
                blamechain: "⛓️ BlameChain: I record all discoveries immutably on blockchain",
                handshake: "🤝 Handshake Layer: I discover services and establish agreements"
            };
            
            addNarrative(messages[nodeType] || "System interaction detected");
            gameState.score += 10;
            updateDisplay();
        }
        
        // Update service status
        function updateServiceStatus(service, status) {
            const statusMap = {
                meta: 'metaStatus',
                monero: 'moneroStatus',
                blamechain: 'blamechainStatus',  
                handshake: 'handshakeStatus'
            };
            
            const element = document.getElementById(statusMap[service]);
            if (element) {
                element.textContent = status;
                element.style.color = status === 'Active' ? '#4ecdc4' : '#666';
            }
        }
        
        // Add narrative entry
        function addNarrative(text) {
            const display = document.getElementById('narrativeDisplay');
            const entry = document.createElement('div');
            entry.className = 'narrative-entry';
            entry.innerHTML = `
                <div class="narrative-time">${new Date().toLocaleTimeString()}</div>
                <div class="narrative-text">"${text}"</div>
            `;
            
            display.appendChild(entry);
            
            // Keep only last 10 entries
            while (display.children.length > 10) {
                display.removeChild(display.firstChild);
            }
            
            // Scroll to bottom
            display.scrollTop = display.scrollHeight;
        }
        
        // Start game loop
        function startGameLoop() {
            setInterval(() => {
                if (gameState.isRunning) {
                    updateDisplay();
                    
                    // Level progression
                    const newLevel = Math.floor(gameState.score / 1000) + 1;
                    if (newLevel > gameState.level) {
                        gameState.level = newLevel;
                        addNarrative(`🎉 Level Up! Reached level ${newLevel}!`);
                    }
                    
                    // Update consciousness level
                    const consciousness = ['Awakening', 'Aware', 'Analyzing', 'Coordinating', 'Transcendent'];
                    const level = Math.min(Math.floor(gameState.agreements / 2), consciousness.length - 1);
                    document.getElementById('consciousnessLevel').textContent = consciousness[level];
                    
                    // Calculate system integrity
                    const activeServices = Object.values(websockets).filter(ws => 
                        ws && ws.readyState === WebSocket.OPEN
                    ).length;
                    const integrity = Math.floor((activeServices / 4) * 100);
                    document.getElementById('systemIntegrity').textContent = integrity + '%';
                }
            }, 1000);
        }
        
        // Update game display
        function updateDisplay() {
            document.getElementById('gameLevel').textContent = gameState.level;
            document.getElementById('gameScore').textContent = gameState.score;
            document.getElementById('totalDiscoveries').textContent = gameState.discoveries;
            document.getElementById('totalAgreements').textContent = gameState.agreements;
            document.getElementById('dataPackets').textContent = gameState.dataPackets;
            
            const activeServices = Object.values(websockets).filter(ws => 
                ws && ws.readyState === WebSocket.OPEN
            ).length;
            document.getElementById('activeServices').textContent = activeServices;
        }
        
        // Initialize game on load
        window.onload = initGame;
        
        // Handle window resize
        window.onresize = () => {
            // Adjust game arena if needed
        };
    </script>
</body>
</html>