<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Treasury Dashboard - FinishThisIdea</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .backdrop-blur {
            backdrop-filter: blur(16px);
        }

        .glass {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ffd700, #ffec8c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(16px);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.875rem;
            font-weight: 500;
        }

        .stat-value {
            color: white;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .stat-change {
            font-size: 0.875rem;
            font-weight: 500;
        }

        .positive {
            color: #10b981;
        }

        .negative {
            color: #ef4444;
        }

        .neutral {
            color: rgba(255, 255, 255, 0.6);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .dashboard-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(16px);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .card-title {
            color: white;
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .activity-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .activity-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 8px;
        }

        .activity-amount {
            color: #10b981;
            font-weight: 600;
        }

        .activity-time {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.75rem;
        }

        .activity-desc {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.875rem;
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 16px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            margin-bottom: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .leaderboard-rank {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ffd700, #ffec8c);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: #333;
            font-size: 0.875rem;
        }

        .leaderboard-info {
            flex: 1;
            margin-left: 12px;
        }

        .leaderboard-name {
            color: white;
            font-weight: 500;
            font-size: 0.875rem;
        }

        .leaderboard-tokens {
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.75rem;
        }

        .leaderboard-value {
            color: #10b981;
            font-weight: 600;
            font-size: 0.875rem;
        }

        .refresh-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.875rem;
            transition: background 0.2s ease;
        }

        .refresh-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .icon {
            width: 20px;
            height: 20px;
        }

        .loading {
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
            padding: 40px;
        }

        .error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #fca5a5;
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { Coins, TrendingUp, Users, Award, DollarSign, RefreshCw } = lucide;

        const TreasuryDashboard = () => {
            const [userEarnings, setUserEarnings] = useState(null);
            const [platformStats, setPlatformStats] = useState(null);
            const [leaderboard, setLeaderboard] = useState([]);
            const [recentActivity, setRecentActivity] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);

            const fetchData = async () => {
                try {
                    setLoading(true);
                    setError(null);

                    // Fetch user earnings
                    const earningsResponse = await fetch('/api/treasury/earnings');
                    if (!earningsResponse.ok) throw new Error('Failed to fetch earnings');
                    const earningsData = await earningsResponse.json();
                    
                    // Fetch platform stats
                    const statsResponse = await fetch('/api/treasury/stats');
                    if (!statsResponse.ok) throw new Error('Failed to fetch stats');
                    const statsData = await statsResponse.json();
                    
                    // Fetch leaderboard
                    const leaderboardResponse = await fetch('/api/treasury/leaderboard?type=tokens&limit=5');
                    if (!leaderboardResponse.ok) throw new Error('Failed to fetch leaderboard');
                    const leaderboardData = await leaderboardResponse.json();

                    setUserEarnings(earningsData.data);
                    setPlatformStats(statsData.data);
                    setLeaderboard(leaderboardData.data.leaderboard || []);
                    
                    // Generate mock recent activity
                    setRecentActivity([
                        { type: 'upload', amount: 1, time: '2 hours ago', desc: 'File upload completed' },
                        { type: 'dividend', amount: 5.50, time: '1 day ago', desc: 'Platform dividend received' },
                        { type: 'achievement', amount: 50, time: '2 days ago', desc: 'First upload achievement' },
                        { type: 'referral', amount: 25, time: '3 days ago', desc: 'Referral bonus earned' }
                    ]);

                } catch (err) {
                    setError(err.message);
                    console.error('Error fetching treasury data:', err);
                } finally {
                    setLoading(false);
                }
            };

            useEffect(() => {
                fetchData();
                // Refresh every 30 seconds
                const interval = setInterval(fetchData, 30000);
                return () => clearInterval(interval);
            }, []);

            const getActivityIcon = (type) => {
                switch (type) {
                    case 'upload': return React.createElement(TrendingUp, { className: "icon", style: { color: '#10b981' } });
                    case 'dividend': return React.createElement(DollarSign, { className: "icon", style: { color: '#fbbf24' } });
                    case 'achievement': return React.createElement(Award, { className: "icon", style: { color: '#8b5cf6' } });
                    case 'referral': return React.createElement(Users, { className: "icon", style: { color: '#06b6d4' } });
                    default: return React.createElement(Coins, { className: "icon", style: { color: '#9ca3af' } });
                }
            };

            if (loading) {
                return (
                    <div className="container">
                        <div className="loading">
                            <RefreshCw className="icon" style={{ animation: 'spin 1s linear infinite', margin: '0 auto 16px' }} />
                            <p>Loading your treasury data...</p>
                        </div>
                    </div>
                );
            }

            return (
                <div className="container">
                    {/* Header */}
                    <div className="header">
                        <h1>ðŸ’° Treasury Dashboard</h1>
                        <p>Your stake in FinishThisIdea's success â€¢ Earn from platform growth â€¢ Real ownership</p>
                    </div>

                    {error && (
                        <div className="error">
                            <strong>Error:</strong> {error}
                            <button 
                                onClick={fetchData} 
                                className="refresh-btn" 
                                style={{ marginLeft: '12px' }}
                            >
                                Retry
                            </button>
                        </div>
                    )}

                    {/* Main Stats */}
                    <div className="stats-grid">
                        <div className="stat-card">
                            <div className="stat-header">
                                <span className="stat-label">Platform Tokens</span>
                                <Coins className="icon" style={{ color: '#fbbf24' }} />
                            </div>
                            <div className="stat-value">{userEarnings?.tokensHeld?.toLocaleString() || '0'}</div>
                            <div className="stat-change positive">
                                {userEarnings?.ownershipPercentage?.toFixed(4) || '0.0000'}% ownership
                            </div>
                        </div>

                        <div className="stat-card">
                            <div className="stat-header">
                                <span className="stat-label">Total Earnings</span>
                                <DollarSign className="icon" style={{ color: '#10b981' }} />
                            </div>
                            <div className="stat-value">${userEarnings?.totalEarnings?.toFixed(2) || '0.00'}</div>
                            <div className="stat-change positive">
                                +${userEarnings?.referralEarnings?.toFixed(2) || '0.00'} referrals
                            </div>
                        </div>

                        <div className="stat-card">
                            <div className="stat-header">
                                <span className="stat-label">Platform Revenue</span>
                                <TrendingUp className="icon" style={{ color: '#06b6d4' }} />
                            </div>
                            <div className="stat-value">${platformStats?.totalRevenue?.toFixed(2) || '0.00'}</div>
                            <div className="stat-change positive">
                                ${platformStats?.totalDividendsPaid?.toFixed(2) || '0.00'} distributed
                            </div>
                        </div>

                        <div className="stat-card">
                            <div className="stat-header">
                                <span className="stat-label">Next Dividend</span>
                                <Award className="icon" style={{ color: '#8b5cf6' }} />
                            </div>
                            <div className="stat-value">${userEarnings?.projectedNextDividend?.toFixed(2) || '0.00'}</div>
                            <div className="stat-change neutral">
                                Based on {platformStats?.dividendRate || 30}% rate
                            </div>
                        </div>
                    </div>

                    {/* Dashboard Grid */}
                    <div className="dashboard-grid">
                        {/* Recent Activity */}
                        <div className="dashboard-card">
                            <div className="card-title">
                                Recent Activity
                                <button onClick={fetchData} className="refresh-btn">
                                    <RefreshCw className="icon" />
                                </button>
                            </div>
                            
                            <div>
                                {recentActivity.map((activity, index) => (
                                    <div key={index} className="activity-item">
                                        <div className="activity-header">
                                            <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                                {getActivityIcon(activity.type)}
                                                <span className="activity-amount">+{activity.amount} tokens</span>
                                            </div>
                                            <span className="activity-time">{activity.time}</span>
                                        </div>
                                        <div className="activity-desc">{activity.desc}</div>
                                    </div>
                                ))}
                            </div>
                        </div>

                        {/* Token Holders Leaderboard */}
                        <div className="dashboard-card">
                            <div className="card-title">
                                Top Token Holders
                                <span style={{ fontSize: '0.875rem', color: 'rgba(255,255,255,0.6)' }}>
                                    {platformStats?.tokenHolders || 0} total holders
                                </span>
                            </div>
                            
                            <div>
                                {leaderboard.length > 0 ? (
                                    leaderboard.map((holder, index) => (
                                        <div key={index} className="leaderboard-item">
                                            <div className="leaderboard-rank">#{index + 1}</div>
                                            <div className="leaderboard-info">
                                                <div className="leaderboard-name">
                                                    {holder.name || holder.id || 'Anonymous'}
                                                </div>
                                                <div className="leaderboard-tokens">
                                                    {(holder.platformTokens || 0).toLocaleString()} tokens
                                                </div>
                                            </div>
                                            <div className="leaderboard-value">
                                                {((holder.platformTokens || 0) / (platformStats?.totalTokens || 1) * 100).toFixed(2)}%
                                            </div>
                                        </div>
                                    ))
                                ) : (
                                    <div style={{ textAlign: 'center', color: 'rgba(255,255,255,0.6)', padding: '20px' }}>
                                        No token holders yet. Be the first!
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>

                    {/* Platform Info */}
                    <div style={{ marginTop: '40px', textAlign: 'center', color: 'rgba(255,255,255,0.8)' }}>
                        <p>ðŸ’¡ Earn tokens by uploading files, referring users, and participating in platform growth</p>
                        <p style={{ marginTop: '8px', fontSize: '0.875rem' }}>
                            Revenue sharing: {platformStats?.dividendRate || 30}% â€¢ 
                            Total tokens in circulation: {(platformStats?.totalTokens || 0).toLocaleString()}
                        </p>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<TreasuryDashboard />, document.getElementById('root'));
    </script>
</body>
</html>