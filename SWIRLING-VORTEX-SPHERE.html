<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸŒ€ Swirling Vortex Sphere - Story Extraction Interface</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            overflow: hidden;
            position: relative;
            height: 100vh;
            cursor: crosshair;
        }
        
        /* Matrix Rain Background */
        #matrix-rain {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            opacity: 0.3;
        }
        
        /* Central Vortex Container */
        .vortex-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 600px;
            height: 600px;
            z-index: 10;
        }
        
        /* The Sphere */
        .vortex-sphere {
            position: absolute;
            width: 400px;
            height: 400px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.5s ease;
            overflow: hidden;
            background: radial-gradient(circle at 30% 30%, 
                rgba(138, 43, 226, 0.8) 0%,
                rgba(75, 0, 130, 0.6) 20%,
                rgba(138, 43, 226, 0.4) 40%,
                rgba(0, 0, 0, 0.8) 100%);
            box-shadow: 
                0 0 100px rgba(138, 43, 226, 0.8),
                inset 0 0 100px rgba(138, 43, 226, 0.3),
                0 0 200px rgba(75, 0, 130, 0.5);
            animation: sphere-pulse 4s ease-in-out infinite;
        }
        
        @keyframes sphere-pulse {
            0%, 100% { 
                transform: translate(-50%, -50%) scale(1);
                box-shadow: 
                    0 0 100px rgba(138, 43, 226, 0.8),
                    inset 0 0 100px rgba(138, 43, 226, 0.3),
                    0 0 200px rgba(75, 0, 130, 0.5);
            }
            50% { 
                transform: translate(-50%, -50%) scale(1.05);
                box-shadow: 
                    0 0 150px rgba(138, 43, 226, 1),
                    inset 0 0 150px rgba(138, 43, 226, 0.5),
                    0 0 300px rgba(75, 0, 130, 0.7);
            }
        }
        
        /* Lava Lamp Effect Inside Sphere */
        .lava-lamp {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            overflow: hidden;
            filter: blur(10px);
        }
        
        .lava-blob {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle, 
                rgba(255, 0, 255, 0.8) 0%,
                rgba(138, 43, 226, 0.6) 50%,
                transparent 100%);
            animation: float-up 15s infinite ease-in-out;
        }
        
        .lava-blob:nth-child(1) {
            width: 120px;
            height: 120px;
            left: 20%;
            animation-delay: 0s;
            animation-duration: 12s;
        }
        
        .lava-blob:nth-child(2) {
            width: 80px;
            height: 80px;
            left: 50%;
            animation-delay: 2s;
            animation-duration: 18s;
        }
        
        .lava-blob:nth-child(3) {
            width: 150px;
            height: 150px;
            left: 70%;
            animation-delay: 4s;
            animation-duration: 15s;
        }
        
        .lava-blob:nth-child(4) {
            width: 100px;
            height: 100px;
            left: 30%;
            animation-delay: 6s;
            animation-duration: 20s;
        }
        
        @keyframes float-up {
            0% {
                bottom: -150px;
                transform: translateX(0) scale(1);
            }
            25% {
                transform: translateX(50px) scale(1.2);
            }
            50% {
                transform: translateX(-30px) scale(0.8);
            }
            75% {
                transform: translateX(20px) scale(1.1);
            }
            100% {
                bottom: 110%;
                transform: translateX(0) scale(0.5);
            }
        }
        
        /* Electric Effect Overlay */
        .electric-overlay {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            pointer-events: none;
            mix-blend-mode: screen;
        }
        
        .electric-arc {
            position: absolute;
            width: 2px;
            height: 100%;
            background: linear-gradient(to bottom,
                transparent 0%,
                rgba(0, 255, 255, 1) 20%,
                rgba(255, 0, 255, 1) 50%,
                rgba(0, 255, 255, 1) 80%,
                transparent 100%);
            left: 50%;
            transform-origin: center;
            animation: electric-spin 2s linear infinite;
            opacity: 0.7;
        }
        
        .electric-arc:nth-child(1) { animation-delay: 0s; }
        .electric-arc:nth-child(2) { animation-delay: 0.2s; transform: rotate(30deg); }
        .electric-arc:nth-child(3) { animation-delay: 0.4s; transform: rotate(60deg); }
        .electric-arc:nth-child(4) { animation-delay: 0.6s; transform: rotate(90deg); }
        .electric-arc:nth-child(5) { animation-delay: 0.8s; transform: rotate(120deg); }
        .electric-arc:nth-child(6) { animation-delay: 1s; transform: rotate(150deg); }
        
        @keyframes electric-spin {
            0% { transform: rotate(0deg) scaleY(0); opacity: 0; }
            10% { transform: rotate(36deg) scaleY(1); opacity: 1; }
            90% { transform: rotate(324deg) scaleY(1); opacity: 1; }
            100% { transform: rotate(360deg) scaleY(0); opacity: 0; }
        }
        
        /* Purple Word Pulse System */
        .word-pulse-container {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 15;
        }
        
        .pulse-word {
            position: absolute;
            color: #8a2be2;
            text-shadow: 0 0 20px #8a2be2, 0 0 40px #8a2be2;
            font-size: 18px;
            font-weight: bold;
            opacity: 0;
            animation: word-pulse-out 4s ease-out forwards;
            white-space: nowrap;
        }
        
        @keyframes word-pulse-out {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 0;
            }
            20% {
                opacity: 1;
            }
            80% {
                opacity: 0.8;
            }
            100% {
                transform: translate(-50%, -50%) scale(3);
                opacity: 0;
            }
        }
        
        /* Editable Layers (Photoshop-style) */
        .layer-controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #8a2be2;
            padding: 15px;
            border-radius: 5px;
            z-index: 100;
            min-width: 200px;
        }
        
        .layer-control {
            margin: 10px 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .layer-control label {
            color: #8a2be2;
            font-size: 12px;
        }
        
        .layer-control input[type="range"] {
            width: 100px;
        }
        
        .layer-control input[type="checkbox"] {
            cursor: pointer;
        }
        
        /* Story Extraction Header/Footer */
        .story-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: linear-gradient(to bottom, rgba(0,0,0,0.9), transparent);
            z-index: 20;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #8a2be2;
            text-shadow: 0 0 10px currentColor;
        }
        
        .story-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
            z-index: 20;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #0ff;
            text-shadow: 0 0 10px currentColor;
        }
        
        /* Interactive State */
        .vortex-sphere.active {
            animation: none;
            transform: translate(-50%, -50%) scale(1.2);
            box-shadow: 
                0 0 200px rgba(0, 255, 255, 1),
                inset 0 0 200px rgba(255, 0, 255, 0.5),
                0 0 400px rgba(138, 43, 226, 0.8);
        }
        
        /* Non-interactive elements */
        .decorative-element {
            position: absolute;
            pointer-events: none;
            transition: pointer-events 0.3s;
        }
        
        .decorative-element.editable {
            pointer-events: all;
            cursor: move;
            border: 1px dashed #8a2be2;
        }
        
        /* Hacker Stream Effect */
        .hacker-stream {
            position: absolute;
            width: 2px;
            background: linear-gradient(to bottom,
                transparent,
                #0f0,
                transparent);
            animation: stream-down 3s linear infinite;
            opacity: 0.6;
        }
        
        @keyframes stream-down {
            0% {
                top: -100px;
                opacity: 0;
            }
            10% {
                opacity: 0.6;
            }
            90% {
                opacity: 0.6;
            }
            100% {
                top: 100vh;
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Matrix Rain Background -->
    <canvas id="matrix-rain"></canvas>
    
    <!-- Story Header -->
    <div class="story-header" id="storyHeader">
        <span id="headerText">INITIALIZING VORTEX...</span>
    </div>
    
    <!-- Story Footer -->
    <div class="story-footer" id="storyFooter">
        <span id="footerText">Click the sphere to begin extraction</span>
    </div>
    
    <!-- Word Pulse Container -->
    <div class="word-pulse-container" id="wordPulseContainer"></div>
    
    <!-- Main Vortex Container -->
    <div class="vortex-container">
        <div class="vortex-sphere" id="vortexSphere">
            <!-- Lava Lamp Effect -->
            <div class="lava-lamp">
                <div class="lava-blob"></div>
                <div class="lava-blob"></div>
                <div class="lava-blob"></div>
                <div class="lava-blob"></div>
            </div>
            
            <!-- Electric Overlay -->
            <div class="electric-overlay">
                <div class="electric-arc"></div>
                <div class="electric-arc"></div>
                <div class="electric-arc"></div>
                <div class="electric-arc"></div>
                <div class="electric-arc"></div>
                <div class="electric-arc"></div>
            </div>
        </div>
    </div>
    
    <!-- Hacker Streams -->
    <div id="hackerStreams"></div>
    
    <!-- Layer Controls (Photoshop-style) -->
    <div class="layer-controls">
        <h3 style="color: #8a2be2; margin-bottom: 15px;">Layer Controls</h3>
        
        <div class="layer-control">
            <label>Lava Intensity</label>
            <input type="range" id="lavaIntensity" min="0" max="20" value="10">
        </div>
        
        <div class="layer-control">
            <label>Electric Effect</label>
            <input type="checkbox" id="electricToggle" checked>
        </div>
        
        <div class="layer-control">
            <label>Matrix Rain</label>
            <input type="checkbox" id="matrixToggle" checked>
        </div>
        
        <div class="layer-control">
            <label>Word Pulse Rate</label>
            <input type="range" id="pulseRate" min="500" max="5000" value="2000">
        </div>
        
        <div class="layer-control">
            <label>Edit Mode</label>
            <input type="checkbox" id="editMode">
        </div>
    </div>
    
    <script>
        // Matrix Rain Effect
        const canvas = document.getElementById('matrix-rain');
        const ctx = canvas.getContext('2d');
        
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        
        const matrix = "ABCDEFGHIJKLMNOPQRSTUVWXYZ123456789@#$%^&*()*&^%+-/~{[|`]}";
        const matrixArray = matrix.split("");
        
        const fontSize = 10;
        const columns = canvas.width / fontSize;
        
        const drops = [];
        for(let x = 0; x < columns; x++) {
            drops[x] = 1;
        }
        
        function drawMatrixRain() {
            if (!document.getElementById('matrixToggle').checked) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                return;
            }
            
            ctx.fillStyle = 'rgba(0, 0, 0, 0.04)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            ctx.fillStyle = '#0F0';
            ctx.font = fontSize + 'px monospace';
            
            for(let i = 0; i < drops.length; i++) {
                const text = matrixArray[Math.floor(Math.random() * matrixArray.length)];
                ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                
                if(drops[i] * fontSize > canvas.height && Math.random() > 0.975) {
                    drops[i] = 0;
                }
                drops[i]++;
            }
        }
        
        setInterval(drawMatrixRain, 35);
        
        // Purple Word Pulse System
        const words = [
            'VORTEX', 'SWIRL', 'PULSE', 'DREAM', 'MATRIX', 'SPHERE',
            'ELECTRIC', 'LAVA', 'STORY', 'EXTRACT', 'DECODE', 'TRANSFORM',
            'CLICK', 'ACTIVATE', 'EMERGE', 'FLOW', 'SYNC', 'CONNECT'
        ];
        
        let pulseInterval;
        
        function createPulseWord() {
            const word = words[Math.floor(Math.random() * words.length)];
            const pulseElement = document.createElement('div');
            pulseElement.className = 'pulse-word';
            pulseElement.textContent = word;
            
            // Random angle for outward direction
            const angle = Math.random() * Math.PI * 2;
            const distance = 300;
            
            // Start from center
            pulseElement.style.left = '50%';
            pulseElement.style.top = '50%';
            
            // Set animation to move outward
            pulseElement.style.setProperty('--end-x', Math.cos(angle) * distance + 'px');
            pulseElement.style.setProperty('--end-y', Math.sin(angle) * distance + 'px');
            
            document.getElementById('wordPulseContainer').appendChild(pulseElement);
            
            // Remove after animation
            setTimeout(() => {
                pulseElement.remove();
            }, 4000);
        }
        
        function startPulseWords() {
            const rate = document.getElementById('pulseRate').value;
            clearInterval(pulseInterval);
            pulseInterval = setInterval(createPulseWord, rate);
        }
        
        startPulseWords();
        
        // Hacker Stream Effect
        function createHackerStream() {
            const stream = document.createElement('div');
            stream.className = 'hacker-stream';
            stream.style.left = Math.random() * window.innerWidth + 'px';
            stream.style.animationDuration = (Math.random() * 2 + 2) + 's';
            stream.style.animationDelay = Math.random() * 3 + 's';
            
            document.getElementById('hackerStreams').appendChild(stream);
            
            setTimeout(() => {
                stream.remove();
            }, 5000);
        }
        
        // Create multiple streams
        setInterval(createHackerStream, 300);
        
        // Vortex Sphere Interaction
        const sphere = document.getElementById('vortexSphere');
        let isActive = false;
        let storySequence = 0;
        
        const storyHeaders = [
            'VORTEX ACTIVATED',
            'EXTRACTING STORIES...',
            'DECODING NARRATIVE STREAMS',
            'TRANSFORMING REALITY',
            'CAL CONSULTING MODE'
        ];
        
        const storyFooters = [
            'Stories emerging from the void',
            'Narrative threads detected',
            'Game ideas crystallizing',
            'Consulting framework online',
            'Ready for implementation'
        ];
        
        sphere.addEventListener('click', () => {
            isActive = !isActive;
            sphere.classList.toggle('active');
            
            if (isActive) {
                // Update story text
                document.getElementById('headerText').textContent = storyHeaders[storySequence % storyHeaders.length];
                document.getElementById('footerText').textContent = storyFooters[storySequence % storyFooters.length];
                storySequence++;
                
                // Trigger story extraction event
                extractStory();
            } else {
                document.getElementById('headerText').textContent = 'VORTEX DEACTIVATED';
                document.getElementById('footerText').textContent = 'Click to resume extraction';
            }
        });
        
        // Story Extraction Function
        function extractStory() {
            // This would connect to the barbell decoder
            const storyData = {
                header: document.getElementById('headerText').textContent,
                footer: document.getElementById('footerText').textContent,
                timestamp: Date.now(),
                vortexState: isActive,
                extractedWords: Array.from(document.querySelectorAll('.pulse-word')).map(el => el.textContent)
            };
            
            console.log('Story Extracted:', storyData);
            
            // Send to Cal's consulting system
            if (window.parent && window.parent.postMessage) {
                window.parent.postMessage({
                    type: 'story-extraction',
                    data: storyData
                }, '*');
            }
        }
        
        // Layer Controls
        document.getElementById('lavaIntensity').addEventListener('input', (e) => {
            document.querySelector('.lava-lamp').style.filter = `blur(${e.target.value}px)`;
        });
        
        document.getElementById('electricToggle').addEventListener('change', (e) => {
            document.querySelector('.electric-overlay').style.display = e.target.checked ? 'block' : 'none';
        });
        
        document.getElementById('pulseRate').addEventListener('input', (e) => {
            startPulseWords();
        });
        
        document.getElementById('editMode').addEventListener('change', (e) => {
            document.querySelectorAll('.decorative-element').forEach(el => {
                el.classList.toggle('editable', e.target.checked);
            });
        });
        
        // Window resize handler
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
        
        // Periodic story extraction when active
        setInterval(() => {
            if (isActive) {
                extractStory();
            }
        }, 5000);
    </script>
</body>
</html>