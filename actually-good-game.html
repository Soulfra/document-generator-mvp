<!DOCTYPE html>
<html>
<head>
    <title>üè¥‚Äç‚ò†Ô∏è Pirate Treasure Hunt</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, system-ui, sans-serif;
            background: #000;
            color: #fff;
            height: 100vh;
            overflow: hidden;
            user-select: none;
        }
        
        #gameWorld {
            width: 100vw;
            height: 100vh;
            position: relative;
            background: 
                radial-gradient(circle at 20% 80%, rgba(0, 100, 200, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(0, 200, 100, 0.3) 0%, transparent 50%),
                linear-gradient(45deg, #001122 0%, #002244 50%, #001133 100%);
            overflow: hidden;
        }
        
        /* Animated water waves */
        .wave {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 200%;
            height: 100px;
            background: linear-gradient(90deg, 
                rgba(0, 100, 200, 0.3) 0%, 
                rgba(0, 150, 255, 0.5) 50%, 
                rgba(0, 100, 200, 0.3) 100%);
            border-radius: 100% 100% 0 0;
            animation: wave 6s infinite linear;
            opacity: 0.6;
        }
        
        .wave:nth-child(2) {
            animation-delay: -2s;
            opacity: 0.4;
            height: 80px;
        }
        
        .wave:nth-child(3) {
            animation-delay: -4s;
            opacity: 0.2;
            height: 120px;
        }
        
        @keyframes wave {
            0% { transform: translateX(-50%); }
            100% { transform: translateX(0%); }
        }
        
        /* Pirate ship character */
        #pirate {
            position: absolute;
            width: 60px;
            height: 60px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transition: all 0.2s ease;
            z-index: 100;
        }
        
        .ship-body {
            width: 50px;
            height: 30px;
            background: #8B4513;
            border-radius: 15px;
            position: relative;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        
        .ship-sail {
            width: 20px;
            height: 35px;
            background: #FFF;
            position: absolute;
            top: -35px;
            left: 15px;
            border-radius: 10px 10px 0 0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .ship-mast {
            width: 2px;
            height: 40px;
            background: #654321;
            position: absolute;
            top: -40px;
            left: 24px;
        }
        
        /* Treasure chests */
        .treasure {
            position: absolute;
            width: 40px;
            height: 40px;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 50;
        }
        
        .treasure-chest {
            width: 35px;
            height: 25px;
            background: linear-gradient(45deg, #B8860B, #DAA520);
            border-radius: 5px;
            position: relative;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.4);
        }
        
        .treasure-lid {
            width: 35px;
            height: 12px;
            background: linear-gradient(45deg, #DAA520, #FFD700);
            border-radius: 8px 8px 5px 5px;
            position: absolute;
            top: -8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .treasure:hover {
            transform: scale(1.1);
            filter: brightness(1.2);
        }
        
        .treasure.collected {
            animation: collectTreasure 0.5s ease-out forwards;
        }
        
        @keyframes collectTreasure {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.5) translateY(-20px); opacity: 0.8; }
            100% { transform: scale(2) translateY(-40px); opacity: 0; }
        }
        
        /* Enemy ships */
        .enemy {
            position: absolute;
            width: 45px;
            height: 35px;
            transition: all 0.3s ease;
            cursor: crosshair;
            z-index: 50;
        }
        
        .enemy-ship {
            width: 40px;
            height: 25px;
            background: #800000;
            border-radius: 12px;
            position: relative;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.4);
        }
        
        .enemy-sail {
            width: 15px;
            height: 25px;
            background: #600000;
            position: absolute;
            top: -25px;
            left: 12px;
            border-radius: 8px 8px 0 0;
        }
        
        .enemy-flag {
            width: 8px;
            height: 8px;
            background: #000;
            position: absolute;
            top: -30px;
            left: 20px;
            border-radius: 2px;
        }
        
        .enemy:hover {
            transform: scale(1.05);
            filter: brightness(1.1);
        }
        
        .enemy.destroyed {
            animation: destroyShip 0.8s ease-out forwards;
        }
        
        @keyframes destroyShip {
            0% { transform: scale(1) rotate(0deg); opacity: 1; }
            50% { transform: scale(1.2) rotate(180deg); opacity: 0.5; }
            100% { transform: scale(0) rotate(360deg); opacity: 0; }
        }
        
        /* Islands */
        .island {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle, #228B22, #006400);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            z-index: 10;
        }
        
        .palm-tree {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 4px;
            height: 20px;
            background: #8B4513;
        }
        
        .palm-leaves {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            width: 20px;
            height: 20px;
            background: radial-gradient(circle, #32CD32, #228B22);
            border-radius: 50%;
        }
        
        /* UI Elements */
        #gameUI {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            padding: 20px;
            background: linear-gradient(180deg, rgba(0, 0, 0, 0.8) 0%, transparent 100%);
            z-index: 200;
        }
        
        .ui-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .player-info {
            display: flex;
            align-items: center;
            gap: 20px;
            font-size: 18px;
            font-weight: bold;
        }
        
        .stat {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(0, 0, 0, 0.5);
            padding: 8px 15px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }
        
        .health-bar {
            width: 100px;
            height: 8px;
            background: rgba(255, 0, 0, 0.3);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .health-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff4444, #ff6666);
            transition: width 0.3s ease;
            border-radius: 4px;
        }
        
        .progress-bar {
            width: 120px;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 5px;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff88, #44ffaa);
            transition: width 0.3s ease;
            border-radius: 3px;
        }
        
        /* Mobile controls */
        #mobileControls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 200;
        }
        
        .control-btn {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: rgba(0, 0, 0, 0.7);
            border: 3px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            font-size: 24px;
            cursor: pointer;
            transition: all 0.2s ease;
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            user-select: none;
        }
        
        .control-btn:active {
            transform: scale(0.9);
            background: rgba(255, 255, 255, 0.2);
            border-color: #00ff88;
        }
        
        .control-btn.special {
            background: rgba(255, 215, 0, 0.3);
            border-color: #ffd700;
        }
        
        .control-btn.special:active {
            background: rgba(255, 215, 0, 0.5);
        }
        
        /* Particles */
        .particle {
            position: absolute;
            pointer-events: none;
            z-index: 150;
        }
        
        .coin-particle {
            font-size: 20px;
            animation: coinFloat 2s ease-out forwards;
        }
        
        @keyframes coinFloat {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-60px) scale(1.5); opacity: 0; }
        }
        
        .explosion-particle {
            width: 8px;
            height: 8px;
            background: #ff6600;
            border-radius: 50%;
            animation: explode 1s ease-out forwards;
        }
        
        @keyframes explode {
            0% { transform: scale(1); opacity: 1; }
            100% { transform: scale(0) translate(var(--dx), var(--dy)); opacity: 0; }
        }
        
        /* Notifications */
        .notification {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: #fff;
            padding: 20px 40px;
            border-radius: 15px;
            font-size: 20px;
            font-weight: bold;
            text-align: center;
            z-index: 300;
            opacity: 0;
            transition: opacity 0.3s ease;
            backdrop-filter: blur(10px);
            border: 2px solid #00ff88;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }
        
        .notification.show {
            opacity: 1;
        }
        
        /* Character customization */
        #customizePanel {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            padding: 30px;
            border-radius: 20px;
            border: 2px solid #00ff88;
            backdrop-filter: blur(15px);
            z-index: 400;
            display: none;
            text-align: center;
            min-width: 300px;
        }
        
        #customizePanel h3 {
            margin-bottom: 20px;
            color: #00ff88;
        }
        
        #nameInput {
            width: 100%;
            padding: 12px;
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid #333;
            border-radius: 8px;
            color: #fff;
            font-size: 16px;
            text-align: center;
        }
        
        #nameInput::placeholder {
            color: #888;
        }
        
        .customize-btn {
            padding: 12px 25px;
            margin: 0 10px;
            background: rgba(0, 255, 136, 0.2);
            border: 1px solid #00ff88;
            color: #00ff88;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.2s;
        }
        
        .customize-btn:hover {
            background: rgba(0, 255, 136, 0.4);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .player-info {
                font-size: 14px;
                gap: 10px;
            }
            
            .control-btn {
                width: 60px;
                height: 60px;
                font-size: 20px;
            }
            
            #mobileControls {
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div id="gameWorld">
        <!-- Animated water waves -->
        <div class="wave"></div>
        <div class="wave"></div>
        <div class="wave"></div>
        
        <!-- Player pirate ship -->
        <div id="pirate">
            <div class="ship-mast"></div>
            <div class="ship-sail"></div>
            <div class="ship-body"></div>
        </div>
        
        <!-- Game UI -->
        <div id="gameUI">
            <div class="ui-top">
                <div class="player-info">
                    <div class="stat">
                        <span>üè¥‚Äç‚ò†Ô∏è</span>
                        <span id="playerName">Captain</span>
                    </div>
                    <div class="stat">
                        <span>üí∞</span>
                        <span id="goldCount">0</span>
                    </div>
                    <div class="stat">
                        <span>‚≠ê</span>
                        <span>Level <span id="playerLevel">1</span></span>
                    </div>
                </div>
                
                <div class="stat">
                    <span>‚ù§Ô∏è</span>
                    <div class="health-bar">
                        <div class="health-fill" id="healthFill" style="width: 100%;"></div>
                    </div>
                </div>
            </div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="xpFill" style="width: 0%;"></div>
            </div>
        </div>
        
        <!-- Mobile controls -->
        <div id="mobileControls">
            <button class="control-btn" id="leftBtn">‚Üê</button>
            <button class="control-btn" id="upBtn">‚Üë</button>
            <button class="control-btn" id="downBtn">‚Üì</button>
            <button class="control-btn" id="rightBtn">‚Üí</button>
            <button class="control-btn special" id="actionBtn">‚ö°</button>
            <button class="control-btn special" id="customizeBtn">üé®</button>
        </div>
        
        <!-- Notification -->
        <div class="notification" id="notification"></div>
        
        <!-- Character customization panel -->
        <div id="customizePanel">
            <h3>üè¥‚Äç‚ò†Ô∏è Customize Your Pirate</h3>
            <input type="text" id="nameInput" placeholder="Enter pirate name" maxlength="15">
            <div style="margin: 20px 0;">
                <div>Drop an image to customize your ship's colors!</div>
                <input type="file" id="imageInput" accept="image/*" style="margin: 10px 0;">
            </div>
            <button class="customize-btn" onclick="applyCustomization()">‚ö° Set Sail!</button>
            <button class="customize-btn" onclick="closeCustomization()">Cancel</button>
        </div>
    </div>
    
    <script>
        // Game state
        let gameState = {
            player: {
                x: window.innerWidth / 2,
                y: window.innerHeight / 2,
                health: 100,
                gold: 0,
                level: 1,
                xp: 0,
                name: 'Captain',
                shipColor: '#8B4513'
            },
            treasures: [],
            enemies: [],
            islands: [],
            gameSpeed: 1,
            paused: false
        };
        
        let keys = {};
        let lastSpawnTime = 0;
        let gameLoop;
        
        // Initialize game
        function initGame() {
            console.log('üè¥‚Äç‚ò†Ô∏è Pirate Treasure Hunt - Starting adventure!');
            
            // Create initial world
            spawnIslands();
            spawnTreasure();
            spawnEnemies();
            
            // Event listeners
            setupControls();
            setupCustomization();
            
            // Start game loop
            gameLoop = setInterval(updateGame, 16); // 60 FPS
            
            showNotification('‚ö° Welcome aboard, Captain!<br>Collect treasure and battle enemies!');
        }
        
        function setupControls() {
            // Keyboard
            document.addEventListener('keydown', (e) => {
                keys[e.key.toLowerCase()] = true;
                
                if (e.key === ' ') {
                    e.preventDefault();
                    fireCannonball();
                }
                if (e.key === 'c') {
                    showCustomization();
                }
            });
            
            document.addEventListener('keyup', (e) => {
                keys[e.key.toLowerCase()] = false;
            });
            
            // Mobile controls
            document.getElementById('leftBtn').addEventListener('touchstart', () => keys['a'] = true);
            document.getElementById('leftBtn').addEventListener('touchend', () => keys['a'] = false);
            document.getElementById('rightBtn').addEventListener('touchstart', () => keys['d'] = true);
            document.getElementById('rightBtn').addEventListener('touchend', () => keys['d'] = false);
            document.getElementById('upBtn').addEventListener('touchstart', () => keys['w'] = true);
            document.getElementById('upBtn').addEventListener('touchend', () => keys['w'] = false);
            document.getElementById('downBtn').addEventListener('touchstart', () => keys['s'] = true);
            document.getElementById('downBtn').addEventListener('touchend', () => keys['s'] = false);
            
            document.getElementById('actionBtn').addEventListener('click', fireCannonball);
            document.getElementById('customizeBtn').addEventListener('click', showCustomization);
        }
        
        function updateGame() {
            if (gameState.paused) return;
            
            // Move player
            let moveSpeed = 3;
            let moved = false;
            
            if (keys['w'] || keys['arrowup']) {
                gameState.player.y = Math.max(50, gameState.player.y - moveSpeed);
                moved = true;
            }
            if (keys['s'] || keys['arrowdown']) {
                gameState.player.y = Math.min(window.innerHeight - 100, gameState.player.y + moveSpeed);
                moved = true;
            }
            if (keys['a'] || keys['arrowleft']) {
                gameState.player.x = Math.max(30, gameState.player.x - moveSpeed);
                moved = true;
            }
            if (keys['d'] || keys['arrowright']) {
                gameState.player.x = Math.min(window.innerWidth - 30, gameState.player.x + moveSpeed);
                moved = true;
            }
            
            if (moved) {
                updatePlayerPosition();
            }
            
            // Check collisions
            checkTreasureCollisions();
            checkEnemyCollisions();
            
            // Spawn new items
            let currentTime = Date.now();
            if (currentTime - lastSpawnTime > 5000) {
                spawnTreasure();
                if (Math.random() > 0.7) spawnEnemies();
                lastSpawnTime = currentTime;
            }
            
            // Update UI
            updateUI();
        }
        
        function updatePlayerPosition() {
            const pirate = document.getElementById('pirate');
            pirate.style.left = gameState.player.x + 'px';
            pirate.style.top = gameState.player.y + 'px';
            pirate.style.transform = 'translate(-50%, -50%)';
        }
        
        function spawnIslands() {
            for (let i = 0; i < 5; i++) {
                createIsland();
            }
        }
        
        function createIsland() {
            const island = document.createElement('div');
            island.className = 'island';
            
            const size = 60 + Math.random() * 40;
            island.style.width = size + 'px';
            island.style.height = size * 0.8 + 'px';
            island.style.left = Math.random() * (window.innerWidth - size) + 'px';
            island.style.top = Math.random() * (window.innerHeight - size) + 'px';
            
            // Add palm tree
            const tree = document.createElement('div');
            tree.className = 'palm-tree';
            const leaves = document.createElement('div');
            leaves.className = 'palm-leaves';
            tree.appendChild(leaves);
            island.appendChild(tree);
            
            document.getElementById('gameWorld').appendChild(island);
            gameState.islands.push(island);
        }
        
        function spawnTreasure() {
            for (let i = 0; i < 3; i++) {
                createTreasure();
            }
        }
        
        function createTreasure() {
            const treasure = document.createElement('div');
            treasure.className = 'treasure';
            
            treasure.innerHTML = `
                <div class="treasure-lid"></div>
                <div class="treasure-chest"></div>
            `;
            
            treasure.style.left = Math.random() * (window.innerWidth - 40) + 'px';
            treasure.style.top = Math.random() * (window.innerHeight - 40) + 'px';
            
            treasure.addEventListener('click', () => collectTreasure(treasure));
            
            document.getElementById('gameWorld').appendChild(treasure);
            gameState.treasures.push(treasure);
        }
        
        function spawnEnemies() {
            for (let i = 0; i < 2; i++) {
                createEnemy();
            }
        }
        
        function createEnemy() {
            const enemy = document.createElement('div');
            enemy.className = 'enemy';
            
            enemy.innerHTML = `
                <div class="enemy-flag"></div>
                <div class="enemy-sail"></div>
                <div class="enemy-ship"></div>
            `;
            
            enemy.style.left = Math.random() * (window.innerWidth - 45) + 'px';
            enemy.style.top = Math.random() * (window.innerHeight - 35) + 'px';
            
            enemy.addEventListener('click', () => attackEnemy(enemy));
            
            document.getElementById('gameWorld').appendChild(enemy);
            gameState.enemies.push(enemy);
        }
        
        function checkTreasureCollisions() {
            const playerRect = {
                x: gameState.player.x - 30,
                y: gameState.player.y - 30,
                width: 60,
                height: 60
            };
            
            gameState.treasures.forEach(treasure => {
                if (!treasure.parentNode) return;
                
                const treasureRect = treasure.getBoundingClientRect();
                const gameRect = document.getElementById('gameWorld').getBoundingClientRect();
                
                const treasurePos = {
                    x: treasureRect.left - gameRect.left,
                    y: treasureRect.top - gameRect.top,
                    width: 40,
                    height: 40
                };
                
                if (isColliding(playerRect, treasurePos)) {
                    collectTreasure(treasure);
                }
            });
        }
        
        function checkEnemyCollisions() {
            const playerRect = {
                x: gameState.player.x - 30,
                y: gameState.player.y - 30,
                width: 60,
                height: 60
            };
            
            gameState.enemies.forEach(enemy => {
                if (!enemy.parentNode) return;
                
                const enemyRect = enemy.getBoundingClientRect();
                const gameRect = document.getElementById('gameWorld').getBoundingClientRect();
                
                const enemyPos = {
                    x: enemyRect.left - gameRect.left,
                    y: enemyRect.top - gameRect.top,
                    width: 45,
                    height: 35
                };
                
                if (isColliding(playerRect, enemyPos)) {
                    takeDamage(20);
                    createExplosion(enemyPos.x + 22, enemyPos.y + 17);
                }
            });
        }
        
        function isColliding(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                   rect1.x + rect1.width > rect2.x &&
                   rect1.y < rect2.y + rect2.height &&
                   rect1.y + rect1.height > rect2.y;
        }
        
        function collectTreasure(treasure) {
            if (treasure.classList.contains('collected')) return;
            
            treasure.classList.add('collected');
            
            const goldValue = 50 + Math.floor(Math.random() * 100);
            gameState.player.gold += goldValue;
            gameState.player.xp += 25;
            
            createCoinParticle(treasure.offsetLeft + 20, treasure.offsetTop + 20, goldValue);
            
            setTimeout(() => {
                if (treasure.parentNode) {
                    treasure.remove();
                }
                // Remove from array
                const index = gameState.treasures.indexOf(treasure);
                if (index > -1) {
                    gameState.treasures.splice(index, 1);
                }
            }, 500);
            
            checkLevelUp();
            showNotification(`üí∞ Found treasure! +${goldValue} gold!`);
        }
        
        function attackEnemy(enemy) {
            if (enemy.classList.contains('destroyed')) return;
            
            enemy.classList.add('destroyed');
            
            const goldReward = 100 + Math.floor(Math.random() * 150);
            gameState.player.gold += goldReward;
            gameState.player.xp += 50;
            
            createExplosion(enemy.offsetLeft + 22, enemy.offsetTop + 17);
            createCoinParticle(enemy.offsetLeft + 22, enemy.offsetTop + 17, goldReward);
            
            setTimeout(() => {
                if (enemy.parentNode) {
                    enemy.remove();
                }
                // Remove from array
                const index = gameState.enemies.indexOf(enemy);
                if (index > -1) {
                    gameState.enemies.splice(index, 1);
                }
            }, 800);
            
            checkLevelUp();
            showNotification(`‚öîÔ∏è Enemy defeated! +${goldReward} gold!`);
        }
        
        function fireCannonball() {
            // Visual feedback for firing
            const pirate = document.getElementById('pirate');
            pirate.style.transform = 'translate(-50%, -50%) scale(1.1)';
            setTimeout(() => {
                pirate.style.transform = 'translate(-50%, -50%) scale(1)';
            }, 150);
            
            // Find nearest enemy and attack
            let nearestEnemy = null;
            let nearestDistance = Infinity;
            
            gameState.enemies.forEach(enemy => {
                if (enemy.classList.contains('destroyed')) return;
                
                const enemyRect = enemy.getBoundingClientRect();
                const gameRect = document.getElementById('gameWorld').getBoundingClientRect();
                
                const distance = Math.sqrt(
                    Math.pow(gameState.player.x - (enemyRect.left - gameRect.left + 22), 2) +
                    Math.pow(gameState.player.y - (enemyRect.top - gameRect.top + 17), 2)
                );
                
                if (distance < nearestDistance && distance < 200) {
                    nearestDistance = distance;
                    nearestEnemy = enemy;
                }
            });
            
            if (nearestEnemy) {
                attackEnemy(nearestEnemy);
            } else {
                showNotification('üí® No enemies in range!');
            }
        }
        
        function takeDamage(amount) {
            gameState.player.health -= amount;
            gameState.player.health = Math.max(0, gameState.player.health);
            
            // Screen flash
            document.getElementById('gameWorld').style.filter = 'brightness(1.5) hue-rotate(0deg)';
            setTimeout(() => {
                document.getElementById('gameWorld').style.filter = '';
            }, 200);
            
            if (gameState.player.health <= 0) {
                gameOver();
            } else {
                showNotification(`üí• Took ${amount} damage!`);
            }
        }
        
        function checkLevelUp() {
            const xpNeeded = gameState.player.level * 100;
            if (gameState.player.xp >= xpNeeded) {
                gameState.player.level++;
                gameState.player.xp = 0;
                gameState.player.health = Math.min(100, gameState.player.health + 25);
                
                showNotification(`üåü Level up! Now level ${gameState.player.level}!<br>Health restored!`);
                
                // Visual celebration
                for (let i = 0; i < 10; i++) {
                    setTimeout(() => {
                        createCoinParticle(
                            gameState.player.x + (Math.random() - 0.5) * 100,
                            gameState.player.y + (Math.random() - 0.5) * 100,
                            '‚≠ê'
                        );
                    }, i * 100);
                }
            }
        }
        
        function createCoinParticle(x, y, value) {
            const particle = document.createElement('div');
            particle.className = 'particle coin-particle';
            particle.textContent = typeof value === 'number' ? `+${value}üí∞` : value;
            particle.style.left = x + 'px';
            particle.style.top = y + 'px';
            
            document.getElementById('gameWorld').appendChild(particle);
            
            setTimeout(() => {
                if (particle.parentNode) {
                    particle.remove();
                }
            }, 2000);
        }
        
        function createExplosion(x, y) {
            for (let i = 0; i < 8; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle explosion-particle';
                
                const angle = (i / 8) * Math.PI * 2;
                const distance = 30 + Math.random() * 20;
                const dx = Math.cos(angle) * distance;
                const dy = Math.sin(angle) * distance;
                
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                particle.style.setProperty('--dx', dx + 'px');
                particle.style.setProperty('--dy', dy + 'px');
                
                document.getElementById('gameWorld').appendChild(particle);
                
                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.remove();
                    }
                }, 1000);
            }
        }
        
        function updateUI() {
            document.getElementById('playerName').textContent = gameState.player.name;
            document.getElementById('goldCount').textContent = gameState.player.gold;
            document.getElementById('playerLevel').textContent = gameState.player.level;
            
            const healthPercent = (gameState.player.health / 100) * 100;
            document.getElementById('healthFill').style.width = healthPercent + '%';
            
            const xpPercent = (gameState.player.xp / (gameState.player.level * 100)) * 100;
            document.getElementById('xpFill').style.width = xpPercent + '%';
        }
        
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.innerHTML = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        function setupCustomization() {
            document.getElementById('imageInput').addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    const file = e.target.files[0];
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        extractColorsFromImage(event.target.result);
                    };
                    reader.readAsDataURL(file);
                }
            });
        }
        
        function extractColorsFromImage(imageDataUrl) {
            const img = new Image();
            img.onload = () => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = img.width;
                canvas.height = img.height;
                ctx.drawImage(img, 0, 0);
                
                const imageData = ctx.getImageData(0, 0, img.width, img.height);
                const colors = getAverageColor(imageData);
                
                // Apply colors to ship
                gameState.player.shipColor = colors.primary;
                document.querySelector('.ship-body').style.background = colors.primary;
                document.querySelector('.ship-sail').style.background = colors.secondary;
                
                showNotification('üé® Ship customized with image colors!');
            };
            img.src = imageDataUrl;
        }
        
        function getAverageColor(imageData) {
            const data = imageData.data;
            let r = 0, g = 0, b = 0;
            const totalPixels = data.length / 4;
            
            for (let i = 0; i < data.length; i += 16) { // Sample every 4th pixel for performance
                r += data[i];
                g += data[i + 1];
                b += data[i + 2];
            }
            
            r = Math.floor(r / (totalPixels / 4));
            g = Math.floor(g / (totalPixels / 4));
            b = Math.floor(b / (totalPixels / 4));
            
            return {
                primary: `rgb(${r}, ${g}, ${b})`,
                secondary: `rgb(${Math.min(255, r + 50)}, ${Math.min(255, g + 50)}, ${Math.min(255, b + 50)})`
            };
        }
        
        function showCustomization() {
            gameState.paused = true;
            document.getElementById('customizePanel').style.display = 'block';
            document.getElementById('nameInput').value = gameState.player.name;
            document.getElementById('nameInput').focus();
        }
        
        function closeCustomization() {
            gameState.paused = false;
            document.getElementById('customizePanel').style.display = 'none';
        }
        
        function applyCustomization() {
            const newName = document.getElementById('nameInput').value.trim();
            if (newName) {
                gameState.player.name = newName.substring(0, 15);
            }
            closeCustomization();
            showNotification(`‚ö° Welcome aboard, ${gameState.player.name}!`);
        }
        
        function gameOver() {
            gameState.paused = true;
            clearInterval(gameLoop);
            
            showNotification(`üíÄ Game Over, ${gameState.player.name}!<br>Final Score: ${gameState.player.gold} gold<br>Level: ${gameState.player.level}<br><br>Refresh to play again!`);
        }
        
        // Initialize game when page loads
        window.addEventListener('load', initGame);
        
        // Handle window resize
        window.addEventListener('resize', () => {
            // Keep player in bounds
            gameState.player.x = Math.min(gameState.player.x, window.innerWidth - 30);
            gameState.player.y = Math.min(gameState.player.y, window.innerHeight - 100);
            updatePlayerPosition();
        });
        
        console.log('üè¥‚Äç‚ò†Ô∏è Pirate Treasure Hunt loaded!');
        console.log('‚å®Ô∏è Controls: WASD to move, Space to fire, C to customize');
        console.log('üì± Mobile: Use buttons, tap enemies/treasure to interact');
    </script>
</body>
</html>