<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Monitoring - FinishThisIdea</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0f1419;
            color: #e1e8ed;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #2f3336;
        }
        
        h1 {
            font-size: 2rem;
            color: #fff;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .status-healthy { background: #00ba7c; }
        .status-degraded { background: #ffa500; }
        .status-unhealthy { background: #f91880; }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: #192734;
            border: 1px solid #2f3336;
            border-radius: 12px;
            padding: 20px;
            transition: transform 0.2s;
        }
        
        .metric-card:hover {
            transform: translateY(-2px);
            border-color: #1d9bf0;
        }
        
        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .metric-title {
            font-size: 0.9rem;
            color: #8b98a5;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: #fff;
        }
        
        .metric-change {
            font-size: 0.85rem;
            margin-top: 5px;
        }
        
        .metric-positive { color: #00ba7c; }
        .metric-negative { color: #f91880; }
        
        .chart-container {
            background: #192734;
            border: 1px solid #2f3336;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            height: 300px;
        }
        
        .alerts-container {
            background: #192734;
            border: 1px solid #2f3336;
            border-radius: 12px;
            padding: 20px;
        }
        
        .alert-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            margin-bottom: 10px;
            background: #0f1419;
            border-radius: 8px;
            border-left: 4px solid;
        }
        
        .alert-critical { border-color: #f91880; }
        .alert-warning { border-color: #ffa500; }
        .alert-info { border-color: #1d9bf0; }
        
        .alert-icon {
            font-size: 1.5rem;
        }
        
        .alert-content {
            flex: 1;
        }
        
        .alert-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .alert-time {
            font-size: 0.85rem;
            color: #8b98a5;
        }
        
        .queue-status {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .queue-item {
            flex: 1;
            text-align: center;
            padding: 10px;
            background: #0f1419;
            border-radius: 6px;
        }
        
        .queue-label {
            font-size: 0.8rem;
            color: #8b98a5;
            margin-bottom: 5px;
        }
        
        .queue-count {
            font-size: 1.5rem;
            font-weight: bold;
        }
        
        .refresh-btn {
            background: #1d9bf0;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background 0.2s;
        }
        
        .refresh-btn:hover {
            background: #1a8cd8;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #2f3336;
            border-top-color: #1d9bf0;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .error-message {
            background: #f918803d;
            border: 1px solid #f91880;
            color: #f91880;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéØ System Monitoring</h1>
            <div class="status-indicator">
                <div id="status-dot" class="status-dot status-healthy"></div>
                <span id="status-text">Checking...</span>
                <button class="refresh-btn" onclick="refreshDashboard()">Refresh</button>
            </div>
        </header>

        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-header">
                    <span class="metric-title">Active Jobs</span>
                    <span>üöÄ</span>
                </div>
                <div class="metric-value" id="active-jobs">-</div>
                <div class="metric-change" id="jobs-change"></div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <span class="metric-title">Success Rate</span>
                    <span>‚úÖ</span>
                </div>
                <div class="metric-value" id="success-rate">-</div>
                <div class="metric-change metric-positive">Last 24 hours</div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <span class="metric-title">Avg Response Time</span>
                    <span>‚è±Ô∏è</span>
                </div>
                <div class="metric-value" id="response-time">-</div>
                <div class="metric-change" id="response-change"></div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <span class="metric-title">Memory Usage</span>
                    <span>üíæ</span>
                </div>
                <div class="metric-value" id="memory-usage">-</div>
                <div class="metric-change" id="memory-total"></div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <span class="metric-title">Error Rate</span>
                    <span>‚ö†Ô∏è</span>
                </div>
                <div class="metric-value" id="error-rate">-</div>
                <div class="metric-change" id="error-change"></div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <span class="metric-title">Uptime</span>
                    <span>üü¢</span>
                </div>
                <div class="metric-value" id="uptime">-</div>
                <div class="metric-change metric-positive">Since last restart</div>
            </div>
        </div>

        <div class="chart-container">
            <h3>Job Queue Status</h3>
            <div class="queue-status" id="queue-status">
                <div class="queue-item">
                    <div class="queue-label">Waiting</div>
                    <div class="queue-count" id="queue-waiting">-</div>
                </div>
                <div class="queue-item">
                    <div class="queue-label">Active</div>
                    <div class="queue-count" id="queue-active">-</div>
                </div>
                <div class="queue-item">
                    <div class="queue-label">Completed</div>
                    <div class="queue-count" id="queue-completed">-</div>
                </div>
                <div class="queue-item">
                    <div class="queue-label">Failed</div>
                    <div class="queue-count" id="queue-failed">-</div>
                </div>
            </div>
        </div>

        <div class="alerts-container">
            <h3>System Alerts</h3>
            <div id="alerts-list">
                <div class="alert-item alert-info">
                    <span class="alert-icon">‚ÑπÔ∏è</span>
                    <div class="alert-content">
                        <div class="alert-title">No alerts</div>
                        <div class="alert-time">System operating normally</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = '/api/monitoring';
        let refreshInterval;

        async function fetchDashboardData() {
            try {
                // Fetch health status
                const healthResponse = await fetch(`${API_BASE}/health`);
                const healthData = await healthResponse.json();
                
                if (healthData.success) {
                    updateHealthStatus(healthData.data);
                }

                // Fetch error analytics
                const errorsResponse = await fetch(`${API_BASE}/errors?timeRange=1h`);
                const errorsData = await errorsResponse.json();
                
                if (errorsData.success) {
                    updateErrorMetrics(errorsData.data);
                }

                // Fetch alerts
                const alertsResponse = await fetch(`${API_BASE}/alerts`);
                const alertsData = await alertsResponse.json();
                
                if (alertsData.success) {
                    updateAlerts(alertsData.data);
                }

                // Fetch queue status
                const queueResponse = await fetch(`${API_BASE}/queue`);
                const queueData = await queueResponse.json();
                
                if (queueData.success) {
                    updateQueueStatus(queueData.data);
                }

            } catch (error) {
                console.error('Failed to fetch dashboard data:', error);
                showError('Failed to load monitoring data');
            }
        }

        function updateHealthStatus(health) {
            // Update status indicator
            const statusDot = document.getElementById('status-dot');
            const statusText = document.getElementById('status-text');
            
            statusDot.className = `status-dot status-${health.status}`;
            statusText.textContent = health.status.charAt(0).toUpperCase() + health.status.slice(1);

            // Update metrics
            document.getElementById('memory-usage').textContent = `${health.resources.memory.percentage}%`;
            document.getElementById('memory-total').textContent = `${health.resources.memory.used}MB / ${health.resources.memory.total}MB`;
            
            // Update uptime
            const uptimeHours = Math.floor(health.resources.uptime / 3600);
            const uptimeMinutes = Math.floor((health.resources.uptime % 3600) / 60);
            document.getElementById('uptime').textContent = `${uptimeHours}h ${uptimeMinutes}m`;
            
            // Update response time
            if (health.performance) {
                document.getElementById('response-time').textContent = `${health.performance.averageResponseTime}ms`;
            }
        }

        function updateErrorMetrics(errors) {
            const errorRate = errors.totalErrors;
            document.getElementById('error-rate').textContent = errorRate.toString();
            
            const errorChange = document.getElementById('error-change');
            if (errorRate > 10) {
                errorChange.textContent = '‚ö†Ô∏è High error rate';
                errorChange.className = 'metric-change metric-negative';
            } else {
                errorChange.textContent = '‚úì Normal';
                errorChange.className = 'metric-change metric-positive';
            }
            
            // Update success rate
            const successRate = Math.round(errors.recoveryRate || 0);
            document.getElementById('success-rate').textContent = `${successRate}%`;
        }

        function updateQueueStatus(queue) {
            document.getElementById('queue-waiting').textContent = queue.counts.waiting || 0;
            document.getElementById('queue-active').textContent = queue.counts.active || 0;
            document.getElementById('queue-completed').textContent = queue.counts.completed || 0;
            document.getElementById('queue-failed').textContent = queue.counts.failed || 0;
            
            // Update active jobs metric
            document.getElementById('active-jobs').textContent = queue.counts.active || 0;
            
            const jobsChange = document.getElementById('jobs-change');
            if (queue.counts.waiting > 10) {
                jobsChange.textContent = `${queue.counts.waiting} in queue`;
                jobsChange.className = 'metric-change metric-negative';
            } else {
                jobsChange.textContent = `${queue.counts.waiting} in queue`;
                jobsChange.className = 'metric-change metric-positive';
            }
        }

        function updateAlerts(alertsData) {
            const alertsList = document.getElementById('alerts-list');
            
            if (alertsData.alerts.length === 0) {
                alertsList.innerHTML = `
                    <div class="alert-item alert-info">
                        <span class="alert-icon">‚ÑπÔ∏è</span>
                        <div class="alert-content">
                            <div class="alert-title">No alerts</div>
                            <div class="alert-time">System operating normally</div>
                        </div>
                    </div>
                `;
                return;
            }
            
            alertsList.innerHTML = alertsData.alerts.map(alert => {
                const icon = alert.level === 'critical' ? 'üö®' : 
                           alert.level === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
                
                return `
                    <div class="alert-item alert-${alert.level}">
                        <span class="alert-icon">${icon}</span>
                        <div class="alert-content">
                            <div class="alert-title">${alert.message}</div>
                            <div class="alert-time">${new Date(alert.timestamp).toLocaleTimeString()}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function showError(message) {
            const container = document.querySelector('.container');
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            container.insertBefore(errorDiv, container.firstChild.nextSibling);
            
            setTimeout(() => errorDiv.remove(), 5000);
        }

        function refreshDashboard() {
            const btn = document.querySelector('.refresh-btn');
            btn.innerHTML = '<span class="loading"></span>';
            btn.disabled = true;
            
            fetchDashboardData().finally(() => {
                btn.innerHTML = 'Refresh';
                btn.disabled = false;
            });
        }

        // Initialize dashboard
        fetchDashboardData();

        // Auto-refresh every 10 seconds
        refreshInterval = setInterval(fetchDashboardData, 10000);

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (refreshInterval) clearInterval(refreshInterval);
        });
    </script>
</body>
</html>