<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Godot 4 Economic Engine - Professional AAA Visualization</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background: #000;
            color: #fff;
            font-family: 'Courier New', monospace;
            overflow: hidden;
        }

        #game-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            background: linear-gradient(45deg, #000011, #001122);
        }

        #godot-canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        #loading-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #000, #002);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .loading-logo {
            font-size: 48px;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }

        .loading-text {
            font-size: 24px;
            color: #0f0;
            margin-bottom: 30px;
        }

        .loading-bar {
            width: 400px;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .loading-progress {
            height: 100%;
            background: linear-gradient(90deg, #0f0, #0ff);
            width: 0%;
            transition: width 0.3s;
            border-radius: 4px;
        }

        .loading-status {
            font-size: 14px;
            opacity: 0.8;
            text-align: center;
        }

        #ui-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
        }

        .ui-panel {
            position: absolute;
            background: rgba(0, 0, 0, 0.85);
            border: 2px solid #00ff00;
            border-radius: 10px;
            padding: 15px;
            color: #00ff00;
            font-size: 12px;
            backdrop-filter: blur(10px);
            pointer-events: auto;
            transition: all 0.3s;
        }

        .ui-panel:hover {
            border-color: #00ffff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
        }

        #engine-info {
            top: 20px;
            left: 20px;
            min-width: 280px;
        }

        #performance-info {
            top: 20px;
            right: 20px;
            min-width: 200px;
            border-color: #ff6600;
            color: #ff6600;
        }

        #controls-info {
            bottom: 20px;
            left: 20px;
            min-width: 350px;
            border-color: #6600ff;
            color: #6600ff;
        }

        #status-info {
            bottom: 20px;
            right: 20px;
            min-width: 200px;
            border-color: #ff0066;
            color: #ff0066;
        }

        .metric-row {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            padding: 3px 0;
        }

        .metric-label {
            opacity: 0.8;
        }

        .metric-value {
            font-weight: bold;
        }

        .engine-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
            text-shadow: 0 0 10px currentColor;
        }

        .control-item {
            margin: 5px 0;
            font-size: 11px;
            opacity: 0.9;
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-online { background: #0f0; }
        .status-loading { background: #ff0; animation: blink 1s infinite; }
        .status-error { background: #f00; }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        .godot-logo {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            opacity: 0.5;
            color: #0ff;
        }

        #error-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(100, 0, 0, 0.9);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
        }

        .error-title {
            font-size: 36px;
            color: #ff4444;
            margin-bottom: 20px;
        }

        .error-message {
            font-size: 16px;
            text-align: center;
            max-width: 600px;
            line-height: 1.5;
            margin-bottom: 30px;
        }

        .fallback-button {
            padding: 15px 30px;
            background: linear-gradient(135deg, #ff4444, #cc0000);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .fallback-button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255, 68, 68, 0.5);
        }
    </style>
</head>
<body>
    <div id="game-container">
        <!-- Loading Screen -->
        <div id="loading-screen">
            <div class="loading-logo">üéÆüöÄ</div>
            <div class="loading-text">INITIALIZING GODOT 4 ECONOMIC ENGINE</div>
            <div class="loading-bar">
                <div class="loading-progress" id="loading-progress"></div>
            </div>
            <div class="loading-status" id="loading-status">Loading game engine...</div>
        </div>

        <!-- Error Screen -->
        <div id="error-screen">
            <div class="error-title">üö´ ENGINE ERROR</div>
            <div class="error-message" id="error-message">
                Godot 4 web export not available. This requires building the Godot project and exporting to WebGL.
            </div>
            <button class="fallback-button" onclick="showFallbackOptions()">
                VIEW FALLBACK OPTIONS
            </button>
        </div>

        <!-- Godot Canvas (would be injected by Godot export) -->
        <canvas id="godot-canvas" style="display: none;"></canvas>

        <!-- UI Overlay -->
        <div id="ui-overlay">
            <div id="engine-info" class="ui-panel">
                <div class="engine-title">üéÆ GODOT 4 ENGINE</div>
                <div class="metric-row">
                    <span class="metric-label">Renderer:</span>
                    <span class="metric-value">Vulkan/WebGL</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Physics:</span>
                    <span class="metric-value">Jolt Engine</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Agents:</span>
                    <span class="metric-value" id="agent-count">7</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Trade Lines:</span>
                    <span class="metric-value" id="trade-count">0</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Particles:</span>
                    <span class="metric-value" id="particle-count">0</span>
                </div>
            </div>

            <div id="performance-info" class="ui-panel">
                <div class="engine-title">‚ö° PERFORMANCE</div>
                <div class="metric-row">
                    <span class="metric-label">FPS:</span>
                    <span class="metric-value" id="fps">60</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Frame Time:</span>
                    <span class="metric-value" id="frame-time">16.7ms</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Draw Calls:</span>
                    <span class="metric-value" id="draw-calls">~50</span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Memory:</span>
                    <span class="metric-value" id="memory-usage">25MB</span>
                </div>
            </div>

            <div id="controls-info" class="ui-panel">
                <div class="engine-title">üéÆ CONTROLS</div>
                <div class="control-item">üñ±Ô∏è Left Click + Drag: Orbit Camera</div>
                <div class="control-item">üé° Mouse Wheel: Zoom In/Out</div>
                <div class="control-item">‚å®Ô∏è WASD: Move Camera</div>
                <div class="control-item">üéØ R: Reset Camera Position</div>
                <div class="control-item">üî• C: Chaos Mode</div>
                <div class="control-item">ü§ñ 1-7: Focus on Agent</div>
                <div class="control-item">üëÜ Click Agents: View Details</div>
                <div class="control-item">‚è∏Ô∏è ESC: Release Mouse</div>
            </div>

            <div id="status-info" class="ui-panel">
                <div class="engine-title">üìä STATUS</div>
                <div class="metric-row">
                    <span class="metric-label">Engine:</span>
                    <span class="metric-value">
                        <span class="status-indicator status-loading" id="engine-status"></span>
                        Loading
                    </span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Economy API:</span>
                    <span class="metric-value" id="api-status">
                        <span class="status-indicator status-loading"></span>
                        Connecting
                    </span>
                </div>
                <div class="metric-row">
                    <span class="metric-label">Real-time Data:</span>
                    <span class="metric-value" id="data-status">
                        <span class="status-indicator status-loading"></span>
                        Syncing
                    </span>
                </div>
            </div>
        </div>

        <div class="godot-logo">
            Powered by Godot 4 Open Source Game Engine
        </div>
    </div>

    <script>
        class GodotEconomicEngineLoader {
            constructor() {
                this.loadingProgress = 0;
                this.engineLoaded = false;
                this.economyConnected = false;
                
                this.init();
            }

            async init() {
                this.updateLoadingProgress(10, "Checking Godot runtime...");
                
                // Simulate loading process
                await this.simulateLoading();
                
                // Try to load Godot engine
                await this.loadGodotEngine();
                
                // Start UI updates
                this.startUIUpdates();
            }

            async simulateLoading() {
                const steps = [
                    { progress: 20, message: "Loading Godot 4 runtime..." },
                    { progress: 40, message: "Initializing WebGL renderer..." },
                    { progress: 60, message: "Setting up physics engine..." },
                    { progress: 80, message: "Creating economic agents..." },
                    { progress: 95, message: "Connecting to economy API..." }
                ];

                for (const step of steps) {
                    await this.delay(800);
                    this.updateLoadingProgress(step.progress, step.message);
                }
            }

            async loadGodotEngine() {
                try {
                    // Check if Godot export files exist
                    const hasGodotBuild = await this.checkGodotBuild();
                    
                    if (hasGodotBuild) {
                        await this.loadGodotRuntime();
                        this.showGame();
                    } else {
                        this.showError("Godot 4 export files not found. Build required.");
                    }
                } catch (error) {
                    console.error("Failed to load Godot engine:", error);
                    this.showError(error.message);
                }
            }

            async checkGodotBuild() {
                // In a real implementation, this would check for Godot export files
                // For now, we simulate the check
                try {
                    const response = await fetch('/godot-build/index.html');
                    return response.ok;
                } catch {
                    return false;
                }
            }

            async loadGodotRuntime() {
                // In a real implementation, this would load the Godot WebGL export
                // const script = document.createElement('script');
                // script.src = '/godot-build/index.js';
                // document.head.appendChild(script);
                
                this.updateLoadingProgress(100, "Engine loaded successfully!");
                await this.delay(500);
            }

            showGame() {
                document.getElementById('loading-screen').style.display = 'none';
                document.getElementById('godot-canvas').style.display = 'block';
                
                // Update status indicators
                this.updateStatusIndicator('engine-status', 'online', 'Running');
                this.updateStatusIndicator('api-status', 'online', 'Connected');
                this.updateStatusIndicator('data-status', 'online', 'Live');
                
                this.engineLoaded = true;
                console.log("üéÆ Godot Economic Engine loaded successfully!");
            }

            showError(message) {
                document.getElementById('loading-screen').style.display = 'none';
                document.getElementById('error-message').textContent = message;
                document.getElementById('error-screen').style.display = 'flex';
                
                // Update status indicators
                this.updateStatusIndicator('engine-status', 'error', 'Failed');
                this.updateStatusIndicator('api-status', 'error', 'Failed');
                this.updateStatusIndicator('data-status', 'error', 'Failed');
            }

            updateLoadingProgress(progress, message) {
                this.loadingProgress = progress;
                document.getElementById('loading-progress').style.width = `${progress}%`;
                document.getElementById('loading-status').textContent = message;
            }

            updateStatusIndicator(elementId, status, text) {
                const element = document.getElementById(elementId);
                const indicator = element.querySelector('.status-indicator');
                
                indicator.className = `status-indicator status-${status}`;
                element.innerHTML = `<span class="status-indicator status-${status}"></span>${text}`;
            }

            startUIUpdates() {
                // Simulate real-time performance metrics
                setInterval(() => {
                    if (this.engineLoaded) {
                        this.updatePerformanceMetrics();
                    }
                }, 1000);

                // Simulate economy data updates
                setInterval(() => {
                    if (this.engineLoaded) {
                        this.updateEconomyMetrics();
                    }
                }, 2000);
            }

            updatePerformanceMetrics() {
                // Simulate realistic performance metrics
                const fps = 55 + Math.random() * 10;
                const frameTime = 1000 / fps;
                const drawCalls = 45 + Math.floor(Math.random() * 15);
                const memory = 25 + Math.random() * 5;

                document.getElementById('fps').textContent = fps.toFixed(0);
                document.getElementById('frame-time').textContent = frameTime.toFixed(1) + 'ms';
                document.getElementById('draw-calls').textContent = '~' + drawCalls;
                document.getElementById('memory-usage').textContent = memory.toFixed(1) + 'MB';
            }

            updateEconomyMetrics() {
                // Simulate trade and particle activity
                const tradeCount = Math.floor(Math.random() * 5);
                const particleCount = Math.floor(Math.random() * 200);

                document.getElementById('trade-count').textContent = tradeCount;
                document.getElementById('particle-count').textContent = particleCount;
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // Fallback function for when Godot build is not available
        function showFallbackOptions() {
            const options = `
                <div style="text-align: left; max-width: 500px;">
                    <h3>üõ†Ô∏è To run the full Godot 4 engine:</h3>
                    <br>
                    <p><strong>1. Install Godot 4</strong></p>
                    <p>Download from: <a href="https://godotengine.org" target="_blank" style="color: #0ff;">godotengine.org</a></p>
                    <br>
                    <p><strong>2. Open the project</strong></p>
                    <p>Load: <code>/godot-project/project.godot</code></p>
                    <br>
                    <p><strong>3. Export to Web</strong></p>
                    <p>Project ‚Üí Export ‚Üí Web ‚Üí Export Project</p>
                    <br>
                    <p><strong>4. Alternative Options</strong></p>
                    <p>‚Ä¢ <a href="/engine" style="color: #0ff;">Babylon.js Engine</a> (available now)</p>
                    <p>‚Ä¢ <a href="/visualization" style="color: #0ff;">Three.js Visualization</a> (basic)</p>
                    <p>‚Ä¢ <a href="/economy" style="color: #0ff;">Economy Dashboard</a> (data only)</p>
                </div>
            `;
            
            document.getElementById('error-message').innerHTML = options;
        }

        // Initialize the loader when page loads
        window.addEventListener('DOMContentLoaded', () => {
            new GodotEconomicEngineLoader();
        });

        // Handle fullscreen and browser compatibility
        document.addEventListener('keydown', (event) => {
            if (event.key === 'F11') {
                event.preventDefault();
                if (!document.fullscreenElement) {
                    document.documentElement.requestFullscreen();
                } else {
                    document.exitFullscreen();
                }
            }
        });
    </script>
</body>
</html>