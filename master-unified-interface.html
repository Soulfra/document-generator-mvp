<!DOCTYPE html>
<html>
<head>
    <title>üåê MASTER UNIFIED INTERFACE - All Systems Connected</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: #00ff00;
            font-family: 'Courier New', monospace;
            overflow-x: hidden;
        }
        
        .header {
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            text-align: center;
            border-bottom: 3px solid #00ff00;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px;
        }
        
        .status-card {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #00ff00;
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s;
        }
        
        .status-card.gaming {
            border-color: #ff6600;
        }
        
        .status-card.financial {
            border-color: #ffff00;
        }
        
        .status-card.universal {
            border-color: #ff00ff;
        }
        
        .status-card.broadcaster {
            border-color: #00ffff;
        }
        
        .status-indicator {
            width: 15px;
            height: 15px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 10px;
        }
        
        .status-online {
            background: #0f0;
            box-shadow: 0 0 10px #0f0;
        }
        
        .status-offline {
            background: #f00;
        }
        
        .status-loading {
            background: #ff0;
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .layer-data {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            font-size: 14px;
        }
        
        .controls {
            text-align: center;
            margin: 20px;
        }
        
        .btn {
            background: linear-gradient(135deg, #00ff00, #ffff00);
            color: #000;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-weight: bold;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 255, 0, 0.3);
        }
        
        .unified-log {
            background: #111;
            border: 2px solid #0ff;
            padding: 20px;
            margin: 20px;
            height: 300px;
            overflow-y: auto;
            font-size: 12px;
            border-radius: 10px;
        }
        
        .log-entry {
            margin: 5px 0;
            color: #0ff;
        }
        
        .success { color: #0f0; }
        .error { color: #f00; }
        .warning { color: #ff0; }
        .info { color: #0ff; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üåê MASTER UNIFIED INTERFACE üåê</h1>
        <div style="font-size: 16px; color: #00ffff;">All 983 Discovered Worlds Connected | Real Data Flowing</div>
    </div>

    <div class="status-grid">
        <!-- Gaming Layer Status -->
        <div class="status-card gaming">
            <h3>üéÆ GAMING LAYER</h3>
            <div>
                <span class="status-indicator status-loading" id="gamingStatus"></span>
                <span id="gamingStatusText">Connecting...</span>
            </div>
            <div class="layer-data" id="gamingData">
                <div>Active Players: <span id="gamingPlayers">Loading...</span></div>
                <div>Game Engines: <span id="gamingEngines">Loading...</span></div>
                <div>Total Sessions: <span id="gamingSessions">Loading...</span></div>
            </div>
            <button class="btn" onclick="openGamingInterface()">üéÆ OPEN GAMING</button>
        </div>

        <!-- Financial Layer Status -->
        <div class="status-card financial">
            <h3>üí∞ FINANCIAL LAYER</h3>
            <div>
                <span class="status-indicator status-loading" id="financialStatus"></span>
                <span id="financialStatusText">Connecting...</span>
            </div>
            <div class="layer-data" id="financialData">
                <div>Real Revenue: <span id="financialRevenue">Loading...</span></div>
                <div>API Costs: <span id="financialCosts">Loading...</span></div>
                <div>Active Trades: <span id="financialTrades">Loading...</span></div>
            </div>
            <button class="btn" onclick="openFinancialInterface()">üí∞ OPEN FINANCIAL</button>
        </div>

        <!-- Universal Data Layer Status -->
        <div class="status-card universal">
            <h3>üåê UNIVERSAL DATA</h3>
            <div>
                <span class="status-indicator status-loading" id="universalStatus"></span>
                <span id="universalStatusText">Connecting...</span>
            </div>
            <div class="layer-data" id="universalData">
                <div>Wikipedia: <span id="wikipediaStatus">Loading...</span></div>
                <div>GitHub: <span id="githubStatus">Loading...</span></div>
                <div>Crypto: <span id="cryptoStatus">Loading...</span></div>
            </div>
            <button class="btn" onclick="openUniversalInterface()">üåê OPEN UNIVERSAL</button>
        </div>

        <!-- Unified Broadcaster Status -->
        <div class="status-card broadcaster">
            <h3>üì° UNIFIED BROADCASTER</h3>
            <div>
                <span class="status-indicator status-loading" id="broadcasterStatus"></span>
                <span id="broadcasterStatusText">Connecting...</span>
            </div>
            <div class="layer-data" id="broadcasterData">
                <div>Total Worlds: <span id="totalWorlds">Loading...</span></div>
                <div>Connected Clients: <span id="connectedClients">Loading...</span></div>
                <div>Broadcasting: <span id="broadcastingStatus">Loading...</span></div>
            </div>
            <button class="btn" onclick="openBroadcasterInterface()">üì° VIEW ALL WORLDS</button>
        </div>
    </div>

    <div class="controls">
        <button class="btn" onclick="startAllSystems()">üöÄ START ALL SYSTEMS</button>
        <button class="btn" onclick="runRealVerification()">‚úÖ RUN REAL VERIFICATION</button>
        <button class="btn" onclick="broadcastToAll()">üì¢ BROADCAST TO ALL</button>
        <button class="btn" onclick="refreshAllData()">üîÑ REFRESH ALL DATA</button>
    </div>

    <!-- Unified Activity Log -->
    <div class="unified-log" id="unifiedLog">
        <div class="log-entry info">üåê Master Unified Interface initialized</div>
        <div class="log-entry info">üì° Connecting to all 983 discovered worlds...</div>
    </div>

    <script>
        let ws = null;
        let systemStatus = {
            gaming: false,
            financial: false,
            universal: false,
            broadcaster: false
        };

        async function initializeMasterInterface() {
            logMessage('üöÄ Initializing Master Unified Interface...', 'info');
            
            // Connect to unified broadcaster WebSocket
            connectToUnifiedBroadcaster();
            
            // Check all systems
            await checkAllSystems();
            
            // Start periodic updates
            setInterval(refreshAllData, 10000); // Every 10 seconds
        }

        function connectToUnifiedBroadcaster() {
            try {
                ws = new WebSocket('ws://localhost:8081?layer=master&world=unified');
                
                ws.onopen = () => {
                    logMessage('üì° Connected to Unified Broadcaster', 'success');
                    updateStatus('broadcaster', true);
                };
                
                ws.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    handleBroadcastMessage(data);
                };
                
                ws.onclose = () => {
                    logMessage('üì° Disconnected from Unified Broadcaster', 'warning');
                    updateStatus('broadcaster', false);
                    
                    // Attempt reconnection
                    setTimeout(connectToUnifiedBroadcaster, 5000);
                };
                
                ws.onerror = (error) => {
                    logMessage('üì° Unified Broadcaster connection error', 'error');
                    updateStatus('broadcaster', false);
                };
                
            } catch (error) {
                logMessage(`üì° Failed to connect to Unified Broadcaster: ${error.message}`, 'error');
                updateStatus('broadcaster', false);
            }
        }

        async function checkAllSystems() {
            const systems = [
                { name: 'gaming', url: 'http://localhost:7777/api/gaming-status' },
                { name: 'financial', url: 'http://localhost:8888/api/real-economy' },
                { name: 'universal', url: 'http://localhost:9999/api/universal-status' },
                { name: 'broadcaster', url: 'http://localhost:8080/api/status' }
            ];

            for (const system of systems) {
                try {
                    const response = await fetch(system.url, {
                        method: 'GET',
                        mode: 'cors',
                        signal: AbortSignal.timeout(5000) // 5 second timeout
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        updateSystemData(system.name, data);
                        updateStatus(system.name, true);
                        logMessage(`‚úÖ ${system.name.toUpperCase()} system online`, 'success');
                    } else {
                        throw new Error(`HTTP ${response.status}`);
                    }
                } catch (error) {
                    updateStatus(system.name, false);
                    logMessage(`‚ùå ${system.name.toUpperCase()} system offline: ${error.message}`, 'error');
                }
            }
        }

        function updateSystemData(systemName, data) {
            switch (systemName) {
                case 'gaming':
                    document.getElementById('gamingPlayers').textContent = data.activePlayers || '0';
                    document.getElementById('gamingEngines').textContent = data.activeEngines || '0';
                    document.getElementById('gamingSessions').textContent = data.totalSessions || '0';
                    break;
                    
                case 'financial':
                    document.getElementById('financialRevenue').textContent = `$${(data.actualRevenue || 0).toFixed(4)}`;
                    document.getElementById('financialCosts').textContent = `$${(data.totalCosts || 0).toFixed(4)}`;
                    document.getElementById('financialTrades').textContent = data.totalTrades || '0';
                    break;
                    
                case 'universal':
                    document.getElementById('wikipediaStatus').textContent = data.connectedSources >= 1 ? 'Online' : 'Offline';
                    document.getElementById('githubStatus').textContent = data.connectedSources >= 2 ? 'Online' : 'Offline';
                    document.getElementById('cryptoStatus').textContent = data.connectedSources >= 1 ? 'Online' : 'Offline';
                    break;
                    
                case 'broadcaster':
                    document.getElementById('totalWorlds').textContent = data.totalWorlds || '983';
                    document.getElementById('connectedClients').textContent = data.connectedClients || '0';
                    document.getElementById('broadcastingStatus').textContent = 'Active';
                    break;
            }
        }

        function updateStatus(systemName, isOnline) {
            systemStatus[systemName] = isOnline;
            
            const indicator = document.getElementById(`${systemName}Status`);
            const statusText = document.getElementById(`${systemName}StatusText`);
            
            if (isOnline) {
                indicator.className = 'status-indicator status-online';
                statusText.textContent = 'Online';
                statusText.style.color = '#0f0';
            } else {
                indicator.className = 'status-indicator status-offline';
                statusText.textContent = 'Offline';
                statusText.style.color = '#f00';
            }
        }

        function handleBroadcastMessage(data) {
            switch (data.type) {
                case 'welcome':
                    logMessage(`üì° Welcome to unified broadcasting - ${data.totalWorlds} worlds available`, 'info');
                    break;
                    
                case 'world-discovery-complete':
                    logMessage(`üåç World discovery complete: ${data.totalWorlds} total items`, 'success');
                    document.getElementById('totalWorlds').textContent = data.totalWorlds;
                    break;
                    
                case 'unified-data-update':
                    logMessage('üìä Unified data update received', 'info');
                    if (data.data.gaming) updateSystemData('gaming', data.data.gaming);
                    if (data.data.financial) updateSystemData('financial', data.data.financial);
                    if (data.data.universal) updateSystemData('universal', data.data.universal);
                    break;
                    
                case 'world-started':
                    logMessage(`üéÆ World started: ${data.data.world}`, 'success');
                    break;
                    
                default:
                    logMessage(`üì° Broadcast: ${data.type}`, 'info');
            }
        }

        function openGamingInterface() {
            window.open('corrected-gaming-interface.html', '_blank');
            logMessage('üéÆ Opening Gaming Interface', 'info');
        }

        function openFinancialInterface() {
            window.open('real-admin-dashboard.html', '_blank');
            logMessage('üí∞ Opening Financial Interface', 'info');
        }

        function openUniversalInterface() {
            logMessage('üåê Universal Data Interface not yet implemented', 'warning');
        }

        function openBroadcasterInterface() {
            window.open('http://localhost:8080/api/worlds', '_blank');
            logMessage('üì° Opening World Browser', 'info');
        }

        async function startAllSystems() {
            logMessage('üöÄ Starting all systems...', 'info');
            
            // Send start command through WebSocket
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({
                    type: 'broadcast-message',
                    message: 'START_ALL_SYSTEMS',
                    targetLayer: null // Broadcast to all
                }));
            }
            
            // Refresh data after starting
            setTimeout(refreshAllData, 3000);
        }

        async function broadcastToAll() {
            const message = prompt('Enter message to broadcast to all 983 worlds:');
            if (message) {
                if (ws && ws.readyState === WebSocket.OPEN) {
                    ws.send(JSON.stringify({
                        type: 'broadcast-message',
                        message: message,
                        targetLayer: null
                    }));
                    logMessage(`üì¢ Broadcasting: "${message}"`, 'info');
                }
            }
        }

        async function refreshAllData() {
            logMessage('üîÑ Refreshing all system data...', 'info');
            await checkAllSystems();
        }
        
        async function runRealVerification() {
            logMessage('‚úÖ Running real verification...', 'info');
            
            // Call the verification endpoint if available
            try {
                const response = await fetch('http://localhost:6001/verify', {
                    method: 'GET',
                    signal: AbortSignal.timeout(30000) // 30 second timeout for verification
                });
                
                if (response.ok) {
                    const result = await response.json();
                    
                    if (result.summary) {
                        Object.entries(result.summary).forEach(([service, status]) => {
                            const icon = status.success ? '‚úÖ' : '‚ùå';
                            logMessage(`${icon} ${service}: ${status.message || 'Checked'}`, status.success ? 'success' : 'error');
                        });
                    }
                    
                    logMessage(`üéØ Verification complete - Score: ${result.score || 'N/A'}`, 'info');
                } else {
                    throw new Error('Verification service not available');
                }
            } catch (error) {
                logMessage(`‚ö†Ô∏è Verification service not running. Starting CLI verification...`, 'warning');
                
                // Fallback: Open CLI for verification
                window.open('http://localhost:4000/cli', '_blank');
                logMessage('üîó Opened CLI for manual verification', 'info');
            }
        }

        function logMessage(message, type = 'info') {
            const log = document.getElementById('unifiedLog');
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${timestamp}] ${message}`;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;

            // Keep only last 50 entries
            while (log.children.length > 50) {
                log.removeChild(log.firstChild);
            }
        }
        
        async function performHealthCheck(port, service) {
            try {
                const response = await fetch(`http://localhost:${port}/health`, {
                    method: 'GET',
                    signal: AbortSignal.timeout(3000)
                });
                
                return response.ok;
            } catch {
                return false;
            }
        }
        
        // Real-time health monitoring
        async function monitorHealth() {
            const services = [
                { name: 'Document Generator', port: 4000 },
                { name: 'AI API', port: 3001 },
                { name: 'Template Processor', port: 3000 },
                { name: 'Gaming Engine', port: 7777 },
                { name: 'Financial System', port: 8888 }
            ];
            
            for (const service of services) {
                const healthy = await performHealthCheck(service.port, service.name);
                if (!healthy && systemStatus[service.name.toLowerCase()]) {
                    logMessage(`‚ö†Ô∏è ${service.name} health check failed`, 'warning');
                }
            }
        }
        
        // Start health monitoring
        setInterval(monitorHealth, 30000); // Every 30 seconds

        // Initialize on load
        window.onload = initializeMasterInterface;
    </script>
</body>
</html>