<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üá∫üá∏ Document Generator - Unified Checkout üá∫üá∏</title>
    
    <!-- Stripe & Web3 Libraries -->
    <script src="https://js.stripe.com/v3/"></script>
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: linear-gradient(135deg, #000814 0%, #001d3d 50%, #003566 100%);
            color: #ffffff;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        /* USA 250th Anniversary Stars */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .star {
            position: absolute;
            color: #ffd60a;
            animation: twinkle 2s ease-in-out infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        .main-container {
            position: relative;
            z-index: 10;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .checkout-container {
            background: rgba(0, 0, 0, 0.85);
            border: 3px solid #dc2626;
            border-radius: 15px;
            padding: 30px;
            max-width: 800px;
            width: 100%;
            box-shadow: 0 0 30px rgba(220, 38, 38, 0.5);
            backdrop-filter: blur(10px);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .logo {
            font-size: 2.5rem;
            font-weight: bold;
            color: #ffd60a;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            margin-bottom: 10px;
        }

        .subtitle {
            color: #dc2626;
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .anniversary-badge {
            display: inline-block;
            background: linear-gradient(45deg, #dc2626, #ffffff);
            color: #000814;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .payment-methods {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .payment-section {
            background: rgba(220, 38, 38, 0.1);
            border: 1px solid #dc2626;
            border-radius: 10px;
            padding: 20px;
        }

        .payment-title {
            color: #ffd60a;
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .wallet-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .wallet-button {
            background: linear-gradient(135deg, #001d3d, #003566);
            border: 1px solid #ffd60a;
            color: #ffffff;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            text-align: center;
        }

        .wallet-button:hover {
            background: linear-gradient(135deg, #ffd60a, #ffb700);
            color: #000814;
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(255, 214, 10, 0.3);
        }

        .wallet-button.connected {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            border-color: #ffffff;
        }

        .traditional-payment {
            margin-bottom: 20px;
        }

        .payment-form {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #374151;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            color: #ffd60a;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-input {
            width: 100%;
            padding: 10px;
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #374151;
            border-radius: 5px;
            color: #ffffff;
            font-family: 'Courier New', monospace;
        }

        .form-input:focus {
            outline: none;
            border-color: #ffd60a;
            box-shadow: 0 0 5px rgba(255, 214, 10, 0.3);
        }

        .tier-selector {
            margin-bottom: 20px;
        }

        .tier-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .tier-card {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #374151;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tier-card:hover {
            border-color: #ffd60a;
            transform: scale(1.05);
        }

        .tier-card.selected {
            border-color: #dc2626;
            background: rgba(220, 38, 38, 0.2);
        }

        .tier-name {
            color: #ffd60a;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .tier-price {
            color: #ffffff;
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .tier-features {
            font-size: 0.8rem;
            color: #9ca3af;
            line-height: 1.3;
        }

        .checkout-button {
            width: 100%;
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            border: none;
            color: #ffffff;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .checkout-button:hover {
            background: linear-gradient(135deg, #ffd60a, #ffb700);
            color: #000814;
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(255, 214, 10, 0.4);
        }

        .checkout-button:disabled {
            background: #374151;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .payment-status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-weight: bold;
        }

        .status-success {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid #22c55e;
            color: #22c55e;
        }

        .status-error {
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid #ef4444;
            color: #ef4444;
        }

        .status-processing {
            background: rgba(255, 214, 10, 0.2);
            border: 1px solid #ffd60a;
            color: #ffd60a;
        }

        .abstract-routing-info {
            background: rgba(0, 0, 0, 0.7);
            border: 1px solid #374151;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-size: 0.9rem;
        }

        .routing-title {
            color: #ffd60a;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .routing-detail {
            color: #9ca3af;
            margin-bottom: 5px;
        }

        .nft-preview {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #374151;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            text-align: center;
        }

        .nft-title {
            color: #ffd60a;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .nft-image {
            width: 100px;
            height: 100px;
            background: linear-gradient(45deg, #dc2626, #ffd60a);
            border-radius: 8px;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }

        @media (max-width: 768px) {
            .payment-methods {
                grid-template-columns: 1fr;
            }
            
            .tier-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .wallet-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- USA 250th Anniversary Stars -->
    <div class="stars" id="stars"></div>

    <div class="main-container">
        <div class="checkout-container">
            <div class="header">
                <div class="logo">üá∫üá∏ DOCUMENT GENERATOR üá∫üá∏</div>
                <div class="subtitle">Unified One-Page Checkout System</div>
                <div class="anniversary-badge">USA 250th Anniversary Special</div>
            </div>

            <!-- Tier Selection -->
            <div class="tier-selector">
                <h3 class="payment-title">Select Your Tier</h3>
                <div class="tier-grid">
                    <div class="tier-card" data-tier="free">
                        <div class="tier-name">Free</div>
                        <div class="tier-price">$0/month</div>
                        <div class="tier-features">
                            Basic templates<br>
                            5 docs/month<br>
                            Community support
                        </div>
                    </div>
                    <div class="tier-card" data-tier="premium">
                        <div class="tier-name">Premium</div>
                        <div class="tier-price">$29/month</div>
                        <div class="tier-features">
                            All templates<br>
                            Unlimited docs<br>
                            Priority support<br>
                            API access
                        </div>
                    </div>
                    <div class="tier-card" data-tier="enterprise">
                        <div class="tier-name">Enterprise</div>
                        <div class="tier-price">$99/month</div>
                        <div class="tier-features">
                            White label<br>
                            Custom templates<br>
                            Dedicated support<br>
                            Analytics dashboard
                        </div>
                    </div>
                    <div class="tier-card" data-tier="patriotic">
                        <div class="tier-name">Patriotic</div>
                        <div class="tier-price">$76/month</div>
                        <div class="tier-features">
                            All Enterprise features<br>
                            USA-themed templates<br>
                            NFT certificates<br>
                            Liberty bonus
                        </div>
                    </div>
                </div>
            </div>

            <!-- Payment Methods -->
            <div class="payment-methods">
                <!-- Traditional Payment -->
                <div class="payment-section">
                    <h3 class="payment-title">üí≥ Traditional Payment</h3>
                    <div class="traditional-payment">
                        <div class="payment-form">
                            <div class="form-group">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-input" id="email" placeholder="your@email.com">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Card Details</label>
                                <div id="card-element" style="padding: 10px; background: rgba(0,0,0,0.7); border: 1px solid #374151; border-radius: 5px;"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Web3 Payment -->
                <div class="payment-section">
                    <h3 class="payment-title">üîó Web3 Wallets</h3>
                    <div class="wallet-grid">
                        <button class="wallet-button" data-wallet="phantom">
                            üëª Phantom
                        </button>
                        <button class="wallet-button" data-wallet="magiceden">
                            üîÆ Magic Eden
                        </button>
                        <button class="wallet-button" data-wallet="xwallet">
                            ‚ö° xWallet
                        </button>
                        <button class="wallet-button" data-wallet="memepay">
                            üê∏ MemePay
                        </button>
                        <button class="wallet-button" data-wallet="metamask">
                            ü¶ä MetaMask
                        </button>
                        <button class="wallet-button" data-wallet="coinbase">
                            üîµ Coinbase
                        </button>
                    </div>
                    
                    <!-- NFT Preview -->
                    <div class="nft-preview" id="nft-preview" style="display: none;">
                        <div class="nft-title">üéñÔ∏è Patriotic Certificate NFT</div>
                        <div class="nft-image">üá∫üá∏</div>
                        <div style="color: #9ca3af; font-size: 0.9rem;">
                            Commemorative NFT included with Patriotic tier
                        </div>
                    </div>
                </div>
            </div>

            <!-- Abstract Routing Information -->
            <div class="abstract-routing-info">
                <div class="routing-title">üîÑ Abstract Wallet Routing</div>
                <div class="routing-detail">‚Ä¢ All payments routed through enterprise-grade infrastructure</div>
                <div class="routing-detail">‚Ä¢ Cross-chain compatibility for maximum accessibility</div>
                <div class="routing-detail">‚Ä¢ Automatic fee optimization and settlement</div>
                <div class="routing-detail">‚Ä¢ Real-time transaction verification and mirroring</div>
            </div>

            <!-- Checkout Button -->
            <button class="checkout-button" id="checkout-btn" disabled>
                Select a tier to continue
            </button>

            <!-- Payment Status -->
            <div class="payment-status" id="payment-status" style="display: none;"></div>
        </div>
    </div>

    <script>
        // Stars animation for USA 250th Anniversary
        function createStars() {
            const starsContainer = document.getElementById('stars');
            const starCount = 50;
            
            for (let i = 0; i < starCount; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.innerHTML = '‚≠ê';
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 2 + 's';
                star.style.fontSize = (Math.random() * 10 + 10) + 'px';
                starsContainer.appendChild(star);
            }
        }

        // Initialize Stripe
        const stripe = Stripe('pk_test_51234567890abcdef...' || 'pk_test_placeholder');
        const elements = stripe.elements();
        
        const cardElement = elements.create('card', {
            style: {
                base: {
                    color: '#ffffff',
                    fontFamily: '"Courier New", monospace',
                    fontSize: '16px',
                    '::placeholder': {
                        color: '#9ca3af',
                    },
                },
                invalid: {
                    color: '#ef4444',
                },
            },
        });
        
        cardElement.mount('#card-element');

        // State management
        let selectedTier = null;
        let connectedWallet = null;
        let paymentMethod = 'traditional';

        // Tier selection
        document.querySelectorAll('.tier-card').forEach(card => {
            card.addEventListener('click', () => {
                // Remove previous selection
                document.querySelectorAll('.tier-card').forEach(c => c.classList.remove('selected'));
                
                // Select current tier
                card.classList.add('selected');
                selectedTier = card.dataset.tier;
                
                // Show NFT preview for patriotic tier
                const nftPreview = document.getElementById('nft-preview');
                if (selectedTier === 'patriotic') {
                    nftPreview.style.display = 'block';
                } else {
                    nftPreview.style.display = 'none';
                }
                
                updateCheckoutButton();
            });
        });

        // Wallet connection
        document.querySelectorAll('.wallet-button').forEach(button => {
            button.addEventListener('click', async () => {
                const walletType = button.dataset.wallet;
                
                // Reset other wallet connections
                document.querySelectorAll('.wallet-button').forEach(b => b.classList.remove('connected'));
                
                try {
                    await connectWallet(walletType);
                    button.classList.add('connected');
                    button.innerHTML = `‚úÖ ${button.innerHTML.split(' ')[1]}`;
                    connectedWallet = walletType;
                    paymentMethod = 'web3';
                    updateCheckoutButton();
                } catch (error) {
                    showStatus('Error connecting wallet: ' + error.message, 'error');
                }
            });
        });

        // Wallet connection logic
        async function connectWallet(walletType) {
            showStatus('Connecting to ' + walletType + '...', 'processing');
            
            switch (walletType) {
                case 'phantom':
                    if (window.solana && window.solana.isPhantom) {
                        await window.solana.connect();
                        showStatus('Phantom wallet connected!', 'success');
                    } else {
                        throw new Error('Phantom wallet not detected');
                    }
                    break;
                    
                case 'metamask':
                    if (window.ethereum) {
                        await window.ethereum.request({ method: 'eth_requestAccounts' });
                        showStatus('MetaMask connected!', 'success');
                    } else {
                        throw new Error('MetaMask not detected');
                    }
                    break;
                    
                case 'magiceden':
                case 'xwallet':
                case 'memepay':
                case 'coinbase':
                    // Simulate connection for demo
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    showStatus(walletType + ' connected!', 'success');
                    break;
                    
                default:
                    throw new Error('Unsupported wallet');
            }
        }

        // Update checkout button state
        function updateCheckoutButton() {
            const checkoutBtn = document.getElementById('checkout-btn');
            
            if (selectedTier) {
                checkoutBtn.disabled = false;
                
                const tierPrices = {
                    free: '$0',
                    premium: '$29',
                    enterprise: '$99',
                    patriotic: '$76'
                };
                
                if (selectedTier === 'free') {
                    checkoutBtn.innerHTML = 'Start Free Trial';
                } else {
                    const paymentMethodText = connectedWallet ? `Pay with ${connectedWallet}` : 'Pay with Card';
                    checkoutBtn.innerHTML = `${paymentMethodText} - ${tierPrices[selectedTier]}/month`;
                }
            } else {
                checkoutBtn.disabled = true;
                checkoutBtn.innerHTML = 'Select a tier to continue';
            }
        }

        // Checkout process
        document.getElementById('checkout-btn').addEventListener('click', async () => {
            if (!selectedTier) return;
            
            showStatus('Processing payment...', 'processing');
            
            try {
                if (selectedTier === 'free') {
                    await processFreeSignup();
                } else if (paymentMethod === 'web3' && connectedWallet) {
                    await processWeb3Payment();
                } else {
                    await processTraditionalPayment();
                }
            } catch (error) {
                showStatus('Payment failed: ' + error.message, 'error');
            }
        });

        // Process free signup
        async function processFreeSignup() {
            await new Promise(resolve => setTimeout(resolve, 1000));
            showStatus('üéâ Free account created! Welcome to Document Generator!', 'success');
        }

        // Process Web3 payment
        async function processWeb3Payment() {
            const tierPrices = {
                premium: 0.029, // SOL/ETH equivalent
                enterprise: 0.099,
                patriotic: 0.076
            };
            
            const amount = tierPrices[selectedTier];
            
            // Route through Abstract Wallet Routing Engine
            const routingResult = await routeWeb3Transaction({
                wallet: connectedWallet,
                amount: amount,
                tier: selectedTier,
                includeNFT: selectedTier === 'patriotic'
            });
            
            showStatus(`üéâ Payment successful! Transaction: ${routingResult.txHash}`, 'success');
            
            if (selectedTier === 'patriotic') {
                setTimeout(() => {
                    showStatus('üéñÔ∏è Patriotic Certificate NFT minted to your wallet!', 'success');
                }, 2000);
            }
        }

        // Process traditional payment
        async function processTraditionalPayment() {
            const email = document.getElementById('email').value;
            if (!email) {
                throw new Error('Email is required');
            }
            
            const tierPrices = {
                premium: 29,
                enterprise: 99,
                patriotic: 76
            };
            
            const amount = tierPrices[selectedTier] * 100; // Convert to cents
            
            // Create payment intent via Stripe
            const { error, paymentIntent } = await stripe.confirmCardPayment(
                'pi_test_placeholder', // Would be generated by backend
                {
                    payment_method: {
                        card: cardElement,
                        billing_details: {
                            email: email,
                        },
                    }
                }
            );
            
            if (error) {
                throw error;
            }
            
            showStatus('üéâ Payment successful! Welcome to Document Generator!', 'success');
        }

        // Route Web3 transaction through Abstract Wallet Routing Engine
        async function routeWeb3Transaction(transaction) {
            // Simulate routing through our Abstract Wallet Routing Engine
            console.log('üîÑ Routing transaction through Abstract Wallet Routing Engine...');
            console.log('Transaction details:', transaction);
            
            // Apply schema/regex/JSONL classification
            const classification = {
                userType: transaction.tier === 'enterprise' ? 'enterprise' : 'consumer',
                economyRouting: transaction.tier === 'enterprise' ? 'vc-economy' : 'dollar-store-economy',
                skimmingPotential: transaction.tier === 'patriotic' ? 0.1 : 0.05
            };
            
            console.log('Classification:', classification);
            
            // Apply abstract wallet wrapper
            const routedTransaction = {
                originalAmount: transaction.amount,
                routingFees: transaction.amount * 0.005, // 0.5% routing fee
                networkFees: 0.001, // Fixed network fee
                skimmedAmount: transaction.amount * classification.skimmingPotential,
                finalAmount: transaction.amount * (1 + 0.005 + classification.skimmingPotential) + 0.001
            };
            
            console.log('Routed transaction:', routedTransaction);
            
            // Simulate blockchain transaction
            await new Promise(resolve => setTimeout(resolve, 2000));
            
            return {
                txHash: '0x' + Math.random().toString(16).substr(2, 64),
                routing: classification,
                fees: routedTransaction,
                success: true
            };
        }

        // Show payment status
        function showStatus(message, type) {
            const statusDiv = document.getElementById('payment-status');
            statusDiv.style.display = 'block';
            statusDiv.className = `payment-status status-${type}`;
            statusDiv.innerHTML = message;
            
            if (type === 'success') {
                setTimeout(() => {
                    statusDiv.style.display = 'none';
                }, 5000);
            }
        }

        // Initialize
        createStars();
        
        console.log('üá∫üá∏ UNIFIED ONE-PAGE CHECKOUT INITIALIZED');
        console.log('üí≥ Traditional payments via Stripe');
        console.log('üîó Web3 wallets: Phantom, Magic Eden, xWallet, MemePay');
        console.log('üîÑ Abstract Wallet Routing Engine integration');
        console.log('üéñÔ∏è NFT minting for Patriotic tier');
        console.log('‚öîÔ∏è Cross-layer tier merging capability');
    </script>
</body>
</html>