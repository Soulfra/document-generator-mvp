<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üåç Sovereign Game Economy</title>
    <style>
        body {
            background: linear-gradient(135deg, #000 0%, #001122 50%, #000 100%);
            color: #00ff00;
            font-family: monospace;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .economy-hub {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }
        
        .game-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }
        
        .game-world {
            background: rgba(0,255,0,0.1);
            border: 2px solid #00ff00;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .game-world:hover {
            background: rgba(0,255,0,0.2);
            transform: scale(1.05);
        }
        
        .game-world.underwater { border-color: #0088ff; color: #0088ff; }
        .game-world.space { border-color: #8800ff; color: #8800ff; }
        .game-world.medieval { border-color: #ffaa00; color: #ffaa00; }
        .game-world.cyber { border-color: #ff0088; color: #ff0088; }
        
        .world-icon {
            font-size: 48px;
            margin: 10px 0;
        }
        
        .economy-status {
            background: rgba(0,0,0,0.8);
            border: 1px solid #00ff00;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .verification-needed {
            background: rgba(255,165,0,0.1);
            border: 2px solid #ffa500;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }
        
        .crypto-bridge {
            background: rgba(255,215,0,0.1);
            border: 2px solid #ffd700;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        
        .phase-indicator {
            display: flex;
            justify-content: space-between;
            margin: 30px 0;
            padding: 20px;
            background: rgba(0,0,0,0.5);
            border-radius: 10px;
        }
        
        .phase {
            flex: 1;
            text-align: center;
            padding: 10px;
            border-radius: 5px;
            margin: 0 5px;
        }
        
        .phase.active {
            background: rgba(0,255,0,0.3);
            border: 1px solid #00ff00;
        }
        
        .phase.completed {
            background: rgba(255,215,0,0.3);
            border: 1px solid #ffd700;
        }
        
        .invitation-system {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.9);
            border: 2px solid #00ff00;
            border-radius: 15px;
            padding: 15px;
            width: 300px;
        }
    </style>
</head>
<body>
    <div class="economy-hub">
        <h1>üåç SOVEREIGN GAME ECONOMY</h1>
        <p>Choose your world. Build your empire. Earn real value.</p>
        
        <div class="phase-indicator">
            <div class="phase active" id="phase-game">
                <h4>üéÆ GAME</h4>
                <p>Play & Earn</p>
            </div>
            <div class="phase" id="phase-verify">
                <h4>‚úÖ VERIFY</h4>
                <p>Touch Grass</p>
            </div>
            <div class="phase" id="phase-bridge">
                <h4>üåâ BRIDGE</h4>
                <p>Web2.5 Layer</p>
            </div>
            <div class="phase" id="phase-sovereign">
                <h4>üëë SOVEREIGN</h4>
                <p>Real Economy</p>
            </div>
        </div>
        
        <div class="economy-status">
            <h3>üìä Your Economic Status</h3>
            <div>Game Empire Value: $<span id="gameValue">0</span></div>
            <div>Verification Status: <span id="verifyStatus">Unverified</span></div>
            <div>Real Economic Value: $<span id="realValue">0.00</span></div>
            <div>Sovereignty Level: <span id="sovereignLevel">Tourist</span></div>
        </div>
        
        <div class="verification-needed" id="verificationAlert" style="display: none;">
            <h3>‚ö†Ô∏è VERIFICATION REQUIRED</h3>
            <p>Your game empire has reached $10,000! Time to verify you're human.</p>
            <button onclick="startVerification()">üìç Start howwasthevibe Verification</button>
        </div>
        
        <div class="crypto-bridge" id="cryptoBridge" style="display: none;">
            <h3>üåâ WEB2.5 BRIDGE ACTIVATED</h3>
            <p>You're verified! Your game progress is now backed by real crypto.</p>
            <div>Conversion Rate: 1 Game Dollar = 0.001 ETH</div>
            <button onclick="bridgeToReal()">üí∞ Bridge to Real Economy</button>
        </div>
        
        <h2>üéÆ Choose Your Game World</h2>
        <div class="game-selector">
            <div class="game-world underwater" onclick="enterWorld('underwater')">
                <div class="world-icon">üåä</div>
                <h3>Underwater Empire</h3>
                <p>Deep sea mining, submarine battles, underwater cities</p>
                <div>Active Players: <span class="player-count">47</span></div>
            </div>
            
            <div class="game-world space" onclick="enterWorld('space')">
                <div class="world-icon">üöÄ</div>
                <h3>Space Conquest</h3>
                <p>Galactic empire, asteroid mining, space stations</p>
                <div>Active Players: <span class="player-count">23</span></div>
            </div>
            
            <div class="game-world medieval" onclick="enterWorld('medieval')">
                <div class="world-icon">üè∞</div>
                <h3>Medieval Kingdoms</h3>
                <p>Castle building, knight battles, gold mining</p>
                <div>Active Players: <span class="player-count">31</span></div>
            </div>
            
            <div class="game-world cyber" onclick="enterWorld('cyber')">
                <div class="world-icon">ü§ñ</div>
                <h3>Cyber Matrix</h3>
                <p>AI agents, digital territories, code mining</p>
                <div>Active Players: <span class="player-count">89</span></div>
            </div>
        </div>
    </div>
    
    <div class="invitation-system">
        <h4>üì± Invite Network</h4>
        <button onclick="generateInviteQR()">üéØ Generate Invite QR</button>
        <button onclick="shareLocation()">üìç Share Location</button>
        <div id="inviteStats">
            <small>Referrals: 0 | Rewards: $0</small>
        </div>
    </div>
    
    <script>
        // Game Economy State
        let economyState = {
            gameValue: 0,
            isVerified: false,
            realValue: 0,
            sovereignLevel: 'Tourist',
            currentPhase: 'game',
            referrals: 0,
            selectedWorld: null
        };
        
        // Load saved state
        function loadEconomyState() {
            const saved = localStorage.getItem('sovereignEconomy');
            if (saved) {
                economyState = { ...economyState, ...JSON.parse(saved) };
                updateDisplay();
            }
        }
        
        // Save state
        function saveEconomyState() {
            localStorage.setItem('sovereignEconomy', JSON.stringify(economyState));
        }
        
        // Update display
        function updateDisplay() {
            document.getElementById('gameValue').textContent = economyState.gameValue.toLocaleString();
            document.getElementById('verifyStatus').textContent = economyState.isVerified ? 'Verified Human ‚úÖ' : 'Unverified ‚ùå';
            document.getElementById('realValue').textContent = economyState.realValue.toFixed(2);
            document.getElementById('sovereignLevel').textContent = economyState.sovereignLevel;
            
            // Update phases
            document.querySelectorAll('.phase').forEach(phase => {
                phase.classList.remove('active', 'completed');
            });
            
            const phases = ['game', 'verify', 'bridge', 'sovereign'];
            const currentIndex = phases.indexOf(economyState.currentPhase);
            
            phases.forEach((phase, index) => {
                const element = document.getElementById(`phase-${phase}`);
                if (index < currentIndex) {
                    element.classList.add('completed');
                } else if (index === currentIndex) {
                    element.classList.add('active');
                }
            });
            
            // Show verification alert
            if (economyState.gameValue >= 10000 && !economyState.isVerified) {
                document.getElementById('verificationAlert').style.display = 'block';
            }
            
            // Show crypto bridge
            if (economyState.isVerified && economyState.currentPhase !== 'sovereign') {
                document.getElementById('cryptoBridge').style.display = 'block';
            }
        }
        
        // Enter game world
        function enterWorld(worldType) {
            economyState.selectedWorld = worldType;
            saveEconomyState();
            
            // Redirect to the actual game with world theme
            const worldConfig = {
                underwater: { bg: '#001144', theme: 'ocean' },
                space: { bg: '#110044', theme: 'galaxy' },
                medieval: { bg: '#442200', theme: 'castle' },
                cyber: { bg: '#440022', theme: 'matrix' }
            };
            
            const config = worldConfig[worldType];
            const gameUrl = `simple-mobile-game.html?world=${worldType}&theme=${config.theme}&bg=${encodeURIComponent(config.bg)}`;
            
            alert(`üéÆ Entering ${worldType} world! All your existing empire systems are now themed as ${worldType} components.`);
            
            // Open the game
            window.location.href = gameUrl;
        }
        
        // Start verification process
        function startVerification() {
            alert('üìç howwasthevibe Verification Starting!\\n\\nYou need to:\\n1. Go to a real location\\n2. Take a photo with timestamp\\n3. Get 3 people to verify you were there\\n4. Submit location review\\n\\nThis proves you\'re human and not a bot!');
            
            // Simulate verification process
            economyState.currentPhase = 'verify';
            updateDisplay();
            saveEconomyState();
            
            // For demo, auto-complete after 10 seconds
            setTimeout(() => {
                completeVerification();
            }, 10000);
        }
        
        // Complete verification
        function completeVerification() {
            economyState.isVerified = true;
            economyState.currentPhase = 'bridge';
            alert('‚úÖ Verification Complete!\\n\\nYou are now a verified human in the sovereign network!\\nYour game progress can now be bridged to real crypto value!');
            updateDisplay();
            saveEconomyState();
        }
        
        // Bridge to real economy
        function bridgeToReal() {
            if (!economyState.isVerified) {
                alert('‚ùå Must be verified first!');
                return;
            }
            
            // Convert game value to real value (simplified)
            const conversionRate = 0.001; // 1 game dollar = 0.001 ETH
            economyState.realValue = economyState.gameValue * conversionRate;
            economyState.currentPhase = 'sovereign';
            economyState.sovereignLevel = economyState.realValue > 100 ? 'Sovereign Citizen' : 'Verified Human';
            
            alert(`üåâ Welcome to the Sovereign Economy!\\n\\nYour $${economyState.gameValue.toLocaleString()} game empire is now worth ${economyState.realValue.toFixed(3)} ETH!\\n\\nYou can now earn real crypto through gameplay!`);
            
            updateDisplay();
            saveEconomyState();
        }
        
        // Generate invite QR
        function generateInviteQR() {
            const inviteData = {
                referrer: 'player-' + Date.now(),
                world: economyState.selectedWorld || 'cyber',
                bonus: Math.floor(economyState.gameValue * 0.1),
                verified: economyState.isVerified,
                sovereign: economyState.currentPhase === 'sovereign'
            };
            
            const inviteUrl = `${window.location.origin}/sovereign-game-economy.html?invite=${encodeURIComponent(JSON.stringify(inviteData))}`;
            
            // Open QR generator
            window.open(`simple-qr-generator.html?invite=${encodeURIComponent(JSON.stringify(inviteData))}`, '_blank');
            
            alert('üì± Invite QR Generated!\\n\\nWhen friends scan this:\\n- They get a bonus based on your empire\\n- You get referral rewards\\n- They enter your selected world theme\\n- If you\'re sovereign, they get fast-track verification');
        }
        
        // Share location
        function shareLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                    const locationData = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude,
                        empire: economyState.gameValue,
                        world: economyState.selectedWorld,
                        verified: economyState.isVerified,
                        sovereign: economyState.currentPhase === 'sovereign'
                    };
                    
                    const shareText = `üåç Join my Sovereign Game Economy! ${economyState.isVerified ? '‚úÖ Verified Human' : 'üéÆ Gaming'} | Empire: $${economyState.gameValue.toLocaleString()} | World: ${economyState.selectedWorld || 'None'}`;
                    const shareUrl = `https://maps.google.com/maps?q=${locationData.lat},${locationData.lng}&z=15`;
                    
                    if (navigator.share) {
                        navigator.share({
                            title: 'üåç Sovereign Game Economy',
                            text: shareText,
                            url: shareUrl
                        });
                    } else {
                        navigator.clipboard.writeText(`${shareText}\\n${shareUrl}`);
                        alert('üìã Location shared! Send to your brother and friends!');
                    }
                });
            }
        }
        
        // Handle invites
        function handleInvite() {
            const urlParams = new URLSearchParams(window.location.search);
            const inviteParam = urlParams.get('invite');
            
            if (inviteParam) {
                try {
                    const inviteData = JSON.parse(decodeURIComponent(inviteParam));
                    
                    // Give invite bonus
                    economyState.gameValue += inviteData.bonus || 1000;
                    
                    // If referrer is sovereign, give fast-track
                    if (inviteData.sovereign) {
                        alert(`üëë Invited by Sovereign Citizen!\\n\\nYou get:\\n- $${(inviteData.bonus || 1000).toLocaleString()} starting bonus\\n- Fast-track verification available\\n- Access to ${inviteData.world} world`);
                        
                        economyState.selectedWorld = inviteData.world;
                        if (economyState.gameValue >= 5000) { // Lower threshold for sovereign referrals
                            document.getElementById('verificationAlert').style.display = 'block';
                        }
                    } else {
                        alert(`üéÆ Game Invite Accepted!\\n\\nStarting bonus: $${(inviteData.bonus || 1000).toLocaleString()}\\nWorld: ${inviteData.world}`);
                        economyState.selectedWorld = inviteData.world;
                    }
                    
                    updateDisplay();
                    saveEconomyState();
                    
                } catch (e) {
                    console.error('Invalid invite data:', e);
                }
            }
        }
        
        // Integration Hub Connection
        async function connectToIntegrationHub() {
            try {
                const response = await fetch('http://localhost:3333/api/systems');
                const systems = await response.json();
                
                if (systems.totalFiles > 0) {
                    showSystemIntegrationStatus(systems);
                    
                    // Sync with all empire systems
                    await syncWithAllSystems();
                }
            } catch (error) {
                console.log('‚ö†Ô∏è Integration Hub not running on port 3333');
            }
        }
        
        function showSystemIntegrationStatus(systems) {
            const statusDiv = document.createElement('div');
            statusDiv.style.cssText = `
                position: fixed;
                top: 20px;
                left: 20px;
                background: rgba(0,0,0,0.9);
                border: 2px solid #00ff00;
                border-radius: 10px;
                padding: 15px;
                color: #00ff00;
                font-size: 12px;
                z-index: 1000;
                max-width: 300px;
            `;
            
            statusDiv.innerHTML = `
                <h4>üîó System Integration Status</h4>
                <div>Total JS Files: ${systems.totalFiles}</div>
                <div>Empire Systems: ${systems.existing.empire?.length || 0}</div>
                <div>AI Agents: ${systems.existing.agents?.length || 0}</div>
                <div>Blockchain: ${systems.existing.blockchain?.length || 0}</div>
                <div>Gaming: ${systems.existing.gaming?.length || 0}</div>
                <div>Economy: ${systems.existing.economy?.length || 0}</div>
                <div>Platforms: ${systems.existing.platforms?.length || 0}</div>
                <div style="margin-top: 10px; color: #ffd700;">‚úÖ All systems integrated!</div>
            `;
            
            document.body.appendChild(statusDiv);
            
            // Auto-hide after 10 seconds
            setTimeout(() => {
                statusDiv.style.opacity = '0.3';
            }, 10000);
        }
        
        async function syncWithAllSystems() {
            try {
                const response = await fetch('http://localhost:3333/api/sync/all-systems', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ gameState: economyState })
                });
                
                const result = await response.json();
                console.log(`üîÑ Synced with ${result.synced} empire systems`);
                
                // Get aggregated empire value from all systems
                const valueResponse = await fetch('http://localhost:3333/api/aggregate/empire-value');
                const valueData = await valueResponse.json();
                
                // Update game value with aggregated empire value
                if (valueData.totalEmpireValue > economyState.gameValue) {
                    economyState.gameValue = valueData.totalEmpireValue;
                    updateDisplay();
                    saveEconomyState();
                    
                    showNotification(`üè∞ Empire systems connected! Total value: $${valueData.totalEmpireValue.toLocaleString()}`);
                }
                
            } catch (error) {
                console.log('‚ö†Ô∏è Could not sync with integration hub');
            }
        }
        
        // Bridge game actions to empire systems
        async function bridgeToEmpireSystem(action, value, systemType) {
            try {
                const response = await fetch('http://localhost:3333/api/bridge/empire-action', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action, value, systemType })
                });
                
                const result = await response.json();
                console.log(`üéØ Action ${action} bridged to ${result.connectedSystems} systems`);
                
                return result;
            } catch (error) {
                console.log('‚ö†Ô∏è Could not bridge to empire systems');
                return null;
            }
        }
        
        function showNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0,255,0,0.9);
                color: #000;
                padding: 20px;
                border-radius: 10px;
                z-index: 2000;
                font-weight: bold;
                max-width: 400px;
                text-align: center;
            `;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 4000);
        }
        
        // Auto-increment game value (now enhanced with system integration)
        setInterval(async () => {
            if (economyState.currentPhase === 'game' || economyState.currentPhase === 'verify') {
                economyState.gameValue += Math.floor(Math.random() * 100) + 50;
                
                // Bridge game increment to empire systems
                await bridgeToEmpireSystem('increment', economyState.gameValue, 'empire');
                
            } else if (economyState.currentPhase === 'bridge' || economyState.currentPhase === 'sovereign') {
                economyState.gameValue += Math.floor(Math.random() * 200) + 100;
                economyState.realValue = economyState.gameValue * 0.001;
                
                // Bridge sovereign actions to all systems
                await bridgeToEmpireSystem('sovereign-increment', economyState.gameValue, 'all');
            }
            
            updateDisplay();
            saveEconomyState();
        }, 3000);
        
        // Initialize
        loadEconomyState();
        handleInvite();
        updateDisplay();
        
        // Connect to integration hub
        setTimeout(() => {
            connectToIntegrationHub();
        }, 2000);
        
        console.log('üåç Sovereign Game Economy Loaded');
        console.log('Game ‚Üí Verify ‚Üí Bridge ‚Üí Sovereign');
        console.log('üîó Connecting to existing empire systems...');
        console.log('The trojan horse is operational! üê¥');
    </script>
</body>
</html>