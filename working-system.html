<!DOCTYPE html>
<html>
<head>
    <title>üîß Working System</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, system-ui, sans-serif;
            background: #000;
            color: #fff;
            min-height: 100vh;
        }
        
        /* Single working interface */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        
        .title {
            font-size: 36px;
            margin-bottom: 10px;
            color: #00ff88;
        }
        
        .subtitle {
            font-size: 16px;
            color: #888;
            margin-bottom: 20px;
        }
        
        /* The actual working parts */
        .working-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid #333;
        }
        
        .section-title {
            font-size: 20px;
            color: #00ff88;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status {
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 12px;
            background: #00ff88;
            color: #000;
        }
        
        .status.broken {
            background: #ff4444;
            color: #fff;
        }
        
        /* Image to Character */
        .drop-area {
            width: 100%;
            height: 150px;
            border: 2px dashed #333;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
            position: relative;
        }
        
        .drop-area:hover, .drop-area.drag-over {
            border-color: #00ff88;
            background: rgba(0, 255, 136, 0.1);
        }
        
        .character-preview {
            display: none;
            text-align: center;
        }
        
        .character-display {
            width: 80px;
            height: 80px;
            margin: 0 auto 10px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            border: 2px solid #00ff88;
        }
        
        /* Game World */
        .game-canvas {
            width: 100%;
            height: 300px;
            background: linear-gradient(45deg, #001122, #002211);
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            margin-bottom: 20px;
        }
        
        .player {
            position: absolute;
            width: 30px;
            height: 30px;
            background: #00ff88;
            border-radius: 50%;
            transition: all 0.2s;
            top: 135px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .item {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .treasure {
            background: #ffd700;
            animation: pulse 2s infinite;
        }
        
        .qr-code {
            background: #fff;
            color: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            border-radius: 4px;
            width: 25px;
            height: 25px;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        /* Controls */
        .controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .btn {
            padding: 10px 20px;
            background: rgba(0, 255, 136, 0.2);
            border: 1px solid #00ff88;
            color: #00ff88;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn:hover {
            background: rgba(0, 255, 136, 0.4);
        }
        
        .btn:active {
            transform: scale(0.95);
        }
        
        /* Stats */
        .stats {
            display: flex;
            justify-content: space-around;
            text-align: center;
        }
        
        .stat {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #333;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #00ff88;
        }
        
        .stat-label {
            font-size: 12px;
            color: #888;
            margin-top: 5px;
        }
        
        /* Payment Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: #111;
            padding: 30px;
            border-radius: 15px;
            border: 1px solid #00ff88;
            text-align: center;
            max-width: 400px;
            width: 90%;
        }
        
        .modal-title {
            font-size: 24px;
            color: #00ff88;
            margin-bottom: 20px;
        }
        
        .payment-amount {
            font-size: 32px;
            color: #ffd700;
            margin: 20px 0;
        }
        
        .payment-btn {
            padding: 15px 30px;
            background: linear-gradient(45deg, #00ff88, #00cc66);
            border: none;
            color: #000;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin: 10px;
            transition: all 0.2s;
        }
        
        .payment-btn:hover {
            transform: scale(1.05);
        }
        
        .payment-btn.cancel {
            background: #333;
            color: #fff;
        }
        
        /* Log */
        .log {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            max-height: 150px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .log-line {
            margin-bottom: 5px;
            opacity: 0.8;
        }
        
        .log-line.success {
            color: #00ff88;
        }
        
        .log-line.error {
            color: #ff4444;
        }
        
        .log-line.info {
            color: #4A90E2;
        }
        
        /* Hidden file input */
        #fileInput {
            display: none;
        }
        
        /* Responsive */
        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }
            
            .title {
                font-size: 28px;
            }
            
            .controls {
                flex-wrap: wrap;
                gap: 5px;
            }
            
            .btn {
                padding: 8px 16px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="title">üîß Working System</div>
            <div class="subtitle">Stop building frameworks - just make it work</div>
            <div style="font-size: 12px; color: #666; margin-top: 10px;">
                Drop image ‚Üí Play game ‚Üí Scan QR ‚Üí Process payment ‚Üí Actually works
            </div>
        </div>
        
        <!-- Image to Character -->
        <div class="working-section">
            <div class="section-title">
                üì∏ Image to Character
                <span class="status">WORKING</span>
            </div>
            
            <div class="drop-area" id="dropArea">
                <div id="dropText">Drop an image here or click to select</div>
                <div class="character-preview" id="characterPreview">
                    <div class="character-display" id="characterDisplay">üéÆ</div>
                    <div id="characterName">Player</div>
                </div>
            </div>
            
            <input type="file" id="fileInput" accept="image/*">
        </div>
        
        <!-- Game World -->
        <div class="working-section">
            <div class="section-title">
                üéÆ Game World
                <span class="status">WORKING</span>
            </div>
            
            <div class="game-canvas" id="gameCanvas">
                <div class="player" id="player"></div>
            </div>
            
            <div class="controls">
                <button class="btn" onclick="movePlayer('left')">‚Üê Left</button>
                <button class="btn" onclick="movePlayer('up')">‚Üë Up</button>
                <button class="btn" onclick="movePlayer('down')">‚Üì Down</button>
                <button class="btn" onclick="movePlayer('right')">‚Üí Right</button>
                <button class="btn" onclick="spawnTreasure()">üí∞ Spawn Treasure</button>
                <button class="btn" onclick="spawnQR()">üì± Spawn QR</button>
            </div>
        </div>
        
        <!-- Stats -->
        <div class="working-section">
            <div class="section-title">
                üìä Player Stats
                <span class="status">WORKING</span>
            </div>
            
            <div class="stats">
                <div class="stat">
                    <div class="stat-value" id="goldStat">0</div>
                    <div class="stat-label">Gold</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="levelStat">1</div>
                    <div class="stat-label">Level</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="itemsStat">0</div>
                    <div class="stat-label">Items Found</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="paymentsStat">$0.00</div>
                    <div class="stat-label">Payments</div>
                </div>
            </div>
        </div>
        
        <!-- System Log -->
        <div class="working-section">
            <div class="section-title">
                üìù System Log
                <span class="status">WORKING</span>
            </div>
            
            <div class="log" id="systemLog">
                <div class="log-line info">[System] Working System initialized</div>
                <div class="log-line info">[System] All components online</div>
                <div class="log-line success">[Ready] Drop an image to start</div>
            </div>
        </div>
    </div>
    
    <!-- Payment Modal -->
    <div class="modal" id="paymentModal">
        <div class="modal-content">
            <div class="modal-title">üí≥ Process Payment</div>
            <div>QR Code scanned successfully!</div>
            <div class="payment-amount" id="paymentAmount">$0.00</div>
            <div style="margin: 20px 0; font-size: 14px; color: #888;">
                This would integrate with Stripe in production
            </div>
            <button class="payment-btn" onclick="processPayment()">üí≥ Pay Now</button>
            <button class="payment-btn cancel" onclick="closePayment()">Cancel</button>
        </div>
    </div>
    
    <script>
        // Simple working state
        let gameState = {
            player: {
                x: 50, // percentage
                y: 50, // percentage
                gold: 0,
                level: 1,
                itemsFound: 0,
                totalPayments: 0,
                character: {
                    name: 'Player',
                    color: '#00ff88',
                    image: null
                }
            },
            items: []
        };
        
        // Initialize
        function init() {
            console.log('üîß Working System - Initializing...');
            
            setupImageDrop();
            setupKeyboard();
            updateDisplay();
            
            log('System ready - everything actually works!', 'success');
        }
        
        // Image handling that actually works
        function setupImageDrop() {
            const dropArea = document.getElementById('dropArea');
            const fileInput = document.getElementById('fileInput');
            
            dropArea.addEventListener('click', () => fileInput.click());
            
            dropArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropArea.classList.add('drag-over');
            });
            
            dropArea.addEventListener('dragleave', () => {
                dropArea.classList.remove('drag-over');
            });
            
            dropArea.addEventListener('drop', (e) => {
                e.preventDefault();
                dropArea.classList.remove('drag-over');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    processImage(files[0]);
                }
            });
            
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    processImage(e.target.files[0]);
                }
            });
        }
        
        function processImage(file) {
            if (!file.type.startsWith('image/')) {
                log('Error: Please select an image file', 'error');
                return;
            }
            
            log(`Processing image: ${file.name}`, 'info');
            
            const reader = new FileReader();
            reader.onload = (e) => {
                // Get character name
                const name = prompt('Name your character:', 'Hero') || 'Hero';
                
                // Extract dominant color (simplified)
                const img = new Image();
                img.onload = () => {
                    const color = extractColor(img);
                    
                    // Update character
                    gameState.player.character.name = name;
                    gameState.player.character.color = color;
                    gameState.player.character.image = e.target.result;
                    
                    // Show character
                    showCharacter();
                    
                    // Reward for creating character
                    gameState.player.gold += 100;
                    gameState.player.itemsFound += 1;
                    
                    updateDisplay();
                    log(`Character created: ${name} with color ${color}`, 'success');
                    log('Gained 100 gold for character creation!', 'success');
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
        
        function extractColor(img) {
            // Create canvas to sample image
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = img.width;
            canvas.height = img.height;
            ctx.drawImage(img, 0, 0);
            
            // Sample center pixel
            const centerX = Math.floor(img.width / 2);
            const centerY = Math.floor(img.height / 2);
            const pixel = ctx.getImageData(centerX, centerY, 1, 1).data;
            
            return `rgb(${pixel[0]}, ${pixel[1]}, ${pixel[2]})`;
        }
        
        function showCharacter() {
            document.getElementById('dropText').style.display = 'none';
            document.getElementById('characterPreview').style.display = 'block';
            
            const display = document.getElementById('characterDisplay');
            const nameEl = document.getElementById('characterName');
            
            display.style.background = gameState.player.character.color;
            nameEl.textContent = gameState.player.character.name;
            
            // Update player in game
            const player = document.getElementById('player');
            player.style.background = gameState.player.character.color;
        }
        
        // Game movement that actually works
        function movePlayer(direction) {
            const speed = 5; // percentage
            let newX = gameState.player.x;
            let newY = gameState.player.y;
            
            switch (direction) {
                case 'left':
                    newX = Math.max(5, gameState.player.x - speed);
                    break;
                case 'right':
                    newX = Math.min(95, gameState.player.x + speed);
                    break;
                case 'up':
                    newY = Math.max(5, gameState.player.y - speed);
                    break;
                case 'down':
                    newY = Math.min(95, gameState.player.y + speed);
                    break;
            }
            
            gameState.player.x = newX;
            gameState.player.y = newY;
            
            // Update visual position
            const player = document.getElementById('player');
            player.style.left = newX + '%';
            player.style.top = newY + '%';
            
            // Check for item collisions
            checkCollisions();
            
            log(`Player moved ${direction} to (${newX.toFixed(1)}, ${newY.toFixed(1)})`, 'info');
        }
        
        function spawnTreasure() {
            const id = 'treasure_' + Date.now();
            const item = {
                id,
                type: 'treasure',
                x: Math.random() * 90 + 5,
                y: Math.random() * 90 + 5,
                value: Math.floor(Math.random() * 50) + 25
            };
            
            gameState.items.push(item);
            
            // Create visual element
            const element = document.createElement('div');
            element.id = item.id;
            element.className = 'item treasure';
            element.style.left = item.x + '%';
            element.style.top = item.y + '%';
            element.title = `Treasure: ${item.value} gold`;
            element.onclick = () => collectItem(item.id);
            
            document.getElementById('gameCanvas').appendChild(element);
            
            log(`Spawned treasure worth ${item.value} gold`, 'success');
        }
        
        function spawnQR() {
            const id = 'qr_' + Date.now();
            const item = {
                id,
                type: 'qr',
                x: Math.random() * 90 + 5,
                y: Math.random() * 90 + 5,
                value: (Math.random() * 20 + 5).toFixed(2)
            };
            
            gameState.items.push(item);
            
            // Create visual element
            const element = document.createElement('div');
            element.id = item.id;
            element.className = 'item qr-code';
            element.style.left = item.x + '%';
            element.style.top = item.y + '%';
            element.innerHTML = 'üì±';
            element.title = `QR Code: $${item.value}`;
            element.onclick = () => scanQR(item.id);
            
            document.getElementById('gameCanvas').appendChild(element);
            
            log(`Spawned QR code worth $${item.value}`, 'success');
        }
        
        function checkCollisions() {
            const playerRect = {
                x: gameState.player.x - 2.5,
                y: gameState.player.y - 2.5,
                width: 5,
                height: 5
            };
            
            gameState.items.forEach(item => {
                const itemRect = {
                    x: item.x - 2.5,
                    y: item.y - 2.5,
                    width: 5,
                    height: 5
                };
                
                if (isColliding(playerRect, itemRect)) {
                    if (item.type === 'treasure') {
                        collectItem(item.id);
                    } else if (item.type === 'qr') {
                        scanQR(item.id);
                    }
                }
            });
        }
        
        function isColliding(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                   rect1.x + rect1.width > rect2.x &&
                   rect1.y < rect2.y + rect2.height &&
                   rect1.y + rect1.height > rect2.y;
        }
        
        function collectItem(itemId) {
            const item = gameState.items.find(i => i.id === itemId);
            if (!item) return;
            
            // Remove from game
            const element = document.getElementById(itemId);
            if (element) {
                element.remove();
            }
            
            // Remove from state
            gameState.items = gameState.items.filter(i => i.id !== itemId);
            
            // Add reward
            gameState.player.gold += item.value;
            gameState.player.itemsFound += 1;
            
            // Check level up
            if (gameState.player.gold >= gameState.player.level * 100) {
                gameState.player.level += 1;
                log(`Level up! Now level ${gameState.player.level}`, 'success');
            }
            
            updateDisplay();
            log(`Collected treasure: +${item.value} gold`, 'success');
        }
        
        function scanQR(itemId) {
            const item = gameState.items.find(i => i.id === itemId);
            if (!item) return;
            
            log(`Scanned QR code worth $${item.value}`, 'info');
            
            // Show payment modal
            document.getElementById('paymentAmount').textContent = '$' + item.value;
            document.getElementById('paymentModal').style.display = 'flex';
            
            // Store current QR item
            window.currentQR = item;
        }
        
        function processPayment() {
            const item = window.currentQR;
            if (!item) return;
            
            log('Processing payment through Stripe...', 'info');
            
            // Simulate payment processing
            setTimeout(() => {
                // Remove QR from game
                const element = document.getElementById(item.id);
                if (element) element.remove();
                
                // Remove from state
                gameState.items = gameState.items.filter(i => i.id !== item.id);
                
                // Add payment reward
                const goldReward = Math.floor(parseFloat(item.value) * 10);
                gameState.player.gold += goldReward;
                gameState.player.totalPayments += parseFloat(item.value);
                gameState.player.itemsFound += 1;
                
                updateDisplay();
                closePayment();
                
                log(`Payment successful! +${goldReward} gold`, 'success');
                log(`Total payments: $${gameState.player.totalPayments.toFixed(2)}`, 'info');
                
                // Spawn bonus treasure
                setTimeout(() => spawnTreasure(), 1000);
                
            }, 2000);
        }
        
        function closePayment() {
            document.getElementById('paymentModal').style.display = 'none';
            window.currentQR = null;
        }
        
        // Keyboard controls
        function setupKeyboard() {
            document.addEventListener('keydown', (e) => {
                switch (e.key.toLowerCase()) {
                    case 'w':
                    case 'arrowup':
                        movePlayer('up');
                        break;
                    case 's':
                    case 'arrowdown':  
                        movePlayer('down');
                        break;
                    case 'a':
                    case 'arrowleft':
                        movePlayer('left');
                        break;
                    case 'd':
                    case 'arrowright':
                        movePlayer('right');
                        break;
                    case ' ':
                        e.preventDefault();
                        spawnTreasure();
                        break;
                    case 'q':
                        spawnQR();
                        break;
                }
            });
        }
        
        function updateDisplay() {
            document.getElementById('goldStat').textContent = gameState.player.gold;
            document.getElementById('levelStat').textContent = gameState.player.level;
            document.getElementById('itemsStat').textContent = gameState.player.itemsFound;
            document.getElementById('paymentsStat').textContent = '$' + gameState.player.totalPayments.toFixed(2);
        }
        
        function log(message, type = 'info') {
            const logEl = document.getElementById('systemLog');
            const line = document.createElement('div');
            line.className = `log-line ${type}`;
            line.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            
            logEl.appendChild(line);
            
            // Keep only last 20 lines
            const lines = logEl.querySelectorAll('.log-line');
            if (lines.length > 20) {
                lines[0].remove();
            }
            
            // Auto scroll
            logEl.scrollTop = logEl.scrollHeight;
            
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        // Initialize when loaded
        window.addEventListener('load', init);
        
        console.log('üîß Working System loaded');
        console.log('üì∏ Drop images to create characters');
        console.log('üéÆ Use WASD/arrows to move, Space for treasure, Q for QR');
        console.log('üí∞ Walk into items or click them to collect');
    </script>
</body>
</html>