<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FinishThisIdea Status - System Health</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f8f9fa;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px 0;
            text-align: center;
            margin-bottom: 40px;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .overall-status {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            margin-bottom: 30px;
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .status-dot {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            animation: pulse 2s infinite;
        }

        .status-operational { background-color: #28a745; }
        .status-degraded { background-color: #ffc107; }
        .status-partial_outage { background-color: #fd7e14; }
        .status-major_outage { background-color: #dc3545; }
        .status-maintenance { background-color: #6c757d; }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.6; }
            100% { opacity: 1; }
        }

        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .service-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.08);
            transition: transform 0.2s;
        }

        .service-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.12);
        }

        .service-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .service-name {
            font-weight: 600;
            font-size: 1.1em;
        }

        .service-status {
            display: flex;
            align-items: center;
            font-size: 0.9em;
        }

        .service-metrics {
            display: flex;
            justify-content: space-between;
            font-size: 0.85em;
            color: #666;
        }

        .incidents-section {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .incident {
            border-left: 4px solid #dc3545;
            padding: 15px;
            margin-bottom: 20px;
            background: #f8f9fa;
        }

        .incident-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .incident-title {
            font-weight: 600;
            color: #dc3545;
        }

        .incident-time {
            font-size: 0.85em;
            color: #666;
        }

        .incident-update {
            margin-left: 20px;
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .incident-update:last-child {
            border-bottom: none;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.08);
        }

        .metric-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
        }

        .metric-label {
            color: #666;
            margin-top: 5px;
        }

        .history-chart {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 30px;
        }

        .chart-container {
            height: 300px;
            position: relative;
        }

        .no-incidents {
            text-align: center;
            color: #666;
            padding: 40px;
        }

        .last-updated {
            text-align: center;
            color: #666;
            font-size: 0.9em;
            margin-top: 20px;
        }

        .subscribe-section {
            background: white;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .subscribe-form {
            display: flex;
            max-width: 400px;
            margin: 20px auto;
        }

        .subscribe-input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px 0 0 5px;
            font-size: 1em;
        }

        .subscribe-button {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 0 5px 5px 0;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
        }

        .subscribe-button:hover {
            background: #5a67d8;
        }

        @media (max-width: 768px) {
            .services-grid {
                grid-template-columns: 1fr;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>FinishThisIdea Status</h1>
        <p class="subtitle">Real-time system health and performance monitoring</p>
    </header>

    <div class="container">
        <!-- Overall Status -->
        <div class="overall-status">
            <div class="status-indicator" id="overall-status">
                <span class="status-dot status-operational"></span>
                <span>All Systems Operational</span>
            </div>
            <p id="status-message">All systems are running normally</p>
        </div>

        <!-- System Metrics -->
        <div class="metrics-grid" id="metrics-grid">
            <div class="metric-card">
                <div class="metric-value">99.9%</div>
                <div class="metric-label">Uptime (90 days)</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">150ms</div>
                <div class="metric-label">Avg Response Time</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">99.5%</div>
                <div class="metric-label">SLO Compliance</div>
            </div>
        </div>

        <!-- Services Grid -->
        <h2 style="margin-bottom: 20px;">Services</h2>
        <div class="services-grid" id="services-grid">
            <!-- Services will be dynamically populated -->
        </div>

        <!-- Active Incidents -->
        <div class="incidents-section">
            <h2 style="margin-bottom: 20px;">Active Incidents</h2>
            <div id="active-incidents">
                <div class="no-incidents">
                    <p>No active incidents</p>
                </div>
            </div>
        </div>

        <!-- Status History Chart -->
        <div class="history-chart">
            <h2 style="margin-bottom: 20px;">24-Hour Status History</h2>
            <div class="chart-container" id="history-chart">
                <!-- Chart will be rendered here -->
            </div>
        </div>

        <!-- Recent Incidents -->
        <div class="incidents-section">
            <h2 style="margin-bottom: 20px;">Recent Incidents</h2>
            <div id="recent-incidents">
                <!-- Recent incidents will be populated -->
            </div>
        </div>

        <!-- Subscribe Section -->
        <div class="subscribe-section">
            <h2>Subscribe to Status Updates</h2>
            <p style="margin: 10px 0; color: #666;">Get notified about system incidents and maintenance</p>
            <form class="subscribe-form" id="subscribe-form">
                <input type="email" class="subscribe-input" placeholder="Enter your email" required>
                <button type="submit" class="subscribe-button">Subscribe</button>
            </form>
        </div>

        <p class="last-updated" id="last-updated">Last updated: Loading...</p>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Status page functionality
        class StatusPage {
            constructor() {
                this.apiUrl = '/api/status';
                this.refreshInterval = 60000; // 1 minute
                this.chart = null;
                this.init();
            }

            async init() {
                await this.loadStatus();
                this.setupEventListeners();
                this.startAutoRefresh();
            }

            async loadStatus() {
                try {
                    const response = await fetch(this.apiUrl);
                    const result = await response.json();
                    
                    if (result.success) {
                        this.updateUI(result.data);
                    }
                } catch (error) {
                    console.error('Failed to load status:', error);
                }
            }

            updateUI(data) {
                // Update overall status
                this.updateOverallStatus(data.overall);
                
                // Update metrics
                this.updateMetrics(data.metrics);
                
                // Update services
                this.updateServices(data.services);
                
                // Update incidents
                this.updateIncidents(data.activeIncidents, data.recentIncidents);
                
                // Update history chart
                this.loadHistoryChart();
                
                // Update last updated time
                document.getElementById('last-updated').textContent = 
                    `Last updated: ${new Date(data.lastUpdated).toLocaleString()}`;
            }

            updateOverallStatus(status) {
                const indicator = document.getElementById('overall-status');
                const message = document.getElementById('status-message');
                
                indicator.innerHTML = `
                    <span class="status-dot status-${status}"></span>
                    <span>${this.getStatusText(status)}</span>
                `;
                
                const messages = {
                    operational: 'All systems are running normally',
                    degraded: 'Some systems are experiencing degraded performance',
                    partial_outage: 'Some services are experiencing issues',
                    major_outage: 'Major service disruption in progress',
                    maintenance: 'Scheduled maintenance in progress'
                };
                
                message.textContent = messages[status] || 'Unknown status';
            }

            updateMetrics(metrics) {
                if (!metrics) return;
                
                const grid = document.getElementById('metrics-grid');
                grid.innerHTML = `
                    <div class="metric-card">
                        <div class="metric-value">${metrics.uptime90d.toFixed(1)}%</div>
                        <div class="metric-label">Uptime (90 days)</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${metrics.averageResponseTime}ms</div>
                        <div class="metric-label">Avg Response Time</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${metrics.sloCompliance.toFixed(1)}%</div>
                        <div class="metric-label">SLO Compliance</div>
                    </div>
                `;
            }

            updateServices(services) {
                const grid = document.getElementById('services-grid');
                grid.innerHTML = services.map(service => `
                    <div class="service-card">
                        <div class="service-header">
                            <span class="service-name">${service.displayName}</span>
                            <span class="service-status">
                                <span class="status-dot status-${service.status}" style="width: 12px; height: 12px; margin-right: 5px;"></span>
                                ${this.getStatusText(service.status)}
                            </span>
                        </div>
                        <div class="service-metrics">
                            <span>Uptime: ${service.uptime90d.toFixed(1)}%</span>
                            ${service.responseTime ? `<span>Response: ${service.responseTime}ms</span>` : ''}
                        </div>
                    </div>
                `).join('');
            }

            updateIncidents(activeIncidents, recentIncidents) {
                // Active incidents
                const activeContainer = document.getElementById('active-incidents');
                if (activeIncidents.length === 0) {
                    activeContainer.innerHTML = '<div class="no-incidents"><p>No active incidents</p></div>';
                } else {
                    activeContainer.innerHTML = activeIncidents.map(incident => 
                        this.renderIncident(incident)
                    ).join('');
                }
                
                // Recent incidents
                const recentContainer = document.getElementById('recent-incidents');
                if (recentIncidents.length === 0) {
                    recentContainer.innerHTML = '<div class="no-incidents"><p>No recent incidents</p></div>';
                } else {
                    recentContainer.innerHTML = recentIncidents.map(incident => 
                        this.renderIncident(incident)
                    ).join('');
                }
            }

            renderIncident(incident) {
                return `
                    <div class="incident">
                        <div class="incident-header">
                            <span class="incident-title">${incident.title}</span>
                            <span class="incident-time">${new Date(incident.startedAt).toLocaleString()}</span>
                        </div>
                        <p>${incident.description}</p>
                        <div style="margin-top: 15px;">
                            ${incident.updates.map(update => `
                                <div class="incident-update">
                                    <strong>${update.status}:</strong> ${update.message}
                                    <div style="font-size: 0.8em; color: #666; margin-top: 5px;">
                                        ${new Date(update.timestamp).toLocaleString()}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            async loadHistoryChart() {
                try {
                    const response = await fetch(`${this.apiUrl}/history?hours=24`);
                    const result = await response.json();
                    
                    if (result.success) {
                        this.renderHistoryChart(result.data);
                    }
                } catch (error) {
                    console.error('Failed to load history:', error);
                }
            }

            renderHistoryChart(historyData) {
                const ctx = document.getElementById('history-chart');
                
                // Prepare data for chart
                const labels = historyData.map(point => 
                    new Date(point.timestamp).toLocaleTimeString()
                );
                
                // Count services by status over time
                const datasets = [{
                    label: 'Operational Services',
                    data: historyData.map(point => 
                        point.services.filter(s => s.status === 'operational').length
                    ),
                    borderColor: '#28a745',
                    backgroundColor: 'rgba(40, 167, 69, 0.1)'
                }];
                
                if (this.chart) {
                    this.chart.destroy();
                }
                
                this.chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                ticks: {
                                    stepSize: 1
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            }

            getStatusText(status) {
                const texts = {
                    operational: 'Operational',
                    degraded: 'Degraded',
                    partial_outage: 'Partial Outage',
                    major_outage: 'Major Outage',
                    maintenance: 'Maintenance'
                };
                return texts[status] || 'Unknown';
            }

            setupEventListeners() {
                document.getElementById('subscribe-form').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const email = e.target.querySelector('input[type="email"]').value;
                    
                    try {
                        const response = await fetch(`${this.apiUrl}/subscribe`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ email })
                        });
                        
                        const result = await response.json();
                        
                        if (result.success) {
                            alert('Successfully subscribed to status updates!');
                            e.target.reset();
                        } else {
                            alert('Failed to subscribe. Please try again.');
                        }
                    } catch (error) {
                        alert('Failed to subscribe. Please try again.');
                    }
                });
            }

            startAutoRefresh() {
                setInterval(() => {
                    this.loadStatus();
                }, this.refreshInterval);
            }
        }

        // Initialize status page
        new StatusPage();
    </script>
</body>
</html>