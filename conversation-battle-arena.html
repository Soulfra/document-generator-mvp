<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÆ Conversation Battle Arena - Middle Out Gaming</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a2e 50%, #16213e 100%);
            color: #ffffff;
            font-family: 'Courier New', monospace;
            overflow: hidden;
            height: 100vh;
        }
        
        /* Main game container */
        .arena-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Nested circular rings - Middle Out Architecture */
        .battle-ring {
            position: absolute;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        /* Battle Arena - Outer Ring */
        .battle-arena {
            width: 90vmin;
            height: 90vmin;
            border-color: #ff4444;
            background: radial-gradient(circle, rgba(255, 68, 68, 0.1) 0%, transparent 70%);
            animation: pulse-red 3s ease-in-out infinite;
        }
        
        /* Audience Layer - Middle Ring */
        .audience-layer {
            width: 65vmin;
            height: 65vmin;
            border-color: #4444ff;
            background: radial-gradient(circle, rgba(68, 68, 255, 0.1) 0%, transparent 70%);
            animation: pulse-blue 2.5s ease-in-out infinite;
        }
        
        /* King/Queen Dance Core - Inner Ring */
        .dance-core {
            width: 40vmin;
            height: 40vmin;
            border-color: #44ff44;
            background: radial-gradient(circle, rgba(68, 255, 68, 0.1) 0%, transparent 70%);
            animation: pulse-green 2s ease-in-out infinite;
            position: relative;
        }
        
        /* Animations */
        @keyframes pulse-red {
            0%, 100% { transform: scale(1); box-shadow: 0 0 20px rgba(255, 68, 68, 0.3); }
            50% { transform: scale(1.05); box-shadow: 0 0 40px rgba(255, 68, 68, 0.6); }
        }
        
        @keyframes pulse-blue {
            0%, 100% { transform: scale(1); box-shadow: 0 0 15px rgba(68, 68, 255, 0.3); }
            50% { transform: scale(1.03); box-shadow: 0 0 30px rgba(68, 68, 255, 0.6); }
        }
        
        @keyframes pulse-green {
            0%, 100% { transform: scale(1); box-shadow: 0 0 10px rgba(68, 255, 68, 0.3); }
            50% { transform: scale(1.02); box-shadow: 0 0 25px rgba(68, 255, 68, 0.6); }
        }
        
        /* King and Queen dancers */
        .dancer {
            position: absolute;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            transition: all 0.5s ease;
            cursor: pointer;
        }
        
        .king {
            background: linear-gradient(45deg, #6a5acd, #483d8b);
            box-shadow: 0 0 20px rgba(106, 90, 205, 0.6);
            top: 50%;
            left: 30%;
            transform: translate(-50%, -50%);
        }
        
        .queen {
            background: linear-gradient(45deg, #ff69b4, #ff1493);
            box-shadow: 0 0 20px rgba(255, 105, 180, 0.6);
            top: 50%;
            right: 30%;
            transform: translate(50%, -50%);
        }
        
        /* Dance connection line */
        .dance-connection {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 200px;
            height: 2px;
            background: linear-gradient(90deg, #6a5acd, #ff69b4);
            transform: translate(-50%, -50%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .dance-connection.active {
            opacity: 1;
            animation: dance-flow 1s ease-in-out infinite alternate;
        }
        
        @keyframes dance-flow {
            0% { transform: translate(-50%, -50%) scaleX(1); }
            100% { transform: translate(-50%, -50%) scaleX(1.2); }
        }
        
        /* Spectators in audience layer */
        .spectator {
            position: absolute;
            width: 20px;
            height: 20px;
            background: #ffd700;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.6);
            animation: spectator-cheer 3s ease-in-out infinite;
        }
        
        @keyframes spectator-cheer {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        /* Fighters in battle arena */
        .fighter {
            position: absolute;
            width: 30px;
            height: 30px;
            background: #ff4444;
            clip-path: polygon(50% 0%, 0% 100%, 100% 100%);
            animation: fighter-ready 2s ease-in-out infinite;
        }
        
        @keyframes fighter-ready {
            0%, 100% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(10deg) scale(1.1); }
        }
        
        /* UI Panels */
        .ui-panel {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            padding: 15px;
            backdrop-filter: blur(10px);
        }
        
        /* Game Stats Panel */
        .stats-panel {
            top: 20px;
            left: 20px;
            width: 300px;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .stat-value {
            color: #00ff00;
            font-weight: bold;
        }
        
        /* Live Chat Panel */
        .chat-panel {
            bottom: 20px;
            left: 20px;
            width: 400px;
            height: 200px;
        }
        
        .chat-messages {
            height: 120px;
            overflow-y: auto;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
            margin-bottom: 10px;
            padding-bottom: 10px;
        }
        
        .chat-message {
            margin-bottom: 5px;
            font-size: 12px;
        }
        
        .chat-input-container {
            display: flex;
            gap: 10px;
        }
        
        .chat-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 5px;
            padding: 5px 10px;
            color: white;
            font-family: inherit;
        }
        
        .chat-send {
            background: #4444ff;
            border: none;
            border-radius: 5px;
            padding: 5px 15px;
            color: white;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        .chat-send:hover {
            background: #6666ff;
        }
        
        /* Battle Panel */
        .battle-panel {
            top: 20px;
            right: 20px;
            width: 250px;
        }
        
        .battle-item {
            background: rgba(255, 68, 68, 0.2);
            border: 1px solid #ff4444;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
            font-size: 12px;
        }
        
        /* Music Visualizer */
        .music-visualizer {
            bottom: 20px;
            right: 20px;
            width: 200px;
            height: 100px;
            display: flex;
            align-items: end;
            gap: 2px;
        }
        
        .music-bar {
            flex: 1;
            background: linear-gradient(to top, #ff4444, #ffff44, #44ff44);
            border-radius: 2px;
            animation: music-bounce 0.5s ease-in-out infinite alternate;
        }
        
        @keyframes music-bounce {
            0% { height: 10px; }
            100% { height: 60px; }
        }
        
        /* Dynamic color states */
        .state-green { border-color: #44ff44 !important; }
        .state-purple { border-color: #8a2be2 !important; }
        .state-gold { border-color: #ffd700 !important; }
        .state-yellow { border-color: #ffff44 !important; }
        .state-red { border-color: #ff4444 !important; }
        
        /* Layer labels */
        .layer-label {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 14px;
            font-weight: bold;
            text-align: center;
            opacity: 0.7;
        }
        
        /* Connection between layers indicator */
        .layer-connection {
            position: absolute;
            width: 2px;
            background: rgba(255, 255, 255, 0.3);
            left: 50%;
            transform: translateX(-50%);
        }
        
        .connection-1 {
            top: 20vmin;
            height: 12.5vmin;
        }
        
        .connection-2 {
            top: 32.5vmin;
            height: 12.5vmin;
        }
    </style>
</head>
<body>
    <div class="arena-container">
        <!-- Battle Arena - Outer Ring -->
        <div class="battle-ring battle-arena state-red" id="battleArena">
            <div class="layer-label">‚öîÔ∏è BATTLE ARENA</div>
            <div class="layer-connection connection-1"></div>
            
            <!-- Fighters -->
            <div class="fighter" style="top: 10%; left: 20%;" title="System Challenger"></div>
            <div class="fighter" style="top: 30%; right: 15%;" title="Error Fighter"></div>
            <div class="fighter" style="bottom: 20%; left: 30%;" title="Debug Warrior"></div>
        </div>
        
        <!-- Audience Layer - Middle Ring -->
        <div class="battle-ring audience-layer state-blue" id="audienceLayer">
            <div class="layer-label">üë• AUDIENCE</div>
            <div class="layer-connection connection-2"></div>
            
            <!-- Spectators -->
            <div class="spectator" style="top: 15%; left: 25%;" title="Spectator 1"></div>
            <div class="spectator" style="top: 25%; right: 20%;" title="Spectator 2"></div>
            <div class="spectator" style="bottom: 30%; left: 35%;" title="Spectator 3"></div>
            <div class="spectator" style="bottom: 15%; right: 25%;" title="Spectator 4"></div>
            <div class="spectator" style="top: 45%; left: 10%;" title="Spectator 5"></div>
            <div class="spectator" style="top: 45%; right: 10%;" title="Spectator 6"></div>
        </div>
        
        <!-- King/Queen Dance Core - Inner Ring -->
        <div class="battle-ring dance-core state-green" id="danceCore">
            <div class="layer-label">üíÉ KING/QUEEN DANCE</div>
            
            <!-- King and Queen -->
            <div class="dancer king" id="king" title="Technical King">üëë</div>
            <div class="dancer queen" id="queen" title="Human Queen">üë∏</div>
            
            <!-- Dance connection line -->
            <div class="dance-connection" id="danceConnection"></div>
        </div>
    </div>
    
    <!-- UI Panels -->
    
    <!-- Game Statistics Panel -->
    <div class="ui-panel stats-panel">
        <h3 style="margin-bottom: 15px; color: #00ff00;">üéÆ Game Stats</h3>
        <div class="stat-item">
            <span>Session:</span>
            <span class="stat-value" id="sessionId">LOADING...</span>
        </div>
        <div class="stat-item">
            <span>Dance Sync:</span>
            <span class="stat-value" id="syncScore">---%</span>
        </div>
        <div class="stat-item">
            <span>Color State:</span>
            <span class="stat-value" id="colorState">GREEN</span>
        </div>
        <div class="stat-item">
            <span>Frequency:</span>
            <span class="stat-value" id="frequency">528Hz</span>
        </div>
        <div class="stat-item">
            <span>Spectators:</span>
            <span class="stat-value" id="spectatorCount">6</span>
        </div>
        <div class="stat-item">
            <span>Active Battles:</span>
            <span class="stat-value" id="activeBattles">3</span>
        </div>
        <div class="stat-item">
            <span>System Health:</span>
            <span class="stat-value" id="systemHealth">HEALTHY</span>
        </div>
    </div>
    
    <!-- Live Chat Panel -->
    <div class="ui-panel chat-panel">
        <h3 style="margin-bottom: 10px; color: #4444ff;">üí¨ Live Chat</h3>
        <div class="chat-messages" id="chatMessages">
            <div class="chat-message"><strong>System:</strong> Welcome to the Conversation Battle Arena!</div>
            <div class="chat-message"><strong>King:</strong> Technical systems are online and ready.</div>
            <div class="chat-message"><strong>Queen:</strong> I'm excited to see how this works!</div>
            <div class="chat-message"><strong>Spectator1:</strong> This is amazing! Watching the middle-out concept live.</div>
        </div>
        <div class="chat-input-container">
            <input type="text" class="chat-input" id="chatInput" placeholder="Type your message..." maxlength="200">
            <button class="chat-send" id="chatSend">Send</button>
        </div>
    </div>
    
    <!-- Battle Events Panel -->
    <div class="ui-panel battle-panel">
        <h3 style="margin-bottom: 10px; color: #ff4444;">‚öîÔ∏è Active Battles</h3>
        <div class="battle-item">
            <strong>System Challenge:</strong><br>
            Error resolution battle<br>
            <small>Difficulty: HIGH</small>
        </div>
        <div class="battle-item">
            <strong>Technical Duel:</strong><br>
            Database sync verification<br>
            <small>Difficulty: MEDIUM</small>
        </div>
        <div class="battle-item">
            <strong>Collaboration Quest:</strong><br>
            Feature implementation<br>
            <small>Difficulty: LOW</small>
        </div>
    </div>
    
    <!-- Music Visualizer -->
    <div class="ui-panel music-visualizer">
        <div class="music-bar" style="animation-delay: 0.1s;"></div>
        <div class="music-bar" style="animation-delay: 0.2s;"></div>
        <div class="music-bar" style="animation-delay: 0.3s;"></div>
        <div class="music-bar" style="animation-delay: 0.4s;"></div>
        <div class="music-bar" style="animation-delay: 0.5s;"></div>
        <div class="music-bar" style="animation-delay: 0.6s;"></div>
        <div class="music-bar" style="animation-delay: 0.7s;"></div>
        <div class="music-bar" style="animation-delay: 0.8s;"></div>
    </div>

    <script>
        // Game state management
        class ConversationBattleArena {
            constructor() {
                this.gameState = {
                    sessionId: this.generateSessionId(),
                    syncScore: 75,
                    colorState: 'green',
                    frequency: 528,
                    spectatorCount: 6,
                    activeBattles: 3,
                    systemHealth: 'healthy',
                    danceActive: false,
                    lastUpdate: Date.now()
                };
                
                this.websocket = null;
                this.chatHistory = [];
                this.initializeWebSocket();
                this.setupEventListeners();
                this.startGameLoop();
                this.updateUI();
            }
            
            generateSessionId() {
                return Math.random().toString(36).substr(2, 8).toUpperCase();
            }
            
            initializeWebSocket() {
                // Connect to game backend (would be real WebSocket in production)
                console.log('üîå Connecting to game backend...');
                
                // Simulate WebSocket connection
                setTimeout(() => {
                    this.simulateGameEvents();
                }, 2000);
            }
            
            setupEventListeners() {
                // Chat functionality
                const chatInput = document.getElementById('chatInput');
                const chatSend = document.getElementById('chatSend');
                
                chatSend.addEventListener('click', () => this.sendChatMessage());
                chatInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.sendChatMessage();
                });
                
                // Dance interaction
                const king = document.getElementById('king');
                const queen = document.getElementById('queen');
                
                king.addEventListener('click', () => this.triggerDanceEvent('king'));
                queen.addEventListener('click', () => this.triggerDanceEvent('queen'));
                
                // Layer interactions
                document.getElementById('danceCore').addEventListener('click', () => {
                    this.processConversationEvent('core_interaction');
                });
                
                document.getElementById('audienceLayer').addEventListener('click', () => {
                    this.processConversationEvent('audience_reaction');
                });
                
                document.getElementById('battleArena').addEventListener('click', () => {
                    this.processConversationEvent('battle_challenge');
                });
            }
            
            sendChatMessage() {
                const input = document.getElementById('chatInput');
                const message = input.value.trim();
                
                if (message) {
                    this.addChatMessage('You', message);
                    input.value = '';
                    
                    // Process message through conversation pipeline
                    this.processConversationMessage(message);
                }
            }
            
            addChatMessage(sender, message) {
                const chatMessages = document.getElementById('chatMessages');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'chat-message';
                messageDiv.innerHTML = `<strong>${sender}:</strong> ${message}`;
                
                chatMessages.appendChild(messageDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                this.chatHistory.push({ sender, message, timestamp: new Date() });
            }
            
            processConversationMessage(message) {
                // Simulate processing through our conversation pipeline
                console.log('üí¨ Processing conversation message:', message);
                
                // Analyze message for King/Queen dynamics
                const isKingMessage = this.detectKingPattern(message);
                const isQueenMessage = this.detectQueenPattern(message);
                
                // Update dance synchronization
                if (isKingMessage || isQueenMessage) {
                    this.updateDanceSync();
                }
                
                // Generate system response
                setTimeout(() => {
                    const response = this.generateSystemResponse(message);
                    this.addChatMessage('System', response);
                }, 1000);
            }
            
            detectKingPattern(message) {
                const kingPatterns = /technical|system|architecture|implementation|code|debug|error|database|sync|verification|proof|test/i;
                return kingPatterns.test(message);
            }
            
            detectQueenPattern(message) {
                const queenPatterns = /user|experience|interface|design|flow|feeling|confusion|clarity|understanding|simple|complex|emotion|satisfaction|frustration|help/i;
                return queenPatterns.test(message);
            }
            
            generateSystemResponse(message) {
                const responses = [
                    "Analyzing conversation patterns...",
                    "King/Queen synchronization detected!",
                    "Color state transition triggered!",
                    "Database verification in progress...",
                    "Proof generation successful!",
                    "Battle event generated!",
                    "Audience engagement increased!"
                ];
                
                return responses[Math.floor(Math.random() * responses.length)];
            }
            
            triggerDanceEvent(dancer) {
                console.log(`üíÉ ${dancer} dance triggered!`);
                
                // Activate dance connection
                const connection = document.getElementById('danceConnection');
                connection.classList.add('active');
                
                this.gameState.danceActive = true;
                this.updateDanceSync();
                
                // Add visual effects
                const dancerElement = document.getElementById(dancer);
                dancerElement.style.transform += ' scale(1.2)';
                
                setTimeout(() => {
                    dancerElement.style.transform = dancerElement.style.transform.replace(' scale(1.2)', '');
                    connection.classList.remove('active');
                    this.gameState.danceActive = false;
                }, 2000);
            }
            
            updateDanceSync() {
                // Simulate synchronization calculation
                const newSync = Math.max(20, Math.min(100, this.gameState.syncScore + (Math.random() - 0.5) * 20));
                this.gameState.syncScore = Math.round(newSync);
                
                // Update color state based on sync
                if (newSync >= 90) {
                    this.updateColorState('gold');
                } else if (newSync >= 75) {
                    this.updateColorState('purple');
                } else if (newSync >= 50) {
                    this.updateColorState('green');
                } else if (newSync >= 25) {
                    this.updateColorState('yellow');
                } else {
                    this.updateColorState('red');
                }
                
                this.updateUI();
            }
            
            updateColorState(newState) {
                const oldState = this.gameState.colorState;
                this.gameState.colorState = newState;
                
                // Update visual elements
                const danceCore = document.getElementById('danceCore');
                danceCore.className = danceCore.className.replace(/state-\w+/, `state-${newState}`);
                
                // Update frequency based on color
                const frequencies = {
                    green: 528,
                    purple: 432,
                    gold: 741,
                    yellow: 396,
                    red: 963
                };
                
                this.gameState.frequency = frequencies[newState];
                
                console.log(`üé® Color state: ${oldState} ‚Üí ${newState} (${this.gameState.frequency}Hz)`);
            }
            
            processConversationEvent(eventType) {
                console.log(`üéÆ Processing conversation event: ${eventType}`);
                
                switch (eventType) {
                    case 'core_interaction':
                        this.triggerDanceEvent(Math.random() > 0.5 ? 'king' : 'queen');
                        break;
                        
                    case 'audience_reaction':
                        this.gameState.spectatorCount += Math.floor(Math.random() * 3);
                        this.addChatMessage('Audience', 'New spectators joined the arena!');
                        break;
                        
                    case 'battle_challenge':
                        this.gameState.activeBattles += 1;
                        this.addChatMessage('Battle System', 'New challenge initiated!');
                        break;
                }
                
                this.updateUI();
            }
            
            simulateGameEvents() {
                // Simulate live game events
                setInterval(() => {
                    if (Math.random() > 0.7) {
                        this.simulateRandomEvent();
                    }
                }, 5000);
            }
            
            simulateRandomEvent() {
                const events = [
                    () => {
                        this.addChatMessage('King', 'Database synchronization complete!');
                        this.updateDanceSync();
                    },
                    () => {
                        this.addChatMessage('Queen', 'User experience feels much smoother now.');
                        this.updateDanceSync();
                    },
                    () => {
                        this.gameState.spectatorCount += Math.floor(Math.random() * 2);
                        this.addChatMessage('System', 'Spectator engagement increased!');
                    },
                    () => {
                        if (this.gameState.activeBattles > 0) {
                            this.gameState.activeBattles--;
                            this.addChatMessage('Battle System', 'Challenge resolved successfully!');
                        }
                    }
                ];
                
                const randomEvent = events[Math.floor(Math.random() * events.length)];
                randomEvent();
                
                this.updateUI();
            }
            
            startGameLoop() {
                // Update game state regularly
                setInterval(() => {
                    this.updateSystemHealth();
                    this.updateMusicVisualizer();
                }, 1000);
            }
            
            updateSystemHealth() {
                let health = 'healthy';
                
                if (this.gameState.syncScore < 30) {
                    health = 'critical';
                } else if (this.gameState.syncScore < 50) {
                    health = 'warning';
                } else if (this.gameState.syncScore > 80) {
                    health = 'excellent';
                }
                
                this.gameState.systemHealth = health;
            }
            
            updateMusicVisualizer() {
                const bars = document.querySelectorAll('.music-bar');
                bars.forEach((bar, index) => {
                    const height = Math.random() * 80 + 20;
                    bar.style.height = `${height}px`;
                    bar.style.animationDelay = `${index * 0.1}s`;
                });
            }
            
            updateUI() {
                // Update all UI elements with current game state
                document.getElementById('sessionId').textContent = this.gameState.sessionId;
                document.getElementById('syncScore').textContent = `${this.gameState.syncScore}%`;
                document.getElementById('colorState').textContent = this.gameState.colorState.toUpperCase();
                document.getElementById('frequency').textContent = `${this.gameState.frequency}Hz`;
                document.getElementById('spectatorCount').textContent = this.gameState.spectatorCount;
                document.getElementById('activeBattles').textContent = this.gameState.activeBattles;
                document.getElementById('systemHealth').textContent = this.gameState.systemHealth.toUpperCase();
                
                // Update sync score color
                const syncElement = document.getElementById('syncScore');
                if (this.gameState.syncScore >= 80) {
                    syncElement.style.color = '#00ff00';
                } else if (this.gameState.syncScore >= 50) {
                    syncElement.style.color = '#ffff00';
                } else {
                    syncElement.style.color = '#ff4444';
                }
            }
        }
        
        // Initialize the arena when page loads
        document.addEventListener('DOMContentLoaded', () => {
            console.log('üéÆ Initializing Conversation Battle Arena...');
            window.battleArena = new ConversationBattleArena();
            
            // Add welcome message
            setTimeout(() => {
                window.battleArena.addChatMessage('System', 'Arena initialized! Click layers to interact, click dancers to trigger events!');
            }, 1000);
        });
    </script>
</body>
</html>