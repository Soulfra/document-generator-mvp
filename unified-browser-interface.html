<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agentic Browser - AI-Powered Web Experience</title>
    <style>
        :root {
            --primary-color: #2196F3;
            --secondary-color: #FFC107;
            --success-color: #4CAF50;
            --warning-color: #FF9800;
            --error-color: #F44336;
            --dark-bg: #1a1a1a;
            --medium-bg: #2d2d2d;
            --light-bg: #3d3d3d;
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --border-color: #555;
            --recording-color: #ff4444;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--dark-bg);
            color: var(--text-primary);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* Top Navigation Bar */
        .top-nav {
            background: var(--medium-bg);
            border-bottom: 1px solid var(--border-color);
            padding: 8px 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 60px;
            flex-shrink: 0;
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .logo {
            font-size: 18px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .recording-controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn {
            background: var(--light-bg);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn:hover {
            background: var(--primary-color);
            border-color: var(--primary-color);
        }

        .btn.recording {
            background: var(--recording-color);
            border-color: var(--recording-color);
            animation: pulse 2s infinite;
        }

        .btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success-color);
        }

        .status-dot.warning { background: var(--warning-color); }
        .status-dot.error { background: var(--error-color); }

        /* Main Content Area */
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* Left Sidebar */
        .left-sidebar {
            width: 300px;
            background: var(--medium-bg);
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }

        .sidebar-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
        }

        .sidebar-tab {
            flex: 1;
            padding: 12px 8px;
            text-align: center;
            cursor: pointer;
            font-size: 12px;
            background: var(--light-bg);
            border-right: 1px solid var(--border-color);
            transition: all 0.2s;
        }

        .sidebar-tab:last-child {
            border-right: none;
        }

        .sidebar-tab.active {
            background: var(--primary-color);
            color: white;
        }

        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        /* Center Panel - Browser/Content */
        .center-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: var(--dark-bg);
        }

        .url-bar {
            background: var(--medium-bg);
            border-bottom: 1px solid var(--border-color);
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .url-input {
            flex: 1;
            background: var(--light-bg);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
        }

        .url-input:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .browser-frame {
            flex: 1;
            background: white;
            border: none;
            width: 100%;
        }

        /* Right Sidebar - Insights */
        .right-sidebar {
            width: 350px;
            background: var(--medium-bg);
            border-left: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            flex-shrink: 0;
        }

        .insights-header {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            background: var(--light-bg);
        }

        .insights-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        /* Analysis Cards */
        .analysis-card {
            background: var(--light-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .analysis-card h3 {
            color: var(--primary-color);
            margin-bottom: 8px;
            font-size: 14px;
        }

        .analysis-card p {
            font-size: 12px;
            line-height: 1.4;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .insight-list {
            list-style: none;
        }

        .insight-list li {
            font-size: 12px;
            padding: 4px 0;
            color: var(--text-secondary);
            border-bottom: 1px solid var(--border-color);
        }

        .insight-list li:last-child {
            border-bottom: none;
        }

        /* Session List */
        .session-item {
            background: var(--light-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .session-item:hover {
            border-color: var(--primary-color);
        }

        .session-item.active {
            background: var(--primary-color);
            border-color: var(--primary-color);
        }

        .session-title {
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 4px;
        }

        .session-meta {
            font-size: 10px;
            color: var(--text-secondary);
        }

        /* Content Library */
        .content-item {
            background: var(--light-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .content-item:hover {
            border-color: var(--primary-color);
        }

        .content-title {
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 4px;
            color: var(--text-primary);
        }

        .content-meta {
            font-size: 10px;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .content-insights {
            font-size: 11px;
            color: var(--text-secondary);
            font-style: italic;
        }

        /* Real-time Stats */
        .realtime-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 16px;
        }

        .stat-card {
            background: var(--light-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 16px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .stat-label {
            font-size: 10px;
            color: var(--text-secondary);
        }

        /* Notifications */
        .notification {
            position: fixed;
            top: 70px;
            right: 20px;
            background: var(--medium-bg);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
            max-width: 300px;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
        }

        .notification.success { border-left: 4px solid var(--success-color); }
        .notification.warning { border-left: 4px solid var(--warning-color); }
        .notification.error { border-left: 4px solid var(--error-color); }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Loading Spinner */
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-top: 2px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            display: inline-block;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .right-sidebar {
                width: 300px;
            }
        }

        @media (max-width: 900px) {
            .left-sidebar,
            .right-sidebar {
                width: 250px;
            }
        }

        /* Hidden class */
        .hidden {
            display: none !important;
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--dark-bg);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-color);
        }
    </style>
</head>
<body>
    <!-- Top Navigation -->
    <div class="top-nav">
        <div class="nav-left">
            <div class="logo">🤖 Agentic Browser</div>
            
            <div class="recording-controls">
                <button id="recordBtn" class="btn">
                    <span id="recordIcon">🎥</span>
                    <span id="recordText">Start Recording</span>
                </button>
                <button id="pauseBtn" class="btn disabled">⏸️ Pause</button>
                <button id="stopBtn" class="btn disabled">⏹️ Stop</button>
            </div>
        </div>

        <div class="nav-right">
            <div class="status-indicator">
                <div id="llmStatus" class="status-dot"></div>
                <span>Local LLM</span>
            </div>
            <div class="status-indicator">
                <div id="dbStatus" class="status-dot"></div>
                <span>Database</span>
            </div>
            <div class="status-indicator">
                <div id="systemStatus" class="status-dot"></div>
                <span>System</span>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Left Sidebar -->
        <div class="left-sidebar">
            <div class="sidebar-tabs">
                <div class="sidebar-tab active" data-tab="sessions">Sessions</div>
                <div class="sidebar-tab" data-tab="content">Library</div>
                <div class="sidebar-tab" data-tab="patterns">Patterns</div>
            </div>

            <div class="sidebar-content">
                <!-- Sessions Tab -->
                <div id="sessionsTab" class="tab-content">
                    <div class="realtime-stats">
                        <div class="stat-card">
                            <div class="stat-value" id="sessionCount">0</div>
                            <div class="stat-label">Sessions</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="interactionCount">0</div>
                            <div class="stat-label">Interactions</div>
                        </div>
                    </div>
                    
                    <h3 style="margin-bottom: 12px; font-size: 14px;">Recent Sessions</h3>
                    <div id="sessionsList"></div>
                </div>

                <!-- Content Library Tab -->
                <div id="contentTab" class="tab-content hidden">
                    <div class="realtime-stats">
                        <div class="stat-card">
                            <div class="stat-value" id="videoCount">0</div>
                            <div class="stat-label">Videos</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="podcastCount">0</div>
                            <div class="stat-label">Podcasts</div>
                        </div>
                    </div>

                    <h3 style="margin-bottom: 12px; font-size: 14px;">Content Library</h3>
                    <div id="contentList"></div>
                </div>

                <!-- Patterns Tab -->
                <div id="patternsTab" class="tab-content hidden">
                    <h3 style="margin-bottom: 12px; font-size: 14px;">Behavioral Patterns</h3>
                    <div id="patternsList"></div>
                </div>
            </div>
        </div>

        <!-- Center Panel -->
        <div class="center-panel">
            <div class="url-bar">
                <button id="backBtn" class="btn">←</button>
                <button id="forwardBtn" class="btn">→</button>
                <button id="refreshBtn" class="btn">🔄</button>
                <input type="text" id="urlInput" class="url-input" placeholder="Enter URL or search term...">
                <button id="goBtn" class="btn">Go</button>
                <button id="analyzeBtn" class="btn">🧠 Analyze</button>
            </div>
            
            <iframe id="browserFrame" class="browser-frame" src="about:blank"></iframe>
        </div>

        <!-- Right Sidebar -->
        <div class="right-sidebar">
            <div class="insights-header">
                <h2 style="font-size: 16px; margin-bottom: 8px;">AI Insights</h2>
                <div class="realtime-stats">
                    <div class="stat-card">
                        <div class="stat-value" id="insightCount">0</div>
                        <div class="stat-label">Total Insights</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="confidenceScore">0%</div>
                        <div class="stat-label">Confidence</div>
                    </div>
                </div>
            </div>

            <div class="insights-content">
                <div id="currentAnalysis" class="analysis-card">
                    <h3>Current Page Analysis</h3>
                    <p>Navigate to a webpage or start recording to see real-time insights.</p>
                </div>

                <div id="realtimeInsights" class="analysis-card">
                    <h3>Real-time Patterns</h3>
                    <ul id="realtimeList" class="insight-list">
                        <li>Start interacting to see patterns...</li>
                    </ul>
                </div>

                <div id="learningRecommendations" class="analysis-card">
                    <h3>Learning Recommendations</h3>
                    <ul id="learningList" class="insight-list">
                        <li>Generate insights to see recommendations...</li>
                    </ul>
                </div>

                <div id="sessionSummary" class="analysis-card">
                    <h3>Session Summary</h3>
                    <p id="sessionSummaryText">No active session</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global state
        let isRecording = false;
        let isPaused = false;
        let currentSession = null;
        let activeTab = 'sessions';
        let systemStatus = {
            llm: 'unknown',
            database: 'unknown',
            system: 'unknown'
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeEventListeners();
            checkSystemStatus();
            loadInitialData();
            startRealtimeUpdates();
        });

        function initializeEventListeners() {
            // Recording controls
            document.getElementById('recordBtn').addEventListener('click', toggleRecording);
            document.getElementById('pauseBtn').addEventListener('click', pauseRecording);
            document.getElementById('stopBtn').addEventListener('click', stopRecording);

            // Navigation controls
            document.getElementById('backBtn').addEventListener('click', () => history.back());
            document.getElementById('forwardBtn').addEventListener('click', () => history.forward());
            document.getElementById('refreshBtn').addEventListener('click', refreshPage);
            document.getElementById('goBtn').addEventListener('click', navigateToUrl);
            document.getElementById('analyzeBtn').addEventListener('click', analyzeCurrentPage);

            // URL input
            document.getElementById('urlInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    navigateToUrl();
                }
            });

            // Sidebar tabs
            document.querySelectorAll('.sidebar-tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    switchTab(this.dataset.tab);
                });
            });

            // Listen for IPC messages from main process
            if (window.electronAPI) {
                window.electronAPI.onRecordingStarted(handleRecordingStarted);
                window.electronAPI.onRecordingStopped(handleRecordingStopped);
                window.electronAPI.onInsightsGenerated(handleInsightsGenerated);
                window.electronAPI.onRealtimeInsights(handleRealtimeInsights);
            }
        }

        async function toggleRecording() {
            if (isRecording) {
                await stopRecording();
            } else {
                await startRecording();
            }
        }

        async function startRecording() {
            try {
                showNotification('Starting recording session...', 'info');
                
                // Call main process to start recording
                if (window.electronAPI) {
                    const result = await window.electronAPI.startRecording();
                    if (result) {
                        handleRecordingStarted(result);
                    }
                } else {
                    // Fallback for testing in browser
                    simulateRecordingStart();
                }
            } catch (error) {
                showNotification('Failed to start recording: ' + error.message, 'error');
            }
        }

        async function pauseRecording() {
            if (!isRecording || isPaused) return;

            try {
                // Call main process to pause recording
                if (window.electronAPI) {
                    await window.electronAPI.pauseRecording();
                }
                
                isPaused = true;
                updateRecordingUI();
                showNotification('Recording paused', 'warning');
            } catch (error) {
                showNotification('Failed to pause recording: ' + error.message, 'error');
            }
        }

        async function stopRecording() {
            if (!isRecording) return;

            try {
                showNotification('Stopping recording session...', 'info');
                
                // Call main process to stop recording
                if (window.electronAPI) {
                    const result = await window.electronAPI.stopRecording();
                    if (result) {
                        handleRecordingStopped(result);
                    }
                } else {
                    // Fallback for testing
                    simulateRecordingStop();
                }
            } catch (error) {
                showNotification('Failed to stop recording: ' + error.message, 'error');
            }
        }

        function handleRecordingStarted(session) {
            isRecording = true;
            isPaused = false;
            currentSession = session;
            updateRecordingUI();
            updateSessionSummary();
            showNotification('Recording started successfully!', 'success');
        }

        function handleRecordingStopped(result) {
            isRecording = false;
            isPaused = false;
            updateRecordingUI();
            updateSessionSummary();
            loadSessions(); // Refresh sessions list
            showNotification(`Recording saved: ${result.duration}ms`, 'success');
        }

        function handleInsightsGenerated(insights) {
            updateCurrentAnalysis(insights);
            incrementInsightCount();
        }

        function handleRealtimeInsights(insights) {
            updateRealtimeInsights(insights);
        }

        function updateRecordingUI() {
            const recordBtn = document.getElementById('recordBtn');
            const pauseBtn = document.getElementById('pauseBtn');
            const stopBtn = document.getElementById('stopBtn');
            const recordIcon = document.getElementById('recordIcon');
            const recordText = document.getElementById('recordText');

            if (isRecording) {
                recordBtn.classList.add('recording');
                recordIcon.textContent = '🔴';
                recordText.textContent = isPaused ? 'Resume' : 'Recording...';
                pauseBtn.classList.remove('disabled');
                stopBtn.classList.remove('disabled');
            } else {
                recordBtn.classList.remove('recording');
                recordIcon.textContent = '🎥';
                recordText.textContent = 'Start Recording';
                pauseBtn.classList.add('disabled');
                stopBtn.classList.add('disabled');
            }
        }

        async function navigateToUrl() {
            const urlInput = document.getElementById('urlInput');
            const url = urlInput.value.trim();
            
            if (!url) return;

            // Add protocol if missing
            let fullUrl = url;
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                // Check if it looks like a search query
                if (url.includes(' ') || !url.includes('.')) {
                    fullUrl = `https://www.google.com/search?q=${encodeURIComponent(url)}`;
                } else {
                    fullUrl = `https://${url}`;
                }
            }

            // Navigate iframe
            const browserFrame = document.getElementById('browserFrame');
            browserFrame.src = fullUrl;

            // Trigger analysis after navigation
            setTimeout(() => {
                analyzeCurrentPage(fullUrl);
            }, 2000);
        }

        function refreshPage() {
            const browserFrame = document.getElementById('browserFrame');
            browserFrame.src = browserFrame.src;
        }

        async function analyzeCurrentPage(url = null) {
            try {
                const currentUrl = url || document.getElementById('urlInput').value;
                if (!currentUrl) return;

                showNotification('Analyzing page content...', 'info');

                // Call main process to analyze content
                if (window.electronAPI) {
                    const result = await window.electronAPI.processUrl(currentUrl);
                    if (result) {
                        updateCurrentAnalysis(result.insights);
                    }
                } else {
                    // Fallback simulation
                    simulatePageAnalysis(currentUrl);
                }
            } catch (error) {
                showNotification('Analysis failed: ' + error.message, 'error');
            }
        }

        function switchTab(tabName) {
            // Update tab UI
            document.querySelectorAll('.sidebar-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

            // Show/hide content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(`${tabName}Tab`).classList.remove('hidden');

            activeTab = tabName;

            // Load tab-specific data
            switch (tabName) {
                case 'sessions':
                    loadSessions();
                    break;
                case 'content':
                    loadContentLibrary();
                    break;
                case 'patterns':
                    loadPatterns();
                    break;
            }
        }

        async function checkSystemStatus() {
            try {
                if (window.electronAPI) {
                    const status = await window.electronAPI.getSystemStatus();
                    updateSystemStatus(status);
                } else {
                    // Simulate status for testing
                    updateSystemStatus({
                        components: {
                            llmProcessor: 'online',
                            database: 'online',
                            recordingEngine: 'online'
                        }
                    });
                }
            } catch (error) {
                console.error('Failed to check system status:', error);
            }
        }

        function updateSystemStatus(status) {
            const llmStatus = document.getElementById('llmStatus');
            const dbStatus = document.getElementById('dbStatus');
            const systemStatus = document.getElementById('systemStatus');

            // Update LLM status
            if (status.components?.llmProcessor === 'online') {
                llmStatus.className = 'status-dot';
            } else {
                llmStatus.className = 'status-dot error';
            }

            // Update database status
            if (status.components?.database === 'online') {
                dbStatus.className = 'status-dot';
            } else {
                dbStatus.className = 'status-dot error';
            }

            // Update system status
            if (status.components?.recordingEngine === 'online') {
                systemStatus.className = 'status-dot';
            } else {
                systemStatus.className = 'status-dot error';
            }
        }

        async function loadInitialData() {
            await loadSessions();
            await loadContentLibrary();
            await loadPatterns();
            updateStats();
        }

        async function loadSessions() {
            // Simulate loading sessions
            const sessionsList = document.getElementById('sessionsList');
            sessionsList.innerHTML = '<div class="spinner"></div>';

            try {
                // In real implementation, this would call electronAPI
                const sessions = await simulateLoadSessions();
                displaySessions(sessions);
            } catch (error) {
                sessionsList.innerHTML = '<p>Failed to load sessions</p>';
            }
        }

        function displaySessions(sessions) {
            const sessionsList = document.getElementById('sessionsList');
            
            if (sessions.length === 0) {
                sessionsList.innerHTML = '<p style="color: var(--text-secondary); font-size: 12px;">No sessions yet. Start recording to create your first session.</p>';
                return;
            }

            sessionsList.innerHTML = sessions.map(session => `
                <div class="session-item" onclick="loadSession('${session.id}')">
                    <div class="session-title">Session ${session.id.slice(-6)}</div>
                    <div class="session-meta">
                        ${new Date(session.start_time).toLocaleDateString()} • 
                        ${session.duration ? Math.round(session.duration / 1000) + 's' : 'In progress'} • 
                        ${session.interaction_count || 0} interactions
                    </div>
                </div>
            `).join('');
        }

        async function loadContentLibrary() {
            const contentList = document.getElementById('contentList');
            contentList.innerHTML = '<div class="spinner"></div>';

            try {
                const content = await simulateLoadContent();
                displayContent(content);
            } catch (error) {
                contentList.innerHTML = '<p>Failed to load content</p>';
            }
        }

        function displayContent(content) {
            const contentList = document.getElementById('contentList');
            
            if (content.length === 0) {
                contentList.innerHTML = '<p style="color: var(--text-secondary); font-size: 12px;">No content analyzed yet. Visit websites or process videos to build your library.</p>';
                return;
            }

            contentList.innerHTML = content.map(item => `
                <div class="content-item" onclick="openContent('${item.url}')">
                    <div class="content-title">${item.title}</div>
                    <div class="content-meta">
                        ${item.type} • ${item.domain} • ${new Date(item.created_at).toLocaleDateString()}
                    </div>
                    <div class="content-insights">${item.insights || 'No insights yet'}</div>
                </div>
            `).join('');
        }

        async function loadPatterns() {
            const patternsList = document.getElementById('patternsList');
            patternsList.innerHTML = '<div class="spinner"></div>';

            try {
                const patterns = await simulateLoadPatterns();
                displayPatterns(patterns);
            } catch (error) {
                patternsList.innerHTML = '<p>Failed to load patterns</p>';
            }
        }

        function displayPatterns(patterns) {
            const patternsList = document.getElementById('patternsList');
            
            if (patterns.length === 0) {
                patternsList.innerHTML = '<p style="color: var(--text-secondary); font-size: 12px;">No patterns detected yet. Use the browser to build behavioral insights.</p>';
                return;
            }

            patternsList.innerHTML = patterns.map(pattern => `
                <div class="session-item">
                    <div class="session-title">${pattern.pattern_name}</div>
                    <div class="session-meta">
                        ${pattern.type} • Frequency: ${pattern.frequency} • ${pattern.significance}
                    </div>
                </div>
            `).join('');
        }

        function updateCurrentAnalysis(insights) {
            const analysisCard = document.getElementById('currentAnalysis');
            
            if (insights && insights.length > 0) {
                analysisCard.innerHTML = `
                    <h3>Current Page Analysis</h3>
                    <ul class="insight-list">
                        ${insights.map(insight => `<li>${insight}</li>`).join('')}
                    </ul>
                `;
            } else {
                analysisCard.innerHTML = `
                    <h3>Current Page Analysis</h3>
                    <p>No insights available for current page.</p>
                `;
            }
        }

        function updateRealtimeInsights(insights) {
            const realtimeList = document.getElementById('realtimeList');
            
            if (insights && insights.length > 0) {
                realtimeList.innerHTML = insights.map(insight => `<li>${insight}</li>`).join('');
            }
        }

        function updateSessionSummary() {
            const summaryText = document.getElementById('sessionSummaryText');
            
            if (currentSession && isRecording) {
                const duration = Date.now() - currentSession.startTime;
                summaryText.textContent = `Active session: ${Math.round(duration / 1000)}s elapsed`;
            } else {
                summaryText.textContent = 'No active session';
            }
        }

        function updateStats() {
            // Update various counters
            document.getElementById('sessionCount').textContent = Math.floor(Math.random() * 10);
            document.getElementById('interactionCount').textContent = Math.floor(Math.random() * 100);
            document.getElementById('videoCount').textContent = Math.floor(Math.random() * 5);
            document.getElementById('podcastCount').textContent = Math.floor(Math.random() * 3);
            document.getElementById('insightCount').textContent = Math.floor(Math.random() * 25);
            document.getElementById('confidenceScore').textContent = Math.floor(Math.random() * 100) + '%';
        }

        function incrementInsightCount() {
            const insightCount = document.getElementById('insightCount');
            insightCount.textContent = parseInt(insightCount.textContent) + 1;
        }

        function startRealtimeUpdates() {
            // Update session summary every second when recording
            setInterval(() => {
                if (isRecording && currentSession) {
                    updateSessionSummary();
                }
            }, 1000);

            // Check system status every 30 seconds
            setInterval(checkSystemStatus, 30000);
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 4px;">${type.toUpperCase()}</div>
                <div>${message}</div>
            `;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        // Simulation functions for testing without Electron
        function simulateRecordingStart() {
            currentSession = {
                id: 'session_' + Date.now(),
                startTime: Date.now()
            };
            handleRecordingStarted(currentSession);
        }

        function simulateRecordingStop() {
            if (currentSession) {
                handleRecordingStopped({
                    sessionId: currentSession.id,
                    duration: Date.now() - currentSession.startTime,
                    interactionCount: Math.floor(Math.random() * 50)
                });
            }
        }

        function simulatePageAnalysis(url) {
            const insights = [
                'Technical documentation detected',
                'High learning value content',
                'Code examples present',
                'Related to web development'
            ];
            handleInsightsGenerated(insights);
        }

        async function simulateLoadSessions() {
            return Array.from({ length: 5 }, (_, i) => ({
                id: `session_${Date.now() - i * 100000}`,
                start_time: Date.now() - i * 100000,
                duration: 60000 + Math.random() * 300000,
                interaction_count: Math.floor(Math.random() * 50)
            }));
        }

        async function simulateLoadContent() {
            return [
                {
                    title: 'React Documentation',
                    type: 'webpage',
                    domain: 'react.dev',
                    url: 'https://react.dev',
                    created_at: Date.now() - 86400000,
                    insights: 'Component architecture, hooks, best practices'
                },
                {
                    title: 'JavaScript Tutorial',
                    type: 'video',
                    domain: 'youtube.com',
                    url: 'https://youtube.com/watch?v=example',
                    created_at: Date.now() - 172800000,
                    insights: 'ES6 features, async/await, modern syntax'
                }
            ];
        }

        async function simulateLoadPatterns() {
            return [
                {
                    pattern_name: 'Documentation Reading',
                    type: 'learning',
                    frequency: 15,
                    significance: 'high'
                },
                {
                    pattern_name: 'Code Copying',
                    type: 'behavior',
                    frequency: 8,
                    significance: 'medium'
                }
            ];
        }

        // Utility functions
        function loadSession(sessionId) {
            console.log('Loading session:', sessionId);
            // Implementation for loading specific session
        }

        function openContent(url) {
            document.getElementById('urlInput').value = url;
            navigateToUrl();
        }
    </script>
</body>
</html>