<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü§ñüëÅÔ∏è AI Reasoning Watcher - Live Context Stream</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Code', monospace;
            background: linear-gradient(135deg, #0a0a0a, #1a1a2e, #16213e);
            color: #00ff41;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .header {
            background: rgba(0, 0, 0, 0.9);
            border-bottom: 2px solid #00ff41;
            padding: 20px;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        
        .header h1 {
            font-size: 28px;
            text-shadow: 0 0 20px #00ff41;
            margin-bottom: 5px;
        }
        
        .header p {
            color: #00ffff;
            font-size: 14px;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: 1fr 400px;
            height: calc(100vh - 80px);
            gap: 20px;
            padding: 20px;
        }
        
        .main-stream {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .context-panel {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #00ff41;
            border-radius: 15px;
            padding: 20px;
            overflow-y: auto;
        }
        
        .live-reasoning {
            flex: 1;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #00ffff;
            border-radius: 15px;
            padding: 20px;
            overflow-y: auto;
            position: relative;
        }
        
        .reasoning-entry {
            background: rgba(0, 255, 65, 0.05);
            border-left: 4px solid;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 0 10px 10px 0;
            transition: all 0.3s;
            position: relative;
        }
        
        .reasoning-entry:hover {
            background: rgba(0, 255, 65, 0.1);
            transform: translateX(5px);
        }
        
        .reasoning-entry.thought {
            border-left-color: #00ffff;
        }
        
        .reasoning-entry.action {
            border-left-color: #ff0040;
        }
        
        .reasoning-entry.exploration {
            border-left-color: #ff00ff;
        }
        
        .reasoning-entry.discovery {
            border-left-color: #00ff00;
        }
        
        .reasoning-entry.emotion {
            border-left-color: #ffff00;
        }
        
        .reasoning-entry.new {
            animation: slideIn 0.5s ease-out;
            box-shadow: 0 0 20px rgba(0, 255, 65, 0.3);
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-30px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        .entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .entry-type {
            font-weight: bold;
            font-size: 12px;
            text-transform: uppercase;
            padding: 3px 8px;
            border-radius: 12px;
            background: rgba(0, 0, 0, 0.5);
        }
        
        .entry-time {
            font-size: 11px;
            color: #888;
        }
        
        .entry-text {
            font-size: 14px;
            line-height: 1.4;
            color: #fff;
        }
        
        .ai-context-summary {
            background: rgba(0, 255, 255, 0.1);
            border: 2px solid #00ffff;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .context-actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .context-button {
            background: linear-gradient(45deg, #00ff41, #00ff88);
            color: #000;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            font-family: inherit;
        }
        
        .context-button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(0, 255, 65, 0.5);
        }
        
        .context-button.secondary {
            background: linear-gradient(45deg, #00ffff, #00bbff);
        }
        
        .copyable-context {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #00ff41;
            border-radius: 5px;
            padding: 15px;
            font-size: 12px;
            color: #00ff41;
            white-space: pre-wrap;
            overflow-y: auto;
            max-height: 300px;
            margin-bottom: 15px;
            cursor: text;
            user-select: all;
        }
        
        .status-indicators {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #ff0000;
            transition: all 0.3s;
        }
        
        .status-dot.active {
            background: #00ff41;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }
        
        .pattern-analysis {
            background: rgba(255, 255, 0, 0.1);
            border: 2px solid #ffff00;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .pattern-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 12px;
        }
        
        .pattern-bar {
            width: 100px;
            height: 4px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            overflow: hidden;
            margin-left: 10px;
        }
        
        .pattern-fill {
            height: 100%;
            background: #ffff00;
            transition: width 0.5s ease;
        }
        
        .ai-suggestions {
            background: rgba(255, 0, 255, 0.1);
            border: 2px solid #ff00ff;
            border-radius: 10px;
            padding: 15px;
        }
        
        .suggestion {
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 10px;
            font-size: 12px;
            border-left: 3px solid #ff00ff;
        }
        
        .suggestion-type {
            font-weight: bold;
            color: #ff00ff;
            margin-bottom: 5px;
        }
        
        .floating-help {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid #00ff41;
            padding: 15px;
            border-radius: 10px;
            max-width: 300px;
            font-size: 12px;
            z-index: 1000;
        }
        
        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #00ff41;
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 1000;
        }
        
        .stream-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .control-select {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid #00ff41;
            color: #00ff41;
            padding: 5px;
            border-radius: 3px;
            font-family: inherit;
        }
        
        .notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 255, 65, 0.9);
            color: #000;
            padding: 20px 30px;
            border-radius: 10px;
            font-weight: bold;
            z-index: 9999;
            display: none;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .stat-box {
            background: rgba(0, 255, 65, 0.1);
            border: 1px solid #00ff41;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: #00ff41;
        }
        
        .stat-label {
            font-size: 11px;
            color: #888;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ü§ñüëÅÔ∏è AI Reasoning Watcher</h1>
        <p>Real-time human reasoning stream for AI context awareness</p>
    </div>
    
    <div class="connection-status" id="connectionStatus">
        <span class="status-dot" id="statusDot"></span>
        <span id="statusText">Connecting...</span>
    </div>
    
    <div class="dashboard">
        <div class="main-stream">
            <div class="live-reasoning">
                <div class="stream-controls">
                    <select class="control-select" id="filterType">
                        <option value="all">All Types</option>
                        <option value="thought">Thoughts</option>
                        <option value="action">Actions</option>
                        <option value="exploration">Exploration</option>
                        <option value="discovery">Discoveries</option>
                    </select>
                    
                    <select class="control-select" id="timeFilter">
                        <option value="live">Live Stream</option>
                        <option value="1m">Last 1 minute</option>
                        <option value="5m">Last 5 minutes</option>
                        <option value="15m">Last 15 minutes</option>
                    </select>
                    
                    <button class="context-button" onclick="togglePause()">
                        <span id="pauseText">‚è∏Ô∏è Pause</span>
                    </button>
                </div>
                
                <div id="reasoningStream">
                    <div style="text-align: center; color: #666; padding: 50px;">
                        <p>üîç Watching for reasoning activity...</p>
                        <p style="font-size: 12px; margin-top: 10px;">Make sure reasoning-viz-manager.js is running</p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="context-panel">
            <h3 style="color: #00ff41; margin-bottom: 15px;">ü§ñ AI Context</h3>
            
            <div class="status-indicators">
                <div class="status-indicator">
                    <div class="status-dot" id="reasoningStatus"></div>
                    <span>Reasoning Stream</span>
                </div>
                <div class="status-indicator">
                    <div class="status-dot" id="aiStatus"></div>
                    <span>AI Bridge</span>
                </div>
            </div>
            
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-value" id="totalEntries">0</div>
                    <div class="stat-label">Total Entries</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="entriesPerMin">0</div>
                    <div class="stat-label">Per Minute</div>
                </div>
            </div>
            
            <div class="context-actions">
                <button class="context-button" onclick="generateContext()">
                    üìã Copy Context
                </button>
                <button class="context-button secondary" onclick="refreshContext()">
                    üîÑ Refresh
                </button>
            </div>
            
            <div class="ai-context-summary" id="contextSummary">
                <h4 style="color: #00ffff; margin-bottom: 10px;">üìä Current Context</h4>
                <p style="color: #ccc; font-size: 12px;">Generating context summary...</p>
            </div>
            
            <div class="copyable-context" id="copyableContext" style="display: none;">
                <!-- Copyable context will appear here -->
            </div>
            
            <div class="pattern-analysis">
                <h4 style="color: #ffff00; margin-bottom: 10px;">üß† Pattern Analysis</h4>
                <div id="patternsList">
                    <!-- Pattern analysis will appear here -->
                </div>
            </div>
            
            <div class="ai-suggestions">
                <h4 style="color: #ff00ff; margin-bottom: 10px;">üí° AI Suggestions</h4>
                <div id="suggestionsList">
                    <p style="color: #ccc; font-size: 12px;">Analyzing patterns for suggestions...</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification"></div>
    
    <div class="floating-help">
        <strong>ü§ñ AI Watcher Help:</strong><br>
        ‚Ä¢ This shows your reasoning in real-time<br>
        ‚Ä¢ Copy context to share with AIs<br>
        ‚Ä¢ Pattern analysis helps AIs understand your focus<br>
        ‚Ä¢ Green = new entries, hover for details
    </div>
    
    <script>
        class AIReasoningWatcher {
            constructor() {
                this.ws = null;
                this.entries = [];
                this.paused = false;
                this.totalEntries = 0;
                this.lastMinuteEntries = 0;
                this.currentContext = null;
                
                this.filters = {
                    type: 'all',
                    timeframe: 'live'
                };
                
                this.init();
            }
            
            init() {
                this.connectWebSocket();
                this.setupEventListeners();
                this.startStatsUpdater();
                this.loadInitialContext();
                
                console.log('ü§ñüëÅÔ∏è AI Reasoning Watcher initialized');
            }
            
            connectWebSocket() {
                const protocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
                this.ws = new WebSocket(`${protocol}//${location.host}?ai=true`);
                
                this.ws.onopen = () => {
                    this.updateConnectionStatus('connected');
                    document.getElementById('reasoningStatus').classList.add('active');
                };
                
                this.ws.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    this.handleMessage(data);
                };
                
                this.ws.onclose = () => {
                    this.updateConnectionStatus('disconnected');
                    document.getElementById('reasoningStatus').classList.remove('active');
                    
                    // Reconnect after 5 seconds
                    setTimeout(() => this.connectWebSocket(), 5000);
                };
                
                this.ws.onerror = (error) => {
                    console.error('WebSocket error:', error);
                    this.updateConnectionStatus('error');
                };
            }
            
            handleMessage(data) {
                switch (data.type) {
                    case 'initial-context':
                        this.entries = data.data || [];
                        this.renderEntries();
                        break;
                    
                    case 'new-entries':
                        if (!this.paused) {
                            data.data.forEach(entry => {
                                this.entries.push(entry);
                                this.totalEntries++;
                                this.lastMinuteEntries++;
                            });
                            
                            // Keep entries manageable
                            if (this.entries.length > 200) {
                                this.entries = this.entries.slice(-100);
                            }
                            
                            this.renderEntries();
                        }
                        break;
                        
                    case 'context-response':
                        this.currentContext = data.data;
                        this.updateContextDisplay();
                        break;
                }
            }
            
            renderEntries() {
                const stream = document.getElementById('reasoningStream');
                
                // Filter entries
                let filteredEntries = this.entries;
                
                if (this.filters.type !== 'all') {
                    filteredEntries = filteredEntries.filter(entry => entry.type === this.filters.type);
                }
                
                if (this.filters.timeframe !== 'live') {
                    const cutoff = this.getTimeframeCutoff(this.filters.timeframe);
                    filteredEntries = filteredEntries.filter(entry => 
                        new Date(entry.timestamp) >= cutoff
                    );
                }
                
                // Clear and render
                stream.innerHTML = '';
                
                if (filteredEntries.length === 0) {
                    stream.innerHTML = `
                        <div style="text-align: center; color: #666; padding: 50px;">
                            <p>üîç No entries match current filters</p>
                        </div>
                    `;
                    return;
                }
                
                filteredEntries.slice(-50).forEach(entry => {
                    const entryElement = this.createEntryElement(entry);
                    stream.appendChild(entryElement);
                });
                
                // Auto-scroll to bottom
                stream.scrollTop = stream.scrollHeight;
            }
            
            createEntryElement(entry) {
                const div = document.createElement('div');
                div.className = `reasoning-entry ${entry.type}`;
                
                const time = new Date(entry.timestamp).toLocaleTimeString();
                const emoji = this.getTypeEmoji(entry.type);
                
                div.innerHTML = `
                    <div class="entry-header">
                        <span class="entry-type">${emoji} ${entry.type}</span>
                        <span class="entry-time">${time}</span>
                    </div>
                    <div class="entry-text">${entry.text}</div>
                `;
                
                // Add new entry animation
                if (Date.now() - new Date(entry.timestamp).getTime() < 10000) {
                    div.classList.add('new');
                    setTimeout(() => div.classList.remove('new'), 500);
                }
                
                return div;
            }
            
            getTypeEmoji(type) {
                const emojis = {
                    thought: 'üí≠',
                    action: 'üî¥',
                    exploration: 'üü£',
                    reasoning: 'üîµ',
                    discovery: 'üü¢',
                    emotion: 'üü°',
                    system: '‚öôÔ∏è'
                };
                return emojis[type] || 'üìù';
            }
            
            async loadInitialContext() {
                try {
                    const response = await fetch('/api/ai/context?format=summary');
                    const data = await response.json();
                    
                    if (data.success) {
                        document.getElementById('contextSummary').innerHTML = `
                            <h4 style="color: #00ffff; margin-bottom: 10px;">üìä Current Context</h4>
                            <div style="font-size: 12px; color: #ccc; white-space: pre-wrap;">${data.context}</div>
                        `;
                    }
                    
                    document.getElementById('aiStatus').classList.add('active');
                } catch (error) {
                    console.error('Failed to load context:', error);
                }
            }
            
            async generateContext() {
                try {
                    const response = await fetch('/api/ai/copyable-context?entries=10&style=structured');
                    const data = await response.json();
                    
                    if (data.success) {
                        const contextDiv = document.getElementById('copyableContext');
                        contextDiv.textContent = data.context;
                        contextDiv.style.display = 'block';
                        
                        // Copy to clipboard
                        await navigator.clipboard.writeText(data.context);
                        this.showNotification('Context copied to clipboard!');
                        
                        // Also show instructions
                        setTimeout(() => {
                            this.showNotification(data.instructions, 5000);
                        }, 2000);
                    }
                } catch (error) {
                    console.error('Failed to generate context:', error);
                    this.showNotification('Failed to generate context', 3000);
                }
            }
            
            async refreshContext() {
                await this.loadInitialContext();
                await this.loadPatternAnalysis();
                this.showNotification('Context refreshed');
            }
            
            async loadPatternAnalysis() {
                try {
                    const response = await fetch('/api/ai/patterns');
                    const data = await response.json();
                    
                    if (data.success) {
                        this.updatePatternDisplay(data.patterns);
                        this.updateSuggestionsDisplay(data.suggestions);
                    }
                } catch (error) {
                    console.error('Failed to load patterns:', error);
                }
            }
            
            updatePatternDisplay(patterns) {
                const patternsList = document.getElementById('patternsList');
                patternsList.innerHTML = '';
                
                Object.entries(patterns).forEach(([pattern, data]) => {
                    const patternDiv = document.createElement('div');
                    patternDiv.className = 'pattern-item';
                    patternDiv.innerHTML = `
                        <span>${pattern}:</span>
                        <span>${data.percentage.toFixed(1)}%</span>
                        <div class="pattern-bar">
                            <div class="pattern-fill" style="width: ${data.percentage}%"></div>
                        </div>
                    `;
                    patternsList.appendChild(patternDiv);
                });
            }
            
            updateSuggestionsDisplay(suggestions) {
                const suggestionsList = document.getElementById('suggestionsList');
                
                if (suggestions.length === 0) {
                    suggestionsList.innerHTML = '<p style="color: #ccc; font-size: 12px;">No specific suggestions at this time.</p>';
                    return;
                }
                
                suggestionsList.innerHTML = '';
                suggestions.forEach(suggestion => {
                    const suggestionDiv = document.createElement('div');
                    suggestionDiv.className = 'suggestion';
                    suggestionDiv.innerHTML = `
                        <div class="suggestion-type">${suggestion.type.toUpperCase()}</div>
                        <div>${suggestion.message}</div>
                    `;
                    suggestionsList.appendChild(suggestionDiv);
                });
            }
            
            updateConnectionStatus(status) {
                const statusDot = document.getElementById('statusDot');
                const statusText = document.getElementById('statusText');
                
                switch (status) {
                    case 'connected':
                        statusDot.classList.add('active');
                        statusText.textContent = 'Connected';
                        break;
                    case 'disconnected':
                        statusDot.classList.remove('active');
                        statusText.textContent = 'Reconnecting...';
                        break;
                    case 'error':
                        statusDot.classList.remove('active');
                        statusText.textContent = 'Error';
                        break;
                }
            }
            
            setupEventListeners() {
                document.getElementById('filterType').addEventListener('change', (e) => {
                    this.filters.type = e.target.value;
                    this.renderEntries();
                });
                
                document.getElementById('timeFilter').addEventListener('change', (e) => {
                    this.filters.timeframe = e.target.value;
                    this.renderEntries();
                });
            }
            
            togglePause() {
                this.paused = !this.paused;
                const pauseText = document.getElementById('pauseText');
                pauseText.textContent = this.paused ? '‚ñ∂Ô∏è Resume' : '‚è∏Ô∏è Pause';
            }
            
            startStatsUpdater() {
                setInterval(() => {
                    document.getElementById('totalEntries').textContent = this.totalEntries;
                    
                    // Reset per-minute counter
                    document.getElementById('entriesPerMin').textContent = this.lastMinuteEntries;
                    this.lastMinuteEntries = 0;
                }, 60000);
                
                // Update every 5 seconds for more responsive feel
                setInterval(() => {
                    document.getElementById('totalEntries').textContent = this.totalEntries;
                }, 5000);
            }
            
            getTimeframeCutoff(timeframe) {
                const now = new Date();
                const cutoffs = {
                    '1m': 1 * 60 * 1000,
                    '5m': 5 * 60 * 1000,
                    '15m': 15 * 60 * 1000
                };
                
                const offset = cutoffs[timeframe] || 0;
                return new Date(now.getTime() - offset);
            }
            
            showNotification(message, duration = 2000) {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.style.display = 'block';
                
                setTimeout(() => {
                    notification.style.display = 'none';
                }, duration);
            }
        }
        
        // Global functions
        function togglePause() {
            window.watcher.togglePause();
        }
        
        function generateContext() {
            window.watcher.generateContext();
        }
        
        function refreshContext() {
            window.watcher.refreshContext();
        }
        
        // Initialize watcher
        window.addEventListener('load', () => {
            window.watcher = new AIReasoningWatcher();
        });
        
        console.log('ü§ñüëÅÔ∏è AI REASONING WATCHER');
        console.log('=========================');
        console.log('üëÅÔ∏è Now AIs can see your reasoning in real-time');
        console.log('üìã Copy context for better AI conversations');
        console.log('üß† Pattern analysis helps AIs understand your focus');
    </script>
</body>
</html>