<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Production Kubernetes Infrastructure</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0a0a;
            color: #e0e0e0;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-content h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-content p {
            color: #b0b0b0;
            font-size: 1.1em;
        }

        .header-actions {
            display: flex;
            gap: 15px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.5);
        }

        .btn.secondary {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn.danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .main-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: #1a1a2e;
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .status-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .status-item h3 {
            color: #b0b0b0;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .status-item .value {
            color: #667eea;
            font-size: 2em;
            font-weight: bold;
        }

        .status-item .unit {
            color: #b0b0b0;
            font-size: 0.8em;
        }

        .agent-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .agent-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .agent-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: #667eea;
        }

        .agent-info h4 {
            color: #e0e0e0;
            margin-bottom: 5px;
        }

        .agent-info p {
            color: #b0b0b0;
            font-size: 0.9em;
        }

        .agent-status {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .status-badge.running {
            background: rgba(74, 222, 128, 0.2);
            color: #4ade80;
        }

        .status-badge.pending {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
        }

        .status-badge.failed {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }

        .service-mesh {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .service-node {
            background: rgba(102, 126, 234, 0.1);
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            position: relative;
            transition: all 0.3s ease;
        }

        .service-node:hover {
            background: rgba(102, 126, 234, 0.2);
            transform: scale(1.05);
        }

        .service-node h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .service-node .metrics {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
            font-size: 0.9em;
        }

        .service-node .metrics span {
            color: #b0b0b0;
        }

        .circuit-breaker {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4ade80;
        }

        .circuit-breaker.open {
            background: #ef4444;
        }

        .circuit-breaker.half-open {
            background: #fbbf24;
        }

        .pulse-monitor {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .pulse-status {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 15px;
        }

        .pulse-indicator {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #4ade80;
            animation: pulse 2s infinite;
        }

        .pulse-indicator.warning {
            background: #fbbf24;
        }

        .pulse-indicator.error {
            background: #ef4444;
            animation: none;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(74, 222, 128, 0.7);
            }
            70% {
                box-shadow: 0 0 0 20px rgba(74, 222, 128, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(74, 222, 128, 0);
            }
        }

        .drift-events {
            max-height: 200px;
            overflow-y: auto;
        }

        .drift-event {
            background: rgba(255, 255, 255, 0.03);
            border-left: 3px solid #ef4444;
            padding: 10px;
            margin-bottom: 10px;
            font-size: 0.9em;
        }

        .drift-event.low {
            border-color: #fbbf24;
        }

        .drift-event.medium {
            border-color: #f97316;
        }

        .infrastructure-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .infra-resource {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .infra-resource h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .infra-resource .status {
            color: #4ade80;
            font-weight: bold;
        }

        .infra-resource .status.unhealthy {
            color: #ef4444;
        }

        .container-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
        }

        .container-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
        }

        .container-item h4 {
            color: #e0e0e0;
            margin-bottom: 10px;
        }

        .container-info {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 10px;
            font-size: 0.9em;
        }

        .container-info span:first-child {
            color: #b0b0b0;
        }

        .container-info span:last-child {
            color: #e0e0e0;
        }

        .actions-bar {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .deploy-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .form-group label {
            color: #b0b0b0;
            font-size: 0.9em;
        }

        .form-group input,
        .form-group select {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 10px;
            color: #e0e0e0;
            font-size: 1em;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            background: rgba(255, 255, 255, 0.1);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #b0b0b0;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #1a1a2e;
            border: 1px solid #667eea;
            border-radius: 10px;
            padding: 15px 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            max-width: 300px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            border-color: #4ade80;
        }

        .notification.error {
            border-color: #ef4444;
        }

        .cost-display {
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
        }

        .cost-display h3 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .cost-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #e0e0e0;
        }

        .cost-trend {
            color: #b0b0b0;
            font-size: 0.9em;
            margin-top: 10px;
        }

        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                gap: 20px;
            }

            .header-actions {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <h1>Production Kubernetes Infrastructure</h1>
                <p>Cal-Kubernetes Orchestrator ‚Ä¢ Service Mesh ‚Ä¢ Pulse Monitoring ‚Ä¢ Cloud Infrastructure</p>
            </div>
            <div class="header-actions">
                <button class="btn secondary" onclick="refreshAll()">üîÑ Refresh</button>
                <button class="btn" onclick="showDeployModal()">üöÄ Deploy Service</button>
                <button class="btn danger" onclick="emergencyShutdown()">üö® Emergency Stop</button>
            </div>
        </div>

        <!-- Actions Bar -->
        <div class="actions-bar">
            <button class="btn secondary" onclick="deployAllServices()">Deploy All Services</button>
            <button class="btn secondary" onclick="healthCheckAll()">Health Check All</button>
            <button class="btn secondary" onclick="autoScale()">Auto Scale</button>
            <button class="btn secondary" onclick="viewLogs()">View Logs</button>
            <button class="btn secondary" onclick="exportMetrics()">Export Metrics</button>
        </div>

        <!-- Status Overview -->
        <div class="card">
            <h2>üìä Cluster Overview</h2>
            <div class="status-grid">
                <div class="status-item">
                    <h3>Total Agents</h3>
                    <div class="value" id="totalAgents">0</div>
                </div>
                <div class="status-item">
                    <h3>Active Services</h3>
                    <div class="value" id="activeServices">0</div>
                </div>
                <div class="status-item">
                    <h3>Port Usage</h3>
                    <div class="value" id="portUsage">0<span class="unit">%</span></div>
                </div>
                <div class="status-item">
                    <h3>System Health</h3>
                    <div class="value" id="systemHealth" style="color: #4ade80;">Healthy</div>
                </div>
                <div class="status-item">
                    <h3>Uptime</h3>
                    <div class="value" id="uptime">0<span class="unit">h</span></div>
                </div>
                <div class="status-item">
                    <h3>Network I/O</h3>
                    <div class="value" id="networkIO">0<span class="unit">MB/s</span></div>
                </div>
            </div>
        </div>

        <div class="main-grid">
            <!-- Agent Registry -->
            <div class="card">
                <h2>ü§ñ Agent Registry</h2>
                <div class="agent-list" id="agentList">
                    <div class="loading active">
                        <div class="spinner"></div>
                        <p>Loading agents...</p>
                    </div>
                </div>
            </div>

            <!-- Service Mesh Topology -->
            <div class="card">
                <h2>üï∏Ô∏è Service Mesh</h2>
                <div class="service-mesh" id="serviceMesh">
                    <div class="loading active">
                        <div class="spinner"></div>
                        <p>Loading service mesh...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pulse Monitoring -->
        <div class="card">
            <h2>üíó Pulse Monitoring</h2>
            <div class="pulse-monitor">
                <div class="pulse-status">
                    <div class="pulse-indicator" id="pulseIndicator"></div>
                    <div>
                        <h3>System Pulse</h3>
                        <p id="pulseMessage">Monitoring system health...</p>
                    </div>
                </div>
                <div class="drift-events" id="driftEvents">
                    <p style="color: #b0b0b0; text-align: center;">No drift events detected</p>
                </div>
            </div>
        </div>

        <div class="main-grid">
            <!-- Container Management -->
            <div class="card">
                <h2>üì¶ Docker Containers</h2>
                <div class="container-list" id="containerList">
                    <div class="loading active">
                        <div class="spinner"></div>
                        <p>Loading containers...</p>
                    </div>
                </div>
            </div>

            <!-- Infrastructure Resources -->
            <div class="card">
                <h2>‚òÅÔ∏è Infrastructure</h2>
                <div class="infrastructure-grid" id="infrastructureGrid">
                    <div class="loading active">
                        <div class="spinner"></div>
                        <p>Loading infrastructure...</p>
                    </div>
                </div>
                <div class="cost-display" style="margin-top: 20px;">
                    <h3>Monthly Cost</h3>
                    <div class="cost-value" id="monthlyCost">$0.00</div>
                    <div class="cost-trend" id="costTrend">Projected: $0.00</div>
                </div>
            </div>
        </div>

        <!-- Performance Metrics -->
        <div class="card">
            <h2>üìà Performance Metrics</h2>
            <div class="status-grid">
                <div class="status-item">
                    <h3>CPU Usage</h3>
                    <div class="value" id="cpuUsage">0<span class="unit">%</span></div>
                </div>
                <div class="status-item">
                    <h3>Memory Usage</h3>
                    <div class="value" id="memoryUsage">0<span class="unit">%</span></div>
                </div>
                <div class="status-item">
                    <h3>Disk I/O</h3>
                    <div class="value" id="diskIO">0<span class="unit">MB/s</span></div>
                </div>
                <div class="status-item">
                    <h3>Request Rate</h3>
                    <div class="value" id="requestRate">0<span class="unit">/s</span></div>
                </div>
                <div class="status-item">
                    <h3>Error Rate</h3>
                    <div class="value" id="errorRate">0<span class="unit">%</span></div>
                </div>
                <div class="status-item">
                    <h3>Response Time</h3>
                    <div class="value" id="responseTime">0<span class="unit">ms</span></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <script>
        let ws = null;

        // Initialize WebSocket connection
        function initWebSocket() {
            ws = new WebSocket('ws://localhost:8081');
            
            ws.onopen = () => {
                console.log('WebSocket connected');
                ws.send(JSON.stringify({
                    type: 'subscribe',
                    channels: ['cluster_updates', 'service_mesh', 'pulse_monitoring', 'infrastructure']
                }));
            };

            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                handleWebSocketMessage(data);
            };

            ws.onclose = () => {
                console.log('WebSocket disconnected');
                setTimeout(initWebSocket, 5000); // Reconnect after 5 seconds
            };

            ws.onerror = (error) => {
                console.error('WebSocket error:', error);
            };
        }

        function handleWebSocketMessage(data) {
            switch (data.type) {
                case 'cluster_status_update':
                    updateClusterOverview();
                    break;
                case 'service_deployed':
                    showNotification(`Service ${data.serviceName} deployed successfully`, 'success');
                    loadAgents();
                    loadServices();
                    break;
                case 'agent_terminated':
                    showNotification(`Agent ${data.agentId} terminated`, 'error');
                    loadAgents();
                    break;
                case 'service_scaled':
                    showNotification(`Service ${data.serviceName} scaled to ${data.replicas} replicas`, 'success');
                    loadAgents();
                    break;
                case 'drift_detected':
                    updateDriftEvents();
                    break;
                case 'infrastructure_deployment_started':
                    showNotification('Infrastructure deployment started', 'success');
                    break;
            }
        }

        // Load cluster overview
        async function updateClusterOverview() {
            try {
                const response = await fetch('/api/k8s/cluster/status');
                const data = await response.json();
                
                if (data.success && data.cluster) {
                    document.getElementById('totalAgents').innerHTML = data.cluster.agents.length;
                    document.getElementById('activeServices').innerHTML = Object.keys(data.cluster.services).length;
                    
                    // Calculate port usage
                    const totalPorts = 1000; // 8000-9000
                    const usedPorts = data.cluster.agents.length;
                    const portUsage = Math.round((usedPorts / totalPorts) * 100);
                    document.getElementById('portUsage').innerHTML = `${portUsage}<span class="unit">%</span>`;
                }
            } catch (error) {
                console.error('Error loading cluster overview:', error);
            }
        }

        // Load agents
        async function loadAgents() {
            try {
                const response = await fetch('/api/k8s/agents');
                const data = await response.json();
                
                if (data.success) {
                    displayAgents(data.agents);
                }
            } catch (error) {
                console.error('Error loading agents:', error);
                document.getElementById('agentList').innerHTML = '<p style="color: #ef4444;">Failed to load agents</p>';
            }
        }

        function displayAgents(agents) {
            const container = document.getElementById('agentList');
            
            if (agents.length === 0) {
                container.innerHTML = '<p style="color: #b0b0b0; text-align: center;">No agents running</p>';
                return;
            }

            container.innerHTML = agents.map(agent => `
                <div class="agent-item">
                    <div class="agent-info">
                        <h4>${agent.serviceName}</h4>
                        <p>Port: ${agent.port} | Tier: ${agent.tier || 'default'}</p>
                        <p>Uptime: ${formatUptime(agent.uptime)}</p>
                    </div>
                    <div class="agent-status">
                        <span class="status-badge ${agent.status}">${agent.status}</span>
                        <button class="btn secondary" style="padding: 5px 10px; font-size: 0.9em;" onclick="terminateAgent('${agent.id}')">
                            Terminate
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Load services
        async function loadServices() {
            try {
                const response = await fetch('/api/k8s/services');
                const data = await response.json();
                
                if (data.success) {
                    displayServices(data.services);
                }
            } catch (error) {
                console.error('Error loading services:', error);
            }
        }

        function displayServices(services) {
            const container = document.getElementById('serviceMesh');
            
            if (Object.keys(services).length === 0) {
                container.innerHTML = '<p style="color: #b0b0b0; text-align: center;">No services discovered</p>';
                return;
            }

            container.innerHTML = Object.entries(services).map(([name, service]) => `
                <div class="service-node">
                    <div class="circuit-breaker ${service.circuitState || 'closed'}"></div>
                    <h4>${name}</h4>
                    <p>${service.endpoint || `${service.host}:${service.port}`}</p>
                    <div class="metrics">
                        <span>Health: ${service.healthy ? '‚úÖ' : '‚ùå'}</span>
                        <span>Tier: ${service.tier || 'default'}</span>
                    </div>
                </div>
            `).join('');
        }

        // Load pulse status
        async function loadPulseStatus() {
            try {
                const response = await fetch('/api/k8s/pulse');
                const data = await response.json();
                
                if (data.success && data.pulse) {
                    updatePulseDisplay(data.pulse);
                }
            } catch (error) {
                console.error('Error loading pulse status:', error);
            }
        }

        function updatePulseDisplay(pulse) {
            const indicator = document.getElementById('pulseIndicator');
            const message = document.getElementById('pulseMessage');
            
            if (pulse.driftDetected) {
                indicator.className = 'pulse-indicator error';
                message.textContent = 'Drift detected - system may be unstable';
            } else if (!pulse.reflectionAlive || !pulse.qrIntegrity) {
                indicator.className = 'pulse-indicator warning';
                message.textContent = 'System health degraded';
            } else {
                indicator.className = 'pulse-indicator';
                message.textContent = 'All systems nominal';
            }
        }

        // Load drift events
        async function updateDriftEvents() {
            try {
                const response = await fetch('/api/k8s/drift');
                const data = await response.json();
                
                if (data.success && data.driftEvents.length > 0) {
                    displayDriftEvents(data.driftEvents);
                }
            } catch (error) {
                console.error('Error loading drift events:', error);
            }
        }

        function displayDriftEvents(events) {
            const container = document.getElementById('driftEvents');
            
            // Show last 5 events
            const recentEvents = events.slice(-5).reverse();
            
            container.innerHTML = recentEvents.map(event => `
                <div class="drift-event ${event.severity}">
                    <strong>${event.type}</strong>: ${event.message}
                    <br>
                    <small>${new Date(event.timestamp).toLocaleTimeString()}</small>
                </div>
            `).join('');
        }

        // Load containers
        async function loadContainers() {
            try {
                const response = await fetch('/api/k8s/containers');
                const data = await response.json();
                
                if (data.success) {
                    displayContainers(data.containers);
                }
            } catch (error) {
                console.error('Error loading containers:', error);
            }
        }

        function displayContainers(containers) {
            const container = document.getElementById('containerList');
            
            container.innerHTML = containers.map(cont => `
                <div class="container-item">
                    <h4>${cont.name}</h4>
                    <div class="container-info">
                        <span>ID:</span><span>${cont.id}</span>
                        <span>Image:</span><span>${cont.image}</span>
                        <span>Status:</span><span class="status-badge ${cont.status}">${cont.status}</span>
                        <span>Ports:</span><span>${cont.ports.join(', ')}</span>
                        <span>Uptime:</span><span>${formatUptime(cont.uptime)}</span>
                    </div>
                </div>
            `).join('');
        }

        // Load infrastructure
        async function loadInfrastructure() {
            try {
                const response = await fetch('/api/k8s/infrastructure');
                const data = await response.json();
                
                if (data.success && data.infrastructure) {
                    displayInfrastructure(data.infrastructure);
                }
            } catch (error) {
                console.error('Error loading infrastructure:', error);
            }
        }

        function displayInfrastructure(infra) {
            const container = document.getElementById('infrastructureGrid');
            
            // Display resources
            const resources = [];
            
            resources.push({
                name: 'Kubernetes Cluster',
                value: infra.resources.clusterName,
                status: 'healthy'
            });
            
            resources.push({
                name: 'Node Count',
                value: infra.resources.nodeCount,
                status: 'healthy'
            });
            
            infra.resources.databases.forEach(db => {
                resources.push({
                    name: `Database: ${db.name}`,
                    value: db.status,
                    status: db.status
                });
            });
            
            infra.resources.caches.forEach(cache => {
                resources.push({
                    name: `Cache: ${cache.name}`,
                    value: cache.status,
                    status: cache.status
                });
            });
            
            container.innerHTML = resources.map(resource => `
                <div class="infra-resource">
                    <h4>${resource.name}</h4>
                    <p class="status ${resource.status !== 'healthy' ? 'unhealthy' : ''}">${resource.value}</p>
                </div>
            `).join('');
            
            // Update costs
            if (infra.costs) {
                document.getElementById('monthlyCost').textContent = `$${infra.costs.current.toFixed(2)}`;
                document.getElementById('costTrend').textContent = `Projected: $${infra.costs.projected.toFixed(2)}`;
            }
        }

        // Agent operations
        async function terminateAgent(agentId) {
            if (!confirm(`Terminate agent ${agentId}?`)) return;
            
            try {
                const response = await fetch(`/api/k8s/agents/${agentId}`, {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification('Agent terminated successfully', 'success');
                    loadAgents();
                } else {
                    showNotification(data.error || 'Failed to terminate agent', 'error');
                }
            } catch (error) {
                console.error('Error terminating agent:', error);
                showNotification('Failed to terminate agent', 'error');
            }
        }

        // Deploy service
        async function deployService(serviceName) {
            try {
                const response = await fetch(`/api/k8s/deploy/${serviceName}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({})
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showNotification(`Service ${serviceName} deployed successfully`, 'success');
                    loadAgents();
                    loadServices();
                } else {
                    showNotification(data.error || 'Failed to deploy service', 'error');
                }
            } catch (error) {
                console.error('Error deploying service:', error);
                showNotification('Failed to deploy service', 'error');
            }
        }

        // Batch operations
        async function deployAllServices() {
            const services = ['semantic-api', 'infinity-router', 'cal-interface', 'main-dashboard'];
            
            for (const service of services) {
                await deployService(service);
                await new Promise(resolve => setTimeout(resolve, 2000)); // Stagger deployments
            }
        }

        async function healthCheckAll() {
            try {
                const response = await fetch('/api/k8s/health');
                const data = await response.json();
                
                if (data.success) {
                    showNotification('Health check completed - all systems operational', 'success');
                }
            } catch (error) {
                showNotification('Health check failed', 'error');
            }
        }

        function autoScale() {
            showNotification('Auto-scaling analysis in progress...', 'success');
            // Would implement actual auto-scaling logic
        }

        function viewLogs() {
            // Would open logs viewer
            showNotification('Logs viewer coming soon', 'success');
        }

        function exportMetrics() {
            // Would export metrics
            showNotification('Metrics export coming soon', 'success');
        }

        function emergencyShutdown() {
            if (!confirm('Are you sure you want to perform an emergency shutdown? This will stop all agents and services.')) {
                return;
            }
            
            showNotification('Emergency shutdown initiated', 'error');
            // Would implement shutdown logic
        }

        // Utility functions
        function formatUptime(seconds) {
            if (!seconds) return 'N/A';
            
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            
            if (hours > 24) {
                const days = Math.floor(hours / 24);
                return `${days}d ${hours % 24}h`;
            }
            
            return `${hours}h ${minutes}m`;
        }

        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function showDeployModal() {
            // Would show a modal for deploying new services
            const serviceName = prompt('Enter service name to deploy:');
            if (serviceName) {
                deployService(serviceName);
            }
        }

        function refreshAll() {
            updateClusterOverview();
            loadAgents();
            loadServices();
            loadPulseStatus();
            updateDriftEvents();
            loadContainers();
            loadInfrastructure();
            updateMetrics();
        }

        // Update performance metrics
        function updateMetrics() {
            // Simulate metrics (would connect to real monitoring)
            document.getElementById('cpuUsage').innerHTML = `${Math.floor(Math.random() * 40 + 20)}<span class="unit">%</span>`;
            document.getElementById('memoryUsage').innerHTML = `${Math.floor(Math.random() * 30 + 40)}<span class="unit">%</span>`;
            document.getElementById('diskIO').innerHTML = `${Math.floor(Math.random() * 50 + 10)}<span class="unit">MB/s</span>`;
            document.getElementById('requestRate').innerHTML = `${Math.floor(Math.random() * 1000 + 500)}<span class="unit">/s</span>`;
            document.getElementById('errorRate').innerHTML = `${(Math.random() * 2).toFixed(1)}<span class="unit">%</span>`;
            document.getElementById('responseTime').innerHTML = `${Math.floor(Math.random() * 50 + 20)}<span class="unit">ms</span>`;
            document.getElementById('networkIO').innerHTML = `${Math.floor(Math.random() * 100 + 50)}<span class="unit">MB/s</span>`;
            
            // Update uptime
            const uptimeHours = Math.floor(Math.random() * 720 + 24); // 1-30 days
            document.getElementById('uptime').innerHTML = `${uptimeHours}<span class="unit">h</span>`;
        }

        // Initialize
        initWebSocket();
        refreshAll();

        // Auto-refresh
        setInterval(() => {
            updateClusterOverview();
            loadPulseStatus();
            updateMetrics();
        }, 10000); // Every 10 seconds

        setInterval(() => {
            loadAgents();
            loadServices();
            loadContainers();
        }, 30000); // Every 30 seconds
    </script>
</body>
</html>