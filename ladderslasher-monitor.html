<!DOCTYPE html>
<html>
<head>
    <title>LadderSlasher XML Extraction Monitor</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: #00ff00;
            font-family: 'Courier New', monospace;
            min-height: 100vh;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { text-shadow: 0 0 5px #00ff00; }
            to { text-shadow: 0 0 20px #00ff00, 0 0 30px #00ff00; }
        }
        
        .extraction-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .panel {
            background: rgba(26, 26, 26, 0.8);
            border: 2px solid #00ff00;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.3);
        }
        
        .panel h3 {
            color: #ffff00;
            margin-top: 0;
            text-align: center;
        }
        
        .status-log {
            background: #000;
            border: 2px solid #00ff00;
            border-radius: 5px;
            padding: 15px;
            height: 300px;
            overflow-y: auto;
            font-size: 12px;
            margin: 20px 0;
        }
        
        .log-line {
            margin: 2px 0;
            opacity: 0;
            animation: fadeIn 0.5s forwards;
        }
        
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        .status-ok { color: #00ff00; }
        .status-warning { color: #ffff00; }
        .status-error { color: #ff0000; }
        .status-info { color: #00ddff; }
        
        .button {
            background: linear-gradient(45deg, #1a1a2e, #16213e);
            border: 2px solid #00ff00;
            color: #00ff00;
            padding: 15px 30px;
            margin: 10px;
            cursor: pointer;
            border-radius: 5px;
            font-size: 16px;
            font-family: 'Courier New', monospace;
            transition: all 0.3s;
        }
        
        .button:hover {
            background: linear-gradient(45deg, #00ff00, #00dd00);
            color: #000;
            box-shadow: 0 0 30px #00ff00;
            transform: scale(1.05);
        }
        
        .metric {
            display: inline-block;
            margin: 10px 20px;
            text-align: center;
        }
        
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #00ff00;
        }
        
        .metric-label {
            font-size: 12px;
            color: #aaa;
        }
        
        .schema-preview {
            background: #000;
            border: 1px solid #00ff00;
            padding: 10px;
            height: 200px;
            overflow: auto;
            font-size: 10px;
            white-space: pre-wrap;
        }
        
        .extraction-phase {
            padding: 10px;
            margin: 5px 0;
            border-left: 4px solid #333;
            background: rgba(0, 255, 0, 0.1);
        }
        
        .phase-active {
            border-left-color: #ffff00;
            background: rgba(255, 255, 0, 0.1);
        }
        
        .phase-complete {
            border-left-color: #00ff00;
            background: rgba(0, 255, 0, 0.1);
        }
        
        .floating-elements {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .floating-xml {
            position: absolute;
            color: #00ff00;
            opacity: 0.3;
            font-size: 12px;
            animation: floatXML 8s infinite linear;
        }
        
        @keyframes floatXML {
            0% { transform: translateY(100vh) translateX(0); opacity: 0.3; }
            50% { opacity: 0.1; }
            100% { transform: translateY(-10px) translateX(50px); opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="floating-elements" id="floatingElements"></div>
    
    <div class="header">
        <h1>üéÆ LADDERSLASHER XML EXTRACTION</h1>
        <p>Deep D2JSP Game Mechanics ‚Üí Agentic OS Schema</p>
        <div id="timestamp"></div>
    </div>
    
    <div style="text-align: center; margin: 20px 0;">
        <button class="button" onclick="startExtraction()">üöÄ Start Extraction</button>
        <button class="button" onclick="connectWebSocket()">üîå Connect Monitor</button>
        <button class="button" onclick="viewSchema()">üìã View Schema</button>
        <button class="button" onclick="downloadFiles()">üíæ Download Files</button>
    </div>
    
    <div class="extraction-grid">
        <div class="panel">
            <h3>üéØ Extraction Phases</h3>
            <div id="phase-interface" class="extraction-phase">
                <strong>1. Game Interface</strong><br>
                Extract HTML structure and JavaScript state
            </div>
            <div id="phase-xml" class="extraction-phase">
                <strong>2. XML Mappings</strong><br>
                Capture AJAX responses and embedded XML
            </div>
            <div id="phase-logic" class="extraction-phase">
                <strong>3. Game Logic</strong><br>
                Analyze interactive elements and mechanics
            </div>
            <div id="phase-patterns" class="extraction-phase">
                <strong>4. Agentic Patterns</strong><br>
                Convert to decision trees and state machines
            </div>
            <div id="phase-jsonl" class="extraction-phase">
                <strong>5. JSONL Schema</strong><br>
                Generate final agentic OS schema
            </div>
        </div>
        
        <div class="panel">
            <h3>üìä Extraction Metrics</h3>
            <div class="metric">
                <div id="ui-elements" class="metric-value">0</div>
                <div class="metric-label">UI Elements</div>
            </div>
            <div class="metric">
                <div id="xml-sources" class="metric-value">0</div>
                <div class="metric-label">XML Sources</div>
            </div>
            <div class="metric">
                <div id="agent-patterns" class="metric-value">0</div>
                <div class="metric-label">Agent Patterns</div>
            </div>
            <div class="metric">
                <div id="jsonl-entries" class="metric-value">0</div>
                <div class="metric-label">JSONL Entries</div>
            </div>
            <div class="metric">
                <div id="os-components" class="metric-value">0</div>
                <div class="metric-label">OS Components</div>
            </div>
        </div>
    </div>
    
    <div class="panel">
        <h3>üîç Real-time Extraction Log</h3>
        <div id="extractionLog" class="status-log">
            <div class="log-line status-info">[MONITOR] LadderSlasher extraction monitor initialized</div>
            <div class="log-line status-info">[MONITOR] Ready to connect to extractor WebSocket</div>
        </div>
    </div>
    
    <div class="extraction-grid">
        <div class="panel">
            <h3>üó∫Ô∏è XML Structure Preview</h3>
            <div id="xmlPreview" class="schema-preview">
                Waiting for XML extraction...
            </div>
        </div>
        
        <div class="panel">
            <h3>üìã JSONL Schema Preview</h3>
            <div id="jsonlPreview" class="schema-preview">
                Waiting for schema generation...
            </div>
        </div>
    </div>
    
    <div class="panel">
        <h3>ü§ñ Generated Agentic OS Components</h3>
        <div id="osComponents" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
            <div style="padding: 10px; border: 1px solid #333; text-align: center;">
                <strong>GameStateManager</strong><br>
                <small>Track and manage game state</small>
            </div>
            <div style="padding: 10px; border: 1px solid #333; text-align: center;">
                <strong>ActionScheduler</strong><br>
                <small>Schedule and execute actions</small>
            </div>
            <div style="padding: 10px; border: 1px solid #333; text-align: center;">
                <strong>DecisionEngine</strong><br>
                <small>Make strategic decisions</small>
            </div>
            <div style="padding: 10px; border: 1px solid #333; text-align: center;">
                <strong>PatternRecognizer</strong><br>
                <small>Identify and learn patterns</small>
            </div>
        </div>
    </div>
    
    <script>
        let ws = null;
        let extractionStats = {
            uiElements: 0,
            xmlSources: 0,
            agentPatterns: 0,
            jsonlEntries: 0,
            osComponents: 4
        };
        
        function updateTimestamp() {
            document.getElementById('timestamp').textContent = new Date().toLocaleString();
        }
        setInterval(updateTimestamp, 1000);
        updateTimestamp();
        
        function createFloatingXML() {
            const container = document.getElementById('floatingElements');
            const xmlTags = ['<game>', '<player>', '<stats>', '<inventory>', '<skills>', '<state>', '<action>', '<response>'];
            
            setInterval(() => {
                const xml = document.createElement('div');
                xml.className = 'floating-xml';
                xml.textContent = xmlTags[Math.floor(Math.random() * xmlTags.length)];
                xml.style.left = Math.random() * 100 + '%';
                xml.style.animationDelay = '0s';
                container.appendChild(xml);
                
                setTimeout(() => {
                    if (xml.parentNode) {
                        xml.parentNode.removeChild(xml);
                    }
                }, 8000);
            }, 1000);
        }
        createFloatingXML();
        
        function logMessage(message, type = 'info') {
            const log = document.getElementById('extractionLog');
            const timestamp = new Date().toLocaleTimeString();
            const line = document.createElement('div');
            line.className = `log-line status-${type}`;
            line.textContent = `[${timestamp}] ${message}`;
            log.appendChild(line);
            log.scrollTop = log.scrollHeight;
            
            // Keep only last 50 lines
            while (log.children.length > 50) {
                log.removeChild(log.firstChild);
            }
        }
        
        function updateMetrics() {
            document.getElementById('ui-elements').textContent = extractionStats.uiElements;
            document.getElementById('xml-sources').textContent = extractionStats.xmlSources;
            document.getElementById('agent-patterns').textContent = extractionStats.agentPatterns;
            document.getElementById('jsonl-entries').textContent = extractionStats.jsonlEntries;
            document.getElementById('os-components').textContent = extractionStats.osComponents;
        }
        
        function setPhaseStatus(phase, status) {
            const element = document.getElementById(`phase-${phase}`);
            element.className = `extraction-phase ${status === 'active' ? 'phase-active' : status === 'complete' ? 'phase-complete' : ''}`;
        }
        
        function connectWebSocket() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                logMessage('WebSocket already connected', 'warning');
                return;
            }
            
            logMessage('Connecting to LadderSlasher extractor...', 'info');
            
            ws = new WebSocket('ws://localhost:48001');
            
            ws.onopen = () => {
                logMessage('‚úÖ Connected to extractor WebSocket', 'ok');
                ws.send(JSON.stringify({ type: 'get_schema' }));
            };
            
            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                handleWebSocketMessage(data);
            };
            
            ws.onerror = () => {
                logMessage('‚ùå WebSocket connection failed', 'error');
                logMessage('Start the extractor with: node ladderslasher-xml-extractor.js', 'warning');
            };
            
            ws.onclose = () => {
                logMessage('WebSocket connection closed', 'warning');
            };
        }
        
        function handleWebSocketMessage(data) {
            switch (data.type) {
                case 'extraction_update':
                    logMessage(data.message, 'info');
                    
                    // Update phase status based on message
                    if (data.message.includes('interface')) {
                        setPhaseStatus('interface', 'active');
                    } else if (data.message.includes('XML')) {
                        setPhaseStatus('interface', 'complete');
                        setPhaseStatus('xml', 'active');
                    } else if (data.message.includes('logic')) {
                        setPhaseStatus('xml', 'complete');
                        setPhaseStatus('logic', 'active');
                    } else if (data.message.includes('patterns')) {
                        setPhaseStatus('logic', 'complete');
                        setPhaseStatus('patterns', 'active');
                    } else if (data.message.includes('JSONL')) {
                        setPhaseStatus('patterns', 'complete');
                        setPhaseStatus('jsonl', 'active');
                    } else if (data.message.includes('complete')) {
                        setPhaseStatus('jsonl', 'complete');
                    }
                    break;
                    
                case 'schema_update':
                    updateSchemaPreview(data.schema);
                    break;
            }
        }
        
        function updateSchemaPreview(schema) {
            // Update XML preview
            if (schema.xml_mappings) {
                const xmlPreview = document.getElementById('xmlPreview');
                xmlPreview.textContent = JSON.stringify(schema.xml_mappings.extraction_stats || {}, null, 2);
                extractionStats.xmlSources = schema.xml_mappings.extraction_stats?.successfully_parsed || 0;
            }
            
            // Update JSONL preview
            if (schema.agent_patterns) {
                const jsonlPreview = document.getElementById('jsonlPreview');
                const sampleEntries = schema.agent_patterns.decision_trees?.slice(0, 3) || [];
                jsonlPreview.textContent = sampleEntries.map(entry => JSON.stringify(entry)).join('\n');
                extractionStats.agentPatterns = schema.agent_patterns.decision_trees?.length || 0;
            }
            
            // Update UI elements count
            if (schema.game_mechanics?.logic?.buttons) {
                extractionStats.uiElements = schema.game_mechanics.logic.buttons.length;
            }
            
            updateMetrics();
        }
        
        function startExtraction() {
            logMessage('üöÄ Starting LadderSlasher extraction...', 'warning');
            
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                connectWebSocket();
                setTimeout(() => {
                    if (ws && ws.readyState === WebSocket.OPEN) {
                        ws.send(JSON.stringify({ type: 'start_extraction' }));
                    }
                }, 1000);
            } else {
                ws.send(JSON.stringify({ type: 'start_extraction' }));
            }
            
            logMessage('This will open a browser to navigate D2JSP...', 'info');
            logMessage('The extraction process may take 2-5 minutes', 'info');
        }
        
        function viewSchema() {
            logMessage('Opening schema viewer...', 'info');
            
            const schemaWindow = window.open('', 'schema', 'width=1200,height=800');
            schemaWindow.document.write(`
                <html>
                <head><title>LadderSlasher Agentic OS Schema</title></head>
                <body style="background: #000; color: #00ff00; font-family: monospace; padding: 20px;">
                    <h2>ü§ñ Agentic OS Schema</h2>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <h3>XML Mappings</h3>
                            <pre id="xmlData" style="background: #1a1a1a; padding: 10px; overflow: auto; height: 300px;"></pre>
                        </div>
                        <div>
                            <h3>Agent Patterns</h3>
                            <pre id="agentData" style="background: #1a1a1a; padding: 10px; overflow: auto; height: 300px;"></pre>
                        </div>
                    </div>
                    <div style="margin-top: 20px;">
                        <h3>JSONL Schema Entries</h3>
                        <pre id="jsonlData" style="background: #1a1a1a; padding: 10px; overflow: auto; height: 200px;"></pre>
                    </div>
                    <script>
                        document.getElementById('xmlData').textContent = 'Requesting schema data...';
                        document.getElementById('agentData').textContent = 'Requesting schema data...';
                        document.getElementById('jsonlData').textContent = 'Requesting schema data...';
                    </script>
                </body>
                </html>
            `);
        }
        
        function downloadFiles() {
            logMessage('Files available in ./ladderslasher-data/ directory:', 'info');
            logMessage('- agentic_os_schema.jsonl', 'ok');
            logMessage('- complete_schema.json', 'ok');
            logMessage('- ladderslasher_agentic_os.js', 'ok');
            logMessage('- xml_mappings.json', 'ok');
            logMessage('- game_interface.html', 'ok');
            logMessage('- extraction_stats.json', 'ok');
        }
        
        // Auto-connect on load
        setTimeout(connectWebSocket, 1000);
        
        logMessage('üéÆ LadderSlasher XML extraction monitor ready', 'ok');
        logMessage('Click "Start Extraction" to begin deep D2JSP analysis', 'info');
    </script>
</body>
</html>