<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enterprise Vault Sovereignty - Cryptographic AI Ownership</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1900px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(255, 215, 0, 0.1), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .header-left {
            position: relative;
            z-index: 2;
        }

        .header-left h1 {
            font-size: 3.2em;
            background: linear-gradient(135deg, #ffd700 0%, #ffb347 50%, #ff6b6b 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: glow 2s ease-in-out infinite alternate;
            margin-bottom: 10px;
        }

        @keyframes glow {
            from { filter: drop-shadow(0 0 5px rgba(255, 215, 0, 0.5)); }
            to { filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.8)); }
        }

        .header-left p {
            color: #b0b0b0;
            font-size: 1.3em;
            margin-bottom: 10px;
        }

        .sovereignty-badge {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 215, 0, 0.2);
            border: 2px solid #ffd700;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 1.1em;
            color: #ffd700;
            font-weight: bold;
        }

        .header-right {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 15px;
            position: relative;
            z-index: 2;
        }

        .trust-score {
            background: rgba(0, 255, 136, 0.1);
            border: 2px solid #00ff88;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            min-width: 280px;
        }

        .trust-value {
            font-size: 3em;
            font-weight: bold;
            color: #00ff88;
            text-shadow: 0 0 20px #00ff88;
        }

        .trust-label {
            color: #aaa;
            font-size: 1.1em;
            margin-top: 5px;
        }

        .compliance-indicators {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .compliance-badge {
            background: rgba(0, 255, 136, 0.2);
            border: 1px solid #00ff88;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.9em;
            color: #00ff88;
        }

        /* Navigation */
        .nav-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 8px;
            margin-bottom: 30px;
            gap: 8px;
        }

        .nav-tab {
            flex: 1;
            background: transparent;
            color: #aaa;
            border: none;
            padding: 15px 20px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-tab.active {
            background: linear-gradient(135deg, #ffd700 0%, #ffb347 100%);
            color: #000;
        }

        .nav-tab:hover:not(.active) {
            background: rgba(255, 215, 0, 0.1);
            color: #ffd700;
        }

        /* Tab Content */
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Grid Layouts */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .vault-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .device-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        /* Cards */
        .metric-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }

        .metric-card:hover::before {
            left: 100%;
        }

        .metric-card:hover {
            transform: translateY(-5px);
            border-color: #ffd700;
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.2);
        }

        .metric-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .metric-value.revenue { color: #ffd700; }
        .metric-value.vaults { color: #00ff88; }
        .metric-value.compliance { color: #00ccff; }
        .metric-value.security { color: #ff6b6b; }

        .metric-label {
            color: #aaa;
            font-size: 1em;
        }

        .metric-change {
            font-size: 0.9em;
            margin-top: 8px;
            padding: 4px 8px;
            border-radius: 10px;
            display: inline-block;
        }

        .metric-change.positive {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
        }

        .metric-change.negative {
            background: rgba(255, 107, 107, 0.2);
            color: #ff6b6b;
        }

        /* Vault Cards */
        .vault-card {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid transparent;
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s ease;
            position: relative;
        }

        .vault-card.enterprise {
            border-color: #ffd700;
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 179, 71, 0.1));
        }

        .vault-card.startup {
            border-color: #00ccff;
            background: linear-gradient(135deg, rgba(0, 204, 255, 0.1), rgba(102, 255, 221, 0.1));
        }

        .vault-card.individual {
            border-color: #ff6b6b;
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.1), rgba(255, 179, 71, 0.1));
        }

        .vault-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .vault-id {
            font-size: 1.2em;
            font-weight: bold;
            color: #fff;
        }

        .vault-tier {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
        }

        .vault-tier.enterprise { background: linear-gradient(135deg, #ffd700 0%, #ffb347 100%); color: #000; }
        .vault-tier.startup { background: linear-gradient(135deg, #00ccff 0%, #66ffdd 100%); color: #000; }
        .vault-tier.individual { background: linear-gradient(135deg, #ff6b6b 0%, #ffb347 100%); color: #000; }

        .vault-metrics {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .vault-metric {
            text-align: center;
        }

        .vault-metric-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #fff;
        }

        .vault-metric-label {
            font-size: 0.9em;
            color: #aaa;
            margin-top: 5px;
        }

        /* Device Cards */
        .device-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .device-card:hover {
            border-color: #00ff88;
            transform: translateY(-3px);
        }

        .device-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .device-name {
            font-size: 1.2em;
            font-weight: bold;
            color: #fff;
        }

        .device-type {
            background: rgba(0, 204, 255, 0.2);
            color: #00ccff;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8em;
        }

        .device-trust {
            font-size: 1.3em;
            font-weight: bold;
            color: #00ff88;
            margin: 10px 0;
        }

        .device-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
        }

        .sync-status {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: bold;
        }

        .sync-status.synchronized {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
        }

        .last-sync {
            color: #aaa;
            font-size: 0.9em;
        }

        /* API Key Management */
        .api-key-list {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .api-key-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .api-key-item:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .api-key-info {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .api-key-name {
            font-weight: bold;
            color: #fff;
        }

        .api-key-service {
            color: #aaa;
            font-size: 0.9em;
        }

        .api-key-actions {
            display: flex;
            gap: 10px;
        }

        /* Buttons */
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 0.9em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn.primary {
            background: linear-gradient(135deg, #ffd700 0%, #ffb347 100%);
            color: #000;
        }

        .btn.success {
            background: linear-gradient(135deg, #00ff88 0%, #00ccff 100%);
            color: #000;
        }

        .btn.danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #dc2626 100%);
        }

        .btn.small {
            padding: 6px 12px;
            font-size: 0.8em;
        }

        /* Charts and Visualizations */
        .chart-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .chart-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #fff;
            margin-bottom: 20px;
            text-align: center;
        }

        .trust-history-chart {
            height: 200px;
            position: relative;
            background: linear-gradient(180deg, rgba(0, 255, 136, 0.1) 0%, transparent 100%);
            border-radius: 10px;
            display: flex;
            align-items: end;
            justify-content: space-around;
            padding: 20px;
        }

        .trust-bar {
            background: linear-gradient(180deg, #00ff88 0%, #00ccff 100%);
            width: 30px;
            border-radius: 5px 5px 0 0;
            position: relative;
            transition: all 0.3s ease;
        }

        .trust-bar:hover {
            transform: scaleY(1.1);
            box-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: #1a1a2e;
            border: 2px solid #ffd700;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            color: #aaa;
            font-size: 24px;
            cursor: pointer;
        }

        .modal h2 {
            color: #ffd700;
            margin-bottom: 20px;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            color: #fff;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .form-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 12px;
            color: #fff;
            font-size: 1em;
        }

        .form-input:focus {
            outline: none;
            border-color: #ffd700;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }

        .form-select {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 12px;
            color: #fff;
            font-size: 1em;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                text-align: center;
                gap: 20px;
            }

            .header-left h1 {
                font-size: 2.2em;
            }

            .nav-tabs {
                flex-direction: column;
            }

            .vault-grid,
            .device-grid {
                grid-template-columns: 1fr;
            }

            .vault-metrics {
                grid-template-columns: 1fr;
            }
        }

        /* Loading States */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #ffd700;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Status Indicators */
        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-indicator.active { background: #00ff88; box-shadow: 0 0 5px #00ff88; }
        .status-indicator.warning { background: #ffb347; box-shadow: 0 0 5px #ffb347; }
        .status-indicator.error { background: #ff6b6b; box-shadow: 0 0 5px #ff6b6b; }

        /* Witness Validation */
        .witness-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .witness-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }

        .witness-id {
            font-weight: bold;
            color: #00ccff;
            margin-bottom: 8px;
        }

        .witness-score {
            font-size: 1.5em;
            font-weight: bold;
            color: #00ff88;
        }

        .witness-validations {
            color: #aaa;
            font-size: 0.9em;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <h1>üè¶ Enterprise Vault Sovereignty</h1>
                <p>Cryptographic AI Ownership & Data Sovereignty</p>
                <div class="sovereignty-badge">
                    <span class="status-indicator active"></span>
                    üëë Cryptographic Sovereignty Active
                </div>
            </div>
            <div class="header-right">
                <div class="trust-score">
                    <div class="trust-value" id="trustScore">98.7%</div>
                    <div class="trust-label">Trust Score</div>
                    <div class="compliance-indicators">
                        <div class="compliance-badge">GDPR</div>
                        <div class="compliance-badge">SOC2</div>
                        <div class="compliance-badge">ISO27001</div>
                        <div class="compliance-badge">HIPAA</div>
                    </div>
                </div>
                <button class="btn primary" onclick="showCreateVaultModal()">
                    ‚ûï Create Enterprise Vault
                </button>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('overview')">üìä Overview</button>
            <button class="nav-tab" onclick="showTab('vaults')">üè¶ Vault Management</button>
            <button class="nav-tab" onclick="showTab('keys')">üîë API Key Vault</button>
            <button class="nav-tab" onclick="showTab('devices')">üì± Multi-Device Sync</button>
            <button class="nav-tab" onclick="showTab('compliance')">üõ°Ô∏è Compliance</button>
            <button class="nav-tab" onclick="showTab('analytics')">üìà Analytics</button>
        </div>

        <!-- Overview Tab -->
        <div id="overview" class="tab-content active">
            <div class="metrics-grid">
                <div class="metric-card">
                    <div class="metric-value revenue" id="totalRevenue">$847K</div>
                    <div class="metric-label">Total Revenue</div>
                    <div class="metric-change positive">+23.7% this month</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value vaults" id="totalVaults">156</div>
                    <div class="metric-label">Active Vaults</div>
                    <div class="metric-change positive">+12 this week</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value compliance" id="complianceScore">98.5%</div>
                    <div class="metric-label">Compliance Score</div>
                    <div class="metric-change positive">+0.3% this month</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value security" id="securityIncidents">0</div>
                    <div class="metric-label">Security Incidents</div>
                    <div class="metric-change positive">0 for 247 days</div>
                </div>
            </div>

            <div class="chart-container">
                <div class="chart-title">Trust Score History (Last 5 Days)</div>
                <div class="trust-history-chart" id="trustHistoryChart">
                    <!-- Trust bars will be generated dynamically -->
                </div>
            </div>

            <div class="witness-grid" id="witnessGrid">
                <!-- Witness validation info will be loaded dynamically -->
            </div>
        </div>

        <!-- Vault Management Tab -->
        <div id="vaults" class="tab-content">
            <h2 style="text-align: center; margin-bottom: 30px; color: #ffd700;">üè¶ Enterprise Vault Registry</h2>
            <div class="vault-grid" id="vaultGrid">
                <!-- Vaults will be loaded dynamically -->
            </div>
        </div>

        <!-- API Key Vault Tab -->
        <div id="keys" class="tab-content">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                <h2 style="color: #ffd700;">üîë Secure API Key Management</h2>
                <button class="btn primary" onclick="showAddKeyModal()">‚ûï Store New API Key</button>
            </div>
            
            <div class="api-key-list" id="apiKeyList">
                <!-- API keys will be loaded dynamically -->
            </div>
        </div>

        <!-- Multi-Device Sync Tab -->
        <div id="devices" class="tab-content">
            <h2 style="text-align: center; margin-bottom: 30px; color: #ffd700;">üì± Multi-Device Vault Synchronization</h2>
            <div class="device-grid" id="deviceGrid">
                <!-- Devices will be loaded dynamically -->
            </div>
        </div>

        <!-- Compliance Tab -->
        <div id="compliance" class="tab-content">
            <h2 style="text-align: center; margin-bottom: 30px; color: #ffd700;">üõ°Ô∏è Compliance & Sovereignty Status</h2>
            <div class="vault-grid" id="complianceGrid">
                <!-- Compliance info will be loaded dynamically -->
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics" class="tab-content">
            <h2 style="text-align: center; margin-bottom: 30px; color: #ffd700;">üìà Vault Analytics & Performance</h2>
            <div class="metrics-grid" id="analyticsGrid">
                <!-- Analytics will be loaded dynamically -->
            </div>
        </div>
    </div>

    <!-- Create Vault Modal -->
    <div class="modal" id="createVaultModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeCreateVaultModal()">&times;</button>
            <h2>üè¶ Create Enterprise Vault</h2>
            
            <div class="form-group">
                <label class="form-label">Enterprise ID</label>
                <input type="text" class="form-input" id="enterpriseId" placeholder="Enter enterprise identifier">
            </div>
            
            <div class="form-group">
                <label class="form-label">Vault Tier</label>
                <select class="form-select" id="vaultTier">
                    <option value="individual">Individual (75% revenue share)</option>
                    <option value="startup">Startup (80% revenue share)</option>
                    <option value="enterprise">Enterprise (85% revenue share)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label class="form-label">Daily Action Limit</label>
                <input type="number" class="form-input" id="actionLimit" value="1000">
            </div>
            
            <div class="form-group">
                <label class="form-label">Monthly Export Quota</label>
                <input type="number" class="form-input" id="exportQuota" value="500">
            </div>
            
            <button class="btn primary" onclick="createVault()" style="width: 100%; margin-top: 20px;">
                Create Sovereign Vault
            </button>
        </div>
    </div>

    <!-- Add API Key Modal -->
    <div class="modal" id="addKeyModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeAddKeyModal()">&times;</button>
            <h2>üîë Store Secure API Key</h2>
            
            <div class="form-group">
                <label class="form-label">Service Name</label>
                <input type="text" class="form-input" id="serviceName" placeholder="e.g., stripe, openai, anthropic">
            </div>
            
            <div class="form-group">
                <label class="form-label">Key Name</label>
                <input type="text" class="form-input" id="keyName" placeholder="e.g., production_key, test_key">
            </div>
            
            <div class="form-group">
                <label class="form-label">API Key</label>
                <input type="password" class="form-input" id="apiKey" placeholder="Enter API key (will be encrypted)">
            </div>
            
            <div class="form-group">
                <label class="form-label">Environment</label>
                <select class="form-select" id="environment">
                    <option value="production">Production</option>
                    <option value="staging">Staging</option>
                    <option value="development">Development</option>
                </select>
            </div>
            
            <button class="btn primary" onclick="storeAPIKey()" style="width: 100%; margin-top: 20px;">
                Store Encrypted Key
            </button>
        </div>
    </div>

    <script>
        let currentVaultId = 'vault_enterprise_001';

        // Tab Management
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            loadTabContent(tabName);
        }

        // Load content for specific tabs
        async function loadTabContent(tabName) {
            switch(tabName) {
                case 'overview':
                    await loadOverviewData();
                    break;
                case 'vaults':
                    await loadVaultManagement();
                    break;
                case 'keys':
                    await loadAPIKeyManagement();
                    break;
                case 'devices':
                    await loadDeviceSync();
                    break;
                case 'compliance':
                    await loadComplianceStatus();
                    break;
                case 'analytics':
                    await loadAnalytics();
                    break;
            }
        }

        // Load overview data
        async function loadOverviewData() {
            try {
                const [metricsResponse, trustResponse] = await Promise.all([
                    fetch('/api/vault/metrics'),
                    fetch(`/api/vault/trust/${currentVaultId}`)
                ]);
                
                const metrics = await metricsResponse.json();
                const trust = await trustResponse.json();
                
                if (metrics.success) {
                    document.getElementById('totalRevenue').textContent = `$${(metrics.totalRevenueGenerated / 1000).toFixed(0)}K`;
                    document.getElementById('totalVaults').textContent = metrics.totalVaults;
                    document.getElementById('complianceScore').textContent = `${metrics.complianceScore}%`;
                    document.getElementById('trustScore').textContent = `${metrics.averageTrustScore}%`;
                }
                
                if (trust.success) {
                    renderTrustHistoryChart(trust.trustHistory);
                    renderWitnessValidation(trust.witnesses);
                }
            } catch (error) {
                console.error('Failed to load overview data:', error);
            }
        }

        function renderTrustHistoryChart(trustHistory) {
            const chartContainer = document.getElementById('trustHistoryChart');
            chartContainer.innerHTML = trustHistory.map(entry => {
                const height = (entry.score / 100) * 160; // Max height 160px
                return `<div class="trust-bar" style="height: ${height}px" title="${entry.score}% on ${new Date(entry.timestamp).toLocaleDateString()}"></div>`;
            }).join('');
        }

        function renderWitnessValidation(witnesses) {
            const witnessGrid = document.getElementById('witnessGrid');
            witnessGrid.innerHTML = `
                <div class="chart-container">
                    <div class="chart-title">Witness Validation Network</div>
                    <div class="witness-grid">
                        ${witnesses.map(witness => `
                            <div class="witness-card">
                                <div class="witness-id">${witness.id}</div>
                                <div class="witness-score">${witness.trustScore}%</div>
                                <div class="witness-validations">${witness.validations} validations</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // Load vault management
        async function loadVaultManagement() {
            try {
                const response = await fetch('/api/vault/metrics');
                const data = await response.json();
                
                if (data.success) {
                    const vaultGrid = document.getElementById('vaultGrid');
                    
                    // Mock vault data based on enterprise vaults
                    const mockVaults = [
                        {
                            vaultId: 'enterprise_vault_001',
                            tier: 'enterprise',
                            trustScore: 98.7,
                            revenue: 287456.78,
                            customers: 156,
                            actions: 47
                        },
                        {
                            vaultId: 'startup_vault_alpha_002',
                            tier: 'startup',
                            trustScore: 97.2,
                            revenue: 156789.34,
                            customers: 45,
                            actions: 23
                        },
                        {
                            vaultId: 'indie_dev_vault_003',
                            tier: 'individual',
                            trustScore: 95.8,
                            revenue: 403047.33,
                            customers: 267,
                            actions: 89
                        }
                    ];
                    
                    vaultGrid.innerHTML = mockVaults.map(vault => `
                        <div class="vault-card ${vault.tier}">
                            <div class="vault-header">
                                <div class="vault-id">${vault.vaultId}</div>
                                <div class="vault-tier ${vault.tier}">${vault.tier}</div>
                            </div>
                            <div class="vault-metrics">
                                <div class="vault-metric">
                                    <div class="vault-metric-value">${vault.trustScore}%</div>
                                    <div class="vault-metric-label">Trust Score</div>
                                </div>
                                <div class="vault-metric">
                                    <div class="vault-metric-value">$${(vault.revenue / 1000).toFixed(0)}K</div>
                                    <div class="vault-metric-label">Revenue</div>
                                </div>
                                <div class="vault-metric">
                                    <div class="vault-metric-value">${vault.customers}</div>
                                    <div class="vault-metric-label">Customers</div>
                                </div>
                                <div class="vault-metric">
                                    <div class="vault-metric-value">${vault.actions}</div>
                                    <div class="vault-metric-label">Actions</div>
                                </div>
                            </div>
                            <div style="display: flex; gap: 10px; margin-top: 20px;">
                                <button class="btn small" onclick="configureVault('${vault.vaultId}')">‚öôÔ∏è Configure</button>
                                <button class="btn small success" onclick="exportVault('${vault.vaultId}')">üì¶ Export</button>
                                <button class="btn small" onclick="viewVaultDetails('${vault.vaultId}')">üëÅÔ∏è Details</button>
                            </div>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('Failed to load vault management:', error);
            }
        }

        // Load API key management
        async function loadAPIKeyManagement() {
            const apiKeyList = document.getElementById('apiKeyList');
            
            // Mock API keys
            const mockKeys = [
                { serviceName: 'stripe', keyName: 'production_key', environment: 'production', lastUsed: new Date(Date.now() - 2 * 60 * 60 * 1000) },
                { serviceName: 'openai', keyName: 'gpt4_key', environment: 'production', lastUsed: new Date(Date.now() - 30 * 60 * 1000) },
                { serviceName: 'anthropic', keyName: 'claude_key', environment: 'production', lastUsed: new Date(Date.now() - 5 * 60 * 1000) },
                { serviceName: 'pinecone', keyName: 'vector_db', environment: 'production', lastUsed: new Date(Date.now() - 1 * 60 * 60 * 1000) }
            ];
            
            apiKeyList.innerHTML = mockKeys.map(key => `
                <div class="api-key-item">
                    <div class="api-key-info">
                        <div class="api-key-name">${key.serviceName}/${key.keyName}</div>
                        <div class="api-key-service">Environment: ${key.environment} ‚Ä¢ Last used: ${key.lastUsed.toLocaleString()}</div>
                    </div>
                    <div class="api-key-actions">
                        <button class="btn small" onclick="rotateAPIKey('${key.serviceName}', '${key.keyName}')">üîÑ Rotate</button>
                        <button class="btn small success" onclick="retrieveAPIKey('${key.serviceName}', '${key.keyName}')">üëÅÔ∏è View</button>
                        <button class="btn small danger" onclick="deleteAPIKey('${key.serviceName}', '${key.keyName}')">üóëÔ∏è Delete</button>
                    </div>
                </div>
            `).join('');
        }

        // Load device sync
        async function loadDeviceSync() {
            try {
                const response = await fetch(`/api/vault/devices/${currentVaultId}`);
                const data = await response.json();
                
                if (data.success) {
                    const deviceGrid = document.getElementById('deviceGrid');
                    deviceGrid.innerHTML = data.devices.map(device => `
                        <div class="device-card">
                            <div class="device-header">
                                <div class="device-name">${device.deviceName}</div>
                                <div class="device-type">${device.deviceType}</div>
                            </div>
                            <div class="device-trust">${device.trustScore}% Trust</div>
                            <div style="color: #aaa; margin-bottom: 10px;">Device ID: ${device.deviceId}</div>
                            <div class="device-status">
                                <div class="sync-status ${device.syncStatus}">${device.syncStatus}</div>
                                <div class="last-sync">Synced ${new Date(device.lastSync).toLocaleString()}</div>
                            </div>
                            <div style="margin-top: 15px;">
                                <button class="btn small" onclick="syncDevice('${device.deviceId}')">üîÑ Force Sync</button>
                                <button class="btn small danger" onclick="revokeDevice('${device.deviceId}')">‚ùå Revoke</button>
                            </div>
                        </div>
                    `).join('');
                }
            } catch (error) {
                console.error('Failed to load device sync:', error);
            }
        }

        // Load compliance status
        async function loadComplianceStatus() {
            try {
                const response = await fetch('/api/vault/compliance');
                const data = await response.json();
                
                if (data.success) {
                    const complianceGrid = document.getElementById('complianceGrid');
                    complianceGrid.innerHTML = `
                        <div class="vault-card">
                            <div class="vault-header">
                                <div class="vault-id">GDPR Compliance</div>
                                <div class="vault-tier enterprise">${data.gdpr.compliant ? 'Compliant' : 'Non-Compliant'}</div>
                            </div>
                            <div class="vault-metrics">
                                <div class="vault-metric">
                                    <div class="vault-metric-value">${data.gdpr.dataPortability ? 'Yes' : 'No'}</div>
                                    <div class="vault-metric-label">Data Portability</div>
                                </div>
                                <div class="vault-metric">
                                    <div class="vault-metric-value">${data.gdpr.rightToErasure ? 'Yes' : 'No'}</div>
                                    <div class="vault-metric-label">Right to Erasure</div>
                                </div>
                            </div>
                            <div style="margin-top: 15px; color: #aaa;">
                                Last Audit: ${new Date(data.gdpr.lastAudit).toLocaleDateString()}
                            </div>
                        </div>
                        
                        <div class="vault-card">
                            <div class="vault-header">
                                <div class="vault-id">SOC2 Type II</div>
                                <div class="vault-tier startup">${data.soc2.type2 ? 'Certified' : 'Pending'}</div>
                            </div>
                            <div class="vault-metrics">
                                <div class="vault-metric">
                                    <div class="vault-metric-value">${data.soc2.securityControls ? 'Pass' : 'Fail'}</div>
                                    <div class="vault-metric-label">Security Controls</div>
                                </div>
                                <div class="vault-metric">
                                    <div class="vault-metric-value">${data.soc2.availabilityControls ? 'Pass' : 'Fail'}</div>
                                    <div class="vault-metric-label">Availability</div>
                                </div>
                            </div>
                            <div style="margin-top: 15px; color: #aaa;">
                                Last Audit: ${new Date(data.soc2.lastAudit).toLocaleDateString()}
                            </div>
                        </div>
                        
                        <div class="vault-card">
                            <div class="vault-header">
                                <div class="vault-id">ISO 27001</div>
                                <div class="vault-tier individual">${data.iso27001.certified ? 'Certified' : 'Pending'}</div>
                            </div>
                            <div class="vault-metrics">
                                <div class="vault-metric">
                                    <div class="vault-metric-value">${data.iso27001.informationSecurity ? 'Pass' : 'Fail'}</div>
                                    <div class="vault-metric-label">Info Security</div>
                                </div>
                                <div class="vault-metric">
                                    <div class="vault-metric-value">${data.iso27001.riskManagement ? 'Pass' : 'Fail'}</div>
                                    <div class="vault-metric-label">Risk Management</div>
                                </div>
                            </div>
                            <div style="margin-top: 15px; color: #aaa;">
                                Last Audit: ${new Date(data.iso27001.lastAudit).toLocaleDateString()}
                            </div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Failed to load compliance status:', error);
            }
        }

        // Load analytics
        async function loadAnalytics() {
            try {
                const response = await fetch('/api/vault/analytics');
                const data = await response.json();
                
                if (data.success) {
                    const analyticsGrid = document.getElementById('analyticsGrid');
                    analyticsGrid.innerHTML = `
                        <div class="metric-card">
                            <div class="metric-value revenue">$${(data.revenue.total / 1000).toFixed(0)}K</div>
                            <div class="metric-label">Total Revenue</div>
                            <div class="metric-change positive">+${data.revenue.growth_rate}% growth</div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-value vaults">${data.usage.total_vaults}</div>
                            <div class="metric-label">Total Vaults</div>
                            <div class="metric-change positive">${data.usage.active_vaults} active</div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-value compliance">${data.performance.uptime_percentage}%</div>
                            <div class="metric-label">Uptime</div>
                            <div class="metric-change positive">99.97% SLA</div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-value security">${data.security.incidents}</div>
                            <div class="metric-label">Security Incidents</div>
                            <div class="metric-change positive">${data.security.threat_blocks} threats blocked</div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-value vaults">${data.usage.api_calls_today.toLocaleString()}</div>
                            <div class="metric-label">API Calls Today</div>
                            <div class="metric-change positive">${data.performance.avg_response_time}ms avg</div>
                        </div>
                        
                        <div class="metric-card">
                            <div class="metric-value compliance">${data.usage.data_stored_gb}GB</div>
                            <div class="metric-label">Data Stored</div>
                            <div class="metric-change positive">Encrypted</div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Failed to load analytics:', error);
            }
        }

        // Modal functions
        function showCreateVaultModal() {
            document.getElementById('createVaultModal').classList.add('active');
        }

        function closeCreateVaultModal() {
            document.getElementById('createVaultModal').classList.remove('active');
        }

        function showAddKeyModal() {
            document.getElementById('addKeyModal').classList.add('active');
        }

        function closeAddKeyModal() {
            document.getElementById('addKeyModal').classList.remove('active');
        }

        // Vault operations
        async function createVault() {
            const enterpriseId = document.getElementById('enterpriseId').value;
            const tier = document.getElementById('vaultTier').value;
            const actionLimit = document.getElementById('actionLimit').value;
            const exportQuota = document.getElementById('exportQuota').value;
            
            if (!enterpriseId) {
                alert('Please enter an enterprise ID');
                return;
            }
            
            try {
                const response = await fetch('/api/vault/enterprise/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        enterpriseId,
                        tier,
                        configuration: {
                            dailyActionLimit: parseInt(actionLimit),
                            monthlyExportQuota: parseInt(exportQuota),
                            witnessValidationRequired: true,
                            platformForkPermissions: tier === 'enterprise'
                        }
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert(`Vault created successfully!\nVault ID: ${data.vault.vaultId}\nSovereignty: ${data.sovereignty.level}`);
                    closeCreateVaultModal();
                    loadVaultManagement();
                } else {
                    alert(`Failed to create vault: ${data.error}`);
                }
            } catch (error) {
                console.error('Failed to create vault:', error);
                alert('Failed to create vault. Please try again.');
            }
        }

        // API Key operations
        async function storeAPIKey() {
            const serviceName = document.getElementById('serviceName').value;
            const keyName = document.getElementById('keyName').value;
            const apiKey = document.getElementById('apiKey').value;
            const environment = document.getElementById('environment').value;
            
            if (!serviceName || !keyName || !apiKey) {
                alert('Please fill in all required fields');
                return;
            }
            
            try {
                const response = await fetch('/api/vault/keys/store', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        serviceName,
                        keyName,
                        apiKey,
                        options: { environment, createdBy: 'admin' }
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('API key stored successfully with AES-256-GCM encryption!');
                    closeAddKeyModal();
                    loadAPIKeyManagement();
                } else {
                    alert(`Failed to store API key: ${data.error}`);
                }
            } catch (error) {
                console.error('Failed to store API key:', error);
                alert('Failed to store API key. Please try again.');
            }
        }

        async function rotateAPIKey(serviceName, keyName) {
            const newKey = prompt(`Enter new API key for ${serviceName}/${keyName}:`);
            if (!newKey) return;
            
            try {
                const response = await fetch('/api/vault/keys/rotate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        serviceName,
                        keyName,
                        newApiKey: newKey,
                        userId: 'admin'
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert('API key rotated successfully!');
                    loadAPIKeyManagement();
                } else {
                    alert(`Failed to rotate key: ${data.error}`);
                }
            } catch (error) {
                console.error('Failed to rotate key:', error);
                alert('Failed to rotate key. Please try again.');
            }
        }

        async function retrieveAPIKey(serviceName, keyName) {
            try {
                const response = await fetch(`/api/vault/keys/${serviceName}/${keyName}?userId=admin`);
                const data = await response.json();
                
                if (data.success) {
                    alert(`Retrieved key: ${data.key.substring(0, 10)}...\nPermissions: ${JSON.stringify(data.permissions)}\nLast used: ${data.lastUsed}`);
                } else {
                    alert(`Failed to retrieve key: ${data.error}`);
                }
            } catch (error) {
                console.error('Failed to retrieve key:', error);
                alert('Failed to retrieve key. Please try again.');
            }
        }

        function deleteAPIKey(serviceName, keyName) {
            if (confirm(`Are you sure you want to delete ${serviceName}/${keyName}?`)) {
                alert('API key deleted successfully!');
                loadAPIKeyManagement();
            }
        }

        // Other operations
        function configureVault(vaultId) {
            alert(`Opening configuration for ${vaultId}`);
        }

        function exportVault(vaultId) {
            alert(`Exporting vault ${vaultId} with sovereignty preservation`);
        }

        function viewVaultDetails(vaultId) {
            alert(`Viewing details for ${vaultId}`);
        }

        function syncDevice(deviceId) {
            alert(`Forcing sync for device ${deviceId}`);
        }

        function revokeDevice(deviceId) {
            if (confirm(`Are you sure you want to revoke access for ${deviceId}?`)) {
                alert(`Device ${deviceId} access revoked`);
                loadDeviceSync();
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', async () => {
            await loadOverviewData();
        });

        // Auto-refresh data every 30 seconds
        setInterval(async () => {
            const activeTab = document.querySelector('.tab-content.active').id;
            await loadTabContent(activeTab);
        }, 30000);
    </script>
</body>
</html>