<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚õìÔ∏è Web3 Metaverse Interface - On-Chain Activity Tracker</title>
    
    <!-- Web3 and Ethers.js -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Courier New', monospace;
            background: #0a0a0a;
            color: #00ff00;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            padding: 20px 0;
            border-bottom: 2px solid #00ff00;
            margin-bottom: 30px;
        }
        
        .header h1 {
            font-size: 2.5em;
            text-shadow: 0 0 20px #00ff00;
            margin-bottom: 10px;
        }
        
        .connection-panel {
            background: #1a1a1a;
            border: 1px solid #00ff00;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.2);
        }
        
        .status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ff0000;
            box-shadow: 0 0 10px currentColor;
        }
        
        .status-dot.connected {
            background: #00ff00;
        }
        
        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            font-family: inherit;
            transition: all 0.3s;
        }
        
        button:hover {
            background: #00cc00;
            box-shadow: 0 0 15px #00ff00;
            transform: translateY(-2px);
        }
        
        button:disabled {
            background: #333;
            color: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .panel {
            background: #1a1a1a;
            border: 1px solid #00ff00;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 20px rgba(0, 255, 0, 0.1);
        }
        
        .panel h2 {
            font-size: 1.5em;
            margin-bottom: 15px;
            color: #00ff00;
            text-shadow: 0 0 10px #00ff00;
        }
        
        .stat-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        
        .stat {
            background: #0a0a0a;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #333;
        }
        
        .stat-label {
            font-size: 0.8em;
            color: #888;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 1.2em;
            color: #00ff00;
            font-weight: bold;
        }
        
        .activity-feed {
            max-height: 400px;
            overflow-y: auto;
            background: #0a0a0a;
            border-radius: 5px;
            padding: 10px;
        }
        
        .activity-item {
            padding: 10px;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s;
        }
        
        .activity-item:hover {
            background: #1a1a1a;
        }
        
        .activity-type {
            font-size: 0.8em;
            padding: 2px 8px;
            border-radius: 3px;
            background: #333;
            color: #00ff00;
        }
        
        .duo-card {
            background: #0a0a0a;
            border: 1px solid #333;
            border-radius: 5px;
            padding: 15px;
            margin-bottom: 10px;
            transition: all 0.3s;
        }
        
        .duo-card:hover {
            border-color: #00ff00;
            box-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
        }
        
        .duo-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .duo-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            font-size: 0.9em;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #1a1a1a;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff00, #00cc00);
            transition: width 0.5s ease;
            box-shadow: 0 0 10px #00ff00;
        }
        
        .actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        input {
            flex: 1;
            padding: 10px;
            background: #0a0a0a;
            border: 1px solid #00ff00;
            border-radius: 5px;
            color: #00ff00;
            font-family: inherit;
        }
        
        input::placeholder {
            color: #666;
        }
        
        .transaction-log {
            font-size: 0.8em;
            background: #0a0a0a;
            padding: 10px;
            border-radius: 5px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 10px;
        }
        
        .tx-item {
            padding: 5px;
            border-bottom: 1px solid #222;
            word-break: break-all;
        }
        
        .tx-item a {
            color: #00ff00;
            text-decoration: none;
        }
        
        .tx-item a:hover {
            text-decoration: underline;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #333;
            border-top-color: #00ff00;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .error {
            background: #ff000020;
            border: 1px solid #ff0000;
            color: #ff6666;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .success {
            background: #00ff0020;
            border: 1px solid #00ff00;
            color: #00ff00;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .tab-container {
            margin-top: 30px;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid #333;
        }
        
        .tab {
            padding: 10px 20px;
            background: none;
            border: none;
            color: #888;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .tab.active {
            color: #00ff00;
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background: #00ff00;
            box-shadow: 0 0 10px #00ff00;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚õìÔ∏è Web3 Metaverse Interface</h1>
            <p>Real-time on-chain tracking for the sandbox metaverse</p>
        </div>
        
        <div class="connection-panel">
            <div class="status">
                <div class="status-dot" id="web3Status"></div>
                <span id="connectionStatus">Disconnected</span>
            </div>
            
            <div class="input-group">
                <input type="text" id="rpcUrl" placeholder="RPC URL (default: http://localhost:8545)" value="http://localhost:8545">
                <button onclick="connectWeb3()">Connect Web3</button>
                <button onclick="connectWallet()">Connect Wallet</button>
            </div>
            
            <div id="accountInfo" style="display: none;">
                <p>Account: <span id="accountAddress"></span></p>
                <p>Balance: <span id="accountBalance"></span> ETH</p>
                <p>Chain ID: <span id="chainId"></span></p>
            </div>
        </div>
        
        <div class="grid">
            <div class="panel">
                <h2>üåê World Statistics</h2>
                <div class="stat-grid">
                    <div class="stat">
                        <div class="stat-label">Total Buildings</div>
                        <div class="stat-value" id="totalBuildings">0</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Active Players</div>
                        <div class="stat-value" id="totalPlayers">0</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Duo Systems</div>
                        <div class="stat-value" id="totalDuos">0</div>
                    </div>
                    <div class="stat">
                        <div class="stat-label">Economy Supply</div>
                        <div class="stat-value" id="economySupply">0</div>
                    </div>
                </div>
                
                <div class="actions">
                    <button onclick="refreshWorldStats()">Refresh Stats</button>
                    <button onclick="registerPlayer()">Register Player</button>
                </div>
            </div>
            
            <div class="panel">
                <h2>üìä Player Status</h2>
                <div id="playerStats" style="display: none;">
                    <div class="stat-grid">
                        <div class="stat">
                            <div class="stat-label">Player ID</div>
                            <div class="stat-value" id="playerId">-</div>
                        </div>
                        <div class="stat">
                            <div class="stat-label">Resources</div>
                            <div class="stat-value" id="playerResources">0</div>
                        </div>
                        <div class="stat">
                            <div class="stat-label">Buildings Owned</div>
                            <div class="stat-value" id="playerBuildings">0</div>
                        </div>
                        <div class="stat">
                            <div class="stat-label">Premium Status</div>
                            <div class="stat-value" id="playerPremium">No</div>
                        </div>
                    </div>
                </div>
                
                <div id="noPlayerStats">
                    <p style="text-align: center; color: #666; padding: 20px;">
                        Connect wallet and register as player to see stats
                    </p>
                </div>
                
                <div class="actions">
                    <button onclick="refreshPlayerStats()" id="refreshPlayerBtn" disabled>Refresh</button>
                    <button onclick="claimResources()" id="claimResourcesBtn" disabled>Claim Daily Resources</button>
                </div>
            </div>
        </div>
        
        <div class="tab-container">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('activity')">üî• Live Activity</button>
                <button class="tab" onclick="switchTab('duos')">ü§ñ Duo Systems</button>
                <button class="tab" onclick="switchTab('buildings')">üèóÔ∏è Buildings</button>
                <button class="tab" onclick="switchTab('transactions')">üí∞ Transactions</button>
            </div>
            
            <div id="activity" class="tab-content active">
                <div class="panel">
                    <h2>üî• Live Blockchain Activity</h2>
                    <div class="activity-feed" id="activityFeed">
                        <p style="text-align: center; color: #666; padding: 20px;">
                            Waiting for blockchain events...
                        </p>
                    </div>
                </div>
            </div>
            
            <div id="duos" class="tab-content">
                <div class="panel">
                    <h2>ü§ñ Duo System Performance</h2>
                    
                    <div class="input-group">
                        <input type="text" id="duoIdInput" placeholder="Enter Duo ID to register">
                        <button onclick="registerDuo()">Register Duo</button>
                    </div>
                    
                    <div id="duoList">
                        <p style="text-align: center; color: #666; padding: 20px;">
                            No duo systems registered yet
                        </p>
                    </div>
                    
                    <div class="actions">
                        <button onclick="refreshDuoStats()">Refresh All Duos</button>
                        <button onclick="simulateVerification()">Simulate Verification</button>
                    </div>
                </div>
            </div>
            
            <div id="buildings" class="tab-content">
                <div class="panel">
                    <h2>üèóÔ∏è Building Management</h2>
                    
                    <div class="input-group">
                        <input type="number" id="buildX" placeholder="X" style="width: 100px;">
                        <input type="number" id="buildY" placeholder="Y" style="width: 100px;">
                        <input type="number" id="buildZ" placeholder="Z" style="width: 100px;">
                        <select id="buildType" style="padding: 10px; background: #0a0a0a; border: 1px solid #00ff00; color: #00ff00;">
                            <option value="house">House (100)</option>
                            <option value="tower">Tower (200)</option>
                            <option value="spawner">Spawner (150)</option>
                            <option value="farm">Farm (75)</option>
                        </select>
                        <button onclick="createBuilding()">Create Building</button>
                    </div>
                    
                    <div id="buildingList" style="max-height: 400px; overflow-y: auto;">
                        <p style="text-align: center; color: #666; padding: 20px;">
                            No buildings created yet
                        </p>
                    </div>
                </div>
            </div>
            
            <div id="transactions" class="tab-content">
                <div class="panel">
                    <h2>üí∞ Transaction Log</h2>
                    <div class="transaction-log" id="txLog">
                        <p style="text-align: center; color: #666; padding: 20px;">
                            No transactions yet
                        </p>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="messageContainer"></div>
    </div>
    
    <script>
        // Contract ABIs (simplified)
        const METAVERSE_REGISTRY_ABI = [
            "function registerPlayer(string memory playerId)",
            "function registerDuoSystem(string memory duoId)",
            "function createBuilding(string memory buildingId, int256 x, int256 y, int256 z, string memory buildingType, uint256 cost)",
            "function getWorldStats() view returns (uint256, uint256, uint256, uint256, uint256)",
            "function getPlayerStats(address player) view returns (string memory, uint256, uint256, uint256, uint256, bool)",
            "function getDuoStats(string memory duoId) view returns (address, uint256, uint256, uint256, bool, uint256)",
            "function transferResources(address to, uint256 amount, string memory reason)",
            "function recordDuoVerification(string memory duoId, uint256 verificationCount, uint256 successCount)",
            "event BuildingCreated(string indexed buildingId, address indexed owner, int256 x, int256 y, int256 z, string buildingType)",
            "event PlayerRegistered(address indexed wallet, string playerId, uint256 timestamp)",
            "event DuoSystemRegistered(string indexed duoId, address indexed operator, uint256 timestamp)",
            "event ResourcesTransferred(address indexed from, address indexed to, uint256 amount, string reason)",
            "event VerificationRecorded(string indexed duoId, uint256 count, uint256 successRate)"
        ];
        
        const DUO_TRACKER_ABI = [
            "function recordVerification(string memory duoId, uint256 scraperResults, uint256 validatorConfirms, uint256 dataVolume, uint256 gasUsed, string memory targetUrl, bool battlenetVerified)",
            "function getDuoPerformance(string memory duoId) view returns (uint256, uint256, uint256, uint256, uint256)",
            "function sendHeartbeat(string memory duoId)",
            "event VerificationRecorded(string indexed duoId, uint256 scraperResults, uint256 validatorConfirms, uint256 dataVolume, bool success)"
        ];
        
        // Contract addresses (update these with your deployed addresses)
        const CONTRACTS = {
            metaverseRegistry: "0x0000000000000000000000000000000000000001", // Update with actual address
            duoTracker: "0x0000000000000000000000000000000000000002" // Update with actual address
        };
        
        // Global variables
        let provider = null;
        let signer = null;
        let metaverseContract = null;
        let duoContract = null;
        let account = null;
        
        // Initialize
        async function connectWeb3() {
            try {
                showMessage('Connecting to Web3...', 'info');
                
                const rpcUrl = document.getElementById('rpcUrl').value || 'http://localhost:8545';
                
                // Create provider
                provider = new ethers.providers.JsonRpcProvider(rpcUrl);
                
                // Test connection
                const network = await provider.getNetwork();
                
                // Update UI
                document.getElementById('web3Status').classList.add('connected');
                document.getElementById('connectionStatus').textContent = `Connected to chain ${network.chainId}`;
                document.getElementById('chainId').textContent = network.chainId;
                
                // Initialize contracts
                metaverseContract = new ethers.Contract(
                    CONTRACTS.metaverseRegistry,
                    METAVERSE_REGISTRY_ABI,
                    provider
                );
                
                duoContract = new ethers.Contract(
                    CONTRACTS.duoTracker,
                    DUO_TRACKER_ABI,
                    provider
                );
                
                // Start listening to events
                listenToEvents();
                
                showMessage('Web3 connected successfully!', 'success');
                
                // Load initial data
                await refreshWorldStats();
                
            } catch (error) {
                console.error('Web3 connection error:', error);
                showMessage(`Failed to connect: ${error.message}`, 'error');
            }
        }
        
        async function connectWallet() {
            try {
                if (!window.ethereum) {
                    showMessage('MetaMask not found. Please install MetaMask!', 'error');
                    return;
                }
                
                showMessage('Connecting wallet...', 'info');
                
                // Request account access
                const accounts = await window.ethereum.request({ 
                    method: 'eth_requestAccounts' 
                });
                
                account = accounts[0];
                
                // Create provider and signer
                const web3Provider = new ethers.providers.Web3Provider(window.ethereum);
                signer = web3Provider.getSigner();
                
                // Update contracts with signer
                metaverseContract = new ethers.Contract(
                    CONTRACTS.metaverseRegistry,
                    METAVERSE_REGISTRY_ABI,
                    signer
                );
                
                duoContract = new ethers.Contract(
                    CONTRACTS.duoTracker,
                    DUO_TRACKER_ABI,
                    signer
                );
                
                // Update UI
                document.getElementById('accountInfo').style.display = 'block';
                document.getElementById('accountAddress').textContent = 
                    account.slice(0, 6) + '...' + account.slice(-4);
                
                // Get balance
                const balance = await web3Provider.getBalance(account);
                document.getElementById('accountBalance').textContent = 
                    ethers.utils.formatEther(balance);
                
                // Enable player actions
                document.getElementById('refreshPlayerBtn').disabled = false;
                document.getElementById('claimResourcesBtn').disabled = false;
                
                showMessage('Wallet connected!', 'success');
                
                // Load player stats
                await refreshPlayerStats();
                
            } catch (error) {
                console.error('Wallet connection error:', error);
                showMessage(`Failed to connect wallet: ${error.message}`, 'error');
            }
        }
        
        async function refreshWorldStats() {
            try {
                if (!metaverseContract) return;
                
                const stats = await metaverseContract.getWorldStats();
                
                document.getElementById('totalBuildings').textContent = stats[0].toString();
                document.getElementById('totalPlayers').textContent = stats[1].toString();
                document.getElementById('totalDuos').textContent = stats[2].toString();
                document.getElementById('economySupply').textContent = 
                    ethers.utils.formatEther(stats[3]);
                
            } catch (error) {
                console.error('Error fetching world stats:', error);
            }
        }
        
        async function refreshPlayerStats() {
            try {
                if (!metaverseContract || !account) return;
                
                const stats = await metaverseContract.getPlayerStats(account);
                
                if (stats[0]) { // Has player ID
                    document.getElementById('playerStats').style.display = 'block';
                    document.getElementById('noPlayerStats').style.display = 'none';
                    
                    document.getElementById('playerId').textContent = stats[0];
                    document.getElementById('playerResources').textContent = stats[1].toString();
                    document.getElementById('playerBuildings').textContent = stats[2].toString();
                    document.getElementById('playerPremium').textContent = stats[5] ? 'Yes' : 'No';
                }
                
            } catch (error) {
                console.error('Error fetching player stats:', error);
            }
        }
        
        async function registerPlayer() {
            try {
                if (!signer) {
                    showMessage('Please connect wallet first', 'error');
                    return;
                }
                
                const playerId = prompt('Enter your player ID:');
                if (!playerId) return;
                
                showMessage('Registering player...', 'info');
                
                const tx = await metaverseContract.registerPlayer(playerId);
                logTransaction(tx);
                
                await tx.wait();
                
                showMessage('Player registered successfully!', 'success');
                await refreshPlayerStats();
                await refreshWorldStats();
                
            } catch (error) {
                console.error('Registration error:', error);
                showMessage(`Registration failed: ${error.message}`, 'error');
            }
        }
        
        async function registerDuo() {
            try {
                if (!signer) {
                    showMessage('Please connect wallet first', 'error');
                    return;
                }
                
                const duoId = document.getElementById('duoIdInput').value;
                if (!duoId) {
                    showMessage('Please enter a Duo ID', 'error');
                    return;
                }
                
                showMessage('Registering duo system...', 'info');
                
                const tx = await metaverseContract.registerDuoSystem(duoId);
                logTransaction(tx);
                
                await tx.wait();
                
                showMessage('Duo system registered!', 'success');
                document.getElementById('duoIdInput').value = '';
                await refreshDuoStats();
                
            } catch (error) {
                console.error('Duo registration error:', error);
                showMessage(`Registration failed: ${error.message}`, 'error');
            }
        }
        
        async function createBuilding() {
            try {
                if (!signer) {
                    showMessage('Please connect wallet first', 'error');
                    return;
                }
                
                const x = parseInt(document.getElementById('buildX').value);
                const y = parseInt(document.getElementById('buildY').value);
                const z = parseInt(document.getElementById('buildZ').value);
                const type = document.getElementById('buildType').value;
                
                if (isNaN(x) || isNaN(y) || isNaN(z)) {
                    showMessage('Please enter valid coordinates', 'error');
                    return;
                }
                
                const costs = {
                    house: 100,
                    tower: 200,
                    spawner: 150,
                    farm: 75
                };
                
                const buildingId = `building_${Date.now()}`;
                
                showMessage('Creating building...', 'info');
                
                const tx = await metaverseContract.createBuilding(
                    buildingId, x, y, z, type, costs[type]
                );
                logTransaction(tx);
                
                await tx.wait();
                
                showMessage('Building created!', 'success');
                
                // Clear inputs
                document.getElementById('buildX').value = '';
                document.getElementById('buildY').value = '';
                document.getElementById('buildZ').value = '';
                
                await refreshPlayerStats();
                await refreshWorldStats();
                
            } catch (error) {
                console.error('Building creation error:', error);
                showMessage(`Building creation failed: ${error.message}`, 'error');
            }
        }
        
        async function simulateVerification() {
            try {
                if (!signer) {
                    showMessage('Please connect wallet first', 'error');
                    return;
                }
                
                const duoId = prompt('Enter Duo ID for verification:');
                if (!duoId) return;
                
                showMessage('Simulating verification...', 'info');
                
                // Random verification data
                const scraperResults = Math.floor(Math.random() * 100) + 50;
                const validatorConfirms = Math.floor(scraperResults * (0.8 + Math.random() * 0.2));
                const dataVolume = Math.floor(Math.random() * 10000) + 1000;
                const gasUsed = Math.floor(Math.random() * 100000) + 50000;
                
                const tx = await duoContract.recordVerification(
                    duoId,
                    scraperResults,
                    validatorConfirms,
                    dataVolume,
                    gasUsed,
                    "https://example.com/test",
                    Math.random() > 0.5
                );
                logTransaction(tx);
                
                await tx.wait();
                
                showMessage('Verification recorded!', 'success');
                await refreshDuoStats();
                
            } catch (error) {
                console.error('Verification error:', error);
                showMessage(`Verification failed: ${error.message}`, 'error');
            }
        }
        
        async function refreshDuoStats() {
            // This would fetch and display all registered duos
            // For now, just show a placeholder
            const duoList = document.getElementById('duoList');
            duoList.innerHTML = '<p style="color: #666; text-align: center;">Loading duo systems...</p>';
        }
        
        function listenToEvents() {
            if (!metaverseContract || !duoContract) return;
            
            // Listen to building events
            metaverseContract.on('BuildingCreated', (buildingId, owner, x, y, z, buildingType) => {
                addActivityItem({
                    type: 'building',
                    message: `New ${buildingType} at (${x}, ${y}, ${z})`,
                    owner: owner
                });
            });
            
            // Listen to player events
            metaverseContract.on('PlayerRegistered', (wallet, playerId, timestamp) => {
                addActivityItem({
                    type: 'player',
                    message: `Player "${playerId}" joined`,
                    owner: wallet
                });
            });
            
            // Listen to duo events
            metaverseContract.on('DuoSystemRegistered', (duoId, operator, timestamp) => {
                addActivityItem({
                    type: 'duo',
                    message: `Duo system "${duoId}" registered`,
                    owner: operator
                });
            });
            
            // Listen to verification events
            duoContract.on('VerificationRecorded', (duoId, scraperResults, validatorConfirms, dataVolume, success) => {
                addActivityItem({
                    type: 'verification',
                    message: `${duoId}: ${validatorConfirms}/${scraperResults} verified`,
                    success: success
                });
            });
        }
        
        function addActivityItem(data) {
            const feed = document.getElementById('activityFeed');
            
            // Clear placeholder if exists
            if (feed.querySelector('p')) {
                feed.innerHTML = '';
            }
            
            const item = document.createElement('div');
            item.className = 'activity-item';
            
            const time = new Date().toLocaleTimeString();
            
            item.innerHTML = `
                <div>
                    <span style="color: #666; font-size: 0.8em;">${time}</span>
                    <span>${data.message}</span>
                </div>
                <span class="activity-type">${data.type}</span>
            `;
            
            feed.insertBefore(item, feed.firstChild);
            
            // Keep only last 50 items
            while (feed.children.length > 50) {
                feed.removeChild(feed.lastChild);
            }
        }
        
        function logTransaction(tx) {
            const txLog = document.getElementById('txLog');
            
            // Clear placeholder if exists
            if (txLog.querySelector('p')) {
                txLog.innerHTML = '';
            }
            
            const item = document.createElement('div');
            item.className = 'tx-item';
            
            item.innerHTML = `
                <span style="color: #666;">${new Date().toLocaleTimeString()}</span>
                <a href="https://etherscan.io/tx/${tx.hash}" target="_blank">
                    ${tx.hash.slice(0, 10)}...${tx.hash.slice(-8)}
                </a>
            `;
            
            txLog.insertBefore(item, txLog.firstChild);
        }
        
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
        }
        
        function showMessage(message, type = 'info') {
            const container = document.getElementById('messageContainer');
            
            const div = document.createElement('div');
            div.className = type === 'error' ? 'error' : type === 'success' ? 'success' : '';
            div.textContent = message;
            
            container.appendChild(div);
            
            setTimeout(() => {
                div.remove();
            }, 5000);
        }
        
        async function claimResources() {
            showMessage('Daily resource claims coming soon!', 'info');
        }
        
        // Auto-connect on load
        window.addEventListener('load', () => {
            // Try to connect to local node
            setTimeout(connectWeb3, 1000);
        });
        
        // Listen for account changes
        if (window.ethereum) {
            window.ethereum.on('accountsChanged', (accounts) => {
                if (accounts.length === 0) {
                    account = null;
                    document.getElementById('accountInfo').style.display = 'none';
                } else {
                    account = accounts[0];
                    connectWallet();
                }
            });
        }
    </script>
</body>
</html>